[{"filePath":"C:\\Abraham-of-london\\Update in pages\\shorts\\[slug].tsx","messages":[{"ruleId":null,"fatal":true,"severity":2,"message":"Parsing error: '}' expected.","line":38,"column":32,"nodeType":null}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Update in pages/shorts/[slug].tsx\r\nconst ShortPage: NextPage<ShortPageProps> = ({ short }) => {\r\n  const MDXContent = useMDXComponent(short.body.code);\r\n  const {\r\n    likes,\r\n    saves,\r\n    userLiked,\r\n    userSaved,\r\n    loading,\r\n    handleLike,\r\n    handleSave,\r\n  } = useShortInteractions(short.slug);\r\n\r\n  // Debug logging\r\n  React.useEffect(() => {\r\n    console.log('Interaction state:', {\r\n      likes,\r\n      saves,\r\n      userLiked,\r\n      userSaved,\r\n      loading,\r\n      slug: short.slug,\r\n    });\r\n  }, [likes, saves, userLiked, userSaved, loading, short.slug]);\r\n\r\n  const handleLikeWithLog = () => {\r\n    console.log('Like clicked, current state:', { userLiked, loading });\r\n    handleLike();\r\n  };\r\n\r\n  const handleSaveWithLog = () => {\r\n    console.log('Save clicked, current state:', { userSaved, loading });\r\n    handleSave();\r\n  };\r\n\r\n  // Then in your JSX, update the buttons:\r\n  // onClick={handleLikeWithLog}\r\n  // onClick={handleSaveWithLog}","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\_tests_\\components\\Layout.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\app-archived\\books\\the-architecture-of-human-purpose-landing.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\app-archived\\components.app-disabled\\ThemeToggle.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\app-archived\\fonts-disabled\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\app-archived\\fonts.ts (or componentsfonts.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\app-archived\\layout.app-disabled.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\app-archived\\mdx-components.app-disabled.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\app-archived\\not-found.app-disabled.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\app-archived\\print-disabled\\[slug].tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\app-archived\\print-disabled\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\app-archived\\sitemap.app-disabled.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\app-archived\\strategy-disabled\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\app\\api\\downloads\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\app\\api\\hello\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\app\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\app\\robots.txt\\troute.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\AdminRevokeButton.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Trash2' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// components/AdminRevokeButton.tsx\r\n\r\nimport React, { useState } from 'react';\r\nimport { Trash2, ShieldAlert, Loader2 } from 'lucide-react';\r\n\r\ninterface RevokeProps {\r\n  accessKey: string; // The raw key or hash you wish to revoke\r\n}\r\n\r\nexport const AdminRevokeButton: React.FC<RevokeProps> = ({ accessKey }) => {\r\n  const [isConfirming, setIsConfirming] = useState(false);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const handleRevoke = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const res = await fetch('/api/inner-circle/revoke', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ \r\n          key: accessKey,\r\n          adminSecret: process.env.NEXT_PUBLIC_ADMIN_HINT // Ensure this matches your secure env setup\r\n        }),\r\n      });\r\n      if (res.ok) alert('Vault key has been neutralized.');\r\n    } finally {\r\n      setLoading(false);\r\n      setIsConfirming(false);\r\n    }\r\n  };\r\n\r\n  if (!isConfirming) {\r\n    return (\r\n      <button \r\n        onClick={() => setIsConfirming(true)}\r\n        className=\"flex items-center gap-2 px-3 py-1 text-sm font-medium text-red-600 hover:bg-red-50 rounded-md transition-colors\"\r\n      >\r\n        <ShieldAlert className=\"w-4 h-4\" /> Revoke Access\r\n      </button>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex items-center gap-2\">\r\n      <span className=\"text-xs font-bold text-red-600 animate-pulse uppercase\">Are you sure?</span>\r\n      <button \r\n        onClick={handleRevoke}\r\n        disabled={loading}\r\n        className=\"bg-red-600 text-white px-3 py-1 rounded text-xs hover:bg-red-700 disabled:opacity-50\"\r\n      >\r\n        {loading ? <Loader2 className=\"w-3 h-3 animate-spin\" /> : 'Confirm Revoke'}\r\n      </button>\r\n      <button onClick={() => setIsConfirming(false)} className=\"text-xs text-neutral-500\">Cancel</button>\r\n    </div>\r\n  );\r\n};","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\AnimatedContentGrid.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\AnimatedCounter.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\Article.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\ArticleHero.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\BlogPostCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\BookCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\BookHero.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\BrandFrame.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\Breadcrumb.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\Button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\CTA.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":68,"column":18,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[2448,2507],"text":"\n              Let&apos;s build something enduring.\n            "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[2448,2507],"text":"\n              Let&lsquo;s build something enduring.\n            "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[2448,2507],"text":"\n              Let&#39;s build something enduring.\n            "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[2448,2507],"text":"\n              Let&rsquo;s build something enduring.\n            "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// components/CTA.tsx\nimport Link from \"next/link\";\nimport { useEffect, useState } from \"react\";\n\ntype Props = {\n  /** show the pill on small screens (default true) */\n  floatingOnMobile?: boolean;\n};\n\nexport default function CTA({ floatingOnMobile = true }: Props) {\n  const [hasSafeArea, setHasSafeArea] = useState(false);\n\n  useEffect(() => {\n    // Check for iOS safe area support\n    if (typeof window !== \"undefined\") {\n      const safeAreaTest = getComputedStyle(\n        document.documentElement\n      ).getPropertyValue(\"--satest\");\n      setHasSafeArea(!!safeAreaTest);\n    }\n  }, []);\n\n  const Pill = (\n    <div className=\"flex items-center gap-3\">\n      <a\n        href=\"tel:+442086225909\"\n        aria-label=\"Call +44 208 622 5909\"\n        className=\"grid h-12 w-12 place-items-center rounded-full border border-black/10 bg-white text-emerald-700 shadow ring-1 ring-black/5 transition-colors hover:bg-emerald-50\"\n      >\n        <svg\n          width=\"20\"\n          height=\"20\"\n          viewBox=\"0 0 24 24\"\n          fill=\"none\"\n          aria-hidden=\"true\"\n        >\n          <path\n            d=\"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6A19.79 19.79 0 0 1 2.08 4.18 2 2 0 0 1 4.06 2h3a2 2 0 0 1 2 1.72c.12.9.3 1.77.55 2.61a2 2 0 0 1-.45 2.11L8 9a16 16 0 0 0 7 7l.56-1.16a2 2 0 0 1 2.11-.45c.84.25 1.71.43 2.61.55A2 2 0 0 1 22 16.92Z\"\n            stroke=\"currentColor\"\n            strokeWidth=\"2\"\n          />\n        </svg>\n      </a>\n\n      <Link\n        href=\"/contact\"\n        className=\"rounded-full bg-emerald-600 px-5 py-3 text-sm font-semibold text-white shadow hover:bg-emerald-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-400 transition-colors\"\n      >\n        Work With Me\n      </Link>\n\n      <Link\n        href=\"/#newsletter\"\n        className=\"rounded-full border border-black/10 bg-white px-5 py-3 text-sm font-semibold text-slate-800 shadow hover:bg-slate-50 focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-400 transition-colors\"\n      >\n        Subscribe\n      </Link>\n    </div>\n  );\n\n  return (\n    <>\n      {/* Desktop inline */}\n      <div className=\"hidden md:block\">\n        <div className=\"mx-auto max-w-5xl rounded-2xl border border-black/5 bg-white/80 px-6 py-4 backdrop-blur shadow ring-1 ring-black/5\">\n          <div className=\"flex items-center justify-between gap-6\">\n            <p className=\"text-slate-800 font-medium\">\n              Let's build something enduring.\n            </p>\n            {Pill}\n          </div>\n        </div>\n      </div>\n\n      {/* Mobile floating pill */}\n      {floatingOnMobile && (\n        <div\n          className=\"fixed inset-x-4 bottom-4 z-40 md:hidden\"\n          style={\n            hasSafeArea\n              ? { paddingBottom: \"max(env(safe-area-inset-bottom), 1rem)\" }\n              : undefined\n          }\n        >\n          <div className=\"rounded-2xl border border-black/10 bg-white/95 p-3 shadow-xl ring-1 ring-black/5 backdrop-blur\">\n            {Pill}\n          </div>\n        </div>\n      )}\n    </>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\Callout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\CanonCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\CanonInvocation.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\CanonReference.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\Cards\\ArticleHero.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\Cards\\BaseCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\Cards\\BlogPostCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\Cards\\BookCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\Cards\\CanonPrimaryCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\Cards\\CanonResourceCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\Cards\\getCardPropsForDocument.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\Cards\\index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\Cards\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\Cards\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\Comments.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook React.useCallback has an unnecessary dependency: 'retryCount'. Either exclude it or remove the dependency array.","line":183,"column":5,"nodeType":"ArrayExpression","endLine":192,"endColumn":6,"suggestions":[{"desc":"Update the dependencies array to be: [repo, issueTerm, label, computeInitialTheme, isRepoValid, pollMs, timeoutMs]","fix":{"range":[6262,6456],"text":"[repo, issueTerm, label, computeInitialTheme, isRepoValid, pollMs, timeoutMs]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport * as React from \"react\";\nimport { usePathname, useSearchParams } from \"next/navigation\";\nimport {\n  RefreshCw,\n  MessageCircle,\n  AlertCircle,\n  CheckCircle,\n} from \"lucide-react\";\n\ntype IssueTerm = \"pathname\" | \"url\" | \"title\" | \"og:title\" | (string & {});\n\ntype CommentsProps = {\n  /** The GitHub repository path for Utterances comments, e.g., \"owner/repo\". */\n  repo?: string;\n  /** Determines how the GitHub issue is linked, e.g., \"pathname\" (default) or \"title\". */\n  issueTerm?: IssueTerm;\n  /** Optional GitHub Issues label to apply to new comments/issues. */\n  label?: string;\n  /** If true, theme syncs dynamically using the <html class=\"dark\"> marker. */\n  useClassDarkMode?: boolean;\n  /** Margin for lazy-mounting the comments iframe (Intersection Observer rootMargin). */\n  rootMargin?: string;\n  /** Threshold for lazy-mounting (Intersection Observer threshold). */\n  threshold?: number;\n  className?: string;\n  /** Maximum time to wait before declaring comment load failure (ms). Default 10000. */\n  timeoutMs?: number;\n  /** Polling frequency for checking if the iframe has rendered (ms). Default 250. */\n  pollMs?: number;\n  /** Enable retry functionality for failed loads */\n  enableRetry?: boolean;\n  /** Custom placeholder while loading */\n  placeholder?: React.ReactNode;\n};\n\nconst UTTERANCES_ORIGIN = \"https://utteranc.es\";\nconst IFRAME_SELECTOR = \"iframe.utterances-frame\";\n\n// Allow override via environment variable, defaulting to the specified repository.\nconst DEFAULT_REPO =\n  (process.env.NEXT_PUBLIC_UTTERANCES_REPO as string | undefined) ??\n  \"AbrahamofLondon/abrahamoflondon-comments\";\n\nexport default function Comments({\n  repo = DEFAULT_REPO,\n  issueTerm = \"pathname\",\n  label,\n  useClassDarkMode = true,\n  rootMargin = \"200px\",\n  threshold = 0.1,\n  className,\n  timeoutMs = 10_000,\n  pollMs = 250,\n  enableRetry = true,\n  placeholder,\n}: CommentsProps) {\n  const pathname = usePathname();\n  const searchParams = useSearchParams();\n  const containerRef = React.useRef<HTMLDivElement | null>(null);\n  const [loading, setLoading] = React.useState(true);\n  const [error, setError] = React.useState<string | null>(null);\n  const [readyToMount, setReadyToMount] = React.useState(false);\n  const [retryCount, setRetryCount] = React.useState(0);\n  const [success, setSuccess] = React.useState(false);\n\n  // Create a stable key for the current page that includes query params\n  const pageKey = React.useMemo(() => {\n    return searchParams.toString() ? `${pathname}?${searchParams}` : pathname;\n  }, [pathname, searchParams]);\n\n  // Validate repo format upfront to fail fast.\n  const isRepoValid = React.useMemo(() => /^[^/]+\\/[^/]+$/.test(repo), [repo]);\n\n  /** Computes the initial theme setting for the Utterances script tag. */\n  const computeInitialTheme = React.useCallback((): string => {\n    if (typeof document === \"undefined\") return \"preferred-color-scheme\";\n\n    if (useClassDarkMode) {\n      const isDark = document.documentElement.classList.contains(\"dark\");\n      return isDark ? \"github-dark\" : \"github-light\";\n    }\n    return \"preferred-color-scheme\";\n  }, [useClassDarkMode]);\n\n  /** Posts a theme update message directly to the Utterances iframe. */\n  const postThemeToIframe = React.useCallback((theme: string) => {\n    try {\n      const frame =\n        containerRef.current?.querySelector<HTMLIFrameElement>(IFRAME_SELECTOR);\n      frame?.contentWindow?.postMessage(\n        { type: \"set-theme\", theme },\n        UTTERANCES_ORIGIN\n      );\n    } catch {\n      // Ignore errors if the iframe is not fully ready.\n    }\n  }, []);\n\n  /** Retry loading comments */\n  const handleRetry = React.useCallback(() => {\n    setError(null);\n    setLoading(true);\n    setRetryCount((prev) => prev + 1);\n    // Force remount by resetting readyToMount\n    setReadyToMount(false);\n    setTimeout(() => setReadyToMount(true), 100);\n  }, []);\n\n  /** Dynamically mounts the Utterances script into the host element. */\n  const mountUtterances = React.useCallback(\n    (host: HTMLDivElement | null | undefined) => {\n      if (!host) return () => {};\n\n      // Check repo validity before attempting to mount\n      if (!isRepoValid) {\n        setError(\n          'Invalid \"repo\" format. Use \"owner/repo\", e.g. \"AbrahamofLondon/abrahamoflondon-comments\".'\n        );\n        setLoading(false);\n        return () => {};\n      }\n\n      // Ensure container is clean before appending script\n      while (host.firstChild) host.removeChild(host.firstChild);\n\n      setLoading(true);\n      setError(null);\n      setSuccess(false);\n\n      const script = document.createElement(\"script\");\n      script.src = `${UTTERANCES_ORIGIN}/client.js`;\n      script.async = true;\n      script.crossOrigin = \"anonymous\";\n      script.setAttribute(\"repo\", repo);\n      script.setAttribute(\"issue-term\", issueTerm);\n      if (label?.trim()) script.setAttribute(\"label\", label.trim());\n      script.setAttribute(\"theme\", computeInitialTheme());\n\n      // Error handling for script loading failure\n      const onError = () => {\n        setError(\n          \"Comments failed to load. Ensure the repo exists (public), Issues are enabled, and the Utterances app has access.\"\n        );\n        setLoading(false);\n        setSuccess(false);\n      };\n\n      script.addEventListener(\"error\", onError);\n      host.appendChild(script);\n\n      // Polling to detect successful iframe load\n      const pollId = window.setInterval(\n        () => {\n          const hasFrame = !!host.querySelector(IFRAME_SELECTOR);\n          if (hasFrame) {\n            window.clearInterval(pollId);\n            setLoading(false);\n            setSuccess(true);\n            setError(null);\n          }\n        },\n        Math.max(50, pollMs)\n      );\n\n      // Timeout to declare load failure if iframe never appears\n      const timeoutId = window.setTimeout(\n        () => {\n          const hasFrame = !!host.querySelector(IFRAME_SELECTOR);\n          if (!hasFrame) onError();\n        },\n        Math.max(1000, timeoutMs)\n      );\n\n      // Cleanup function to stop timers and remove event listeners\n      return () => {\n        script.removeEventListener(\"error\", onError);\n        window.clearInterval(pollId);\n        window.clearTimeout(timeoutId);\n      };\n    },\n    [\n      repo,\n      issueTerm,\n      label,\n      computeInitialTheme,\n      isRepoValid,\n      pollMs,\n      timeoutMs,\n      retryCount, // Include retryCount to trigger remount on retry\n    ]\n  );\n\n  // Lazy loading logic (Intersection Observer)\n  React.useEffect(() => {\n    if (typeof window === \"undefined\" || readyToMount) return;\n\n    const host = containerRef.current;\n    if (!host) return;\n\n    // Check if already in view (for pages that load quickly)\n    const rect = host.getBoundingClientRect();\n    const inView = rect.top < window.innerHeight && rect.bottom >= 0;\n    if (inView) {\n      setReadyToMount(true);\n      return;\n    }\n\n    // Set up Intersection Observer for lazy loading\n    const io = new IntersectionObserver(\n      (entries) => {\n        if (entries.some((e) => e.isIntersecting)) {\n          setReadyToMount(true);\n          io.disconnect();\n        }\n      },\n      { root: null, rootMargin, threshold }\n    );\n    io.observe(host);\n    return () => io.disconnect();\n  }, [readyToMount, rootMargin, threshold]);\n\n  // Mount/Remount logic\n  React.useEffect(() => {\n    if (!readyToMount) return;\n    const host = containerRef.current;\n    const cleanup = mountUtterances(host);\n    return () => {\n      cleanup?.();\n      if (host) while (host.firstChild) host.removeChild(host.firstChild);\n    };\n  }, [readyToMount, mountUtterances, pageKey]); // Use pageKey instead of router.asPath\n\n  // Dynamic theme syncing\n  React.useEffect(() => {\n    if (typeof window === \"undefined\") return;\n\n    let mqCleanup: (() => void) | null = null;\n    let classObserver: MutationObserver | null = null;\n    let raf = 0;\n\n    const scheduleThemeUpdate = (isDark: boolean) => {\n      cancelAnimationFrame(raf);\n      raf = requestAnimationFrame(() => {\n        postThemeToIframe(isDark ? \"github-dark\" : \"github-light\");\n      });\n    };\n\n    if (useClassDarkMode) {\n      classObserver = new MutationObserver(() => {\n        const isDark = document.documentElement.classList.contains(\"dark\");\n        scheduleThemeUpdate(isDark);\n      });\n      classObserver.observe(document.documentElement, {\n        attributes: true,\n        attributeFilter: [\"class\"],\n      });\n      scheduleThemeUpdate(document.documentElement.classList.contains(\"dark\"));\n    } else if (window.matchMedia) {\n      const mql = window.matchMedia(\"(prefers-color-scheme: dark)\");\n      const onChange = () => scheduleThemeUpdate(mql.matches);\n\n      mql.addEventListener?.(\"change\", onChange);\n\n      if (\n        \"addListener\" in mql &&\n        typeof (mql as { addListener?: unknown }).addListener === \"function\"\n      ) {\n        (\n          mql as {\n            addListener: (\n              callback: (this: MediaQueryList, ev: MediaQueryListEvent) => void\n            ) => void;\n          }\n        ).addListener(onChange);\n      }\n\n      mqCleanup = () => {\n        mql.removeEventListener?.(\"change\", onChange);\n        if (\n          \"removeListener\" in mql &&\n          typeof (mql as { removeListener?: unknown }).removeListener ===\n            \"function\"\n        ) {\n          (\n            mql as {\n              removeListener: (\n                callback: (\n                  this: MediaQueryList,\n                  ev: MediaQueryListEvent\n                ) => void\n              ) => void;\n            }\n          ).removeListener(onChange);\n        }\n      };\n\n      scheduleThemeUpdate(mql.matches);\n    }\n\n    return () => {\n      classObserver?.disconnect();\n      mqCleanup?.();\n      cancelAnimationFrame(raf);\n    };\n  }, [useClassDarkMode, postThemeToIframe]);\n\n  // Default placeholder component\n  const defaultPlaceholder = (\n    <div className=\"flex items-center justify-center py-12\">\n      <div className=\"flex items-center space-x-3 text-aol-muted\">\n        <RefreshCw className=\"h-5 w-5 animate-spin\" />\n        <span className=\"text-sm font-medium\">Loading comments...</span>\n      </div>\n    </div>\n  );\n\n  return (\n    <section\n      aria-labelledby=\"comments-title\"\n      className={[\n        \"mt-16 rounded-lg border border-aol-border bg-white dark:bg-aol-dark dark:border-aol-dark-border\",\n        \"shadow-sm transition-all duration-200\",\n        className || \"\",\n      ]\n        .join(\" \")\n        .trim()}\n    >\n      <div className=\"px-6 py-4 border-b border-aol-border dark:border-aol-dark-border\">\n        <h2\n          id=\"comments-title\"\n          className=\"text-lg font-semibold text-aol-text dark:text-aol-dark-text flex items-center gap-2\"\n        >\n          <MessageCircle className=\"h-5 w-5\" />\n          Comments\n        </h2>\n        <p className=\"text-sm text-aol-muted mt-1\">\n          Join the discussion using GitHub issues\n        </p>\n      </div>\n\n      <div\n        key={pageKey}\n        ref={containerRef}\n        className=\"min-h-[200px] transition-opacity duration-300\"\n      />\n\n      {/* Loading State */}\n      {loading && !error && (\n        <div className=\"px-6 py-8\">{placeholder || defaultPlaceholder}</div>\n      )}\n\n      {/* Error State */}\n      {error && (\n        <div className=\"px-6 py-8 text-center\">\n          <div className=\"max-w-md mx-auto\">\n            <AlertCircle className=\"h-12 w-12 text-red-500 mx-auto mb-4\" />\n            <h3 className=\"text-lg font-medium text-aol-text dark:text-aol-dark-text mb-2\">\n              Unable to load comments\n            </h3>\n            <p className=\"text-aol-muted text-sm mb-4\">{error}</p>\n            {enableRetry && (\n              <button\n                onClick={handleRetry}\n                className=\"inline-flex items-center gap-2 px-4 py-2 bg-aol-primary text-white rounded-md hover:bg-aol-primary-dark transition-colors text-sm font-medium\"\n              >\n                <RefreshCw className=\"h-4 w-4\" />\n                Try Again\n              </button>\n            )}\n          </div>\n        </div>\n      )}\n\n      {/* Success State Indicator */}\n      {success && !loading && (\n        <div className=\"px-6 py-3 bg-green-50 dark:bg-green-900/20 border-t border-green-200 dark:border-green-800\">\n          <div className=\"flex items-center gap-2 text-green-700 dark:text-green-400 text-sm\">\n            <CheckCircle className=\"h-4 w-4\" />\n            Comments loaded successfully\n          </div>\n        </div>\n      )}\n\n      <noscript>\n        <div className=\"px-6 py-4 bg-amber-50 dark:bg-amber-900/20 border-t border-amber-200 dark:border-amber-800\">\n          <p className=\"text-amber-800 dark:text-amber-400 text-sm flex items-center gap-2\">\n            <AlertCircle className=\"h-4 w-4\" />\n            Comments require JavaScript. Please enable it to view and post.\n          </p>\n        </div>\n      </noscript>\n    </section>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\CommentsSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\ContactForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\ContentCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\ContentPageTemplate.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\ContentPortal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'index' is defined but never used. Allowed unused args must match /^_/u.","line":352,"column":41,"nodeType":null,"messageId":"unusedVar","endLine":352,"endColumn":46}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport * as React from 'react';\r\nimport Link from 'next/link';\r\nimport { useRouter } from 'next/router';\r\nimport { ChevronDownIcon } from '@heroicons/react/24/outline';\r\nimport { BaseCard } from '@/components/Cards';\r\n\r\n// Define Category type locally (no Contentlayer dependency yet)\r\ninterface Category {\r\n  id: string;\r\n  title: string;\r\n  description: string;\r\n  icon: string;\r\n  color: string;\r\n  count: number;\r\n  signal: { subtle: string; texture: string };\r\n}\r\n\r\nexport function ContentPortal() {\r\n  const router = useRouter();\r\n  const [categories, setCategories] = React.useState<Category[]>([]);\r\n  const [hoveredCategory, setHoveredCategory] = React.useState<string | null>(null);\r\n  const [isLoaded, setIsLoaded] = React.useState(false);\r\n  const [mousePosition, setMousePosition] = React.useState({ x: 0, y: 0 });\r\n\r\n  React.useEffect(() => {\r\n    // Keep mock data for now (safe)\r\n    const mockCategories: Category[] = [\r\n      {\r\n        id: 'strategic-insights',\r\n        title: 'Strategic Insights',\r\n        description: 'Architectural thinking for complex systems',\r\n        icon: 'â†—',\r\n        color: '#d4af37',\r\n        count: 24,\r\n        signal: { subtle: 'Structural principles for decision-making', texture: 'architectural' },\r\n      },\r\n      {\r\n        id: 'curated-volumes',\r\n        title: 'Curated Volumes',\r\n        description: 'Complete frameworks in bound form',\r\n        icon: 'ðŸ“š',\r\n        color: '#b8941f',\r\n        count: 12,\r\n        signal: { subtle: 'Comprehensive architectural systems', texture: 'bound' },\r\n      },\r\n      {\r\n        id: 'execution-tools',\r\n        title: 'Execution Tools',\r\n        description: 'Instruments for implementation',\r\n        icon: 'âš™',\r\n        color: '#9c7c1a',\r\n        count: 18,\r\n        signal: { subtle: 'Applied architectural instruments', texture: 'instrument' },\r\n      },\r\n      {\r\n        id: 'scholarly-gatherings',\r\n        title: 'Scholarly Gatherings',\r\n        description: 'Live architectural discourse',\r\n        icon: 'ð“‡¯',\r\n        color: '#806515',\r\n        count: 8,\r\n        signal: { subtle: 'Live structural conversations', texture: 'gathering' },\r\n      },\r\n      {\r\n        id: 'print-editions',\r\n        title: 'Print Editions',\r\n        description: 'Physical manifestations of structure',\r\n        icon: 'ð“¯',\r\n        color: '#645010',\r\n        count: 6,\r\n        signal: { subtle: 'Tactile architectural expressions', texture: 'physical' },\r\n      },\r\n      {\r\n        id: 'scholars-toolkit',\r\n        title: 'Scholar\\'s Toolkit',\r\n        description: 'Supplementary structural materials',\r\n        icon: 'â˜¿',\r\n        color: '#48390b',\r\n        count: 14,\r\n        signal: { subtle: 'Auxiliary structural components', texture: 'supplementary' },\r\n      }\r\n    ];\r\n    \r\n    setCategories(mockCategories);\r\n    \r\n    // Animation delay\r\n    const timer = setTimeout(() => setIsLoaded(true), 100);\r\n    \r\n    return () => clearTimeout(timer);\r\n  }, []);\r\n\r\n  React.useEffect(() => {\r\n    const handleMouseMove = (e: MouseEvent) => {\r\n      setMousePosition({ x: e.clientX, y: e.clientY });\r\n    };\r\n\r\n    window.addEventListener('mousemove', handleMouseMove);\r\n    \r\n    return () => {\r\n      window.removeEventListener('mousemove', handleMouseMove);\r\n    };\r\n  }, []);\r\n\r\n  const handleCategoryClick = async (categoryId: string) => {\r\n    try {\r\n      router.push(`/content?category=${categoryId}`);\r\n    } catch (error) {\r\n      console.error('Navigation error:', error);\r\n      // Fallback to direct navigation\r\n      window.location.href = `/content?category=${categoryId}`;\r\n    }\r\n  };\r\n\r\n  const getHoveredCategory = () => {\r\n    return categories.find(cat => cat.id === hoveredCategory);\r\n  };\r\n\r\n  const hoveredCategoryData = getHoveredCategory();\r\n\r\n  // Mock featured content data\r\n  const featuredContent = [\r\n    {\r\n      slug: 'architectural-framework-v1',\r\n      title: 'Architectural Framework v1.0',\r\n      description: 'A comprehensive system for structural decision-making with adaptive governance layers',\r\n      category: 'Strategic Insights',\r\n      date: '2024-01-15',\r\n      readingTime: '12 min',\r\n      tags: ['Strategic', 'Framework', 'Governance'],\r\n      featured: true,\r\n      isNew: true,\r\n      coverImage: '/images/framework-cover.jpg',\r\n    },\r\n    {\r\n      slug: 'bound-volumes-guide',\r\n      title: 'Bound Volumes: Curator\\'s Guide',\r\n      description: 'Complete methodologies for compiling and structuring archival knowledge systems',\r\n      category: 'Curated Volumes',\r\n      date: '2024-01-10',\r\n      readingTime: '8 min',\r\n      tags: ['Archival', 'Methodology', 'Systems'],\r\n      featured: true,\r\n      isNew: false,\r\n      coverImage: '/images/volumes-cover.jpg',\r\n    },\r\n    {\r\n      slug: 'execution-instruments',\r\n      title: 'Execution Instruments Toolkit',\r\n      description: 'Practical tools and instruments for implementing architectural decisions',\r\n      category: 'Execution Tools',\r\n      date: '2024-01-05',\r\n      readingTime: '6 min',\r\n      tags: ['Tools', 'Implementation', 'Practical'],\r\n      featured: true,\r\n      isNew: false,\r\n      coverImage: '/images/tools-cover.jpg',\r\n    },\r\n  ];\r\n\r\n  return (\r\n    <div className=\"relative min-h-screen overflow-hidden\">\r\n      {/* Background grid with parallax effect */}\r\n      <div \r\n        className=\"absolute inset-0 bg-gradient-to-br from-stone-50 via-amber-50/20 to-stone-50\"\r\n        style={{\r\n          backgroundImage: `\r\n            radial-gradient(circle at 25% 25%, rgba(212, 175, 55, 0.03) 0%, transparent 50%),\r\n            radial-gradient(circle at 75% 75%, rgba(184, 148, 31, 0.03) 0%, transparent 50%),\r\n            linear-gradient(45deg, transparent 49%, rgba(212, 175, 55, 0.05) 49%, rgba(212, 175, 55, 0.05) 51%, transparent 51%),\r\n            linear-gradient(-45deg, transparent 49%, rgba(184, 148, 31, 0.05) 49%, rgba(184, 148, 31, 0.05) 51%, transparent 51%)\r\n          `,\r\n          backgroundSize: '100px 100px, 100px 100px, 20px 20px, 20px 20px',\r\n          transform: `translate(${mousePosition.x * 0.01}px, ${mousePosition.y * 0.01}px)`\r\n        }}\r\n      />\r\n\r\n      {/* Decorative corner accents */}\r\n      <div className=\"absolute top-0 left-0 w-64 h-64 border-t-2 border-l-2 border-amber-900/10\" />\r\n      <div className=\"absolute bottom-0 right-0 w-64 h-64 border-b-2 border-r-2 border-amber-900/10\" />\r\n\r\n      <div className=\"container relative mx-auto px-4 py-16 md:py-24\">\r\n        {/* Header */}\r\n        <div className=\"text-center mb-16 md:mb-24\">\r\n          <div className=\"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-amber-900/5 border border-amber-900/10 mb-6\">\r\n            <span className=\"text-amber-900/60 text-sm font-medium\">Content Portal</span>\r\n            <span className=\"text-amber-900/40\">â€¢</span>\r\n            <span className=\"text-amber-900/40 text-sm\">Structural Access</span>\r\n          </div>\r\n          \r\n          <h1 className=\"text-4xl md:text-6xl font-serif font-light text-stone-900 mb-6\">\r\n            Architectural <span className=\"italic\">Intelligence</span> Repository\r\n          </h1>\r\n          \r\n          <p className=\"text-lg md:text-xl text-stone-600 max-w-3xl mx-auto leading-relaxed\">\r\n            A curated collection of structural frameworks, strategic instruments, \r\n            and scholarly materials for architectural thought and execution.\r\n          </p>\r\n        </div>\r\n\r\n        {/* Categories Grid */}\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-16\">\r\n          {categories.map((category, index) => (\r\n            <button\r\n              key={category.id}\r\n              onClick={() => handleCategoryClick(category.id)}\r\n              onMouseEnter={() => setHoveredCategory(category.id)}\r\n              onMouseLeave={() => setHoveredCategory(null)}\r\n              className={`\r\n                group relative p-6 rounded-2xl border-2 transition-all duration-500\r\n                ${isLoaded ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-4'}\r\n                hover:shadow-2xl hover:scale-[1.02] active:scale-[0.98]\r\n                ${hoveredCategory === category.id \r\n                  ? 'border-amber-900/30 bg-white shadow-xl' \r\n                  : 'border-amber-900/10 bg-white/50 hover:border-amber-900/20'\r\n                }\r\n              `}\r\n              style={{ \r\n                transitionDelay: `${index * 100}ms`,\r\n                borderColor: hoveredCategory === category.id ? `${category.color}40` : undefined\r\n              }}\r\n            >\r\n              {/* Background glow effect */}\r\n              <div \r\n                className=\"absolute inset-0 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-500\"\r\n                style={{ \r\n                  background: `radial-gradient(circle at center, ${category.color}15 0%, transparent 70%)`,\r\n                }}\r\n              />\r\n\r\n              <div className=\"relative z-10\">\r\n                <div className=\"flex items-center justify-between mb-4\">\r\n                  <div \r\n                    className=\"w-12 h-12 rounded-xl flex items-center justify-center text-2xl transition-transform duration-300 group-hover:scale-110\"\r\n                    style={{ \r\n                      backgroundColor: `${category.color}15`,\r\n                      color: category.color,\r\n                      border: `1px solid ${category.color}20`\r\n                    }}\r\n                  >\r\n                    {category.icon}\r\n                  </div>\r\n                  <span \r\n                    className=\"text-sm font-medium px-3 py-1 rounded-full\"\r\n                    style={{ \r\n                      backgroundColor: `${category.color}10`,\r\n                      color: category.color\r\n                    }}\r\n                  >\r\n                    {category.count} entries\r\n                  </span>\r\n                </div>\r\n\r\n                <h3 className=\"text-xl font-serif font-medium text-stone-900 mb-2 group-hover:text-amber-900 transition-colors\">\r\n                  {category.title}\r\n                </h3>\r\n                \r\n                <p className=\"text-stone-600 mb-4 leading-relaxed\">\r\n                  {category.description}\r\n                </p>\r\n\r\n                <div className=\"flex items-center text-sm text-stone-500\">\r\n                  <span className=\"mr-2\">Access â†’</span>\r\n                  <ChevronDownIcon className=\"w-4 h-4 transform group-hover:translate-y-1 transition-transform\" />\r\n                </div>\r\n              </div>\r\n            </button>\r\n          ))}\r\n        </div>\r\n\r\n        {/* Hover Preview Panel */}\r\n        {hoveredCategoryData && (\r\n          <div \r\n            className={`\r\n              fixed bottom-8 left-1/2 transform -translate-x-1/2\r\n              w-full max-w-4xl px-4 z-40 transition-all duration-500\r\n              ${hoveredCategory ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-4'}\r\n            `}\r\n          >\r\n            <div className=\"bg-white/90 backdrop-blur-xl rounded-2xl border border-amber-900/10 shadow-2xl p-6\">\r\n              <div className=\"flex items-start gap-4\">\r\n                <div \r\n                  className=\"w-16 h-16 rounded-xl flex items-center justify-center text-3xl flex-shrink-0\"\r\n                  style={{ \r\n                    backgroundColor: `${hoveredCategoryData.color}15`,\r\n                    color: hoveredCategoryData.color,\r\n                    border: `2px solid ${hoveredCategoryData.color}20`\r\n                  }}\r\n                >\r\n                  {hoveredCategoryData.icon}\r\n                </div>\r\n                \r\n                <div className=\"flex-1\">\r\n                  <div className=\"flex items-center justify-between mb-2\">\r\n                    <h3 className=\"text-2xl font-serif font-medium text-stone-900\">\r\n                      {hoveredCategoryData.title}\r\n                    </h3>\r\n                    <span \r\n                      className=\"text-sm font-medium px-3 py-1 rounded-full\"\r\n                      style={{ \r\n                        backgroundColor: `${hoveredCategoryData.color}10`,\r\n                        color: hoveredCategoryData.color\r\n                      }}\r\n                    >\r\n                      {hoveredCategoryData.count} structural entries\r\n                    </span>\r\n                  </div>\r\n                  \r\n                  <p className=\"text-stone-600 mb-4 text-lg\">\r\n                    {hoveredCategoryData.description}\r\n                  </p>\r\n                  \r\n                  <div className=\"grid grid-cols-2 gap-4\">\r\n                    <div className=\"p-3 rounded-lg bg-amber-50/50 border border-amber-900/10\">\r\n                      <p className=\"text-sm text-amber-900/60 mb-1\">Subtle Signal</p>\r\n                      <p className=\"text-stone-700\">{hoveredCategoryData.signal.subtle}</p>\r\n                    </div>\r\n                    <div className=\"p-3 rounded-lg bg-stone-50/50 border border-stone-900/10\">\r\n                      <p className=\"text-sm text-stone-600 mb-1\">Texture</p>\r\n                      <p className=\"text-stone-700 font-medium\">{hoveredCategoryData.signal.texture}</p>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Featured Content Preview */}\r\n        <div className=\"mt-24\">\r\n          <div className=\"flex items-center justify-between mb-8\">\r\n            <div>\r\n              <h2 className=\"text-2xl md:text-3xl font-serif font-light text-stone-900\">\r\n                Recently <span className=\"italic\">Structured</span>\r\n              </h2>\r\n              <p className=\"text-stone-600 mt-2\">\r\n                Latest additions to the architectural repository\r\n              </p>\r\n            </div>\r\n            <Link\r\n              href=\"/content\"\r\n              className=\"px-6 py-3 rounded-full bg-amber-900 text-white font-medium hover:bg-amber-800 transition-colors flex items-center gap-2 group\"\r\n            >\r\n              Explore All Content\r\n              <ChevronDownIcon className=\"w-4 h-4 transform rotate-90 group-hover:translate-x-1 transition-transform\" />\r\n            </Link>\r\n          </div>\r\n\r\n          {/* Featured content cards */}\r\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n            {featuredContent.map((item, index) => (\r\n              <BaseCard\r\n                key={item.slug}\r\n                slug={item.slug}\r\n                title={item.title}\r\n                description={item.description}\r\n                category={item.category}\r\n                date={item.date}\r\n                readingTime={item.readingTime}\r\n                tags={item.tags}\r\n                featured={item.featured}\r\n                isNew={item.isNew}\r\n                coverImage={item.coverImage}\r\n                className=\"transform transition-all duration-300 hover:-translate-y-1 hover:shadow-xl\"\r\n              />\r\n            ))}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Footer note */}\r\n        <div className=\"text-center mt-16 pt-8 border-t border-amber-900/10\">\r\n          <p className=\"text-stone-500 text-sm\">\r\n            This portal serves as an index to structural intelligence. \r\n            Each category represents a distinct architectural dimension of thought.\r\n          </p>\r\n          <p className=\"text-stone-400 text-xs mt-2\">\r\n            Access levels may vary based on subscription tier\r\n          </p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\ContentlayerDocPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\CtaArt.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\DateFormatter.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\Divider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\EmailSignup.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\EmbossedBrandMark.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\EnhancedFooter.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\ErrorBoundary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\EventCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\FeaturedBook.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\FloatingTeaserCTA.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\FontErrorBoundary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\Footer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\GlossaryTerm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\Grid.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\Header.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\HeroEyebrow.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\HighQImage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\IQPDF.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\InlineCTA.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\InnerCircleBadge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\InteractionErrorBoundary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\InteractiveElements.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\JsonLd.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\LaunchSubscribe.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\Layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\LegalStrip.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\Loader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\LoadingFallback.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\LockScreen.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\LogoTile.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\LogoWall.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\LuxuryAnimations.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\LuxuryNavbar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\MDXProviderWrapper.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\MDXRenderer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\MandateStatement.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\MdxComponents.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\Navbar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\NewsletterForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\Note.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\PolicyFooter.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\PostHero.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\PostProse.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\PullLine.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\QuickActionBar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\Quote.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\ReadingProgress.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\RelatedContent.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\ResourcesCTA.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\RouteHero.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\Rule.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\SEOHead.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\SafeBlock.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\SafeMDXRemote.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\ScrollProgress.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\SearchPalette.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\Section.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\SeoMeta.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\ShareButtons.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\ShareRow.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\ShortCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\SiteLayout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\SocialFollowStrip.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\SocialLinks.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'iconSize' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":22,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'sizeClasses' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":29,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// components/SocialLinks.tsx\nimport * as React from \"react\";\nimport Link from \"next/link\";\nimport clsx from \"clsx\";\nimport { siteConfig } from \"@/lib/imports\";\n\ntype Props = {\n  className?: string;\n  showLabels?: boolean; // Optional: show/hide text labels\n  iconSize?: \"sm\" | \"md\" | \"lg\";\n};\n\nconst isExternal = (href: string) => /^https?:\\/\\//i.test(href);\nconst isUtility = (href: string) =>\n  href.startsWith(\"mailto:\") ||\n  href.startsWith(\"tel:\") ||\n  href.startsWith(\"sms:\");\n\nexport default function SocialLinks({ \n  className, \n  showLabels = true,\n  iconSize = \"md\"\n}: Props): JSX.Element | null {\n  // Get social links directly from siteConfig\n  const socials = siteConfig.socialLinks || [];\n\n  if (!socials.length) return null;\n\n  const sizeClasses = {\n    sm: \"h-4 w-4\",\n    md: \"h-5 w-5\",\n    lg: \"h-6 w-6\"\n  };\n\n  return (\n    <ul\n      className={clsx(\"flex flex-wrap items-center gap-3\", className)}\n      role=\"list\"\n      aria-label=\"Social media links\"\n    >\n      {socials.map((social, i) => {\n        if (!social.href) return null;\n\n        const external = isExternal(social.href);\n        const utility = isUtility(social.href);\n        const isEmail = social.href.startsWith(\"mailto:\");\n        const isPhone = social.href.startsWith(\"tel:\");\n\n        const linkClasses = clsx(\n          \"flex items-center gap-2 transition-colors\",\n          external && !utility && \"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300\",\n          isEmail && \"text-green-600 dark:text-green-400 hover:text-green-800 dark:hover:text-green-300\",\n          isPhone && \"text-purple-600 dark:text-purple-400 hover:text-purple-800 dark:hover:text-purple-300\",\n          !external && \"text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100\"\n        );\n\n        const content = (\n          <>\n            {/* Optional: Add icons here based on social.kind */}\n            {showLabels && (\n              <span className=\"text-sm font-medium\">{social.label}</span>\n            )}\n          </>\n        );\n\n        if (external && !utility) {\n          return (\n            <li key={`${social.label}-${i}`}>\n              <a\n                href={social.href}\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n                className={linkClasses}\n                aria-label={`Visit our ${social.label} profile (opens in new tab)`}\n              >\n                {content}\n              </a>\n            </li>\n          );\n        }\n\n        if (utility) {\n          return (\n            <li key={`${social.label}-${i}`}>\n              <a \n                href={social.href} \n                className={linkClasses}\n                aria-label={`Contact us via ${social.label}`}\n              >\n                {content}\n              </a>\n            </li>\n          );\n        }\n\n        // Internal links (unlikely for social links, but keeping for consistency)\n        return (\n          <li key={`${social.label}-${i}`}>\n            <Link\n              href={social.href}\n              className={linkClasses}\n              aria-label={social.label}\n              prefetch={false}\n            >\n              {content}\n            </Link>\n          </li>\n        );\n      })}\n    </ul>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\SomeComponent.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\StickyCTA.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\TableOfContents.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\TeaserRequest.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\ThemeContext.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getAllDownloadsMeta' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getAllBooksMeta' is defined but never used. Allowed unused vars must match /^_/u.","line":10,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// components/ThemeContext.tsx - FIXED\n\"use client\";\n\nimport React, { createContext, useContext, useEffect, useState } from 'react';\n\nimport { getAllContent } from \"@/lib/mdx\";\n\n// If these are still needed, keep them:\nimport { getAllDownloadsMeta } from \"@/lib/server/downloads-data\";\nimport { getAllBooksMeta } from \"@/lib/server/books-data\";\n\n// ---------------------------------------------------------------------------\n// Enhanced Types with Luxury Aesthetics\n// ---------------------------------------------------------------------------\n\ntype ContentKind =\n  | \"essay\"\n  | \"book\"\n  | \"download\"\n  | \"event\"\n  | \"print\"\n  | \"resource\"\n  | \"canon\";\n\ninterface ThemeStats {\n  totalContent: number;\n  recentAdditions: number;\n  featuredCount: number;\n  byType: Record<ContentKind, number>;\n}\n\ninterface ThemeState {\n  isDarkMode: boolean;\n  accentColor: string;\n  typography: 'serif' | 'sans' | 'mono';\n  spacing: 'compact' | 'comfortable' | 'expansive';\n  stats: ThemeStats;\n}\n\ninterface ThemeContextType {\n  theme: ThemeState;\n  toggleDarkMode: () => void;\n  setAccentColor: (color: string) => void;\n  setTypography: (type: 'serif' | 'sans' | 'mono') => void;\n  setSpacing: (spacing: 'compact' | 'comfortable' | 'expansive') => void;\n  refreshStats: () => Promise<void>;\n}\n\nconst ThemeContext = createContext<ThemeContextType | undefined>(undefined);\n\nconst defaultTheme: ThemeState = {\n  isDarkMode: true,\n  accentColor: '#D4AF37',\n  typography: 'serif',\n  spacing: 'comfortable',\n  stats: {\n    totalContent: 0,\n    recentAdditions: 0,\n    featuredCount: 0,\n    byType: {\n      essay: 0,\n      book: 0,\n      download: 0,\n      event: 0,\n      print: 0,\n      resource: 0,\n      canon: 0,\n    },\n  },\n};\n\nexport const useTheme = () => {\n  const context = useContext(ThemeContext);\n  if (!context) {\n    throw new Error('useTheme must be used within a ThemeProvider');\n  }\n  return context;\n};\n\nexport const ThemeProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\n  const [theme, setTheme] = useState<ThemeState>(() => {\n    // Try to load from localStorage on initial render\n    if (typeof window !== 'undefined') {\n      const saved = localStorage.getItem('theme-settings');\n      if (saved) {\n        try {\n          return { ...defaultTheme, ...JSON.parse(saved) };\n        } catch (e) {\n          console.warn('Failed to parse saved theme settings', e);\n        }\n      }\n    }\n    return defaultTheme;\n  });\n\n  // Calculate content stats - now async\n  const calculateStats = async (): Promise<ThemeStats> => {\n    try {\n      // Use getAllContent from content-utils - it returns a Promise\n      const allContent = await getAllContent();\n      \n      const oneWeekAgo = new Date();\n      oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);\n      \n      const byType: Record<ContentKind, number> = {\n        essay: 0,\n        book: 0,\n        download: 0,\n        event: 0,\n        print: 0,\n        resource: 0,\n        canon: 0,\n      };\n\n      // Now allContent is an array, so forEach works\n      allContent.forEach(item => {\n        const kind = item.category?.toLowerCase() as ContentKind;\n        if (kind && byType.hasOwnProperty(kind)) {\n          byType[kind]++;\n        }\n      });\n\n      return {\n        totalContent: allContent.length,\n        recentAdditions: allContent.filter(item => {\n          if (!item.date) return false;\n          const itemDate = new Date(item.date);\n          return itemDate > oneWeekAgo;\n        }).length,\n        featuredCount: allContent.filter(item => item.tags?.includes('featured')).length,\n        byType,\n      };\n    } catch (error) {\n      console.error('Failed to calculate content stats:', error);\n      return defaultTheme.stats;\n    }\n  };\n\n  // Update stats on mount and when theme changes\n  useEffect(() => {\n    const updateStats = async () => {\n      const newStats = await calculateStats();\n      setTheme(prev => ({\n        ...prev,\n        stats: newStats,\n      }));\n    };\n    \n    updateStats();\n  }, []);\n\n  // Save theme to localStorage\n  useEffect(() => {\n    localStorage.setItem('theme-settings', JSON.stringify(theme));\n  }, [theme]);\n\n  const toggleDarkMode = () => {\n    setTheme(prev => ({\n      ...prev,\n      isDarkMode: !prev.isDarkMode,\n    }));\n  };\n\n  const setAccentColor = (color: string) => {\n    setTheme(prev => ({\n      ...prev,\n      accentColor: color,\n    }));\n  };\n\n  const setTypography = (type: 'serif' | 'sans' | 'mono') => {\n    setTheme(prev => ({\n      ...prev,\n      typography: type,\n    }));\n  };\n\n  const setSpacing = (spacing: 'compact' | 'comfortable' | 'expansive') => {\n    setTheme(prev => ({\n      ...prev,\n      spacing,\n    }));\n  };\n\n  const refreshStats = async () => {\n    const newStats = await calculateStats();\n    setTheme(prev => ({\n      ...prev,\n      stats: newStats,\n    }));\n  };\n\n  return (\n    <ThemeContext.Provider\n      value={{\n        theme,\n        toggleDarkMode,\n        setAccentColor,\n        setTypography,\n        setSpacing,\n        refreshStats,\n      }}\n    >\n      {children}\n    </ThemeContext.Provider>\n  );\n};\n\n// Utility hook for common theme operations\nexport const useThemeActions = () => {\n  const { theme, toggleDarkMode, setAccentColor } = useTheme();\n  \n  return {\n    isDarkMode: theme.isDarkMode,\n    accentColor: theme.accentColor,\n    toggleDarkMode,\n    setAccentColor,\n    stats: theme.stats,\n  };\n};\n\nexport default ThemeContext;","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\ThemeToggle.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\Verse.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\admin\\ShortsAnalytics.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Users' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":44,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":49},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":76,"column":71,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[3466,3467],"text":"&quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[3466,3467],"text":"&ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[3466,3467],"text":"&#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[3466,3467],"text":"&rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":76,"column":93,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[3488,3489],"text":"&quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[3488,3489],"text":"&ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[3488,3489],"text":"&#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[3488,3489],"text":"&rdquo;"},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// components/admin/ShortsAnalytics.tsx\r\n\r\nimport * as React from \"react\";\r\nimport { \r\n  BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Cell \r\n} from \"recharts\";\r\nimport { Heart, Bookmark, TrendingUp, Zap, Users } from \"lucide-react\";\r\n\r\ninterface AnalyticsProps {\r\n  data: {\r\n    slug: string;\r\n    title: string;\r\n    likes: number;\r\n    saves: number;\r\n    engagementRate: number;\r\n  }[];\r\n}\r\n\r\nconst BRAND_COLORS = [\"#d4af37\", \"#aa8a2e\", \"#826a23\", \"#5b4a18\"];\r\n\r\nexport default function ShortsAnalytics({ data }: AnalyticsProps) {\r\n  const totalLikes = data.reduce((acc, curr) => acc + curr.likes, 0);\r\n  const totalSaves = data.reduce((acc, curr) => acc + curr.saves, 0);\r\n  const topPerformer = [...data].sort((a, b) => (b.likes + b.saves) - (a.likes + a.saves))[0];\r\n\r\n  return (\r\n    <div className=\"space-y-8 p-8 bg-black text-cream min-h-screen\">\r\n      <header className=\"flex justify-between items-end border-b border-white/10 pb-8\">\r\n        <div>\r\n          <h2 className=\"font-serif text-3xl font-bold text-white\">Engagement Pulse</h2>\r\n          <p className=\"text-zinc-500 mt-2 italic\">Strategic telemetry for the Kingdom Vault.</p>\r\n        </div>\r\n        <div className=\"flex gap-4\">\r\n          <StatCard icon={<Heart size={16}/>} label=\"Total Likes\" value={totalLikes} color=\"text-rose-500\" />\r\n          <StatCard icon={<Bookmark size={16}/>} label=\"Total Saves\" value={totalSaves} color=\"text-gold\" />\r\n        </div>\r\n      </header>\r\n\r\n      {/* Primary Analytics Grid */}\r\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\r\n        \r\n        {/* Performance Chart */}\r\n        <div className=\"lg:col-span-2 bg-zinc-950 border border-white/5 rounded-[2rem] p-8 shadow-2xl\">\r\n          <div className=\"flex items-center gap-2 mb-8\">\r\n            <TrendingUp className=\"text-gold\" size={20} />\r\n            <h3 className=\"text-sm font-black uppercase tracking-widest text-white\">Content Reach</h3>\r\n          </div>\r\n          <div className=\"h-[400px] w-full\">\r\n            <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n              <BarChart data={data}>\r\n                <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#1f1f1f\" vertical={false} />\r\n                <XAxis dataKey=\"slug\" hide />\r\n                <YAxis stroke=\"#4b5563\" fontSize={12} tickLine={false} axisLine={false} />\r\n                <Tooltip \r\n                  contentStyle={{ backgroundColor: \"#000\", border: \"1px solid #d4af37\", borderRadius: \"12px\" }}\r\n                  itemStyle={{ color: \"#d4af37\" }}\r\n                />\r\n                <Bar dataKey=\"likes\" radius={[4, 4, 0, 0]}>\r\n                  {data.map((entry, index) => (\r\n                    <Cell key={`cell-${index}`} fill={BRAND_COLORS[index % BRAND_COLORS.length]} />\r\n                  ))}\r\n                </Bar>\r\n              </BarChart>\r\n            </ResponsiveContainer>\r\n          </div>\r\n        </div>\r\n\r\n        {/* High-Impact Insight Card */}\r\n        <div className=\"bg-gradient-to-br from-zinc-900 to-black border border-gold/20 rounded-[2rem] p-8 flex flex-col justify-between\">\r\n          <div>\r\n            <Zap className=\"text-gold mb-6\" size={32} />\r\n            <h3 className=\"font-serif text-2xl font-bold text-white leading-tight\">\r\n              Top Performance Insight\r\n            </h3>\r\n            <p className=\"text-zinc-400 mt-4 text-sm leading-relaxed\">\r\n              The entry <span className=\"text-white font-bold italic\">\"{topPerformer?.title}\"</span> has generated the highest \r\n              retention rate, suggesting a deep appetite for this specific strategic theme.\r\n            </p>\r\n          </div>\r\n          \r\n          <div className=\"pt-8 border-t border-white/10 mt-8\">\r\n            <div className=\"flex items-center justify-between text-[10px] font-black uppercase tracking-widest text-zinc-500\">\r\n              <span>Conversion Velocity</span>\r\n              <span className=\"text-gold\">High</span>\r\n            </div>\r\n            <div className=\"mt-2 h-1 w-full bg-zinc-800 rounded-full overflow-hidden\">\r\n              <div className=\"h-full bg-gold w-[85%]\" />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction StatCard({ icon, label, value, color }: { icon: React.ReactNode, label: string, value: number, color: string }) {\r\n  return (\r\n    <div className=\"bg-zinc-900 border border-white/5 px-6 py-4 rounded-2xl flex items-center gap-4\">\r\n      <div className={`${color} bg-white/5 p-3 rounded-xl`}>{icon}</div>\r\n      <div>\r\n        <div className=\"text-[10px] font-black uppercase tracking-tighter text-zinc-500\">{label}</div>\r\n        <div className=\"text-xl font-bold text-white leading-none\">{value.toLocaleString()}</div>\r\n      </div>\r\n    </div>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\blog\\BlogPostPreview.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\books\\BookCard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Book' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getFallbackImage' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'fallbackIndex' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":91,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":91,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// components/books/BookCard.tsx\n\"use client\";\n\nimport Link from \"next/link\";\nimport Image from \"next/image\";\nimport { useState, useMemo } from \"react\";\nimport type { Book } from \"@/types/index\";\nimport { safeString } from \"@/lib/utils\";\nimport { \n  getSafeImageProps, \n  getFallbackImage,\n  type FallbackConfig \n} from \"@/lib/image-utils\";\n\n// FIXED: Made _id optional with a fallback\ninterface BookCardBook {\n  // Required fields from Book interface\n  _id?: string; // CHANGED: Made optional\n  slug: string;\n  title: string;\n  \n  // Optional fields with explicit null/undefined handling\n  excerpt?: string | null;\n  description?: string | null;\n  date?: string | null;\n  coverImage?: string | null;\n  \n  // Extended properties\n  status?: \"published\" | \"draft\" | \"archived\";\n  format?: string | null;\n  featured?: boolean;\n  tags?: (string | null)[];\n  readTime?: string | number | null;\n  author?: string | null;\n  \n  // Allow any additional properties that might exist on Book\n  [key: string]: unknown;\n}\n\ninterface BookCardProps {\n  book: BookCardBook;\n  className?: string;\n  priority?: boolean;\n  size?: \"default\" | \"featured\";\n}\n\nconst formatDateSafe = (dateString: string | null | undefined): string => {\n  if (!dateString) return \"\";\n\n  try {\n    const date = new Date(dateString);\n    if (Number.isNaN(date.getTime())) return \"\";\n\n    return date.toLocaleDateString(\"en-GB\", {\n      year: \"numeric\",\n      month: \"short\",\n      day: \"numeric\",\n    });\n  } catch {\n    return \"\";\n  }\n};\n\nconst getReadTimeText = (readTime: string | number | null | undefined): string => {\n  if (!readTime) return \"\";\n  \n  if (typeof readTime === \"number\") {\n    return `${readTime} min read`;\n  }\n  \n  if (typeof readTime === \"string\") {\n    // Check if it's already formatted\n    if (readTime.includes(\"min\")) return readTime;\n    // Try to parse as number\n    const num = parseInt(readTime);\n    if (!isNaN(num)) return `${num} min read`;\n    return readTime;\n  }\n  \n  return \"\";\n};\n\nexport default function BookCard({\n  book,\n  className = \"\",\n  priority = false,\n  size = \"default\",\n}: BookCardProps) {\n  const [imageLoaded, setImageLoaded] = useState(false);\n  const [imageError, setImageError] = useState(false);\n  const [fallbackIndex, setFallbackIndex] = useState(0);\n\n  // FIXED: Generate a fallback ID if _id is missing\n  const bookWithId = useMemo(() => {\n    return {\n      ...book,\n      _id: book._id || `book-${book.slug || Date.now()}-${Math.random().toString(36).substr(2, 9)}`\n    };\n  }, [book]);\n\n  // Safely extract all values with defaults\n  const safeTitle = safeString(bookWithId.title, \"Untitled Book\");\n  const safeExcerpt = safeString(bookWithId.excerpt, \"\");\n  const safeDate = formatDateSafe(bookWithId.date);\n  const safeSlug = safeString(bookWithId.slug);\n  const safeAuthor = safeString(bookWithId.author);\n  const safeFormat = safeString(bookWithId.format);\n  const readTimeText = getReadTimeText(bookWithId.readTime);\n  \n  // Determine category for fallback images\n  const category = useMemo(() => {\n    if (bookWithId.tags && bookWithId.tags.length > 0) {\n      const firstTag = safeString(bookWithId.tags[0]);\n      if (firstTag.includes(\"philosophy\")) return \"philosophy\";\n      if (firstTag.includes(\"business\")) return \"business\";\n      if (firstTag.includes(\"fiction\")) return \"fiction\";\n      if (firstTag.includes(\"non-fiction\") || firstTag.includes(\"nonfiction\")) return \"nonFiction\";\n    }\n    return \"default\";\n  }, [bookWithId.tags]);\n\n  // Prepare fallback configuration\n  const fallbackConfig: FallbackConfig = {\n    type: \"book\",\n    category,\n    theme: \"gradient\",\n  };\n\n  // Get safe image props using our utility\n  const imageProps = getSafeImageProps(bookWithId.coverImage, safeTitle, {\n    priority,\n    fallbackConfig,\n  });\n\n  // Handle image load\n  const handleImageLoad = () => {\n    setImageLoaded(true);\n    setImageError(false);\n  };\n\n  // Handle image error\n  const handleImageError = () => {\n    setImageError(true);\n    setImageLoaded(false);\n    setFallbackIndex(prev => prev + 1);\n  };\n\n  // Size-based styling\n  const sizeClasses = {\n    default: {\n      container: \"rounded-3xl\",\n      title: \"text-xl md:text-2xl\",\n      content: \"p-6\",\n      image: \"aspect-[3/4]\",\n      excerpt: \"line-clamp-3\",\n    },\n    featured: {\n      container: \"rounded-4xl\",\n      title: \"text-2xl md:text-3xl\",\n      content: \"p-8\",\n      image: \"aspect-[3/4]\",\n      excerpt: \"line-clamp-4\",\n    },\n  } as const;\n\n  const currentSize = sizeClasses[size];\n  const href = safeSlug ? `/books/${safeSlug}` : \"#\";\n\n  return (\n    <article\n      className={`group relative overflow-hidden bg-white/95 backdrop-blur-sm shadow-2xl shadow-black/10 border border-white/20 transition-all duration-700 hover:shadow-3xl hover:shadow-black/20 hover:-translate-y-2 ${currentSize.container} ${className}`}\n    >\n      {/* Premium background effects */}\n      <div className=\"absolute inset-0 bg-gradient-to-br from-white via-gray-50/80 to-softGold/5 opacity-0 group-hover:opacity-100 transition-opacity duration-500\" />\n\n      {/* Animated border glow */}\n      <div\n        className={`absolute inset-0 bg-gradient-to-r from-softGold/0 via-softGold/10 to-forest/0 opacity-0 group-hover:opacity-100 transition-opacity duration-500 ${currentSize.container}`}\n      />\n\n      <Link href={href} className=\"block relative z-10 h-full\" prefetch={false}>\n        <div className=\"flex h-full flex-col\">\n          {/* Image container with premium overlay */}\n          <div\n            className={`relative w-full overflow-hidden ${currentSize.image}`}\n          >\n            <div className=\"absolute inset-0 z-10 bg-gradient-to-t from-black/40 via-black/10 to-transparent opacity-0 transition-opacity duration-500 group-hover:opacity-100\" />\n\n            {/* Loading shimmer */}\n            {!imageLoaded && !imageError && (\n              <div className=\"absolute inset-0 animate-pulse bg-gradient-to-r from-gray-200 via-gray-100 to-gray-200\" />\n            )}\n\n            {/* Image */}\n            <Image\n              src={imageProps.src}\n              alt={imageProps.alt}\n              fill\n              className={`object-cover transition-all duration-700 ${\n                imageLoaded ? \"opacity-100 group-hover:scale-110\" : \"opacity-0\"\n              }`}\n              sizes=\"(min-width: 1024px) 400px, (min-width: 768px) 300px, 100vw\"\n              priority={imageProps.priority}\n              loading={imageProps.loading}\n              onLoad={handleImageLoad}\n              onError={handleImageError}\n            />\n\n            {/* Featured badge overlay */}\n            {bookWithId.featured && (\n              <div className=\"absolute left-4 top-4 z-20\">\n                <div className=\"rounded-full border border-white/10 bg-gradient-to-r from-softGold to-amber-500 px-3 py-1.5 backdrop-blur-sm shadow-lg\">\n                  <span className=\"text-xs font-semibold uppercase tracking-wider text-white\">\n                    Featured\n                  </span>\n                </div>\n              </div>\n            )}\n\n            {/* Hover overlay with read more */}\n            <div className=\"absolute inset-0 z-20 flex items-center justify-center bg-black/40 opacity-0 transition-all duration-500 group-hover:opacity-100\">\n              <div className=\"transform translate-y-4 transition-transform duration-500 group-hover:translate-y-0\">\n                <div className=\"flex items-center gap-2 rounded-full border border-white/20 bg-black/60 px-4 py-2 text-sm font-medium text-white backdrop-blur-sm\">\n                  <span>View Details</span>\n                  <svg\n                    className=\"h-4 w-4 transform transition-transform group-hover:translate-x-1\"\n                    fill=\"none\"\n                    stroke=\"currentColor\"\n                    viewBox=\"0 0 24 24\"\n                  >\n                    <path\n                      strokeLinecap=\"round\"\n                      strokeLinejoin=\"round\"\n                      strokeWidth={2}\n                      d=\"M17 8l4 4m0 0l-4 4m4-4H3\"\n                    />\n                  </svg>\n                </div>\n              </div>\n            </div>\n\n            {/* Book corner fold effect */}\n            <div className=\"absolute top-0 right-0 w-8 h-8 bg-gradient-to-bl from-black/20 to-transparent z-10\" />\n          </div>\n\n          {/* Content container */}\n          <div\n            className={`relative flex flex-col flex-1 ${currentSize.content}`}\n          >\n            {/* Title with gradient hover effect */}\n            <h3\n              className={`mb-3 line-clamp-2 font-serif font-light leading-tight text-deepCharcoal transition-colors duration-300 group-hover:text-forest ${currentSize.title}`}\n            >\n              {safeTitle}\n            </h3>\n\n            {/* Author */}\n            {safeAuthor && (\n              <p className=\"mb-3 text-sm font-medium text-softGold\">\n                by {safeAuthor}\n              </p>\n            )}\n\n            {/* Excerpt with improved typography */}\n            {safeExcerpt && (\n              <p\n                className={`mb-4 flex-1 font-light leading-relaxed text-gray-600 ${currentSize.excerpt}`}\n              >\n                {safeExcerpt}\n              </p>\n            )}\n\n            {/* Metadata and footer */}\n            <div className=\"mt-auto space-y-4\">\n              {/* Status badges */}\n              <div className=\"flex flex-wrap gap-2\">\n                {bookWithId.status && (\n                  <span\n                    className={`rounded-full px-3 py-1 text-xs font-medium ${\n                      bookWithId.status === \"published\"\n                        ? \"bg-green-100 text-green-800 border border-green-200\"\n                        : bookWithId.status === \"draft\"\n                        ? \"bg-gray-100 text-gray-800 border border-gray-200\"\n                        : \"bg-blue-100 text-blue-800 border border-blue-200\"\n                    }`}\n                  >\n                    {bookWithId.status.charAt(0).toUpperCase() + bookWithId.status.slice(1)}\n                  </span>\n                )}\n\n                {safeFormat && (\n                  <span className=\"rounded-full bg-gray-100 px-3 py-1 text-xs font-medium text-gray-700 border border-gray-200\">\n                    {safeFormat}\n                  </span>\n                )}\n              </div>\n\n              {/* Date and read time */}\n              <div className=\"flex items-center justify-between border-t border-gray-100/50 pt-4\">\n                <div className=\"flex flex-col gap-1\">\n                  {safeDate && (\n                    <time\n                      dateTime={bookWithId.date || undefined}\n                      className=\"text-xs font-light text-gray-500\"\n                    >\n                      {safeDate}\n                    </time>\n                  )}\n                  {readTimeText && (\n                    <span className=\"text-xs font-light text-gray-500\">\n                      {readTimeText}\n                    </span>\n                  )}\n                </div>\n\n                <div className=\"transform translate-x-2 opacity-0 transition-all duration-300 group-hover:translate-x-0 group-hover:opacity-100\">\n                  <div className=\"flex h-8 w-8 items-center justify-center rounded-full bg-softGold/10 transition-colors group-hover:bg-softGold/20\">\n                    <svg\n                      className=\"h-4 w-4 text-softGold\"\n                      fill=\"none\"\n                      stroke=\"currentColor\"\n                      viewBox=\"0 0 24 24\"\n                    >\n                      <path\n                        strokeLinecap=\"round\"\n                        strokeLinejoin=\"round\"\n                        strokeWidth={2}\n                        d=\"M17 8l4 4m0 0l-4 4m4-4H3\"\n                      />\n                    </svg>\n                  </div>\n                </div>\n              </div>\n\n              {/* Tags */}\n              {bookWithId.tags && bookWithId.tags.length > 0 && (\n                <div className=\"flex flex-wrap gap-1\">\n                  {bookWithId.tags\n                    .filter((tag): tag is string => typeof tag === \"string\" && tag.trim().length > 0)\n                    .slice(0, 3)\n                    .map((tag, index) => (\n                      <span\n                        key={`${tag}-${index}`}\n                        className=\"rounded-full border border-gray-200/50 bg-gray-100/80 px-2 py-1 text-xs font-light text-gray-600 backdrop-blur-sm transition-all duration-300 hover:border-softGold/20 hover:bg-softGold/10 hover:text-softGold\"\n                      >\n                        {tag}\n                      </span>\n                    ))}\n                  {bookWithId.tags.length > 3 && (\n                    <span className=\"rounded-full border border-gray-200/50 bg-gray-100/80 px-2 py-1 text-xs font-light text-gray-500 backdrop-blur-sm\">\n                      +{bookWithId.tags.length - 3}\n                    </span>\n                  )}\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n\n        {/* Animated bottom border */}\n        <div className=\"absolute bottom-0 left-0 right-0 h-1 origin-left transform scale-x-0 bg-gradient-to-r from-softGold/0 via-softGold to-forest/0 transition-transform duration-500 group-hover:scale-x-100\" />\n      </Link>\n    </article>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\canon\\CanonResourceCard.tsx","messages":[],"suppressedMessages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":75,"column":11,"nodeType":"JSXOpeningElement","endLine":79,"endColumn":13,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\content\\CardDisplay.tsx","messages":[],"suppressedMessages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":89,"column":17,"nodeType":"JSXOpeningElement","endLine":94,"endColumn":19,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\content\\ContentLayout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\contexts\\ThemeContext.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\downloads\\DownloadCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\downloads\\DownloadsGrid.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\emails\\TeaserEmail.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\events\\AddToCalendar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\events\\ChathamBadge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\events\\ChathamCallout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\events\\EventCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\events\\EventHero.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\events\\EventMeta.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\events\\EventPageHeader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\events\\EventResources.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\events\\mdx-components.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\homepage\\AboutSection.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Sparkles' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":67,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":75},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'className' is defined but never used. Allowed unused args must match /^_/u.","line":88,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":88,"endColumn":12},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":337,"column":57,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[14417,14418],"text":"&quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[14417,14418],"text":"&ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[14417,14418],"text":"&#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[14417,14418],"text":"&rdquo;"},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// components/homepage/AboutSection.tsx\n\"use client\";\n\nimport React from \"react\";\nimport Image from \"next/image\";\nimport Link from \"next/link\";\nimport { motion, useScroll, useTransform } from \"framer-motion\";\nimport { BookOpen, Award, Calendar, Mail, Users, FileText, Clock, Sparkles } from \"lucide-react\";\n\n// --- Types ---\n\nexport type Achievement = {\n  title: string;\n  description: string;\n  year: number;\n  href?: string;\n  icon?: string;\n};\n\ntype AboutSectionProps = {\n  id?: string;\n  bio: string;\n  achievements?: Achievement[];\n  portraitSrc?: string;\n  portraitAlt?: string;\n  priority?: boolean;\n  className?: string;\n};\n\n// --- Animation Variants ---\n\nconst container = {\n  hidden: { opacity: 0 },\n  visible: {\n    opacity: 1,\n    transition: {\n      when: \"beforeChildren\",\n      staggerChildren: 0.15,\n      duration: 0.8,\n    },\n  },\n} as const;\n\nconst item = {\n  hidden: { y: 40, opacity: 0 },\n  visible: {\n    y: 0,\n    opacity: 1,\n    transition: {\n      duration: 0.8,\n      ease: [0.22, 1, 0.36, 1],\n    },\n  },\n} as const;\n\nconst fadeIn = {\n  hidden: { opacity: 0 },\n  visible: {\n    opacity: 1,\n    transition: { duration: 1.2, ease: \"easeOut\" },\n  },\n} as const;\n\nconst iconMap: Record<string, React.ReactNode> = {\n  book: <BookOpen className=\"h-5 w-5\" />,\n  award: <Award className=\"h-5 w-5\" />,\n  calendar: <Calendar className=\"h-5 w-5\" />,\n  default: <Award className=\"h-5 w-5\" />,\n};\n\n// Stats icons\nconst statsIcons = [\n  <BookOpen key=\"works\" className=\"h-6 w-6\" />,\n  <Clock key=\"years\" className=\"h-6 w-6\" />,\n  <Users key=\"readers\" className=\"h-6 w-6\" />,\n  <FileText key=\"essays\" className=\"h-6 w-6\" />,\n];\n\n// --- Component ---\n\nexport default function AboutSection({\n  id = \"about\",\n  bio,\n  achievements = [],\n  portraitSrc = \"/assets/images/profile-portrait.webp\",\n  portraitAlt = \"Portrait of Abraham of London\",\n  priority = false,\n  className,\n}: AboutSectionProps) {\n  const containerRef = React.useRef<HTMLElement>(null);\n  const { scrollYProgress } = useScroll({\n    target: containerRef,\n    offset: [\"start end\", \"end start\"],\n  });\n\n  const parallaxY = useTransform(scrollYProgress, [0, 1], [-30, 30]);\n\n  const sortedAchievements = React.useMemo(() => {\n    return achievements.slice().sort((a, b) => b.year - a.year);\n  }, [achievements]);\n\n  // Stats data\n  const stats = [\n    { value: `${achievements.length}+`, label: \"Published Works\", color: \"from-blue-600 to-cyan-500\" },\n    { value: `${new Date().getFullYear() - 2010}+`, label: \"Years Writing\", color: \"from-emerald-600 to-teal-500\" },\n    { value: \"10K+\", label: \"Readers Reached\", color: \"from-violet-600 to-purple-500\" },\n    { value: \"100+\", label: \"Essays Written\", color: \"from-amber-600 to-orange-500\" },\n  ];\n\n  return (\n    <section\n      ref={containerRef}\n      id={id}\n      className=\"relative overflow-hidden bg-gradient-to-b from-slate-50 to-white dark:from-gray-950 dark:to-gray-900\"\n    >\n      {/* Subtle background patterns */}\n      <div className=\"absolute inset-0\">\n        <motion.div\n          style={{ y: parallaxY }}\n          className=\"absolute -right-32 top-1/4 h-96 w-96 rounded-full bg-blue-100 blur-3xl dark:bg-blue-900/20\"\n        />\n        <div className=\"absolute -left-32 bottom-1/4 h-80 w-80 rounded-full bg-amber-100 blur-3xl dark:bg-amber-900/20\" />\n      </div>\n\n      <div className=\"relative mx-auto max-w-7xl px-4 py-20 sm:px-6 lg:px-8 lg:py-28\">\n        <motion.div\n          variants={container}\n          initial=\"hidden\"\n          whileInView=\"visible\"\n          viewport={{ once: true, amount: 0.2 }}\n          className=\"grid grid-cols-1 gap-16 lg:grid-cols-2\"\n        >\n          {/* Left Column - Portrait & Personal Info */}\n          <motion.div variants={item} className=\"relative\">\n            {/* Portrait Container */}\n            <div className=\"relative mx-auto max-w-md lg:mx-0 lg:max-w-none\">\n              {/* Decorative frame */}\n              <div className=\"absolute -inset-4 rounded-3xl bg-gradient-to-br from-blue-500/10 via-emerald-500/10 to-transparent dark:from-blue-500/20 dark:via-emerald-500/20\" />\n              \n              <div className=\"relative overflow-hidden rounded-2xl border-2 border-gray-200 bg-white shadow-2xl dark:border-gray-800 dark:bg-gray-900\">\n                <div className=\"aspect-[3/4] relative overflow-hidden\">\n                  <Image\n                    src={portraitSrc}\n                    alt={portraitAlt}\n                    fill\n                    sizes=\"(max-width: 768px) 100vw, 50vw\"\n                    priority={priority}\n                    className=\"object-cover object-top transition-all duration-700 hover:scale-[1.02]\"\n                  />\n                  {/* Subtle vignette */}\n                  <div className=\"absolute inset-0 bg-gradient-to-t from-black/5 via-transparent to-transparent\" />\n                </div>\n              </div>\n\n              {/* Name plate */}\n              <div className=\"mt-6 rounded-xl bg-gradient-to-r from-gray-50 to-white p-4 shadow-sm dark:from-gray-900 dark:to-gray-800\">\n                <h3 className=\"font-serif text-xl font-semibold text-gray-900 dark:text-white\">\n                  Abraham of London\n                </h3>\n                <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                  Author, Philosopher & Mentor\n                </p>\n              </div>\n            </div>\n\n            {/* Contact CTA */}\n            <motion.div\n              variants={fadeIn}\n              className=\"mt-8 text-center lg:text-left\"\n            >\n              <Link\n                href=\"/contact\"\n                className=\"group relative inline-flex items-center justify-center gap-3 overflow-hidden rounded-xl bg-gradient-to-r from-gray-900 to-black px-8 py-4 text-lg font-semibold text-white shadow-lg transition-all duration-300 hover:shadow-2xl hover:shadow-gray-900/30 dark:from-blue-900 dark:to-blue-950\"\n              >\n                <span className=\"relative z-10\">Connect With Me</span>\n                <Mail className=\"h-5 w-5 transition-transform group-hover:translate-x-1\" />\n                <div className=\"absolute inset-0 -translate-x-full bg-gradient-to-r from-white/20 via-transparent to-transparent transition-transform duration-700 group-hover:translate-x-full\" />\n              </Link>\n            </motion.div>\n          </motion.div>\n\n          {/* Right Column - Bio & Achievements */}\n          <motion.div variants={item} className=\"flex flex-col\">\n            {/* Section Header */}\n            <div className=\"mb-8\">\n              <motion.div\n                variants={fadeIn}\n                className=\"mb-3 flex items-center gap-3\"\n              >\n                <div className=\"h-px w-12 bg-gradient-to-r from-blue-500 to-emerald-500\" />\n                <span className=\"font-sans text-sm font-semibold uppercase tracking-widest text-gray-600 dark:text-gray-400\">\n                  About Me\n                </span>\n              </motion.div>\n              \n              <motion.h1\n                variants={item}\n                className=\"font-serif text-4xl font-bold leading-tight text-gray-900 dark:text-white md:text-5xl lg:text-6xl\"\n              >\n                Crafting Wisdom Through{\" \"}\n                <span className=\"relative inline-block\">\n                  <span className=\"relative z-10 bg-gradient-to-r from-blue-600 to-emerald-600 bg-clip-text text-transparent\">\n                    Words & Works\n                  </span>\n                  <div className=\"absolute -bottom-2 left-0 h-1 w-full bg-gradient-to-r from-blue-500 to-emerald-500\" />\n                </span>\n              </motion.h1>\n            </div>\n\n            {/* Biography */}\n            <motion.div\n              variants={fadeIn}\n              className=\"mb-12\"\n            >\n              <p className=\"text-lg leading-relaxed text-gray-700 dark:text-gray-300 md:text-xl\">\n                {bio}\n              </p>\n            </motion.div>\n\n            {/* Achievements Timeline */}\n            {sortedAchievements.length > 0 && (\n              <motion.div variants={item} className=\"mt-6\">\n                <div className=\"mb-8\">\n                  <h2 className=\"font-serif text-2xl font-bold text-gray-900 dark:text-white md:text-3xl\">\n                    Milestones &{\" \"}\n                    <span className=\"bg-gradient-to-r from-blue-600 to-emerald-600 bg-clip-text text-transparent\">\n                      Achievements\n                    </span>\n                  </h2>\n                  <div className=\"mt-2 h-px w-24 bg-gradient-to-r from-blue-500 to-transparent\" />\n                </div>\n\n                <div className=\"relative\">\n                  {/* Timeline line */}\n                  <div className=\"absolute left-0 top-0 h-full w-px bg-gradient-to-b from-blue-500/60 via-emerald-500/40 to-transparent\" />\n\n                  <div className=\"space-y-8 pl-6\">\n                    {sortedAchievements.map((achievement, index) => {\n                      const Icon = iconMap[achievement.icon || \"default\"];\n                      \n                      return (\n                        <motion.div\n                          key={`${achievement.title}-${achievement.year}-${index}`}\n                          variants={item}\n                          className=\"relative group\"\n                        >\n                          {/* Timeline dot */}\n                          <div className=\"absolute -left-[25px] top-0 z-10 flex h-6 w-6 items-center justify-center rounded-full border-4 border-white bg-gradient-to-r from-blue-500 to-emerald-500 shadow-lg dark:border-gray-900\">\n                            <div className=\"h-1.5 w-1.5 rounded-full bg-white\" />\n                          </div>\n\n                          {/* Year */}\n                          <div className=\"mb-2\">\n                            <span className=\"inline-block rounded-full bg-gradient-to-r from-blue-500/10 to-emerald-500/10 px-4 py-1.5 text-sm font-semibold text-gray-900 dark:text-white\">\n                              {achievement.year}\n                            </span>\n                          </div>\n\n                          {/* Achievement card */}\n                          <div\n                            className={`rounded-xl border border-gray-200 bg-white p-5 shadow-sm transition-all duration-300 hover:shadow-lg dark:border-gray-800 dark:bg-gray-900 ${\n                              achievement.href\n                                ? \"cursor-pointer hover:border-blue-400 dark:hover:border-blue-600\"\n                                : \"\"\n                            }`}\n                          >\n                            <div className=\"flex items-start gap-4\">\n                              <div className=\"flex h-12 w-12 items-center justify-center rounded-lg bg-gradient-to-br from-blue-500/10 to-emerald-500/10\">\n                                {Icon}\n                              </div>\n                              <div className=\"flex-1\">\n                                <h3 className=\"font-serif text-lg font-semibold text-gray-900 dark:text-white\">\n                                  {achievement.title}\n                                </h3>\n                                <p className=\"mt-2 text-sm leading-relaxed text-gray-600 dark:text-gray-300\">\n                                  {achievement.description}\n                                </p>\n                              </div>\n                            </div>\n\n                            {/* Link indicator */}\n                            {achievement.href && (\n                              <div className=\"mt-4 flex items-center justify-end\">\n                                <span className=\"text-sm font-medium text-blue-600 transition-colors group-hover:text-blue-700 dark:text-blue-400 dark:group-hover:text-blue-300\">\n                                  Learn more â†’\n                                </span>\n                              </div>\n                            )}\n                          </div>\n                        </motion.div>\n                      );\n                    })}\n                  </div>\n                </div>\n              </motion.div>\n            )}\n\n            {/* Stats or Additional Info - FIXED FOR LEGIBILITY */}\n            <motion.div\n              variants={fadeIn}\n              className=\"mt-12\"\n            >\n              <h3 className=\"mb-6 font-serif text-2xl font-bold text-gray-900 dark:text-white md:text-3xl\">\n                By the Numbers\n              </h3>\n              <div className=\"grid grid-cols-2 gap-4 sm:grid-cols-4\">\n                {stats.map((stat, index) => (\n                  <div\n                    key={index}\n                    className=\"group relative overflow-hidden rounded-xl border border-gray-200 bg-gradient-to-br from-white to-gray-50 p-4 shadow-sm transition-all duration-300 hover:shadow-lg dark:border-gray-800 dark:from-gray-900 dark:to-gray-950\"\n                  >\n                    {/* Gradient overlay */}\n                    <div className={`absolute inset-0 bg-gradient-to-br ${stat.color} opacity-0 transition-opacity duration-300 group-hover:opacity-10`} />\n                    \n                    <div className=\"relative z-10 flex flex-col items-center\">\n                      <div className=\"mb-2 flex h-12 w-12 items-center justify-center rounded-lg bg-gradient-to-br from-white to-gray-50 shadow-sm dark:from-gray-800 dark:to-gray-900\">\n                        {statsIcons[index]}\n                      </div>\n                      <div className=\"font-serif text-3xl font-bold text-gray-900 dark:text-white\">\n                        {stat.value}\n                      </div>\n                      <div className=\"mt-1 text-center text-xs font-semibold uppercase tracking-wider text-gray-600 dark:text-gray-400\">\n                        {stat.label}\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </motion.div>\n\n            {/* Philosophy quote */}\n            <motion.div\n              variants={fadeIn}\n              className=\"mt-12 rounded-xl border border-gray-200 bg-gradient-to-br from-white to-gray-50 p-6 shadow-sm dark:border-gray-800 dark:from-gray-900 dark:to-gray-950\"\n            >\n              <div className=\"flex items-start gap-3\">\n                <div className=\"text-3xl text-blue-500\">\"</div>\n                <div>\n                  <p className=\"font-serif text-lg italic text-gray-800 dark:text-gray-300\">\n                    The true measure of wisdom is not in what you know, but in what you do with that knowledge to shape a better world.\n                  </p>\n                  <div className=\"mt-4 flex items-center gap-2\">\n                    <div className=\"h-px w-8 bg-gradient-to-r from-blue-500 to-emerald-500\" />\n                    <span className=\"text-sm font-medium text-gray-600 dark:text-gray-400\">Abraham of London</span>\n                  </div>\n                </div>\n              </div>\n            </motion.div>\n          </motion.div>\n        </motion.div>\n      </div>\n    </section>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\homepage\\ContentShowcase.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\homepage\\EventsSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\homepage\\HeroBanner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\homepage\\HeroSection.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'BaseCard' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CARD_ANIMATIONS' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":35}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// components/HeroSection.tsx\nimport * as React from \"react\";\nimport Image from \"next/image\";\nimport Link from \"next/link\";\nimport clsx from \"clsx\";\nimport { BaseCard, CARD_ANIMATIONS } from '@/components/Cards';\n\n// --- Utility Components ------------------------------------------------------\n\n/** Small â€œeyebrowâ€ pill used above the H1 */\nfunction Eyebrow({\n  children,\n  className,\n}: React.PropsWithChildren<{ className?: string }>) {\n  return (\n    <span\n      className={clsx(\n        \"inline-flex items-center gap-2 rounded-full\",\n        \"border border-lightGrey/70 bg-warmWhite/70 px-3 py-1\",\n        \"text-xs uppercase tracking-wide font-semibold\",\n        \"text-[color:var(--color-on-secondary)] opacity-70\",\n        \"dark:text-[color:var(--color-on-primary)] dark:opacity-80\",\n        className\n      )}\n    >\n      {children}\n    </span>\n  );\n}\n\n// --- Type Definitions --------------------------------------------------------\n\ntype Cta = { href: string; label: string; ariaLabel?: string };\ntype VideoSource = { src: string; type: string };\ntype AspectRatio = \"book\" | \"wide\" | \"square\" | \"cover-wide\";\n\ntype HeroProps = {\n  title?: string;\n  subtitle?: string;\n  primaryCta?: Cta;\n  secondaryCta?: Cta;\n\n  /** Image shown when no video or as poster fallback */\n  coverImage?: string | null;\n  /** Aspect ratio: 'book' (2/3), 'wide' (16/9), 'square' (1/1), 'cover-wide' (21/9) */\n  coverAspect?: AspectRatio;\n  /** 'contain' (book covers) or 'cover' (edge-to-edge) */\n  coverFit?: \"contain\" | \"cover\";\n  /** object position for Image/Video */\n  coverPosition?: \"left\" | \"center\" | \"right\" | \"top\";\n\n  /** Optional autoplaying looped background video */\n  videoSources?: VideoSource[] | null;\n  /** Poster image for the video (defaults to coverImage) */\n  poster?: string | null;\n\n  eyebrow?: string;\n};\n\n// --- Utilities ---------------------------------------------------------------\n\n/**\n * Normalizes a URL path: ensures relative paths start with a slash.\n */\nfunction normalizeLocal(src?: string | null): string | undefined {\n  if (!src) return undefined;\n  if (/^https?:\\/\\//i.test(src)) return src;\n  const cleanSrc = src.replace(/^\\/+/, \"\");\n  return `/${cleanSrc}`;\n}\n\n/**\n * Maps the AspectRatio prop to responsive *heights* (not full-screen boxes).\n * The parent controls width; these classes just keep the box civilised.\n */\nfunction getAspectClass(aspect: AspectRatio): string {\n  switch (aspect) {\n    case \"square\":\n      return \"h-[220px] sm:h-[260px] md:h-[300px] lg:h-[340px]\";\n    case \"wide\":\n      return \"h-[200px] sm:h-[230px] md:h-[260px] lg:h-[300px]\";\n    case \"cover-wide\":\n      return \"h-[180px] sm:h-[210px] md:h-[240px] lg:h-[280px]\";\n    case \"book\":\n    default:\n      // Portrait / book-style, but capped\n      return \"h-[260px] sm:h-[320px] md:h-[380px] lg:h-[420px]\";\n  }\n}\n\n// --- Main Component ----------------------------------------------------------\n\nexport default function HeroSection({\n  title = \"When the System Breaks You: Finding Purpose in Pain\",\n  subtitle = \"Win the only battle you fully control â€” the one inside your chest.\",\n  eyebrow = \"Featured Insight\",\n  primaryCta = {\n    href: \"/downloads/Fathering_Without_Fear_Teaser-Mobile.pdf\",\n    label: \"Get the free teaser\",\n    ariaLabel: \"Download the Fathering Without Fear Teaser PDF\",\n  },\n  secondaryCta = { href: \"/blog\", label: \"Read the latest insights\" },\n\n  coverImage,\n  coverAspect = \"book\",\n  coverFit = \"contain\",\n  coverPosition = \"center\",\n\n  videoSources = [],\n  poster = null,\n}: HeroProps) {\n  // 1. --- Core Data and Fallbacks ---\n  const defaultImage = \"/assets/images/abraham-of-london-banner.webp\";\n  const imgSrc = normalizeLocal(coverImage) || normalizeLocal(defaultImage)!;\n  const hasVideo = Array.isArray(videoSources) && videoSources.length > 0;\n  const posterSrc = normalizeLocal(poster) || imgSrc;\n\n  // 2. --- Dynamic Class Generation (with clsx) ---\n  const frameClasses = clsx(\n    \"relative overflow-hidden rounded-2xl shadow-lg shadow-black/15\",\n    // contained visual â€“ NEVER full-width skyscraper\n    \"max-w-[520px] w-full mx-auto\",\n    getAspectClass(coverAspect),\n    {\n      \"p-2 sm:p-3 md:p-4 bg-warmWhite border border-lightGrey/70\":\n        coverFit === \"contain\",\n    }\n  );\n\n  const mediaClasses = clsx(\n    \"block h-full w-full\", // parent controls the box size\n    coverFit === \"contain\" ? \"object-contain\" : \"object-cover\",\n    {\n      \"object-left\": coverPosition === \"left\",\n      \"object-right\": coverPosition === \"right\",\n      \"object-top\": coverPosition === \"top\",\n      \"object-center\": coverPosition === \"center\",\n    }\n  );\n\n  // 3. --- Render -------------------------------------------------------------\n  return (\n    <section\n      className={clsx(\n        \"relative overflow-hidden bg-white dark:bg-black\",\n        \"before:pointer-events-none before:absolute before:inset-0\",\n        \"before:bg-[radial-gradient(80%_60%_at_50%_0%,rgba(212,175,55,.14),transparent_60%)]\",\n        \"dark:before:bg-[radial-gradient(80%_60%_at_50%_0%,rgba(212,175,55,.22),transparent_60%)]\"\n      )}\n      role=\"region\"\n      aria-label=\"Featured content section\"\n    >\n      <div className=\"mx-auto grid max-w-7xl grid-cols-1 items-center gap-8 px-4 py-12 md:grid-cols-2 md:gap-12 md:py-16\">\n        {/* LEFT: copy -------------------------------------------------------- */}\n        <div className=\"relative z-[1]\">\n          {eyebrow && <Eyebrow className=\"mb-3\">{eyebrow}</Eyebrow>}\n\n          <h1\n            id=\"hero-title\"\n            className=\"font-serif text-[clamp(2rem,3.6vw,3.25rem)] font-semibold leading-[1.08] text-deepCharcoal dark:text-cream [text-wrap:balance]\"\n          >\n            {title}\n          </h1>\n\n          {subtitle && (\n            <p className=\"mt-4 max-w-prose text-[color:var(--color-on-secondary)] opacity-85 dark:text-[color:var(--color-on-primary)] dark:opacity-85\">\n              {subtitle}\n            </p>\n          )}\n\n          <div className=\"mt-6 flex flex-wrap items-center gap-3\">\n            {/* Primary CTA */}\n            {primaryCta && (\n              <Link\n                href={primaryCta.href}\n                aria-label={primaryCta.ariaLabel || `Go to ${primaryCta.label}`}\n                className=\"aol-btn\"\n              >\n                {primaryCta.label}\n              </Link>\n            )}\n\n            {/* Secondary CTA */}\n            {secondaryCta && (\n              <Link\n                href={secondaryCta.href}\n                aria-label={\n                  secondaryCta.ariaLabel || `Go to ${secondaryCta.label}`\n                }\n                className=\"rounded-full border border-lightGrey bg-warmWhite px-4 py-2 text-sm font-semibold text-deepCharcoal transition hover:brightness-[.98] focus:outline-none focus-visible:ring-2\"\n              >\n                {secondaryCta.label}\n              </Link>\n            )}\n          </div>\n        </div>\n\n        {/* RIGHT: visual media container ------------------------------------ */}\n        <div className={frameClasses}>\n          {/* Gradient veil for cover-fit visuals */}\n          {coverFit === \"cover\" && (\n            <div\n              aria-hidden\n              className=\"pointer-events-none absolute inset-0 z-[1]\n                         bg-[linear-gradient(to_bottom,rgba(0,0,0,0.30),transparent_35%,transparent_65%,rgba(0,0,0,0.25))]\n                         dark:bg-[linear-gradient(to_bottom,rgba(0,0,0,0.45),transparent_40%,transparent_60%,rgba(0,0,0,0.35))]\"\n            />\n          )}\n\n          {/* Media: Video or Image Fallback */}\n          {hasVideo ? (\n            <video\n              className={mediaClasses}\n              autoPlay\n              muted\n              loop\n              playsInline\n              preload=\"metadata\"\n              poster={posterSrc}\n              aria-describedby=\"hero-title\"\n              onContextMenu={(e) => e.preventDefault()}\n            >\n              {videoSources!.map((s) => (\n                <source key={s.src} src={normalizeLocal(s.src)} type={s.type} />\n              ))}\n            </video>\n          ) : (\n            <Image\n              src={imgSrc}\n              alt={title || \"Hero image illustrating the page content\"}\n              // IMPORTANT: do NOT use fill â€“ we size via CSS\n              width={800}\n              height={1200} // portrait-ish; actual box is controlled by classes\n              priority\n              sizes=\"(max-width: 768px) 100vw, 50vw\"\n              className={mediaClasses}\n            />\n          )}\n        </div>\n      </div>\n\n      {/* Decorative grid dots */}\n      <div\n        aria-hidden\n        className=\"pointer-events-none absolute inset-x-0 bottom-0 h-24 bg-[radial-gradient(rgba(0,0,0,0.06)_1px,transparent_1px)] [background-size:18px_18px] dark:opacity-30\"\n      />\n    </section>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\homepage\\MilestonesTimeline.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\homepage\\StatsBar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\homepage\\StrategicFunnelStrip.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\homepage\\TestimonialsSection.tsx","messages":[],"suppressedMessages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":269,"column":25,"nodeType":"JSXOpeningElement","endLine":276,"endColumn":27,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":346,"column":21,"nodeType":"JSXOpeningElement","endLine":351,"endColumn":23,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\homepage\\VenturesSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\icons\\BrandLogo.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\icons\\LockClosedIcon.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\icons\\SocialIcons\\BrandLogo.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\logos.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\makeContentPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\mdx-components.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\mdx\\Badge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\mdx\\BadgeRow.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\mdx\\BrandFrame.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\mdx\\CTA.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\mdx\\CTAPreset.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\mdx\\Callout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\mdx\\Caption.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\mdx\\CtaPresetComponent.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\mdx\\DownloadCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\mdx\\FallbackComponent.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\mdx\\Grid.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\mdx\\HeroEyebrow.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\mdx\\JsonLd.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\mdx\\MDXComponents.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\mdx\\MissingComponent.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\mdx\\Note.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\mdx\\PullLine.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\mdx\\Quote.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":38,"column":95,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[865,866],"text":"&quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[865,866],"text":"&ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[865,866],"text":"&#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[865,866],"text":"&rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":44,"column":99,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[1152,1153],"text":"&quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[1152,1153],"text":"&ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[1152,1153],"text":"&#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[1152,1153],"text":"&rdquo;"},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// components/mdx/Quote.tsx\r\nimport * as React from \"react\";\r\n\r\nexport interface QuoteProps {\r\n  children: React.ReactNode;\r\n  author?: string;\r\n  source?: string;\r\n  citation?: string;\r\n  align?: \"left\" | \"center\" | \"right\";\r\n  size?: \"sm\" | \"md\" | \"lg\";\r\n  className?: string;\r\n}\r\n\r\nconst Quote: React.FC<QuoteProps> = ({ \r\n  children, \r\n  author, \r\n  source, \r\n  citation,\r\n  align = \"left\",\r\n  size = \"md\",\r\n  className = \"\" \r\n}) => {\r\n  const sizeClasses = {\r\n    sm: \"text-base\",\r\n    md: \"text-lg\",\r\n    lg: \"text-xl\",\r\n  };\r\n\r\n  const alignClasses = {\r\n    left: \"text-left\",\r\n    center: \"text-center\",\r\n    right: \"text-right\",\r\n  };\r\n\r\n  return (\r\n    <figure className={`my-8 ${className}`}>\r\n      <blockquote className={`relative ${alignClasses[align]}`}>\r\n        <div className=\"absolute -left-2 top-0 text-4xl text-gold/30 font-serif leading-none\">\"</div>\r\n        <div className=\"pl-8 pr-4\">\r\n          <p className={`${sizeClasses[size]} italic text-gray-200 leading-relaxed`}>\r\n            {children}\r\n          </p>\r\n        </div>\r\n        <div className=\"absolute -right-2 bottom-0 text-4xl text-gold/30 font-serif leading-none\">\"</div>\r\n      </blockquote>\r\n      \r\n      {(author || source || citation) && (\r\n        <figcaption className={`mt-4 text-sm text-gray-400 ${alignClasses[align]}`}>\r\n          {author && (\r\n            <span className=\"font-medium text-gray-300\">\r\n              {author}\r\n            </span>\r\n          )}\r\n          \r\n          {(author && source) && (\r\n            <span className=\"mx-2\">â€”</span>\r\n          )}\r\n          \r\n          {source && (\r\n            <span className=\"italic\">\r\n              {source}\r\n              {citation && (\r\n                <span className=\"ml-2 text-xs text-gray-500\">\r\n                  [{citation}]\r\n                </span>\r\n              )}\r\n            </span>\r\n          )}\r\n        </figcaption>\r\n      )}\r\n    </figure>\r\n  );\r\n};\r\n\r\nexport default Quote;","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\mdx\\ResourcesCTA.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\mdx\\Rule.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\mdx\\ShareRow.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\mdx\\Verse.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\mdx\\component-resolver.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ComponentModule' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":6,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":21},{"ruleId":"@next/next/no-assign-module-variable","severity":2,"message":"Do not assign to the variable `module`. See: https://nextjs.org/docs/messages/no-assign-module-variable","line":22,"column":5,"nodeType":"VariableDeclaration","endLine":22,"endColumn":70},{"ruleId":"react/display-name","severity":2,"message":"Component definition is missing display name","line":43,"column":14,"nodeType":"ArrowFunctionExpression","messageId":"noDisplayName","endLine":43,"endColumn":81},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook React.useEffect has an unnecessary dependency: 'componentName'. Either exclude it or remove the dependency array. Outer scope values like 'componentName' aren't valid dependencies because mutating them doesn't re-render the component.","line":48,"column":8,"nodeType":"ArrayExpression","endLine":48,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: []","fix":{"range":[1607,1622],"text":"[]"}}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// components/mdx/component-resolver.ts\r\nimport * as React from \"react\";\r\nimport { MissingComponent } from \"./MissingComponent\";\r\n\r\n// Type for component imports\r\ntype ComponentModule = { default: React.ComponentType<any> } | React.ComponentType<any>;\r\n\r\n// Cache for loaded components\r\nconst componentCache = new Map<string, React.ComponentType<any>>();\r\n\r\n// Function to dynamically import components\r\nexport async function getComponent(\r\n  componentName: string\r\n): Promise<React.ComponentType<any>> {\r\n  // Check cache first\r\n  if (componentCache.has(componentName)) {\r\n    return componentCache.get(componentName)!;\r\n  }\r\n\r\n  try {\r\n    // Try to import the component\r\n    const module = await import(`@/components/mdx/${componentName}`);\r\n    const Component = module.default || module;\r\n    \r\n    // Cache it\r\n    componentCache.set(componentName, Component);\r\n    return Component;\r\n  } catch (error) {\r\n    // Return a fallback component\r\n    const Fallback: React.FC<any> = (props) => (\r\n      <MissingComponent componentName={componentName} {...props} />\r\n    );\r\n    \r\n    componentCache.set(componentName, Fallback);\r\n    return Fallback;\r\n  }\r\n}\r\n\r\n// Create a component that loads dynamically\r\nexport function createDynamicComponent(componentName: string): React.FC<any> {\r\n  return function DynamicComponent(props) {\r\n    const [Component, setComponent] = React.useState<React.ComponentType<any>>(() => {\r\n      return () => <MissingComponent componentName={componentName} {...props} />;\r\n    });\r\n\r\n    React.useEffect(() => {\r\n      getComponent(componentName).then(setComponent);\r\n    }, [componentName]);\r\n\r\n    return <Component {...props} />;\r\n  };\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\mdx\\cta-presets.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\mdx\\ctas.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\mdx\\shortcodes.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\media\\CoverFrame.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\print\\BrandFrame.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\print\\EmbossedBrandMark.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\print\\EmbossedSign.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\resources\\ResourceGrid.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\seo\\BookJsonLd.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\seo\\EventJsonLd.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\ui\\Box.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\ui\\Button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\ui\\InteractiveElement.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\ui\\SectionHeading.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\components\\ui\\SilentSurface.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\config\\mdx-plugins.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\config\\nav.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\config\\site.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\content\\canon\\the-architecture-of-human-purpose-landing.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\content\\downloads\\TEMPLATE_FILENAME.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\content\\downloads\\THE-FILE-SLUG.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\contentlayer.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\context\\ThemeContext.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\context\\WebSocketContext.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\data\\achievements.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\data\\blogPosts.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\data\\lib\\getAllPosts.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\data\\lib\\posts.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\data\\meta\\fathering-without-fear.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\emails\\ContactEmail.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\fix-all-coverImage-paths.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\fix-files.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\fix-recaptcha.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\fix-yaml-whitespace.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\globals.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\hooks\\use-inner-circle.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\hooks\\useAnalytics.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\hooks\\useCtaPreset.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CTAPreset' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// hooks/useCtaPreset.ts\nimport { useMemo } from \"react\";\nimport {\n  getCtaPreset,\n  type CTAPreset,\n  type CTAKey,\n  getFeaturedItems,\n  searchPresets,\n} from \"@/components/mdx/cta-presets\";\n\nexport function useCtaPreset(presetKey?: CTAKey | string) {\n  const preset = useMemo(() => {\n    if (!presetKey) return null;\n    return getCtaPreset(presetKey);\n  }, [presetKey]);\n\n  const featuredItems = useMemo(() => {\n    if (!presetKey || typeof presetKey !== \"string\") return [];\n    return getFeaturedItems(presetKey as CTAKey);\n  }, [presetKey]);\n\n  const isEmpty = useMemo(() => {\n    if (!preset) return true;\n    const { reads, downloads, actions, related, featured } = preset;\n    return (\n      !reads?.length &&\n      !downloads?.length &&\n      !actions?.length &&\n      !related?.length &&\n      !featured\n    );\n  }, [preset]);\n\n  return {\n    preset,\n    featuredItems,\n    isEmpty,\n    exists: !!preset,\n  };\n}\n\nexport function useCtaSearch(query: string) {\n  return useMemo(() => {\n    return searchPresets(query);\n  }, [query]);\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\hooks\\usePerformanceMonitor.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'entry' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":31,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":31,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'unmountEntry' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":55,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":55,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'renderEntry' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":92,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":92,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// hooks/usePerformanceMonitor.ts\nimport { useEffect, useRef, useCallback } from \"react\";\n\ninterface PerformanceMetrics {\n  componentName: string;\n  mountTime: number;\n  renderCount: number;\n  averageRenderTime: number;\n  lastRenderTime: number;\n}\n\ninterface PerformanceEntry {\n  componentName: string;\n  timestamp: number;\n  type: \"mount\" | \"render\" | \"unmount\";\n  duration?: number;\n}\n\nexport function usePerformanceMonitor(componentName: string) {\n  const mountTimeRef = useRef<number>(0);\n  const renderCountRef = useRef<number>(0);\n  const lastRenderTimeRef = useRef<number>(0);\n  const renderStartTimeRef = useRef<number>(0);\n\n  // Measure component mount time\n  useEffect(() => {\n    const mountTime = performance.now();\n    mountTimeRef.current = mountTime;\n\n    // Log mount performance\n    const entry: PerformanceEntry = {\n      componentName,\n      timestamp: mountTime,\n      type: \"mount\",\n    };\n\n    // Send to analytics if available\n    if (typeof window !== \"undefined\" && (window as any).gtag) {\n      (window as any).gtag(\"event\", \"performance_component_mount\", {\n        component_name: componentName,\n        mount_time: mountTime,\n      });\n    }\n\n    // Console log in development\n    if (process.env.NODE_ENV === \"development\") {\n      console.log(`ðŸš€ ${componentName} mounted in ${mountTime.toFixed(2)}ms`);\n    }\n\n    // Cleanup on unmount\n    return () => {\n      const unmountTime = performance.now();\n      const totalLifeTime = unmountTime - mountTimeRef.current;\n\n      const unmountEntry: PerformanceEntry = {\n        componentName,\n        timestamp: unmountTime,\n        type: \"unmount\",\n        duration: totalLifeTime,\n      };\n\n      if (process.env.NODE_ENV === \"development\") {\n        console.log(\n          `ðŸ“Š ${componentName} lifetime: ${totalLifeTime.toFixed(2)}ms, Renders: ${renderCountRef.current}`\n        );\n      }\n    };\n  }, [componentName]);\n\n  // Measure render performance\n  useEffect(() => {\n    const now = performance.now();\n\n    // Calculate render duration if this is not the first render\n    if (renderStartTimeRef.current > 0) {\n      const renderDuration = now - renderStartTimeRef.current;\n      lastRenderTimeRef.current = renderDuration;\n\n      if (process.env.NODE_ENV === \"development\" && renderDuration > 16) {\n        // Warn about slow renders (> 16ms = 60fps)\n        console.warn(\n          `ðŸ¢ ${componentName} slow render: ${renderDuration.toFixed(2)}ms`\n        );\n      }\n    }\n\n    renderCountRef.current += 1;\n    renderStartTimeRef.current = now;\n\n    // Log render performance periodically\n    if (renderCountRef.current % 10 === 0) {\n      const renderEntry: PerformanceEntry = {\n        componentName,\n        timestamp: now,\n        type: \"render\",\n        duration: lastRenderTimeRef.current,\n      };\n\n      if (typeof window !== \"undefined\" && (window as any).gtag) {\n        (window as any).gtag(\"event\", \"performance_component_render\", {\n          component_name: componentName,\n          render_count: renderCountRef.current,\n          last_render_time: lastRenderTimeRef.current,\n        });\n      }\n    }\n  });\n\n  const getMetrics = useCallback((): PerformanceMetrics => {\n    const totalTime = performance.now() - mountTimeRef.current;\n    const averageRenderTime =\n      renderCountRef.current > 0 ? totalTime / renderCountRef.current : 0;\n\n    return {\n      componentName,\n      mountTime: mountTimeRef.current,\n      renderCount: renderCountRef.current,\n      averageRenderTime,\n      lastRenderTime: lastRenderTimeRef.current,\n    };\n  }, [componentName]);\n\n  const markRenderStart = useCallback(() => {\n    renderStartTimeRef.current = performance.now();\n  }, []);\n\n  const markRenderEnd = useCallback(() => {\n    const endTime = performance.now();\n    const renderTime = endTime - renderStartTimeRef.current;\n    lastRenderTimeRef.current = renderTime;\n    return renderTime;\n  }, []);\n\n  return {\n    getMetrics,\n    markRenderStart,\n    markRenderEnd,\n    renderCount: renderCountRef.current,\n    lastRenderTime: lastRenderTimeRef.current,\n  };\n}\n\n// Enhanced performance monitoring for page-level metrics\nexport function usePagePerformanceMonitor(pageName: string) {\n  const pageLoadTimeRef = useRef<number>(0);\n  const firstContentfulPaintRef = useRef<number>(0);\n  const largestContentfulPaintRef = useRef<number>(0);\n\n  useEffect(() => {\n    // Mark page load start\n    pageLoadTimeRef.current = performance.now();\n\n    // Track First Contentful Paint\n    if (typeof window !== \"undefined\" && \"PerformanceObserver\" in window) {\n      const fcpObserver = new PerformanceObserver((entryList) => {\n        const entries = entryList.getEntries();\n        for (const entry of entries) {\n          if (entry.name === \"first-contentful-paint\") {\n            firstContentfulPaintRef.current = entry.startTime;\n\n            if (process.env.NODE_ENV === \"development\") {\n              console.log(`ðŸŽ¨ FCP: ${entry.startTime.toFixed(2)}ms`);\n            }\n          }\n        }\n      });\n\n      const lcpObserver = new PerformanceObserver((entryList) => {\n        const entries = entryList.getEntries();\n        const lastEntry = entries[entries.length - 1];\n        if (lastEntry) {\n          largestContentfulPaintRef.current = lastEntry.startTime;\n        }\n      });\n\n      try {\n        fcpObserver.observe({ type: \"paint\", buffered: true });\n        lcpObserver.observe({\n          type: \"largest-contentful-paint\",\n          buffered: true,\n        });\n      } catch (error) {\n        console.warn(\"Performance Observer not supported:\", error);\n      }\n\n      return () => {\n        fcpObserver.disconnect();\n        lcpObserver.disconnect();\n      };\n    }\n\n    return undefined;\n  }, [pageName]);\n\n  const getPageMetrics = useCallback(() => {\n    const pageLoadTime = performance.now() - pageLoadTimeRef.current;\n\n    return {\n      pageName,\n      pageLoadTime,\n      firstContentfulPaint: firstContentfulPaintRef.current,\n      largestContentfulPaint: largestContentfulPaintRef.current,\n      timestamp: new Date().toISOString(),\n    };\n  }, [pageName]);\n\n  return {\n    getPageMetrics,\n    markPageLoad: () => {\n      pageLoadTimeRef.current = performance.now();\n    },\n  };\n}\n\nexport default usePerformanceMonitor;\n","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\hooks\\useRecaptcha.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\hooks\\useShortInteractions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\init-db.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\jest.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\jest.setup.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\ThemeContext.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\analytics.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\api-session.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\api.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\apiGuard.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\auth-proxy.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\books.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\brands.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\canon.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\client-content.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\content-fallback.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'q' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":365,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":365,"endColumn":10}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// lib/content-fallback.ts\n// Direct imports from contentlayer/generated as fallback - NO DEPENDENCIES\nimport { \n  allPosts, \n  allBooks, \n  allDownloads, \n  allEvents, \n  allPrints, \n  allResources, \n  allStrategies, \n  allCanons, \n  allShorts \n} from \"@/lib/contentlayer\";\nimport type {\n  Post as PostType,\n  Book as BookType,\n  Download as DownloadType,\n  Event as EventType,\n  Print as PrintType,\n  Resource as ResourceType,\n  Strategy as StrategyType,\n  Canon as CanonType,\n  Short as ShortType,\n} from \"@/lib/contentlayer\";\n\n// Union type for all documents\nexport type AnyDoc = \n  | PostType \n  | BookType \n  | DownloadType \n  | EventType \n  | PrintType \n  | ResourceType \n  | StrategyType \n  | CanonType \n  | ShortType;\n\nexport type DocKind = \n  | 'Post' \n  | 'Book' \n  | 'Download' \n  | 'Event' \n  | 'Print' \n  | 'Resource' \n  | 'Strategy' \n  | 'Canon' \n  | 'Short';\n\n// ============================================\n// SLUG HELPER\n// ============================================\nexport function getDocSlug(doc: any): string {\n  // First try the slug field\n  if (doc.slug && typeof doc.slug === 'string' && doc.slug.trim()) {\n    return doc.slug.trim();\n  }\n  \n  // Fallback to flattened path\n  if (doc._raw?.flattenedPath) {\n    const path = doc._raw.flattenedPath;\n    const parts = path.split('/');\n    if (parts.length > 1) {\n      const lastPart = parts[parts.length - 1];\n      return lastPart === 'index' ? parts[parts.length - 2] || lastPart : lastPart;\n    }\n    return path;\n  }\n  \n  // Last resort: use title as slug\n  if (doc.title) {\n    return doc.title\n      .toLowerCase()\n      .replace(/[^\\w\\s-]/g, '')\n      .replace(/\\s+/g, '-')\n      .replace(/-+/g, '-');\n  }\n  \n  return 'untitled';\n}\n\n// ============================================\n// TYPE GUARDS - FIXED: use 'type' not '_type'\n// ============================================\nexport const isPost = (doc: AnyDoc): doc is PostType => doc.type === 'Post';\nexport const isBook = (doc: AnyDoc): doc is BookType => doc.type === 'Book';\nexport const isDownload = (doc: AnyDoc): doc is DownloadType => doc.type === 'Download';\nexport const isEvent = (doc: AnyDoc): doc is EventType => doc.type === 'Event';\nexport const isPrint = (doc: AnyDoc): doc is PrintType => doc.type === 'Print';\nexport const isResource = (doc: AnyDoc): doc is ResourceType => doc.type === 'Resource';\nexport const isStrategy = (doc: AnyDoc): doc is StrategyType => doc.type === 'Strategy';\nexport const isCanon = (doc: AnyDoc): doc is CanonType => doc.type === 'Canon';\nexport const isShort = (doc: AnyDoc): doc is ShortType => doc.type === 'Short';\n\nexport const isDraft = (doc: AnyDoc): boolean => Boolean(doc.draft);\nexport const isPublished = (doc: AnyDoc): boolean => !isDraft(doc);\n\n// ============================================\n// CONTENT GETTERS - ALL TYPES\n// ============================================\n\n// Posts\nexport const getAllPostsDirect = (): PostType[] => {\n  return allPosts.filter(post => !post.draft) as PostType[];\n};\n\nexport const getPostBySlugDirect = (slug: string): PostType | undefined => {\n  return getAllPostsDirect().find(post => getDocSlug(post) === slug);\n};\n\n// Books\nexport const getAllBooksDirect = (): BookType[] => {\n  return allBooks.filter(book => !book.draft) as BookType[];\n};\n\nexport const getBookBySlugDirect = (slug: string): BookType | undefined => {\n  return getAllBooksDirect().find(book => getDocSlug(book) === slug);\n};\n\n// Downloads\nexport const getAllDownloadsDirect = (): DownloadType[] => {\n  return allDownloads.filter(download => !download.draft) as DownloadType[];\n};\n\nexport const getDownloadBySlugDirect = (slug: string): DownloadType | undefined => {\n  return getAllDownloadsDirect().find(download => getDocSlug(download) === slug);\n};\n\n// Events\nexport const getAllEventsDirect = (): EventType[] => {\n  return allEvents.filter(event => !event.draft) as EventType[];\n};\n\nexport const getEventBySlugDirect = (slug: string): EventType | undefined => {\n  return getAllEventsDirect().find(event => getDocSlug(event) === slug);\n};\n\n// Prints\nexport const getAllPrintsDirect = (): PrintType[] => {\n  return allPrints.filter(print => !print.draft) as PrintType[];\n};\n\nexport const getPrintBySlugDirect = (slug: string): PrintType | undefined => {\n  return getAllPrintsDirect().find(print => getDocSlug(print) === slug);\n};\n\n// Resources\nexport const getAllResourcesDirect = (): ResourceType[] => {\n  return allResources.filter(resource => !resource.draft) as ResourceType[];\n};\n\nexport const getResourceBySlugDirect = (slug: string): ResourceType | undefined => {\n  return getAllResourcesDirect().find(resource => getDocSlug(resource) === slug);\n};\n\n// Strategies\nexport const getAllStrategiesDirect = (): StrategyType[] => {\n  return allStrategies.filter(strategy => !strategy.draft) as StrategyType[];\n};\n\nexport const getStrategyBySlugDirect = (slug: string): StrategyType | undefined => {\n  return getAllStrategiesDirect().find(strategy => getDocSlug(strategy) === slug);\n};\n\n// Canon\nexport const getAllCanonsDirect = (): CanonType[] => {\n  return allCanons.filter(canon => !canon.draft) as CanonType[];\n};\n\nexport const getCanonBySlugDirect = (slug: string): CanonType | undefined => {\n  return getAllCanonsDirect().find(canon => getDocSlug(canon) === slug);\n};\n\n// Shorts\nexport const getAllShortsDirect = (): ShortType[] => {\n  return allShorts.filter(short => !short.draft) as ShortType[];\n};\n\nexport const getShortBySlugDirect = (slug: string): ShortType | undefined => {\n  return getAllShortsDirect().find(short => getDocSlug(short) === slug);\n};\n\n// ============================================\n// UNIVERSAL GETTERS\n// ============================================\nexport const getAllContentlayerDocsDirect = (): AnyDoc[] => {\n  return [\n    ...allPosts,\n    ...allBooks,\n    ...allDownloads,\n    ...allEvents,\n    ...allPrints,\n    ...allResources,\n    ...allStrategies,\n    ...allCanons,\n    ...allShorts,\n  ] as AnyDoc[];\n};\n\nexport const getPublishedDocumentsDirect = (): AnyDoc[] => {\n  return getAllContentlayerDocsDirect().filter(isPublished);\n};\n\nexport const getFeaturedDocumentsDirect = (): AnyDoc[] => {\n  return getPublishedDocumentsDirect().filter(doc => doc.featured === true);\n};\n\nexport const getPublishedDocumentsByTypeDirect = (type: DocKind): AnyDoc[] => {\n  const docs = getPublishedDocumentsDirect();\n  switch(type) {\n    case 'Post': return docs.filter(isPost);\n    case 'Book': return docs.filter(isBook);\n    case 'Download': return docs.filter(isDownload);\n    case 'Event': return docs.filter(isEvent);\n    case 'Print': return docs.filter(isPrint);\n    case 'Resource': return docs.filter(isResource);\n    case 'Strategy': return docs.filter(isStrategy);\n    case 'Canon': return docs.filter(isCanon);\n    case 'Short': return docs.filter(isShort);\n    default: return [];\n  }\n};\n\nexport const getDocumentBySlugDirect = (slug: string): AnyDoc | undefined => {\n  const allDocs = [\n    ...getAllPostsDirect(),\n    ...getAllBooksDirect(),\n    ...getAllDownloadsDirect(),\n    ...getAllEventsDirect(),\n    ...getAllPrintsDirect(),\n    ...getAllResourcesDirect(),\n    ...getAllStrategiesDirect(),\n    ...getAllCanonsDirect(),\n    ...getAllShortsDirect(),\n  ];\n  \n  return allDocs.find(doc => getDocSlug(doc) === slug);\n};\n\n// ============================================\n// UTILITY FUNCTIONS\n// ============================================\nexport interface ContentlayerCardProps {\n  title: string;\n  description?: string;\n  excerpt?: string;\n  coverImage?: string;\n  date?: string;\n  slug: string;\n  tags?: string[];\n  category?: string;\n  readTime?: string;\n  author?: string;\n  url?: string;\n  type: DocKind;\n}\n\nexport const getCardPropsForDocumentDirect = (doc: AnyDoc): ContentlayerCardProps => {\n  const docType = doc.type.toLowerCase();\n  const url = doc.type === 'Post' \n    ? `/blog/${getDocSlug(doc)}`\n    : `/${docType === 'canon' ? 'canon' : docType}s/${getDocSlug(doc)}`;\n\n  return {\n    title: doc.title || 'Untitled',\n    description: doc.description,\n    excerpt: doc.excerpt,\n    coverImage: doc.coverImage,\n    date: doc.date,\n    slug: getDocSlug(doc),\n    tags: doc.tags,\n    category: (doc as any).category,\n    readTime: (doc as any).readTime,\n    author: (doc as any).author,\n    url: (doc as any).url || url,\n    type: doc.type as DocKind,\n  };\n};\n\nexport function indexBySlugDirect<T extends AnyDoc>(docs: T[]): Record<string, T> {\n  return docs.reduce((acc, doc) => {\n    const slug = getDocSlug(doc);\n    if (slug) acc[slug] = doc;\n    return acc;\n  }, {} as Record<string, T>);\n}\n\nexport function sortByDateDirect<T extends AnyDoc>(docs: T[], order: 'asc' | 'desc' = 'desc'): T[] {\n  return [...docs].sort((a, b) => {\n    const dateA = a.date ? new Date(a.date).getTime() : 0;\n    const dateB = b.date ? new Date(b.date).getTime() : 0;\n    return order === 'desc' ? dateB - dateA : dateA - dateB;\n  });\n}\n\nexport function filterPublishedDirect<T extends AnyDoc>(docs: T[]): T[] {\n  return docs.filter(isPublished);\n}\n\nexport function searchDocumentsDirect<T extends AnyDoc>(docs: T[], query: string): T[] {\n  const q = query.toLowerCase().trim();\n  if (!q) return [];\n  \n  return docs.filter(doc => {\n    const searchable = [\n      doc.title || '',\n      doc.description || '',\n      doc.excerpt || '',\n      ...(doc.tags || []),\n    ].join(' ').toLowerCase();\n    \n    return searchable.includes(q);\n  });\n}\n\nexport function paginateDocumentsDirect<T extends AnyDoc>(docs: T[], page: number = 1, limit: number = 10): T[] {\n  const start = (page - 1) * limit;\n  const end = start + limit;\n  return docs.slice(start, end);\n}\n\n// ============================================\n// AGGREGATED HELPERS\n// ============================================\nexport function getAllContentDirect() {\n  return {\n    posts: getAllPostsDirect(),\n    books: getAllBooksDirect(),\n    canon: getAllCanonsDirect(),\n    downloads: getAllDownloadsDirect(),\n    events: getAllEventsDirect(),\n    prints: getAllPrintsDirect(),\n    resources: getAllResourcesDirect(),\n    strategies: getAllStrategiesDirect(),\n    shorts: getAllShortsDirect(),\n  };\n}\n\nexport function getAllContentFlatDirect(): AnyDoc[] {\n  const {\n    posts,\n    books,\n    canon,\n    downloads,\n    events,\n    prints,\n    resources,\n    strategies,\n    shorts,\n  } = getAllContentDirect();\n\n  return [\n    ...posts,\n    ...books,\n    ...canon,\n    ...downloads,\n    ...events,\n    ...prints,\n    ...resources,\n    ...strategies,\n    ...shorts,\n  ];\n}\n\nexport function searchAllContentDirect(query: string) {\n  const q = query.trim().toLowerCase();\n  \n  return {\n    posts: searchDocumentsDirect(getAllPostsDirect(), query),\n    books: searchDocumentsDirect(getAllBooksDirect(), query),\n    canon: searchDocumentsDirect(getAllCanonsDirect(), query),\n    downloads: searchDocumentsDirect(getAllDownloadsDirect(), query),\n    events: searchDocumentsDirect(getAllEventsDirect(), query),\n    prints: searchDocumentsDirect(getAllPrintsDirect(), query),\n    resources: searchDocumentsDirect(getAllResourcesDirect(), query),\n    strategies: searchDocumentsDirect(getAllStrategiesDirect(), query),\n    shorts: searchDocumentsDirect(getAllShortsDirect(), query),\n  };\n}\n\n// ============================================\n// POST-SPECIFIC UTILITIES (for backward compatibility)\n// ============================================\nexport const getPublicPostsDirect = (): PostType[] => {\n  return getAllPostsDirect().filter(post => !isDraft(post));\n};\n\nexport const getFeaturedPostsDirect = (): PostType[] => {\n  return getAllPostsDirect().filter(post => post.featured === true);\n};\n\nexport const getPostSummariesDirect = (): ContentlayerCardProps[] => {\n  return getAllPostsDirect().map(getCardPropsForDocumentDirect);\n};\n\nexport const getSortedPostsDirect = (): PostType[] => {\n  return getAllPostsDirect().sort((a, b) => {\n    const dateA = a.date ? new Date(a.date).getTime() : 0;\n    const dateB = b.date ? new Date(b.date).getTime() : 0;\n    return dateB - dateA;\n  });\n};\n\nexport const getPaginatedPostsDirect = (page: number = 1, limit: number = 10): PostType[] => {\n  const posts = getSortedPostsDirect();\n  const start = (page - 1) * limit;\n  const end = start + limit;\n  return posts.slice(start, end);\n};\n\nexport const getRecentPostsDirect = (limit: number = 5): PostType[] => {\n  return getSortedPostsDirect().slice(0, limit);\n};\n\nexport const searchPostsDirect = (query: string): PostType[] => {\n  const q = query.toLowerCase().trim();\n  if (!q) return [];\n  \n  return getAllPostsDirect().filter(post => {\n    const searchable = [\n      post.title || '',\n      post.description || '',\n      post.excerpt || '',\n      ...(post.tags || []),\n      (post as any).category || '',\n    ].join(' ').toLowerCase();\n    \n    return searchable.includes(q);\n  });\n};\n\nexport const getPostsByCategoryDirect = (category: string): PostType[] => {\n  return getAllPostsDirect().filter(post => \n    (post as any).category?.toLowerCase() === category.toLowerCase()\n  );\n};\n\nexport const getPostsByTagDirect = (tag: string): PostType[] => {\n  return getAllPostsDirect().filter(post => \n    post.tags?.some(t => t.toLowerCase() === tag.toLowerCase())\n  );\n};\n\n// ============================================\n// CONVENIENCE EXPORTS (arrays for .map, .length, etc.)\n// ============================================\nexport const postsDirect = getAllPostsDirect();\nexport const booksDirect = getAllBooksDirect();\nexport const canonsDirect = getAllCanonsDirect();\nexport const eventsDirect = getAllEventsDirect();\nexport const printsDirect = getAllPrintsDirect();\nexport const strategiesDirect = getAllStrategiesDirect();\nexport const resourcesDirect = getAllResourcesDirect();\nexport const downloadsDirect = getAllDownloadsDirect();\nexport const shortsDirect = getAllShortsDirect();\n\n// ============================================\n// EXPORT ALL TYPES\n// ============================================\nexport type {\n  PostType,\n  BookType,\n  DownloadType,\n  EventType,\n  PrintType,\n  ResourceType,\n  StrategyType,\n  CanonType,\n  ShortType,\n};\n\n// Type aliases for backward compatibility\nexport type Post = PostType;\nexport type PostWithContent = PostType & { content?: string };\nexport type PostMeta = PostType;\nexport type PostForClient = PostType;\nexport type PostSummary = PostType;\nexport type Book = BookType;\nexport type Canon = CanonType;\nexport type Download = DownloadType;\nexport type Event = EventType;\nexport type Print = PrintType;\nexport type Resource = ResourceType;\nexport type Strategy = StrategyType;\nexport type Short = ShortType;\nexport type BasicDoc = AnyDoc;\nexport type ContentItem = AnyDoc;","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\content-index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\content-loader.ts","messages":[{"ruleId":"import/no-anonymous-default-export","severity":1,"message":"Assign object to a variable before exporting as module default","line":90,"column":1,"nodeType":"ExportDefaultDeclaration","endLine":94,"endColumn":3}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// lib/content-loader.ts - FINAL VERSION WITH WORKAROUND\r\nimport { Post } from '@/types/post';\r\n\r\nconst mockPosts = [\r\n  {\r\n    slug: 'welcome-post',\r\n    title: 'Welcome to Abraham of London',\r\n    date: '2024-01-01',\r\n    content: 'This is the welcome post content...',\r\n    excerpt: 'A warm welcome to our platform',\r\n    coverImage: '/images/welcome.jpg',\r\n    published: true,\r\n    featured: true,\r\n    category: 'announcements',\r\n    tags: ['welcome', 'introduction'],\r\n    author: 'Abraham',\r\n    readTime: '2 min read'\r\n  },\r\n  {\r\n    slug: 'getting-started',\r\n    title: 'Getting Started Guide',\r\n    date: '2024-01-02',\r\n    content: 'Guide content here...',\r\n    excerpt: 'Learn how to get started',\r\n        coverImage: '/images/guide.jpg',\r\n    published: true,\r\n    category: 'guides',\r\n    tags: ['guide', 'tutorial'],\r\n    author: 'Abraham',\r\n    readTime: '5 min read'\r\n  }\r\n] as Post[];\r\n\r\nexport async function loadPostsFromSource(): Promise<Post[]> {\r\n  try {\r\n    if (process.env.NODE_ENV === 'development') {\r\n      console.log('[content-loader] Using mock posts data');\r\n      return mockPosts;\r\n    }\r\n\r\n    try {\r\n      const contentlayer = await import('./contentlayer-helper');\r\n      const docs = contentlayer.getAllContentlayerDocs();\r\n      \r\n      return docs.map(doc => ({\r\n        slug: doc.slug || '',\r\n        title: doc.title || 'Untitled',\r\n        date: doc.date || new Date().toISOString().split('T')[0],\r\n                content: doc.body?.raw || (doc as any).content || '',\r\n        excerpt: doc.excerpt || '',\r\n        description: doc.description,\r\n        coverImage: doc.coverImage,\r\n                published: (doc as any).published !== false,\r\n                featured: (doc as any).featured || false,\r\n                category: (doc as any).category,\r\n        tags: doc.tags || [],\r\n                author: (doc as any).author,\r\n                readTime: (doc as any).readTime,\r\n                subtitle: (doc as any).subtitle,\r\n      } as Post));\r\n    } catch (contentlayerError) {\r\n      console.warn('[content-loader] Contentlayer not available');\r\n      return mockPosts;\r\n    }\r\n    \r\n  } catch (error) {\r\n    console.error('[content-loader] Error:', error);\r\n    return mockPosts;\r\n  }\r\n}\r\n\r\nexport async function initializeAllContent(): Promise<{ posts: Post[] }> {\r\n  try {\r\n    const posts = await loadPostsFromSource();\r\n    console.log(`[content-loader] Initialized ${posts.length} posts`);\r\n    return { posts };\r\n  } catch (error) {\r\n    console.error('[content-loader] Error:', error);\r\n    return { posts: [] };\r\n  }\r\n}\r\n\r\nexport function createContentLoader() {\r\n  return {\r\n    load: async () => await loadPostsFromSource()\r\n  };\r\n}\r\n\r\n// Default export remains for compatibility\r\nexport default {\r\n  loadPostsFromSource,\r\n  initializeAllContent,\r\n  createContentLoader\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\content-mappers.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\content-utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\content-validators.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\content.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'kind' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":297,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":297,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// lib/content.ts - FIXED COMPLETE VERSION\n// Centralised content exports - Contentlayer-based\n\n// ============================================\n// CONTENTLAYER HELPER (main source)\n// ============================================\nimport {\n  // Document getters - rename to avoid conflicts\n  getAllContentlayerDocs as getAllContentlayerDocsInternal,\n  getPublishedDocuments as getPublishedDocumentsInternal,\n  getFeaturedDocuments as getFeaturedDocumentsInternal,\n  getDocumentBySlug as getDocumentBySlugInternal,\n  getCardPropsForDocument as getCardPropsForDocumentInternal,\n  getPublishedDocumentsByType as getPublishedDocumentsByTypeInternal,\n  \n  // Type-specific getters\n  getPublishedPosts as getPublishedPostsInternal,\n  getPostBySlug as getPostBySlugInternal,\n  getAllBooks as getAllBooksInternal,\n  getAllDownloads as getAllDownloadsInternal,\n  getAllEvents as getAllEventsInternal,\n  getAllPrints as getAllPrintsInternal,\n  getAllResources as getAllResourcesInternal,\n  getAllStrategies as getAllStrategiesInternal,\n  getAllCanons as getAllCanonsInternal,\n  getPublishedShorts as getPublishedShortsInternal,\n  getShortBySlug as getShortBySlugInternal,\n  \n  // Types (keep these)\n  type AnyDoc,\n  type DocKind,\n  type ContentlayerCardProps,\n  type PostType,\n  type BookType,\n  type DownloadType,\n  type EventType,\n  type PrintType,\n  type ResourceType,\n  type StrategyType,\n  type CanonType,\n  type ShortType,\n  \n  // Type guards (import them from contentlayer-helper)\n  isPost,\n  isDownload,\n  isBook,\n  isEvent,\n  isPrint,\n  isResource,\n  isCanon,\n  isShort,\n  isStrategy,\n  isDraft,\n  isPublished,\n  isContentlayerLoaded,\n} from \"./contentlayer-helper\";\n\n// ============================================\n// SAFE FUNCTION WRAPPERS\n// ============================================\n// Wrap internal functions with safe guards to prevent runtime errors\n// if Contentlayer data isn't available\n\nexport const getPublishedPosts = (limit?: number) => {\n  if (!isContentlayerLoaded()) return [];\n  const posts = getPublishedPostsInternal();\n  return limit ? posts.slice(0, limit) : posts;\n};\n\nexport const getPostBySlug = (slug: string): PostType | null => {\n  if (!isContentlayerLoaded()) return null;\n  return getPostBySlugInternal(slug);\n};\n\nexport const getAllBooks = (limit?: number) => {\n  if (!isContentlayerLoaded()) return [];\n  const books = getAllBooksInternal();\n  return limit ? books.slice(0, limit) : books;\n};\n\nexport const getAllDownloads = (limit?: number) => {\n  if (!isContentlayerLoaded()) return [];\n  const downloads = getAllDownloadsInternal();\n  return limit ? downloads.slice(0, limit) : downloads;\n};\n\nexport const getAllEvents = (limit?: number) => {\n  if (!isContentlayerLoaded()) return [];\n  const events = getAllEventsInternal();\n  return limit ? events.slice(0, limit) : events;\n};\n\nexport const getAllPrints = (limit?: number) => {\n  if (!isContentlayerLoaded()) return [];\n  const prints = getAllPrintsInternal();\n  return limit ? prints.slice(0, limit) : prints;\n};\n\nexport const getAllResources = (limit?: number) => {\n  if (!isContentlayerLoaded()) return [];\n  const resources = getAllResourcesInternal();\n  return limit ? resources.slice(0, limit) : resources;\n};\n\nexport const getAllStrategies = (limit?: number) => {\n  if (!isContentlayerLoaded()) return [];\n  const strategies = getAllStrategiesInternal();\n  return limit ? strategies.slice(0, limit) : strategies;\n};\n\nexport const getAllCanons = (limit?: number) => {\n  if (!isContentlayerLoaded()) return [];\n  const canons = getAllCanonsInternal();\n  return limit ? canons.slice(0, limit) : canons;\n};\n\nexport const getPublishedShorts = (limit?: number) => {\n  if (!isContentlayerLoaded()) return [];\n  const shorts = getPublishedShortsInternal();\n  return limit ? shorts.slice(0, limit) : shorts;\n};\n\nexport const getShortBySlug = (slug: string): ShortType | null => {\n  if (!isContentlayerLoaded()) return null;\n  return getShortBySlugInternal(slug);\n};\n\n// ============================================\n// CONTENT AGGREGATION\n// ============================================\nexport const getAllDocuments = (): AnyDoc[] => {\n  if (!isContentlayerLoaded()) return [];\n  return getAllContentlayerDocsInternal();\n};\n\nexport const getPublishedDocuments = (): AnyDoc[] => {\n  if (!isContentlayerLoaded()) return [];\n  return getPublishedDocumentsInternal();\n};\n\nexport const getFeaturedDocuments = (limit?: number): AnyDoc[] => {\n  if (!isContentlayerLoaded()) return [];\n  const featured = getFeaturedDocumentsInternal();\n  return limit ? featured.slice(0, limit) : featured;\n};\n\nexport const getDocumentBySlug = (slug: string): AnyDoc | null => {\n  if (!isContentlayerLoaded()) return null;\n  return getDocumentBySlugInternal(slug);\n};\n\nexport const getCardPropsForDocument = (doc: AnyDoc): ContentlayerCardProps => {\n  return getCardPropsForDocumentInternal(doc);\n};\n\nexport const getPublishedDocumentsByType = (kind: DocKind, limit?: number): AnyDoc[] => {\n  if (!isContentlayerLoaded()) return [];\n  const docs = getPublishedDocumentsByTypeInternal(kind);\n  return limit ? docs.slice(0, limit) : docs;\n};\n\n// ============================================\n// CONTENT TYPE PREDICATES\n// ============================================\n// Export the imported type guards\nexport {\n  isPost,\n  isDownload,\n  isBook,\n  isEvent,\n  isPrint,\n  isResource,\n  isCanon,\n  isShort,\n  isStrategy,\n  isDraft,\n  isPublished,\n  isContentlayerLoaded,\n};\n\n// ============================================\n// TYPE EXPORTS\n// ============================================\nexport type {\n  AnyDoc,\n  DocKind,\n  ContentlayerCardProps,\n  PostType,\n  BookType,\n  DownloadType,\n  EventType,\n  PrintType,\n  ResourceType,\n  StrategyType,\n  CanonType,\n  ShortType,\n};\n\n// ============================================\n// CONTENT FILTERING\n// ============================================\nexport const filterDocumentsByTag = (tag: string, docs?: AnyDoc[]): AnyDoc[] => {\n  const documents = docs || getPublishedDocuments();\n  return documents.filter(doc => \n    Array.isArray(doc.tags) && \n    doc.tags.some((t: string) => t.toLowerCase() === tag.toLowerCase())\n  );\n};\n\nexport const getDocumentsByDateRange = (\n  startDate: Date,\n  endDate: Date,\n  docs?: AnyDoc[]\n): AnyDoc[] => {\n  const documents = docs || getPublishedDocuments();\n  return documents.filter(doc => {\n    if (!doc.date) return false;\n    const docDate = new Date(doc.date);\n    return docDate >= startDate && docDate <= endDate;\n  });\n};\n\n// ============================================\n// UTILITY FUNCTIONS\n// ============================================\nexport const getUniqueTags = (docs?: AnyDoc[]): string[] => {\n  const documents = docs || getPublishedDocuments();\n  const tagSet = new Set<string>();\n  \n  documents.forEach(doc => {\n    if (Array.isArray(doc.tags)) {\n      doc.tags.forEach((tag: string) => {\n        tagSet.add(tag.toLowerCase());\n      });\n    }\n  });\n  \n  return Array.from(tagSet).sort();\n};\n\nexport const getRecentDocuments = (limit: number = 10, kind?: DocKind): AnyDoc[] => {\n  let documents = getPublishedDocuments();\n  \n  if (kind) {\n    documents = documents.filter(doc => getDocKind(doc) === kind);\n  }\n  \n  return documents\n    .sort((a, b) => {\n      const dateA = a.date ? new Date(a.date).getTime() : 0;\n      const dateB = b.date ? new Date(b.date).getTime() : 0;\n      return dateB - dateA;\n    })\n    .slice(0, limit);\n};\n\n// Helper to get doc kind (imported or fallback)\nconst getDocKind = (doc: AnyDoc): DocKind => {\n  // This should be imported from contentlayer-helper, but we'll define a fallback\n  if (isPost(doc)) return \"post\";\n  if (isDownload(doc)) return \"download\";\n  if (isBook(doc)) return \"book\";\n  if (isEvent(doc)) return \"event\";\n  if (isPrint(doc)) return \"print\";\n  if (isResource(doc)) return \"resource\";\n  if (isStrategy(doc)) return \"strategy\";\n  if (isCanon(doc)) return \"canon\";\n  if (isShort(doc)) return \"short\";\n  return \"unknown\";\n};\n\n// ============================================\n// ALIASES FOR BACKWARD COMPATIBILITY\n// ============================================\nexport const getRecentShorts = getPublishedShorts;\nexport const getRecentPosts = getPublishedPosts;\nexport const getRecentBooks = getAllBooks;\nexport const getRecentDownloads = getAllDownloads;\nexport const getRecentEvents = getAllEvents;\nexport const getRecentPrints = getAllPrints;\nexport const getRecentResources = getAllResources;\nexport const getRecentStrategies = getAllStrategies;\nexport const getRecentCanons = getAllCanons;\n\n// ============================================\n// SITEMAP GENERATION HELPERS\n// ============================================\nexport const getDocumentsForSitemap = (): Array<{\n  url: string;\n  lastModified?: string;\n  changeFrequency?: 'always' | 'hourly' | 'daily' | 'weekly' | 'monthly' | 'yearly' | 'never';\n  priority?: number;\n}> => {\n  if (!isContentlayerLoaded()) return [];\n  \n  return getPublishedDocuments().map(doc => {\n    const kind = getDocKind(doc);\n    const baseUrl = process.env.NEXT_PUBLIC_SITE_URL || 'https://example.com';\n    const href = getCardPropsForDocument(doc).href;\n    \n    return {\n      url: `${baseUrl}${href}`,\n      lastModified: doc.date || undefined,\n      changeFrequency: 'weekly',\n      priority: doc.featured ? 0.8 : 0.5,\n    };\n  });\n};\n\n// ============================================\n// RSS FEED GENERATION HELPERS\n// ============================================\nexport const getDocumentsForRSS = (limit: number = 20): AnyDoc[] => {\n  if (!isContentlayerLoaded()) return [];\n  \n  return getPublishedDocuments()\n    .sort((a, b) => {\n      const dateA = a.date ? new Date(a.date).getTime() : 0;\n      const dateB = b.date ? new Date(b.date).getTime() : 0;\n      return dateB - dateA;\n    })\n    .slice(0, limit);\n};\n\n// ============================================\n// SEARCH INDEXING HELPERS\n// ============================================\nexport const getDocumentsForSearchIndex = (): Array<{\n  id: string;\n  title: string;\n  content: string;\n  excerpt?: string;\n  description?: string;\n  url: string;\n  tags: string[];\n  date?: string;\n  type: DocKind;\n}> => {\n  if (!isContentlayerLoaded()) return [];\n  \n  return getPublishedDocuments().map(doc => {\n    const cardProps = getCardPropsForDocument(doc);\n    \n    // Safely extract body content if it exists\n    const bodyContent = doc.body && typeof doc.body === 'object' && 'raw' in doc.body\n      ? (doc.body as { raw?: string }).raw || ''\n      : '';\n    \n    const content = [\n      doc.title,\n      doc.excerpt || '',\n      doc.description || '',\n      Array.isArray(doc.tags) ? doc.tags.join(' ') : '',\n      bodyContent,\n    ].join(' ').trim();\n    \n    return {\n      id: doc._id || doc.slug,\n      title: doc.title || 'Untitled',\n      content,\n      excerpt: doc.excerpt || undefined,\n      description: doc.description || undefined,\n      url: cardProps.href,\n      tags: Array.isArray(doc.tags) ? doc.tags : [],\n      date: doc.date || undefined,\n      type: getDocKind(doc),\n    };\n  });\n};\n\n// ============================================\n// BUILD VALIDATION\n// ============================================\nexport const validateContentlayerBuild = (): { isValid: boolean; errors: string[] } => {\n  if (!isContentlayerLoaded()) {\n    return {\n      isValid: false,\n      errors: ['Contentlayer is not loaded'],\n    };\n  }\n  \n  const errors: string[] = [];\n  const allDocs = getAllDocuments();\n  \n  if (allDocs.length === 0) {\n    errors.push('No documents found in Contentlayer');\n  }\n  \n  // Check for required fields\n  allDocs.forEach(doc => {\n    if (!doc.title) {\n      errors.push(`Document ${doc.slug || doc._id} is missing title`);\n    }\n    if (!doc.slug && !doc._raw?.flattenedPath) {\n      errors.push(`Document ${doc._id} is missing slug and flattenedPath`);\n    }\n  });\n  \n  return {\n    isValid: errors.length === 0,\n    errors,\n  };\n};","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\contentlayer-helper.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'name' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":661,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":661,"endColumn":28}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// lib/contentlayer-helper.ts - COMPLETE FIXED VERSION WITH TYPE GUARDS\n/* eslint-disable @typescript-eslint/no-explicit-any */\nimport * as generated from \"@/lib/contentlayer\";\n\n/* -------------------------------------------------------------------------- */\n/* Node.js-only imports (guarded for browser compatibility)                   */\n/* -------------------------------------------------------------------------- */\n\n// These will only be available server-side\nconst isServer = typeof window === \"undefined\";\nlet fs: any = null;\nlet path: any = null;\n\nif (isServer) {\n  // Dynamic require to avoid webpack bundling for browser\n  fs = eval('require')(\"fs\");\n  path = eval('require')(\"path\");\n}\n\n/* -------------------------------------------------------------------------- */\n/* Types                                                                      */\n/* -------------------------------------------------------------------------- */\n\nexport type DocKind =\n  | \"post\"\n  | \"book\"\n  | \"download\"\n  | \"event\"\n  | \"print\"\n  | \"resource\"\n  | \"strategy\"\n  | \"canon\"\n  | \"short\"\n  | \"unknown\";\n\nexport type AccessLevel = \"public\" | \"inner-circle\" | \"private\";\n\nexport type ContentDoc = any;\n\n// Basic type interfaces for better type safety\nexport interface BaseDoc {\n  _id: string;\n  slug: string;\n  title: string;\n  excerpt?: string;\n  description?: string;\n  date?: string;\n  tags?: string[];\n  coverImage?: string;\n  _raw: {\n    flattenedPath: string;\n    sourceFileName: string;\n  };\n  [key: string]: unknown;\n}\n\nexport interface PostDoc extends BaseDoc {\n  type: \"post\";\n  featured?: boolean;\n  category?: string;\n  readTime?: string;\n}\n\nexport interface BookDoc extends BaseDoc {\n  type: \"book\";\n  subtitle?: string;\n  isbn?: string;\n  publisher?: string;\n}\n\nexport interface DownloadDoc extends BaseDoc {\n  type: \"download\";\n  file?: string;\n  pdfPath?: string;\n  downloadFile?: string;\n  fileUrl?: string;\n  downloadUrl?: string;\n  fileSize?: string;\n  accessLevel?: AccessLevel;\n}\n\nexport interface EventDoc extends BaseDoc {\n  type: \"event\";\n  startDate?: string;\n  endDate?: string;\n  location?: string;\n  registrationUrl?: string;\n}\n\nexport interface PrintDoc extends BaseDoc {\n  type: \"print\";\n  format?: string;\n  dimensions?: string;\n  price?: string | number;\n  inStock?: boolean;\n}\n\nexport interface ResourceDoc extends BaseDoc {\n  type: \"resource\";\n  format?: string;\n  file?: string;\n}\n\nexport interface StrategyDoc extends BaseDoc {\n  type: \"strategy\";\n  framework?: string;\n  category?: string;\n}\n\nexport interface CanonDoc extends BaseDoc {\n  type: \"canon\";\n  volume?: number;\n  chapter?: number;\n}\n\nexport interface ShortDoc extends BaseDoc {\n  type: \"short\";\n  theme?: string;\n  readTime?: string;\n}\n\nexport type AnyDoc = PostDoc | BookDoc | DownloadDoc | EventDoc | PrintDoc | ResourceDoc | StrategyDoc | CanonDoc | ShortDoc;\n\n// Type aliases for backward compatibility\nexport type PostType = PostDoc;\nexport type BookType = BookDoc;\nexport type DownloadType = DownloadDoc;\nexport type EventType = EventDoc;\nexport type PrintType = PrintDoc;\nexport type ResourceType = ResourceDoc;\nexport type StrategyType = StrategyDoc;\nexport type CanonType = CanonDoc;\nexport type ShortType = ShortDoc;\n\n/* -------------------------------------------------------------------------- */\n/* Type Guards                                                                */\n/* -------------------------------------------------------------------------- */\n\nexport const isPost = (doc: AnyDoc): doc is PostType => doc.type === \"post\";\nexport const isDownload = (doc: AnyDoc): doc is DownloadType => doc.type === \"download\";\nexport const isBook = (doc: AnyDoc): doc is BookType => doc.type === \"book\";\nexport const isEvent = (doc: AnyDoc): doc is EventType => doc.type === \"event\";\nexport const isPrint = (doc: AnyDoc): doc is PrintType => doc.type === \"print\";\nexport const isResource = (doc: AnyDoc): doc is ResourceType => doc.type === \"resource\";\nexport const isCanon = (doc: AnyDoc): doc is CanonType => doc.type === \"canon\";\nexport const isShort = (doc: AnyDoc): doc is ShortType => doc.type === \"short\";\nexport const isStrategy = (doc: AnyDoc): doc is StrategyType => doc.type === \"strategy\";\nexport const isDraft = (doc: AnyDoc): boolean => Boolean(doc.draft);\nexport const isPublished = (doc: AnyDoc): boolean => !isDraft(doc);\nexport const isContentlayerLoaded = (): boolean => true;\n\n/* -------------------------------------------------------------------------- */\n/* Routing                                                                    */\n/* -------------------------------------------------------------------------- */\n\nconst KIND_URL_MAP: Record<DocKind, string> = {\n  post: \"/blog\",\n  book: \"/books\",\n  canon: \"/canon\",\n  download: \"/downloads\",\n  event: \"/events\",\n  print: \"/prints\",\n  short: \"/shorts\",\n  resource: \"/resources\",\n  strategy: \"/strategy\",\n  unknown: \"/content\",\n};\n\nconst GLOBAL_FALLBACK_IMAGE = \"/assets/images/writing-desk.webp\";\nconst SHORT_GLOBAL_FALLBACK = \"/assets/images/shorts/cover.jpg\";\n\n/* -------------------------------------------------------------------------- */\n/* Helpers                                                                    */\n/* -------------------------------------------------------------------------- */\n\nconst cleanStr = (v: unknown) => String(v ?? \"\").trim();\nconst cleanLower = (v: unknown) => cleanStr(v).toLowerCase();\nconst trimTrailingSlashes = (s: string) => s.replace(/\\/+$/, \"\");\nconst trimLeadingSlashes = (s: string) => s.replace(/^\\/+/, \"\");\nconst ensureLeadingSlash = (s: string) => (s.startsWith(\"/\") ? s : `/${s}`);\n\nfunction pickArray(name: string): ContentDoc[] {\n  const v = (generated as any)[name];\n  return Array.isArray(v) ? v : [];\n}\n\n/**\n * Build-time only. Resolves a public URL path (\"/assets/...\") to an absolute FS path.\n * Returns null if the URL path is not a site-local absolute path.\n */\nexport function publicUrlToFsPath(publicUrl: string): string | null {\n  if (!isServer || !path) return null;\n  \n  const u = cleanStr(publicUrl);\n  if (!u.startsWith(\"/\")) return null;\n  return path.join(process.cwd(), \"public\", trimLeadingSlashes(u));\n}\n\nexport function publicFileExists(publicUrl: string): boolean {\n  if (!isServer || !fs) return false;\n  \n  const fsPath = publicUrlToFsPath(publicUrl);\n  if (!fsPath) return false;\n  try {\n    return fs.existsSync(fsPath);\n  } catch {\n    return false;\n  }\n}\n\nexport function publicFileSizeBytes(publicUrl: string): number | null {\n  if (!isServer || !fs) return null;\n  \n  const fsPath = publicUrlToFsPath(publicUrl);\n  if (!fsPath) return null;\n  try {\n    const stat = fs.statSync(fsPath);\n    return typeof stat.size === \"number\" ? stat.size : null;\n  } catch {\n    return null;\n  }\n}\n\nexport function formatBytes(bytes: number): string {\n  const b = Math.max(0, bytes);\n  if (b < 1024) return `${b} B`;\n  const kb = b / 1024;\n  if (kb < 1024) return `${Math.round(kb)} KB`;\n  const mb = kb / 1024;\n  if (mb < 1024) return `${mb.toFixed(1)} MB`;\n  const gb = mb / 1024;\n  return `${gb.toFixed(1)} GB`;\n}\n\n/**\n * Canonical slug normalizer. Deterministic and resilient.\n */\nfunction toCanonicalSlug(input: unknown): string {\n  let s = cleanStr(input);\n  if (!s) return \"\";\n\n  s = s.split(\"#\")[0]?.split(\"?\")[0] ?? s;\n  s = s.replace(/^https?:\\/\\/[^/]+/i, \"\");\n  s = trimTrailingSlashes(cleanLower(s));\n  s = trimLeadingSlashes(s);\n\n  if (!s) return \"\";\n\n  const parts = s.split(\"/\").filter(Boolean);\n  return parts.length ? parts[parts.length - 1] : s;\n}\n\n/* -------------------------------------------------------------------------- */\n/* Collections                                                                */\n/* -------------------------------------------------------------------------- */\n\nexport const allPosts = pickArray(\"allPosts\");\nexport const allBooks = pickArray(\"allBooks\");\nexport const allDownloads = pickArray(\"allDownloads\");\nexport const allEvents = pickArray(\"allEvents\");\nexport const allPrints = pickArray(\"allPrints\");\nexport const allResources = pickArray(\"allResources\");\nexport const allStrategies = pickArray(\"allStrategies\");\nexport const allCanons = pickArray(\"allCanons\");\nexport const allShorts = pickArray(\"allShorts\");\n\n/* -------------------------------------------------------------------------- */\n/* Draft / Publish                                                            */\n/* -------------------------------------------------------------------------- */\n\nexport const isDraftContent = (doc: ContentDoc): boolean =>\n  doc?.draft === true || cleanStr(doc?._raw?.sourceFileName).startsWith(\"_\");\n\nexport const isPublishedContent = (doc: ContentDoc): boolean => !isDraftContent(doc);\n\n/* -------------------------------------------------------------------------- */\n/* Kind detection                                                             */\n/* -------------------------------------------------------------------------- */\n\nexport function getDocKind(doc: ContentDoc): DocKind {\n  const raw = cleanLower(doc?._type ?? doc?.type);\n  switch (raw) {\n    case \"post\":\n      return \"post\";\n    case \"book\":\n      return \"book\";\n    case \"canon\":\n      return \"canon\";\n    case \"short\":\n      return \"short\";\n    case \"download\":\n      return \"download\";\n    case \"resource\":\n      return \"resource\";\n    case \"event\":\n      return \"event\";\n    case \"print\":\n      return \"print\";\n    case \"strategy\":\n      return \"strategy\";\n    default:\n      return \"unknown\";\n  }\n}\n\n/* -------------------------------------------------------------------------- */\n/* Slug normalisation                                                         */\n/* -------------------------------------------------------------------------- */\n\nexport function normalizeSlug(doc: ContentDoc): string {\n  if (!doc) return \"\";\n\n  const explicit = toCanonicalSlug(doc.slug);\n  if (explicit) return explicit;\n\n  const fp = cleanStr(doc?._raw?.flattenedPath);\n  if (!fp) return \"\";\n\n  const fpClean = trimTrailingSlashes(cleanLower(fp));\n  const parts = fpClean.split(\"/\").filter(Boolean);\n  if (!parts.length) return \"\";\n\n  const last = parts[parts.length - 1];\n  const slug = last === \"index\" ? parts[parts.length - 2] ?? \"\" : last;\n\n  return toCanonicalSlug(slug);\n}\n\n/* -------------------------------------------------------------------------- */\n/* Access control                                                             */\n/* -------------------------------------------------------------------------- */\n\nexport function getAccessLevel(doc: ContentDoc): AccessLevel {\n  const v = cleanLower(doc?.accessLevel);\n  if (v === \"inner-circle\" || v === \"private\" || v === \"public\") return v;\n  return \"public\";\n}\n\nexport function isPublic(doc: ContentDoc): boolean {\n  return getAccessLevel(doc) === \"public\";\n}\n\n// Alias for compatibility\nexport function getRequiredTier(doc: ContentDoc): AccessLevel {\n  return getAccessLevel(doc);\n}\n\n/* -------------------------------------------------------------------------- */\n/* URLs                                                                       */\n/* -------------------------------------------------------------------------- */\n\nexport function getDocHref(doc: ContentDoc): string {\n  const kind = getDocKind(doc);\n  const slug = normalizeSlug(doc);\n  const base = KIND_URL_MAP[kind] ?? \"/content\";\n  return slug ? `${base}/${slug}` : base;\n}\n\n/* -------------------------------------------------------------------------- */\n/* Media                                                                      */\n/* -------------------------------------------------------------------------- */\n\n/**\n * Universal cover resolver across all 9 doc types.\n * Strict behavior: if doc provides a value, we return it with a leading slash.\n */\nexport function resolveDocCoverImage(doc: ContentDoc): string {\n  const explicit = cleanStr(doc?.coverImage || doc?.image || doc?.cover);\n  if (explicit) return ensureLeadingSlash(explicit);\n\n  return getDocKind(doc) === \"short\" ? SHORT_GLOBAL_FALLBACK : GLOBAL_FALLBACK_IMAGE;\n}\n\n/* -------------------------------------------------------------------------- */\n/* Download URL resolution (STRICT + CANONICAL)                               */\n/* -------------------------------------------------------------------------- */\n\nexport function resolveDocDownloadUrl(doc: ContentDoc): string | null {\n  const raw =\n    cleanStr(doc?.downloadUrl) ||\n    cleanStr(doc?.fileUrl) ||\n    cleanStr(doc?.pdfPath) ||\n    cleanStr(doc?.file) ||\n    cleanStr(doc?.downloadFile);\n\n  if (!raw) return null;\n\n  const url = ensureLeadingSlash(raw);\n\n  if (url.startsWith(\"/downloads/\")) {\n    return url.replace(/^\\/downloads\\//, \"/assets/downloads/\");\n  }\n\n  if (url.startsWith(\"/assets/downloads/\")) {\n    return url;\n  }\n\n  return url;\n}\n\nexport function resolveDocDownloadHref(doc: ContentDoc): string | null {\n  const direct = resolveDocDownloadUrl(doc);\n  if (!direct) return null;\n\n  const access = getAccessLevel(doc);\n  if (access === \"public\") return direct;\n\n  const slug = normalizeSlug(doc);\n  if (!slug) return null;\n\n  return `/api/downloads/${encodeURIComponent(slug)}`;\n}\n\nexport function resolveDocDownloadSizeLabel(doc: ContentDoc): string | null {\n  const explicit = cleanStr(doc?.fileSize);\n  if (explicit) return explicit;\n\n  const url = resolveDocDownloadUrl(doc);\n  if (!url) return null;\n\n  const bytes = publicFileSizeBytes(url);\n  if (bytes == null) return null;\n\n  return formatBytes(bytes);\n}\n\n/* -------------------------------------------------------------------------- */\n/* Aggregation                                                                */\n/* -------------------------------------------------------------------------- */\n\nexport const getAllContentlayerDocs = (): ContentDoc[] =>\n  [\n    ...allPosts,\n    ...allBooks,\n    ...allDownloads,\n    ...allEvents,\n    ...allPrints,\n    ...allResources,\n    ...allStrategies,\n    ...allCanons,\n    ...allShorts,\n  ].filter(Boolean);\n\nexport const getPublishedDocuments = (): ContentDoc[] =>\n  getAllContentlayerDocs().filter(isPublishedContent);\n\nexport function getPublishedDocumentsByType(kind: DocKind, limit?: number): ContentDoc[] {\n  const items = getPublishedDocuments()\n    .filter((d) => getDocKind(d) === kind)\n    .sort(\n      (a, b) =>\n        new Date(b?.date || 0).getTime() - new Date(a?.date || 0).getTime(),\n    );\n\n  return typeof limit === \"number\" ? items.slice(0, limit) : items;\n}\n\n/* Named Queries */\nexport const getPublishedPosts = () => getPublishedDocumentsByType(\"post\");\nexport const getAllBooks = () => getPublishedDocumentsByType(\"book\");\nexport const getAllCanons = () => getPublishedDocumentsByType(\"canon\");\nexport const getAllDownloads = () => getPublishedDocumentsByType(\"download\");\nexport const getAllEvents = () => getPublishedDocumentsByType(\"event\");\nexport const getAllPrints = () => getPublishedDocumentsByType(\"print\");\nexport const getAllResources = () => getPublishedDocumentsByType(\"resource\");\nexport const getAllStrategies = () => getPublishedDocumentsByType(\"strategy\");\nexport const getPublishedShorts = () => getPublishedDocumentsByType(\"short\");\n\n// Alias for compatibility\nexport const getRecentShorts = (limit?: number) => \n  getPublishedDocumentsByType(\"short\", limit);\n\n/* By Slug */\nconst cleanMatch = (s: string) => toCanonicalSlug(s);\n\nexport const getDownloadBySlug = (s: string) =>\n  getAllDownloads().find((d) => normalizeSlug(d) === cleanMatch(s)) ?? null;\n\nexport const getPostBySlug = (s: string) =>\n  getPublishedPosts().find((d) => normalizeSlug(d) === cleanMatch(s)) ?? null;\n\nexport const getBookBySlug = (s: string) =>\n  getAllBooks().find((d) => normalizeSlug(d) === cleanMatch(s)) ?? null;\n\nexport const getCanonBySlug = (s: string) =>\n  getAllCanons().find((d) => normalizeSlug(d) === cleanMatch(s)) ?? null;\n\nexport const getShortBySlug = (s: string) =>\n  getPublishedShorts().find((d) => normalizeSlug(d) === cleanMatch(s)) ?? null;\n\nexport const getResourceBySlug = (s: string) =>\n  getAllResources().find((d) => normalizeSlug(d) === cleanMatch(s)) ?? null;\n\nexport const getEventBySlug = (s: string) =>\n  getAllEvents().find((d) => normalizeSlug(d) === cleanMatch(s)) ?? null;\n\nexport const getPrintBySlug = (s: string) =>\n  getAllPrints().find((d) => normalizeSlug(d) === cleanMatch(s)) ?? null;\n\nexport const getStrategyBySlug = (s: string) =>\n  getAllStrategies().find((d) => normalizeSlug(d) === cleanMatch(s)) ?? null;\n\n/* -------------------------------------------------------------------------- */\n/* Build Guard                                                                */\n/* -------------------------------------------------------------------------- */\n\nexport function assertContentlayerHasDocs(where: string) {\n  if (getAllContentlayerDocs().length === 0) {\n    throw new Error(`[Critical Build Error] No Contentlayer documents found at ${where}`);\n  }\n}\n\n/**\n * Validates that site-local /assets/* referenced by ANY doc exist in /public.\n * This covers the \"all 9 doc types\" requirement (covers images + other assets).\n * It DOES NOT guess, it only validates deterministic /assets/ paths.\n */\nexport function assertPublicAssetsExistForAllDocs(docs: ContentDoc[]) {\n  const missing: string[] = [];\n\n  for (const doc of docs) {\n    const kind = getDocKind(doc);\n    const slug = normalizeSlug(doc) || \"(no-slug)\";\n    const label = `${kind}/${slug}`;\n\n    // Cover images (if under /assets/)\n    const img = resolveDocCoverImage(doc);\n    if (img.startsWith(\"/assets/\") && !publicFileExists(img)) {\n      missing.push(`${label} coverImage -> ${img}`);\n    }\n\n    // Download files (if present and under /assets/)\n    const dl = resolveDocDownloadUrl(doc);\n    if (dl && dl.startsWith(\"/assets/\") && !publicFileExists(dl)) {\n      missing.push(`${label} downloadFile -> ${dl}`);\n    }\n  }\n\n  if (missing.length) {\n    throw new Error(\n      `[Critical Build Error] Missing public assets referenced by content:\\n` + missing.join(\"\\n\"),\n    );\n  }\n}\n\n/**\n * Validates that all download files referenced in download documents exist in the public directory.\n * This is a specific version of assertPublicAssetsExistForAllDocs focused only on downloads.\n */\nexport function assertDownloadFilesExist(): void {\n  if (!isServer) {\n    console.warn('assertDownloadFilesExist is only available server-side');\n    return;\n  }\n  \n  const downloads = getAllDownloads();\n  const missing: string[] = [];\n\n  for (const doc of downloads) {\n    const slug = normalizeSlug(doc) || \"(no-slug)\";\n    const label = `download/${slug}`;\n\n    // Check download files\n    const dl = resolveDocDownloadUrl(doc);\n    if (dl && dl.startsWith(\"/assets/\") && !publicFileExists(dl)) {\n      missing.push(`${label} downloadFile -> ${dl}`);\n    }\n    \n    // Also check cover images for downloads\n    const img = resolveDocCoverImage(doc);\n    if (img.startsWith(\"/assets/\") && !publicFileExists(img)) {\n      missing.push(`${label} coverImage -> ${img}`);\n    }\n  }\n\n  if (missing.length) {\n    throw new Error(\n      `[Critical Build Error] Missing download files referenced by content:\\n` + missing.join(\"\\n\")\n    );\n  }\n}\n\n// Optional: Add an alias for backward compatibility if needed\nexport const assertDownloadsExist = assertDownloadFilesExist;\n\n/* -------------------------------------------------------------------------- */\n/* Card Props Helper                                                          */\n/* -------------------------------------------------------------------------- */\n\n/**\n * Universal card props extractor for all doc types.\n */\nexport function getCardPropsForDocument(doc: ContentDoc): {\n  slug: string;\n  title: string;\n  excerpt: string | null;\n  description: string | null;\n  href: string;\n  coverImage: string | null;\n  tags: string[];\n  date: string | null;\n  kind: DocKind;\n  accessLevel: AccessLevel;\n  fileSize: string | null;\n} {\n  const kind = getDocKind(doc);\n  const slug = normalizeSlug(doc);\n  const access = getAccessLevel(doc);\n  \n  return {\n    slug,\n    title: cleanStr(doc?.title) || \"Untitled\",\n    excerpt: cleanStr(doc?.excerpt) || null,\n    description: cleanStr(doc?.description) || null,\n    href: getDocHref(doc),\n    coverImage: resolveDocCoverImage(doc),\n    tags: Array.isArray(doc?.tags) ? doc.tags.map(cleanStr) : [],\n    date: doc?.date ? safeDate(doc.date) : null,\n    kind,\n    accessLevel: access,\n    fileSize: kind === \"download\" ? resolveDocDownloadSizeLabel(doc) : null,\n  };\n}\n\nexport type ContentlayerCardProps = ReturnType<typeof getCardPropsForDocument>;\n\n/* -------------------------------------------------------------------------- */\n/* Utility Helpers                                                            */\n/* -------------------------------------------------------------------------- */\n\nfunction safeDate(input: unknown): string {\n  if (!input) return \"\";\n  try {\n    const date = new Date(String(input));\n    return date.toISOString().split(\"T\")[0] || \"\";\n  } catch {\n    return \"\";\n  }\n}\n\n/* -------------------------------------------------------------------------- */\n/* Document Getter                                                            */\n/* -------------------------------------------------------------------------- */\n\nexport const getDocumentBySlug = (slug: string): ContentDoc | null => {\n  const slugClean = toCanonicalSlug(slug);\n  \n  // Try all collections in order of priority\n  const collections = [\n    { getter: getPostBySlug, name: \"post\" },\n    { getter: getBookBySlug, name: \"book\" },\n    { getter: getDownloadBySlug, name: \"download\" },\n    { getter: getShortBySlug, name: \"short\" },\n    { getter: getCanonBySlug, name: \"canon\" },\n    { getter: getResourceBySlug, name: \"resource\" },\n    { getter: getEventBySlug, name: \"event\" },\n    { getter: getPrintBySlug, name: \"print\" },\n    { getter: getStrategyBySlug, name: \"strategy\" },\n  ];\n  \n  for (const { getter, name } of collections) {\n    const doc = getter(slugClean);\n    if (doc) return doc;\n  }\n  \n  return null;\n};\n\n/* -------------------------------------------------------------------------- */\n/* Featured Documents                                                         */\n/* -------------------------------------------------------------------------- */\n\nexport const getFeaturedDocuments = (limit?: number): ContentDoc[] => {\n  const allDocs = getPublishedDocuments();\n  const featured = allDocs.filter(doc => doc?.featured === true);\n  \n  // Sort by date (newest first)\n  const sorted = featured.sort((a, b) => {\n    const dateA = a.date ? new Date(a.date).getTime() : 0;\n    const dateB = b.date ? new Date(b.date).getTime() : 0;\n    return dateB - dateA;\n  });\n  \n  return typeof limit === \"number\" ? sorted.slice(0, limit) : sorted;\n};","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\contentlayer.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\date.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\dateUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\db\\interactions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\db\\schema.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\debug-books.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\downloads.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\downloads\\audit.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\downloads\\security.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\email\\dispatcher.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\email\\sendInnerCircleEmail.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\email\\sendInnerCircleEmail.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\email\\templates\\InnerCircleEmail.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\empty-module.js","messages":[{"ruleId":"import/no-anonymous-default-export","severity":1,"message":"Assign object to a variable before exporting as module default","line":3,"column":1,"nodeType":"ExportDefaultDeclaration","endLine":3,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// lib/empty-module.js\r\n// Empty module for webpack replacements\r\nexport default {};\r\nexport const Client = null;\r\nexport const Pool = null;\r\nexport const native = null;","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\events.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\fonts.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FONT_MAP' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":20,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// lib/fonts.ts\n// Central, tree-shakeable font utility (no React imports)\n\nexport type FontKey =\n  | \"button\"\n  | \"button-sm\"\n  | \"button-lg\"\n  | \"h1\"\n  | \"h2\"\n  | \"h3\"\n  | \"subtitle\"\n  | \"articleBody\"\n  | \"body\"\n  | \"caption\";\n\n// Backwards-compatible alias for consumers expecting FontFamilyKey\nexport type FontFamilyKey = FontKey;\n\n/** Map semantic keys to Tailwind classes for typography. */\nconst FONT_MAP: Record<FontKey, string> = {\n  // Button styles\n  \"button-sm\": \"font-sans text-sm tracking-wide\",\n  button: \"font-sans text-base tracking-wide\",\n  \"button-lg\": \"font-sans text-lg tracking-wide\",\n\n  // Heading styles\n  h1: \"text-4xl md:text-5xl font-bold font-serif tracking-tight\",\n  h2: \"text-3xl md:text-4xl font-semibold font-serif tracking-tight\",\n  h3: \"text-2xl md:text-3xl font-semibold font-serif\",\n\n  // Text styles\n  subtitle: \"text-lg md:text-xl font-sans text-deepCharcoal/80\",\n  articleBody: \"text-lg font-sans leading-relaxed md:leading-loose\",\n  body: \"text-base font-sans leading-relaxed\",\n  caption: \"text-sm font-sans text-deepCharcoal/70\",\n};\n","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\fonts\\FontProvider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\fonts\\client.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\fonts\\fonts.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\fonts\\index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\framer-transitions.ts","messages":[{"ruleId":"import/no-anonymous-default-export","severity":1,"message":"Assign object to a variable before exporting as module default","line":310,"column":1,"nodeType":"ExportDefaultDeclaration","endLine":360,"endColumn":3}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// ---------------------------------------------------------------------------------\n// Lightweight transition typings (no framer-motion import needed)\n// ---------------------------------------------------------------------------------\nexport type EasingName = \"linear\" | \"easeIn\" | \"easeOut\" | \"easeInOut\";\nexport type CubicBezier = readonly [number, number, number, number];\n\nexport type SpringConfig = {\n  type: \"spring\";\n  stiffness?: number;\n  damping?: number;\n  mass?: number;\n  delay?: number;\n};\n\nexport type DurationConfig = {\n  duration: number;\n  ease: EasingName | CubicBezier;\n  delay?: number;\n  repeat?: number | \"Infinity\";\n};\n\nexport type TransitionLike = SpringConfig | DurationConfig;\n\n// =============================================================================\n// CORE TRANSITION PRESETS\n// =============================================================================\n\n/** Spring-based transitions (natural, physics-based) */\nexport const springTransition = {\n  type: \"spring\",\n  stiffness: 100,\n  damping: 20,\n  mass: 1,\n} as const satisfies SpringConfig;\n\nexport const fastSpringTransition = {\n  type: \"spring\",\n  stiffness: 300,\n  damping: 30,\n  mass: 0.8,\n} as const satisfies SpringConfig;\n\nexport const bouncySpringTransition = {\n  type: \"spring\",\n  stiffness: 200,\n  damping: 15,\n  mass: 1,\n} as const satisfies SpringConfig;\n\nexport const gentleSpringTransition = {\n  type: \"spring\",\n  stiffness: 60,\n  damping: 18,\n  mass: 1.2,\n} as const satisfies SpringConfig;\n\nexport const stiffSpringTransition = {\n  type: \"spring\",\n  stiffness: 500,\n  damping: 40,\n  mass: 0.5,\n} as const satisfies SpringConfig;\n\n/** Duration-based transitions (precise timing) */\nexport const instantTransition = {\n  duration: 0.1,\n  ease: \"linear\",\n} as const satisfies DurationConfig;\n\nexport const microTransition = {\n  duration: 0.15,\n  ease: \"easeOut\",\n} as const satisfies DurationConfig;\n\nexport const shortTransition = {\n  duration: 0.3,\n  ease: \"easeOut\",\n} as const satisfies DurationConfig;\n\nexport const defaultTransition = {\n  duration: 0.5,\n  ease: \"easeOut\",\n} as const satisfies DurationConfig;\n\nexport const longTransition = {\n  duration: 0.8,\n  ease: \"easeOut\",\n} as const satisfies DurationConfig;\n\nexport const extraLongTransition = {\n  duration: 1.2,\n  ease: \"easeOut\",\n} as const satisfies DurationConfig;\n\n// =============================================================================\n// EASING PRESETS\n// =============================================================================\n\nexport const easeInOutTransition = {\n  duration: 0.5,\n  ease: [0.4, 0, 0.2, 1] as const, // Material Design standard\n} as const satisfies DurationConfig;\n\nexport const easeInTransition = {\n  duration: 0.5,\n  ease: [0.4, 0, 1, 1] as const,\n} as const satisfies DurationConfig;\n\nexport const easeOutTransition = {\n  duration: 0.5,\n  ease: [0, 0, 0.2, 1] as const,\n} as const satisfies DurationConfig;\n\nexport const sharpTransition = {\n  duration: 0.4,\n  ease: [0.4, 0, 0.6, 1] as const,\n} as const satisfies DurationConfig;\n\nexport const smoothTransition = {\n  duration: 0.6,\n  ease: [0.25, 0.46, 0.45, 0.94] as const, // easeOutQuad-like\n} as const satisfies DurationConfig;\n\n// =============================================================================\n// SPECIALIZED TRANSITIONS\n// =============================================================================\n\n/** Page & overlay */\nexport const pageTransition = {\n  duration: 0.4,\n  ease: [0.25, 0.46, 0.45, 0.94] as const,\n} as const satisfies DurationConfig;\n\nexport const modalTransition = {\n  duration: 0.3,\n  ease: [0.4, 0, 0.2, 1] as const,\n} as const satisfies DurationConfig;\n\nexport const drawerTransition = {\n  type: \"spring\",\n  stiffness: 300,\n  damping: 30,\n} as const satisfies SpringConfig;\n\n/** Loading & infinite */\nexport const loaderTransition = {\n  repeat: Infinity as unknown as \"Infinity\", // keep type simple without framer types\n  duration: 1.4,\n  ease: \"easeInOut\",\n} as const satisfies DurationConfig;\n\nexport const linearTransition = {\n  repeat: Infinity as unknown as \"Infinity\",\n  duration: 1.4,\n  ease: \"linear\",\n} as const satisfies DurationConfig;\n\nexport const pulseTransition = {\n  repeat: Infinity as unknown as \"Infinity\",\n  duration: 2,\n  ease: \"easeInOut\",\n} as const satisfies DurationConfig;\n\nexport const breatheTransition = {\n  repeat: Infinity as unknown as \"Infinity\",\n  duration: 3,\n  ease: \"easeInOut\",\n} as const satisfies DurationConfig;\n\n// =============================================================================\n// STAGGER UTILITIES\n// =============================================================================\n\nexport const staggeredTransition = (delay: number = 0.1) =>\n  ({\n    duration: 0.5,\n    delay,\n    ease: \"easeOut\",\n  }) as const satisfies DurationConfig;\n\nexport const staggeredSpringTransition = (delay: number = 0.1) =>\n  ({\n    ...springTransition,\n    delay,\n  }) as const satisfies SpringConfig & { delay: number };\n\nexport const staggeredFastSpringTransition = (delay: number = 0.05) =>\n  ({\n    ...fastSpringTransition,\n    delay,\n  }) as const satisfies SpringConfig & { delay: number };\n\n// =============================================================================\n// COMPOSITE TRANSITIONS\n// =============================================================================\n\nexport const slideUpTransition = {\n  ...defaultTransition,\n  ease: \"easeOut\",\n} as const satisfies DurationConfig;\n\nexport const slideDownTransition = {\n  ...defaultTransition,\n  ease: \"easeOut\",\n} as const satisfies DurationConfig;\n\nexport const fadeInTransition = {\n  ...longTransition,\n  ease: \"easeOut\",\n} as const satisfies DurationConfig;\n\nexport const scaleTransition = {\n  ...fastSpringTransition,\n} as const satisfies SpringConfig;\n\nexport const rotateTransition = {\n  ...springTransition,\n} as const satisfies SpringConfig;\n\n// =============================================================================\n// TRANSITION GENERATORS\n// =============================================================================\n\nexport const createSpringTransition = (\n  stiffness: number = 100,\n  damping: number = 20,\n  mass: number = 1,\n  delay?: number\n): SpringConfig => ({\n  type: \"spring\",\n  stiffness,\n  damping,\n  mass,\n  ...(typeof delay === \"number\" ? { delay } : {}),\n});\n\nexport const createDurationTransition = (\n  duration: number = 0.5,\n  ease: EasingName | CubicBezier = \"easeOut\",\n  delay?: number,\n  repeat?: number | \"Infinity\"\n): DurationConfig => ({\n  duration,\n  ease,\n  ...(typeof delay === \"number\" ? { delay } : {}),\n  ...(typeof repeat !== \"undefined\" ? { repeat } : {}),\n});\n\nexport const createStaggeredTransition =\n  <T extends TransitionLike>(base: T, staggerDelay: number = 0.1) =>\n  (index: number): T & { delay: number } => ({\n    ...base,\n    delay: (base as any).delay\n      ? (base as any).delay + index * staggerDelay\n      : index * staggerDelay,\n  });\n\n// =============================================================================\n// PRESET COLLECTIONS\n// =============================================================================\n\nexport const TransitionPresets = {\n  // UI\n  button: fastSpringTransition,\n  card: springTransition,\n  input: microTransition,\n  tooltip: shortTransition,\n\n  // Navigation\n  navbar: fastSpringTransition,\n  sidebar: drawerTransition,\n  dropdown: shortTransition,\n\n  // Page Elements\n  hero: longTransition,\n  section: defaultTransition,\n  footer: longTransition,\n\n  // Interactive\n  hover: microTransition,\n  tap: instantTransition,\n  focus: microTransition,\n} as const;\n\nexport const EasingCurves = {\n  standard: [0.4, 0, 0.2, 1] as const,\n  enter: [0, 0, 0.2, 1] as const,\n  exit: [0.4, 0, 1, 1] as const,\n  sharp: [0.4, 0, 0.6, 1] as const,\n  easeOut: [0, 0, 0.2, 1] as const,\n  easeIn: [0.4, 0, 1, 1] as const,\n  easeInOut: [0.4, 0, 0.2, 1] as const,\n  bounce: [0.68, -0.55, 0.265, 1.55] as const,\n} as const;\n\n// =============================================================================\n// TYPES\n// =============================================================================\n\nexport type SpringTransition = typeof springTransition;\nexport type DurationTransition = typeof defaultTransition;\nexport type StaggeredTransition = ReturnType<typeof staggeredTransition>;\nexport type TransitionPreset = keyof typeof TransitionPresets;\nexport type TransitionConfig = TransitionLike;\n\n// =============================================================================\n// DEFAULT EXPORT\n// =============================================================================\n\nexport default {\n  // Core\n  springTransition,\n  fastSpringTransition,\n  bouncySpringTransition,\n  gentleSpringTransition,\n  stiffSpringTransition,\n\n  // Duration\n  instantTransition,\n  microTransition,\n  shortTransition,\n  defaultTransition,\n  longTransition,\n  extraLongTransition,\n\n  // Easing\n  easeInOutTransition,\n  easeInTransition,\n  easeOutTransition,\n  sharpTransition,\n  smoothTransition,\n\n  // Specialized\n  pageTransition,\n  modalTransition,\n  drawerTransition,\n  loaderTransition,\n  linearTransition,\n  pulseTransition,\n  breatheTransition,\n\n  // Staggered\n  staggeredTransition,\n  staggeredSpringTransition,\n  staggeredFastSpringTransition,\n\n  // Composite\n  slideUpTransition,\n  slideDownTransition,\n  fadeInTransition,\n  scaleTransition,\n  rotateTransition,\n\n  // Presets & utilities\n  TransitionPresets,\n  EasingCurves,\n  createSpringTransition,\n  createDurationTransition,\n  createStaggeredTransition,\n};\n","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\fs-utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\gtag.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\hero-banners.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\hooks\\useDebounce.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\image-utils.ts","messages":[{"ruleId":"import/no-anonymous-default-export","severity":1,"message":"Assign object to a variable before exporting as module default","line":594,"column":1,"nodeType":"ExportDefaultDeclaration","endLine":611,"endColumn":3}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// lib/image-utils.ts\r\nimport { safeString } from \"./utils\";\r\n\r\n/* -------------------------------------------------------------------------- */\r\n/* TYPES & INTERFACES                                                         */\r\n/* -------------------------------------------------------------------------- */\r\n\r\ninterface ImageMetadata {\r\n  src: string;\r\n  alt?: string;\r\n  width?: number;\r\n  height?: number;\r\n  aspectRatio?: number;\r\n  format?: string;\r\n  quality?: number;\r\n  blurDataURL?: string;\r\n}\r\n\r\ninterface FallbackConfig {\r\n  type: \"book\" | \"post\" | \"avatar\" | \"project\";\r\n  theme?: \"light\" | \"dark\" | \"gradient\";\r\n  category?: string;\r\n}\r\n\r\ninterface ImageValidationResult {\r\n  isValid: boolean;\r\n  reason?:\r\n    | \"invalid-url\"\r\n    | \"missing-protocol\"\r\n    | \"unsupported-format\"\r\n    | \"size-too-large\";\r\n  suggestedFix?: string;\r\n}\r\n\r\n/* -------------------------------------------------------------------------- */\r\n/* CONSTANTS & CONFIGURATION                                                  */\r\n/* -------------------------------------------------------------------------- */\r\n\r\nconst CDN_BASE_URL =\r\n  process.env.NEXT_PUBLIC_CDN_URL || \"https://cdn.abrahamoflondon.org\";\r\n\r\nconst SUPPORTED_FORMATS = [\r\n  \"jpg\",\r\n  \"jpeg\",\r\n  \"png\",\r\n  \"webp\",\r\n  \"avif\",\r\n  \"gif\",\r\n  \"svg\",\r\n] as const;\r\n\r\ntype SupportedFormat = (typeof SUPPORTED_FORMATS)[number];\r\n\r\nconst PREFERRED_FORMAT: SupportedFormat = \"webp\";\r\n\r\n// âœ… FIXED: Use mutable array types instead of readonly arrays\r\ninterface ImageConfig {\r\n  widths: number[];\r\n  quality: number;\r\n  formats: SupportedFormat[];\r\n}\r\n\r\nconst IMAGE_OPTIMIZATION: Record<string, ImageConfig> = {\r\n  cover: {\r\n    widths: [320, 640, 768, 1024, 1280, 1536, 1920],\r\n    quality: 85,\r\n    formats: [\"webp\", \"jpg\"],\r\n  },\r\n  thumbnail: {\r\n    widths: [100, 200, 300, 400],\r\n    quality: 75,\r\n    formats: [\"webp\"],\r\n  },\r\n  avatar: {\r\n    widths: [32, 64, 128, 256],\r\n    quality: 90,\r\n    formats: [\"webp\"],\r\n  },\r\n};\r\n\r\nconst FALLBACK_IMAGES = {\r\n  book: {\r\n    default: [\r\n      \"/assets/images/books/default-cover-1.webp\",\r\n      \"/assets/images/books/default-cover-2.webp\",\r\n      \"/assets/images/books/default-cover-3.webp\",\r\n    ],\r\n    fiction: \"/assets/images/books/fallback-fiction.webp\",\r\n    nonFiction: \"/assets/images/books/fallback-nonfiction.webp\",\r\n    philosophy: \"/assets/images/books/fallback-philosophy.webp\",\r\n    business: \"/assets/images/books/fallback-business.webp\",\r\n    gradient: \"/assets/images/gradients/book-gradient-1.svg\",\r\n  },\r\n\r\n  post: {\r\n    default: [\r\n      \"/assets/images/posts/default-1.webp\",\r\n      \"/assets/images/posts/default-2.webp\",\r\n      \"/assets/images/posts/default-3.webp\",\r\n    ],\r\n    essay: \"/assets/images/posts/essay-default.webp\",\r\n    article: \"/assets/images/posts/article-default.webp\",\r\n    thought: \"/assets/images/posts/thought-default.webp\",\r\n    gradient: \"/assets/images/gradients/post-gradient-1.svg\",\r\n  },\r\n\r\n  project: {\r\n    default: \"/assets/images/projects/default-project.webp\",\r\n    active: \"/assets/images/projects/active-project.webp\",\r\n    archived: \"/assets/images/projects/archived-project.webp\",\r\n    gradient: \"/assets/images/gradients/project-gradient-1.svg\",\r\n  },\r\n\r\n  avatar: {\r\n    default: \"/assets/images/avatars/default-avatar.webp\",\r\n    author: \"/assets/images/avatars/author-avatar.webp\",\r\n    guest: \"/assets/images/avatars/guest-avatar.webp\",\r\n    gradient: \"/assets/images/gradients/avatar-gradient-1.svg\",\r\n  },\r\n\r\n  generic: {\r\n    placeholder: \"/assets/images/placeholder.webp\",\r\n    gradient: {\r\n      light: \"/assets/images/gradients/light-gradient.svg\",\r\n      dark: \"/assets/images/gradients/dark-gradient.svg\",\r\n      gold: \"/assets/images/gradients/gold-gradient.svg\",\r\n      forest: \"/assets/images/gradients/forest-gradient.svg\",\r\n    },\r\n  },\r\n} as const;\r\n\r\n/* -------------------------------------------------------------------------- */\r\n/* HELPERS                                                                    */\r\n/* -------------------------------------------------------------------------- */\r\n\r\nfunction getFileExtension(path: string): string {\r\n  const fileName = path.split(\"/\").pop() || \"\";\r\n  const extension = fileName.split(\".\").pop() || \"\";\r\n  return extension.toLowerCase();\r\n}\r\n\r\nfunction toBase64(str: string): string {\r\n  // Safe for both Node and browser\r\n  if (typeof window === \"undefined\") {\r\n    // Node.js runtime\r\n    // eslint-disable-next-line no-undef\r\n    return Buffer.from(str).toString(\"base64\");\r\n  }\r\n  // Browser runtime\r\n  return window.btoa(unescape(encodeURIComponent(str)));\r\n}\r\n\r\n/* -------------------------------------------------------------------------- */\r\n/* URL VALIDATION & NORMALIZATION                                             */\r\n/* -------------------------------------------------------------------------- */\r\n\r\nfunction isValidImageUrl(url: string | undefined | null): boolean {\r\n  if (!url || typeof url !== \"string\" || url.trim() === \"\") {\r\n    return false;\r\n  }\r\n\r\n  const trimmedUrl = url.trim();\r\n\r\n  // Data URL\r\n  if (trimmedUrl.startsWith(\"data:\")) {\r\n    return trimmedUrl.startsWith(\"data:image/\");\r\n  }\r\n\r\n  // Local path\r\n  if (trimmedUrl.startsWith(\"/\")) {\r\n    return true;\r\n  }\r\n\r\n  // External URL\r\n  try {\r\n    const parsed = new URL(trimmedUrl);\r\n    const ext = getFileExtension(parsed.pathname).toLowerCase() as\r\n      | SupportedFormat\r\n      | \"\";\r\n    return (SUPPORTED_FORMATS as readonly string[]).includes(ext);\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\nfunction normalizeImageUrl(\r\n  url: string | undefined | null,\r\n  options: {\r\n    baseUrl?: string;\r\n    forceHttps?: boolean;\r\n    addCdnPrefix?: boolean;\r\n  } = {}\r\n): string {\r\n  if (!url || typeof url !== \"string\" || url.trim() === \"\") {\r\n    return \"\";\r\n  }\r\n\r\n  const { baseUrl = \"\", forceHttps = true, addCdnPrefix = false } = options;\r\n  let normalized = url.trim();\r\n\r\n  // Data URLs\r\n  if (normalized.startsWith(\"data:\")) {\r\n    return normalized;\r\n  }\r\n\r\n  // Local paths\r\n  if (normalized.startsWith(\"/\")) {\r\n    if (baseUrl && !normalized.startsWith(baseUrl)) {\r\n      normalized = `${baseUrl.replace(/\\/$/, \"\")}${normalized}`;\r\n    }\r\n  } else if (\r\n    !normalized.startsWith(\"http://\") &&\r\n    !normalized.startsWith(\"https://\")\r\n  ) {\r\n    // Relative path without leading slash\r\n    normalized = `/${normalized}`;\r\n    if (baseUrl) {\r\n      normalized = `${baseUrl.replace(/\\/$/, \"\")}${normalized}`;\r\n    }\r\n  }\r\n\r\n  if (forceHttps && normalized.startsWith(\"http://\")) {\r\n    normalized = normalized.replace(\"http://\", \"https://\");\r\n  }\r\n\r\n  if (addCdnPrefix && CDN_BASE_URL && !normalized.includes(CDN_BASE_URL)) {\r\n    if (normalized.startsWith(\"/\")) {\r\n      normalized = `${CDN_BASE_URL}${normalized}`;\r\n    } else if (normalized.startsWith(\"http\")) {\r\n      // Already absolute â€“ leave it\r\n    } else {\r\n      normalized = `${CDN_BASE_URL}/${normalized}`;\r\n    }\r\n  }\r\n\r\n  return normalized;\r\n}\r\n\r\nfunction validateImageUrl(url: string | null | undefined): ImageValidationResult {\r\n  if (!url) {\r\n    return { isValid: false, reason: \"invalid-url\" };\r\n  }\r\n\r\n  if (!isValidImageUrl(url)) {\r\n    return { isValid: false, reason: \"unsupported-format\" };\r\n  }\r\n\r\n  if (url.startsWith(\"http://\")) {\r\n    return {\r\n      isValid: true,\r\n      reason: \"missing-protocol\",\r\n      suggestedFix: url.replace(\"http://\", \"https://\"),\r\n    };\r\n  }\r\n\r\n  return { isValid: true };\r\n}\r\n\r\n/* -------------------------------------------------------------------------- */\r\n/* FALLBACK IMAGE MANAGEMENT                                                  */\r\n/* -------------------------------------------------------------------------- */\r\n\r\nfunction getFallbackImage(config: FallbackConfig = { type: \"book\" }): string {\r\n  const { type, theme = \"gradient\", category } = config;\r\n  const fallbacks = FALLBACK_IMAGES[type];\r\n\r\n  // Category-specific\r\n  if (category && category in fallbacks) {\r\n    const categoryFallback =\r\n      fallbacks[category as keyof (typeof fallbacks)];\r\n    if (typeof categoryFallback === \"string\") {\r\n      return categoryFallback;\r\n    }\r\n  }\r\n\r\n  // Default array\r\n  if (\"default\" in fallbacks && Array.isArray(fallbacks.default)) {\r\n    const defaultArray = fallbacks.default as string[];\r\n    const index = category\r\n      ? Math.abs(\r\n          category\r\n            .split(\"\")\r\n            .reduce((acc, char) => acc + char.charCodeAt(0), 0)\r\n        ) % defaultArray.length\r\n      : 0;\r\n    return defaultArray[index];\r\n  }\r\n\r\n  // Gradient\r\n  if (theme === \"gradient\" && \"gradient\" in fallbacks) {\r\n    return fallbacks.gradient as string;\r\n  }\r\n\r\n  // Generic placeholder\r\n  return FALLBACK_IMAGES.generic.placeholder;\r\n}\r\n\r\nfunction createFallbackSequence(\r\n  seed: string | number,\r\n  config: FallbackConfig = { type: \"book\" }\r\n): string[] {\r\n  const sequence: string[] = [];\r\n  const seedNum =\r\n    typeof seed === \"string\"\r\n      ? seed\r\n          .split(\"\")\r\n          .reduce((acc, char) => acc + char.charCodeAt(0), 0)\r\n      : seed;\r\n\r\n  const fallbacks = FALLBACK_IMAGES[config.type];\r\n\r\n  if (\"default\" in fallbacks && Array.isArray(fallbacks.default)) {\r\n    const defaultArray = fallbacks.default as string[];\r\n    const primaryIndex = Math.abs(seedNum) % defaultArray.length;\r\n    sequence.push(defaultArray[primaryIndex]);\r\n\r\n    for (let i = 0; i < defaultArray.length; i += 1) {\r\n      if (i !== primaryIndex) {\r\n        sequence.push(defaultArray[i]);\r\n      }\r\n    }\r\n  }\r\n\r\n  if (\"gradient\" in fallbacks) {\r\n    sequence.push(fallbacks.gradient as string);\r\n  }\r\n\r\n  sequence.push(FALLBACK_IMAGES.generic.placeholder);\r\n\r\n  return sequence;\r\n}\r\n\r\n/* -------------------------------------------------------------------------- */\r\n/* IMAGE OPTIMIZATION & TRANSFORMATION                                        */\r\n/* -------------------------------------------------------------------------- */\r\n\r\nfunction generateOptimizedImageUrls(\r\n  baseUrl: string,\r\n  options: {\r\n    widths?: number[];\r\n    quality?: number;\r\n    format?: SupportedFormat;\r\n    context?: keyof typeof IMAGE_OPTIMIZATION;\r\n  } = {}\r\n): Array<{ src: string; width: number; format: string }> {\r\n  const {\r\n    widths,\r\n    quality,\r\n    format = PREFERRED_FORMAT,\r\n    context = \"cover\",\r\n  } = options;\r\n\r\n  const config = IMAGE_OPTIMIZATION[context];\r\n  const targetWidths = widths || config.widths;\r\n  const targetQuality = quality || config.quality;\r\n  const targetFormats: SupportedFormat[] =\r\n    format != null ? [format] : config.formats; // âœ… Now works without error\r\n\r\n  const urls: Array<{ src: string; width: number; format: string }> = [];\r\n\r\n  if (baseUrl.startsWith(\"data:\") || getFileExtension(baseUrl) === \"svg\") {\r\n    return [\r\n      {\r\n        src: baseUrl,\r\n        width: 0,\r\n        format: getFileExtension(baseUrl),\r\n      },\r\n    ];\r\n  }\r\n\r\n  for (const width of targetWidths) {\r\n    for (const fmt of targetFormats) {\r\n      let optimizedUrl = baseUrl;\r\n\r\n      if (CDN_BASE_URL && baseUrl.includes(CDN_BASE_URL)) {\r\n        optimizedUrl = baseUrl.replace(\r\n          /(\\.[a-z]+)$/i,\r\n          `_w${width},q${targetQuality}.${fmt}`\r\n        );\r\n      }\r\n\r\n      urls.push({\r\n        src: optimizedUrl,\r\n        width,\r\n        format: fmt,\r\n      });\r\n    }\r\n  }\r\n\r\n  return urls;\r\n}\r\n\r\nfunction calculateAspectRatio(\r\n  width: number | undefined,\r\n  height: number | undefined\r\n): number | undefined {\r\n  if (!width || !height || width <= 0 || height <= 0) return undefined;\r\n  return width / height;\r\n}\r\n\r\nfunction generateBlurDataURL(\r\n  width: number = 20,\r\n  height: number = 20,\r\n  color: string = \"#6B7280\"\r\n): string {\r\n  const canvas = `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"${width}\" height=\"${height}\">\r\n    <rect width=\"100%\" height=\"100%\" fill=\"${color}\" opacity=\"0.2\"/>\r\n    <rect x=\"0\" y=\"0\" width=\"100%\" height=\"100%\" fill=\"url(#gradient)\" opacity=\"0.5\"/>\r\n    <defs>\r\n      <linearGradient id=\"gradient\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\r\n        <stop offset=\"0%\" stop-color=\"${color}\" stop-opacity=\"0.3\"/>\r\n        <stop offset=\"100%\" stop-color=\"${color}\" stop-opacity=\"0.1\"/>\r\n      </linearGradient>\r\n    </defs>\r\n  </svg>`;\r\n\r\n  const base64 = toBase64(canvas);\r\n  return `data:image/svg+xml;base64,${base64}`;\r\n}\r\n\r\n/* -------------------------------------------------------------------------- */\r\n/* IMAGE LOADING & ERROR HANDLING                                             */\r\n/* -------------------------------------------------------------------------- */\r\n\r\nfunction createImageLoader(\r\n  initialUrl: string | undefined,\r\n  fallbackConfig?: FallbackConfig,\r\n  onError?: (error: Error, attempt: number) => void\r\n) {\r\n  let currentAttempt = 0;\r\n  const fallbackSequence: string[] = [];\r\n\r\n  if (initialUrl) {\r\n    fallbackSequence.push(initialUrl, ...createFallbackSequence(initialUrl, fallbackConfig));\r\n  } else if (fallbackConfig) {\r\n    fallbackSequence.push(\r\n      ...createFallbackSequence(Date.now(), fallbackConfig)\r\n    );\r\n  }\r\n\r\n  const loadImage = async (): Promise<{\r\n    url: string;\r\n    width?: number;\r\n    height?: number;\r\n    metadata?: Partial<ImageMetadata>;\r\n  }> => {\r\n    if (currentAttempt >= fallbackSequence.length) {\r\n      throw new Error(\"All image loading attempts failed\");\r\n    }\r\n\r\n    const url = fallbackSequence[currentAttempt];\r\n    currentAttempt += 1;\r\n\r\n    try {\r\n      if (typeof window !== \"undefined\") {\r\n        await new Promise<void>((resolve, reject) => {\r\n          const img = new window.Image();\r\n          img.onload = () => resolve();\r\n          img.onerror = () =>\r\n            reject(new Error(`Failed to load image: ${url}`));\r\n          img.src = url;\r\n        });\r\n      }\r\n\r\n      return {\r\n        url,\r\n        metadata: {\r\n          src: url,\r\n          format: getFileExtension(url),\r\n        },\r\n      };\r\n    } catch (error) {\r\n      if (onError) {\r\n        onError(error as Error, currentAttempt);\r\n      }\r\n\r\n      if (currentAttempt < fallbackSequence.length) {\r\n        return loadImage();\r\n      }\r\n\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  return {\r\n    load: loadImage,\r\n    getCurrentUrl: () =>\r\n      fallbackSequence[\r\n        Math.min(currentAttempt, Math.max(fallbackSequence.length - 1, 0))\r\n      ],\r\n    hasMoreAttempts: () => currentAttempt < fallbackSequence.length,\r\n    reset: () => {\r\n      currentAttempt = 0;\r\n    },\r\n  };\r\n}\r\n\r\n/* -------------------------------------------------------------------------- */\r\n/* SAFE IMAGE PROPS FOR NEXT/IMAGE                                            */\r\n/* -------------------------------------------------------------------------- */\r\n\r\nfunction getSafeImageProps(\r\n  image: unknown,\r\n  alt: string = \"\",\r\n  options: {\r\n    width?: number;\r\n    height?: number;\r\n    priority?: boolean;\r\n    loading?: \"lazy\" | \"eager\";\r\n    fallbackConfig?: FallbackConfig;\r\n  } = {}\r\n): {\r\n  src: string;\r\n  alt: string;\r\n  width?: number;\r\n  height?: number;\r\n  priority: boolean;\r\n  loading: \"lazy\" | \"eager\";\r\n  blurDataURL?: string;\r\n} {\r\n  const {\r\n    width,\r\n    height,\r\n    priority = false,\r\n    loading = \"lazy\",\r\n    fallbackConfig = { type: \"book\" },\r\n  } = options;\r\n\r\n  let src = \"\";\r\n\r\n  if (typeof image === \"string\") {\r\n    src = normalizeImageUrl(image);\r\n  } else if (image && typeof image === \"object\") {\r\n    const imgObj = image as { src?: unknown; url?: unknown };\r\n    if (typeof imgObj.src === \"string\") {\r\n      src = normalizeImageUrl(imgObj.src);\r\n    } else if (typeof imgObj.url === \"string\") {\r\n      src = normalizeImageUrl(imgObj.url);\r\n    }\r\n  }\r\n\r\n  if (!isValidImageUrl(src)) {\r\n    src = getFallbackImage(fallbackConfig);\r\n  }\r\n\r\n  const blurDataURL =\r\n    width && height && width * height > 100_000\r\n      ? generateBlurDataURL(\r\n          Math.min(20, width),\r\n          Math.min(20, height),\r\n          \"#D1D5DB\"\r\n        )\r\n      : undefined;\r\n\r\n  return {\r\n    src,\r\n    alt: safeString(alt, \"Image\"),\r\n    width: width || undefined,\r\n    height: height || undefined,\r\n    priority,\r\n    loading,\r\n    blurDataURL,\r\n  };\r\n}\r\n\r\n/* -------------------------------------------------------------------------- */\r\n/* EXPORTS                                                                    */\r\n/* -------------------------------------------------------------------------- */\r\n\r\nexport type { ImageMetadata, FallbackConfig, ImageValidationResult };\r\n\r\nexport {\r\n  CDN_BASE_URL,\r\n  SUPPORTED_FORMATS,\r\n  PREFERRED_FORMAT,\r\n  IMAGE_OPTIMIZATION,\r\n  FALLBACK_IMAGES,\r\n};\r\n\r\nexport {\r\n  isValidImageUrl,\r\n  getFileExtension,\r\n  normalizeImageUrl,\r\n  validateImageUrl,\r\n  getFallbackImage,\r\n  createFallbackSequence,\r\n  generateOptimizedImageUrls,\r\n  calculateAspectRatio,\r\n  generateBlurDataURL,\r\n  createImageLoader,\r\n  getSafeImageProps,\r\n};\r\n\r\nexport default {\r\n  CDN_BASE_URL,\r\n  SUPPORTED_FORMATS,\r\n  PREFERRED_FORMAT,\r\n  IMAGE_OPTIMIZATION,\r\n  FALLBACK_IMAGES,\r\n  isValidImageUrl,\r\n  getFileExtension,\r\n  normalizeImageUrl,\r\n  validateImageUrl,\r\n  getFallbackImage,\r\n  createFallbackSequence,\r\n  generateOptimizedImageUrls,\r\n  calculateAspectRatio,\r\n  generateBlurDataURL,\r\n  createImageLoader,\r\n  getSafeImageProps,\r\n};","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\imports.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\inner-circle.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'html' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":359,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":359,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable no-console */\nimport crypto from \"node:crypto\";\nimport { Pool, type PoolClient } from \"pg\";\n\nconst CONFIG = {\n  KEY_EXPIRY_DAYS: Number(process.env.INNER_CIRCLE_KEY_EXPIRY_DAYS || 90),\n  KEY_PREFIX: \"icl_\",\n} as const;\n\nexport type InnerCircleStatus = \"pending\" | \"active\" | \"revoked\" | \"expired\";\n\nexport interface CreateOrUpdateMemberArgs {\n  email: string;\n  name?: string;\n  ipAddress?: string;\n  context?: string;\n}\n\nexport interface IssuedKey {\n  key: string;\n  keySuffix: string;\n  createdAt: string;\n  expiresAt: string;\n  status: InnerCircleStatus;\n  memberId: string;\n}\n\nexport interface VerifyInnerCircleKeyResult {\n  valid: boolean;\n  reason?: string;\n  memberId?: string;\n  keySuffix?: string;\n}\n\nexport interface InnerCircleStore {\n  createOrUpdateMemberAndIssueKey(args: CreateOrUpdateMemberArgs): Promise<IssuedKey>;\n  verifyInnerCircleKey(key: string): Promise<VerifyInnerCircleKeyResult>;\n  recordInnerCircleUnlock(key: string, ip?: string): Promise<void>;\n  revokeInnerCircleKey(key: string, revokedBy?: string, reason?: string): Promise<boolean>;\n  deleteMemberByEmail(email: string): Promise<boolean>;\n  getMemberKeys(memberId: string): Promise<any[]>;\n  getPrivacySafeStats(): Promise<{ totalMembers: number; totalKeys: number }>;\n}\n\nfunction sha256Hex(value: string): string {\n  return crypto.createHash(\"sha256\").update(value, \"utf8\").digest(\"hex\");\n}\n\nfunction generateAccessKey(): { key: string; keyHash: string; keySuffix: string } {\n  const raw = crypto.randomBytes(32).toString(\"base64url\");\n  const key = `${CONFIG.KEY_PREFIX}${raw.slice(0, 28)}`;\n  return { key, keyHash: sha256Hex(key), keySuffix: key.slice(-6) };\n}\n\nfunction isBuildTime(): boolean {\n  return (\n    process.env.NETLIFY === \"true\" &&\n    (process.env.CONTEXT === \"production\" ||\n      process.env.CONTEXT === \"deploy-preview\" ||\n      process.env.CONTEXT === \"branch-deploy\") &&\n    process.env.AWS_LAMBDA_FUNCTION_NAME == null\n  );\n}\n\nlet sharedPool: Pool | null = null;\n\nfunction getPool(): Pool | null {\n  if (isBuildTime()) return null;\n  if (sharedPool) return sharedPool;\n\n  const conn = process.env.INNER_CIRCLE_DB_URL ?? process.env.DATABASE_URL;\n  if (!conn) {\n    console.warn(\"[InnerCircle] No DATABASE_URL/INNER_CIRCLE_DB_URL set; running in no-db mode.\");\n    return null;\n  }\n\n  sharedPool = new Pool({\n    connectionString: conn,\n    max: 5,\n    ssl: conn.includes(\"localhost\") || conn.includes(\"127.0.0.1\")\n      ? undefined\n      : { rejectUnauthorized: false },\n  });\n\n  return sharedPool;\n}\n\nclass PostgresInnerCircleStore implements InnerCircleStore {\n  private async withClient<T>(fn: (client: PoolClient) => Promise<T>, fallback: T): Promise<T> {\n    const pool = getPool();\n    if (!pool) return fallback;\n\n    try {\n      const client = await pool.connect();\n      try {\n        return await fn(client);\n      } finally {\n        client.release();\n      }\n    } catch {\n      console.warn(\"[InnerCircle] DB unavailable; returning fallback.\");\n      return fallback;\n    }\n  }\n\n  async createOrUpdateMemberAndIssueKey(args: CreateOrUpdateMemberArgs): Promise<IssuedKey> {\n    const emailHash = sha256Hex(args.email.trim().toLowerCase());\n    const { key, keyHash, keySuffix } = generateAccessKey();\n    const now = new Date();\n    const expiresAt = new Date();\n    expiresAt.setDate(now.getDate() + CONFIG.KEY_EXPIRY_DAYS);\n\n    const fallback: IssuedKey = {\n      key,\n      keySuffix,\n      createdAt: now.toISOString(),\n      expiresAt: expiresAt.toISOString(),\n      status: \"pending\",\n      memberId: \"no-db\",\n    };\n\n    return this.withClient(async (client) => {\n      await client.query(\"BEGIN\");\n\n      const memberRes = await client.query(\n        `INSERT INTO inner_circle_members (email_hash, email_hash_prefix, name, last_ip)\n         VALUES ($1, $2, $3, $4)\n         ON CONFLICT (email_hash)\n         DO UPDATE SET last_seen_at = NOW(), name = COALESCE($3, inner_circle_members.name)\n         RETURNING id`,\n        [emailHash, emailHash.slice(0, 10), args.name || null, args.ipAddress || null]\n      );\n\n      const memberId: string = memberRes.rows[0].id;\n\n      await client.query(\n        `INSERT INTO inner_circle_keys (member_id, key_hash, key_suffix, status, expires_at)\n         VALUES ($1, $2, $3, 'active', $4)`,\n        [memberId, keyHash, keySuffix, expiresAt]\n      );\n\n      await client.query(\"COMMIT\");\n\n      return {\n        key,\n        keySuffix,\n        createdAt: now.toISOString(),\n        expiresAt: expiresAt.toISOString(),\n        status: \"active\",\n        memberId,\n      };\n    }, fallback);\n  }\n\n  async verifyInnerCircleKey(key: string): Promise<VerifyInnerCircleKeyResult> {\n    const cleaned = key.trim();\n    if (!cleaned) return { valid: false, reason: \"empty\" };\n\n    const keyHash = sha256Hex(cleaned);\n\n    return this.withClient(async (client) => {\n      const res = await client.query(\n        `SELECT member_id, status, expires_at, key_suffix\n         FROM inner_circle_keys\n         WHERE key_hash = $1`,\n        [keyHash]\n      );\n\n      const row = res.rows[0];\n      if (!row) return { valid: false, reason: \"not_found\" };\n      if (row.status === \"revoked\") return { valid: false, reason: \"revoked\" };\n      if (new Date(row.expires_at) < new Date()) return { valid: false, reason: \"expired\" };\n\n      return { valid: true, memberId: row.member_id, keySuffix: row.key_suffix };\n    }, { valid: false, reason: \"no_db\" });\n  }\n\n  async recordInnerCircleUnlock(key: string, ip?: string): Promise<void> {\n    const cleaned = key.trim();\n    if (!cleaned) return;\n\n    await this.withClient(async (client) => {\n      await client.query(\n        `UPDATE inner_circle_keys\n         SET total_unlocks = total_unlocks + 1,\n             last_used_at = NOW(),\n             last_ip = $2\n         WHERE key_hash = $1`,\n        [sha256Hex(cleaned), ip || null]\n      );\n      return;\n    }, undefined);\n  }\n\n  async revokeInnerCircleKey(key: string, revokedBy = \"admin\", reason = \"manual\"): Promise<boolean> {\n    const cleaned = key.trim();\n    if (!cleaned) return false;\n\n    return this.withClient(async (client) => {\n      const res = await client.query(\n        `UPDATE inner_circle_keys\n         SET status = 'revoked', revoked_at = NOW(), revoked_by = $2, revoked_reason = $3\n         WHERE key_hash = $1`,\n        [sha256Hex(cleaned), revokedBy, reason]\n      );\n      return (res.rowCount ?? 0) > 0;\n    }, false);\n  }\n\n  async deleteMemberByEmail(email: string): Promise<boolean> {\n    const cleaned = email.trim().toLowerCase();\n    if (!cleaned) return false;\n\n    return this.withClient(async (client) => {\n      const res = await client.query(\n        `DELETE FROM inner_circle_members WHERE email_hash = $1`,\n        [sha256Hex(cleaned)]\n      );\n      return (res.rowCount ?? 0) > 0;\n    }, false);\n  }\n\n  async getMemberKeys(memberId: string): Promise<any[]> {\n    if (!memberId) return [];\n    return this.withClient(async (client) => {\n      const res = await client.query(\n        `SELECT * FROM inner_circle_keys WHERE member_id = $1 ORDER BY created_at DESC`,\n        [memberId]\n      );\n      return res.rows || [];\n    }, []);\n  }\n\n  async getPrivacySafeStats(): Promise<{ totalMembers: number; totalKeys: number }> {\n    return this.withClient(async (client) => {\n      const m = await client.query(`SELECT COUNT(*) FROM inner_circle_members`);\n      const k = await client.query(`SELECT COUNT(*) FROM inner_circle_keys`);\n      return {\n        totalMembers: Number(m.rows?.[0]?.count ?? 0),\n        totalKeys: Number(k.rows?.[0]?.count ?? 0),\n      };\n    }, { totalMembers: 0, totalKeys: 0 });\n  }\n}\n\nlet storeInstance: InnerCircleStore | null = null;\nfunction getStore(): InnerCircleStore {\n  if (!storeInstance) storeInstance = new PostgresInnerCircleStore();\n  return storeInstance;\n}\n\nexport const createOrUpdateMemberAndIssueKey = (args: CreateOrUpdateMemberArgs) =>\n  getStore().createOrUpdateMemberAndIssueKey(args);\n\nexport const verifyInnerCircleKey = (key: string) => getStore().verifyInnerCircleKey(key);\n\nexport const recordInnerCircleUnlock = (key: string, ip?: string) =>\n  getStore().recordInnerCircleUnlock(key, ip);\n\nexport const revokeInnerCircleKey = (key: string, by?: string, reason?: string) =>\n  getStore().revokeInnerCircleKey(key, by, reason);\n\nexport const deleteMemberByEmail = (email: string) => getStore().deleteMemberByEmail(email);\n\nexport const getPrivacySafeStats = () => getStore().getPrivacySafeStats();\n\nexport async function getActiveKeysForMember(memberId: string) {\n  const keys = await getStore().getMemberKeys(memberId);\n  return keys.filter((k: any) => k?.status === \"active\");\n}\n\n// ---------------------------------------------------------------------------\n// Email: unified + backward compatible (THIS is what you were missing)\n// ---------------------------------------------------------------------------\n\ntype InnerCircleEmailPayload =\n  | {\n      to: string | string[];\n      type: \"welcome\" | \"resend\";\n      data: {\n        name: string;\n        accessKey: string;\n        unlockUrl: string;\n      };\n    }\n  | string;\n\nfunction normalizeRecipients(to: string | string[]): string[] {\n  const arr = Array.isArray(to) ? to : [to];\n  return arr.map((x) => String(x || \"\").trim()).filter(Boolean);\n}\n\nfunction buildInnerCircleEmail(\n  type: \"welcome\" | \"resend\",\n  data: { name: string; accessKey: string; unlockUrl: string }\n) {\n  const siteName = \"Abraham of London\";\n  const subject =\n    type === \"welcome\"\n      ? `Your Inner Circle access key`\n      : `Your Inner Circle access key (resend)`;\n\n  const text =\n`Hello ${data.name},\n\nHere is your Inner Circle access key:\n\n${data.accessKey}\n\nUnlock here:\n${data.unlockUrl}\n\nâ€” ${siteName}\n`;\n\n  const html =\n`<div style=\"font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;line-height:1.5\">\n  <p>Hello <strong>${escapeHtml(data.name)}</strong>,</p>\n  <p>Here is your Inner Circle access key:</p>\n  <p style=\"font-size:18px\"><code>${escapeHtml(data.accessKey)}</code></p>\n  <p>Unlock here:<br/>\n    <a href=\"${escapeAttr(data.unlockUrl)}\">${escapeHtml(data.unlockUrl)}</a>\n  </p>\n  <p style=\"color:#666\">â€” ${siteName}</p>\n</div>`;\n\n  return { subject, text, html };\n}\n\nfunction escapeHtml(s: string) {\n  return String(s)\n    .replace(/&/g, \"&amp;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n    .replace(/\"/g, \"&quot;\");\n}\n\nfunction escapeAttr(s: string) {\n  return escapeHtml(s).replace(/'/g, \"&#39;\");\n}\n\n/**\n * sendInnerCircleEmail() supports:\n *  A) New signature:\n *     sendInnerCircleEmail({ to, type, data })\n *  B) Old signature:\n *     sendInnerCircleEmail(email, key, name?)\n */\nexport async function sendInnerCircleEmail(\n  a: any,\n  b?: any,\n  c?: any\n): Promise<void> {\n  // --- New signature ---\n  if (a && typeof a === \"object\" && \"to\" in a && \"type\" in a && \"data\" in a) {\n    const payload = a as Exclude<InnerCircleEmailPayload, string>;\n    const to = normalizeRecipients(payload.to);\n\n    const { subject, text, html } = buildInnerCircleEmail(payload.type, payload.data);\n\n    // Provider switch (keep it simple + reliable)\n    const provider = process.env.EMAIL_PROVIDER || \"console\";\n    if (provider === \"console\") {\n      console.log(\"ðŸ“§ [InnerCircle Email] (console)\", { to, subject });\n      console.log(text);\n      return;\n    }\n\n    // If you later wire a real provider, plug it here.\n    // For now, fail-safe to console rather than silently dropping.\n    console.warn(\n      \"âš ï¸ [InnerCircle Email] EMAIL_PROVIDER set but no provider wired. Falling back to console.\"\n    );\n    console.log(\"ðŸ“§ [InnerCircle Email] (fallback)\", { to, subject });\n    console.log(text);\n    return;\n  }\n\n  // --- Old signature call (email, key, name?) ---\n  const email = String(a);\n  const key = String(b || \"\");\n  const name = c;\n\n  console.log(`[Email] Dispatching key to ${email} (${name || \"unknown\"})`);\n  console.log(`[Email] Key: ${key}`);\n}\n\nexport function cleanupOldData(): Promise<void> {\n  console.log('[cleanupOldData] Not implemented yet');\n  return Promise.resolve();\n}\n\nexport function getClientIp(req: any): string | undefined {\n  const forwarded = req.headers?.['x-forwarded-for'];\n  if (forwarded) {\n    const ips = Array.isArray(forwarded) ? forwarded[0] : forwarded;\n    return ips.split(',')[0].trim();\n  }\n  const realIp = req.headers?.['x-real-ip'];\n  if (realIp) return Array.isArray(realIp) ? realIp[0] : realIp;\n  const cfConnectingIp = req.headers?.['cf-connecting-ip'];\n  if (cfConnectingIp) return Array.isArray(cfConnectingIp) ? cfConnectingIp[0] : cfConnectingIp;\n  return req.socket?.remoteAddress;\n}\n\nexport function getPrivacySafeKeyExport(key: string): string {\n  if (!key || key.length < 6) return '***';\n  return `***${key.slice(-6)}`;\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\inner-circle\\email.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\inner-circle\\index.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'email' is defined but never used. Allowed unused args must match /^_/u.","line":22,"column":40,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":45},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'email' is defined but never used. Allowed unused args must match /^_/u.","line":28,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":8},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'slug' is defined but never used. Allowed unused args must match /^_/u.","line":29,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":7},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ip' is defined but never used. Allowed unused args must match /^_/u.","line":30,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":5}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// lib/inner-circle/index.ts - SIMPLE RE-EXPORT\r\n/**\r\n * Public Inner Circle module surface.\r\n * Re-exports from the store module.\r\n */\r\n\r\n// Re-export everything from the store\r\nexport {\r\n  createOrUpdateMemberAndIssueKey,\r\n  verifyInnerCircleKey,\r\n  getPrivacySafeStats,\r\n  getPrivacySafeKeyRows,\r\n  getClientIp,\r\n  getPrivacySafeKeyExport,\r\n  deleteMemberByEmail,\r\n} from \"@/lib/server/inner-circle-store\";\r\n\r\n// Email functionality\r\nexport { sendInnerCircleEmail } from \"@/lib/inner-circle/email\";\r\n\r\n// Placeholder functions (not in store)\r\nexport const getMemberByEmail = async (email: string): Promise<any> => {\r\n  console.warn('[InnerCircle] getMemberByEmail not implemented');\r\n  return null;\r\n};\r\n\r\nexport const recordInnerCircleUnlock = async (\r\n  email: string,\r\n  slug: string,\r\n  ip?: string\r\n): Promise<{ success: boolean; message?: string }> => {\r\n  console.warn('[InnerCircle] recordInnerCircleUnlock not implemented');\r\n  return {\r\n    success: true,\r\n    message: 'Access logged (implementation pending)'\r\n  };\r\n};\r\n\r\nexport const revokeInnerCircleKey = async (\r\n  email: string\r\n): Promise<{ success: boolean; message?: string }> => {\r\n  console.warn('[InnerCircle] revokeInnerCircleKey not implemented');\r\n  const { deleteMemberByEmail } = await import(\"@/lib/server/inner-circle-store\");\r\n  const result = await deleteMemberByEmail(email);\r\n  return {\r\n    success: result,\r\n    message: result ? 'Member deleted' : 'Failed to delete member'\r\n  };\r\n};","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\inner-circle\\templates\\InnerCircleEmail.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\innerCircleMembership.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\innerCircleMembership.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\input-validator.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\ip.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\isRecaptchaValid.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\markdownToHtml.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\mdx-components.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\mdx-utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\mdx.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\mdx\\esbuild-alias.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\og.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\pdf\\ultimate-purpose-of-man-pdf.tsx","messages":[],"suppressedMessages":[{"ruleId":"jsx-a11y/alt-text","severity":1,"message":"Image elements must have an alt prop, either with meaningful text, or an empty string for decorative images.","line":220,"column":9,"nodeType":"JSXOpeningElement","endLine":220,"endColumn":65,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\post-extensions.d.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Post' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":14}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// types/post-extensions.d.ts - Type declaration merge\r\nimport { Post } from './post';\r\n\r\n// Ensure Post has coverImage\r\ndeclare module './post' {\r\n  interface Post {\r\n    coverImage?: string | { src?: string } | null;\r\n  }\r\n}\r\n\r\n// Re-export everything\r\nexport * from './post';","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\posts-utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\posts.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'transformPostForClient' is defined but never used. Allowed unused vars must match /^_/u.","line":18,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'toPostSummary' is defined but never used. Allowed unused vars must match /^_/u.","line":19,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'sortPostsByDate' is defined but never used. Allowed unused vars must match /^_/u.","line":20,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'paginatePosts' is defined but never used. Allowed unused vars must match /^_/u.","line":21,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// lib/posts.ts â€” CONTENTLAYER-FIRST + STRICT TYPES (FIXED)\n/* eslint-disable no-console */\nimport type {\n  Post as PostType,\n  PostForClient as PostForClientType,\n  PostSummary as PostSummaryType,\n  PostList,\n} from \"@/types/post\";\n\nimport {\n  PostMetaUtils,\n  TypeGuards,\n  PostFactory,\n  Validation,\n} from \"@/types/post\";\n\nimport {\n  transformPostForClient,\n  toPostSummary,\n  sortPostsByDate,\n  paginatePosts,\n  searchPosts as searchPostsUtil,\n  getFeaturedPosts as getFeaturedPostsUtil,\n} from \"@/lib/posts-utils\";\n\nimport {\n  getPublishedPosts as getPublishedPostDocs,\n  normalizeSlug,\n} from \"@/lib/contentlayer-helper\";\n\n// Helper function to clean slugs\nfunction cleanSlugString(slug: string): string {\n  return typeof slug === 'string' ? slug.trim().toLowerCase() : '';\n}\n\n/**\n * Optional legacy cache support (keep only for backward compatibility).\n * Canon source is Contentlayer.\n */\nlet postsCache: PostType[] | null = null;\n\nexport function initializePosts(posts: PostType[] = []): void {\n  if (Array.isArray(posts)) {\n    // Validate each post before caching\n    const validPosts: PostType[] = [];\n    const invalidPosts: PostType[] = [];\n    \n    posts.forEach(post => {\n      // Validate the post\n      const validation = Validation.validatePostMeta(post);\n      if (validation.isValid && TypeGuards.isPost(post)) {\n        validPosts.push(post);\n      } else {\n        invalidPosts.push(post);\n        const slug = PostMetaUtils.getSlug(post);\n        console.warn(`[posts] Skipping invalid post ${slug}:`, \n          validation.isValid ? 'Missing content' : validation.errors);\n      }\n    });\n    \n    postsCache = validPosts;\n    console.log(`[posts] Initialized ${validPosts.length} valid posts (${invalidPosts.length} invalid ignored)`);\n  } else {\n    postsCache = [];\n    console.warn('[posts] initializePosts called with non-array input');\n  }\n}\n\n/**\n * Convert Contentlayer Post doc -> strict PostType with full validation.\n */\nfunction mapDocToPost(doc: any): PostType | null {\n  try {\n    if (!doc || typeof doc !== 'object') {\n      console.warn('[posts] mapDocToPost received invalid doc');\n      return null;\n    }\n\n    const slug = normalizeSlug(doc) || '';\n    const content = String(doc?.body?.raw ?? doc?.content ?? \"\").trim();\n    \n    if (!slug || !content) {\n      console.warn(`[posts] Skipping doc with missing slug or content: ${slug}`);\n      return null;\n    }\n\n    // Build complete post data with safe defaults\n    const postData = {\n      slug,\n      title: String(doc?.title ?? \"Untitled\"),\n      date: String(doc?.date ?? new Date().toISOString().split(\"T\")[0]),\n      excerpt: String(doc?.excerpt ?? doc?.description ?? \"\").trim(),\n      \n      published: doc?.draft !== true,\n      featured: Boolean(doc?.featured),\n      \n      category: doc?.category ? String(doc.category) : undefined,\n      tags: Array.isArray(doc?.tags) ? doc.tags.map(String).filter(Boolean) : undefined,\n      author: doc?.author ? String(doc.author) : undefined,\n      readTime: doc?.readTime ? String(doc.readTime) : undefined,\n      \n      subtitle: doc?.subtitle ? String(doc.subtitle) : undefined,\n      description: doc?.description ? String(doc.description) : undefined,\n      \n      coverImage: doc?.coverImage ?? undefined,\n      ogImage: doc?.ogImage ?? undefined,\n      \n      series: doc?.series ? String(doc.series) : undefined,\n      seriesOrder: typeof doc?.seriesOrder === 'number' ? doc.seriesOrder : undefined,\n      \n      coverAspect: doc?.coverAspect ? String(doc.coverAspect) : undefined,\n      coverFit: doc?.coverFit ? String(doc.coverFit) : undefined,\n      coverPosition: doc?.coverPosition ? String(doc.coverPosition) : undefined,\n      \n      authors: Array.isArray(doc?.authors) ? doc.authors.map(String).filter(Boolean) : undefined,\n      wordCount: typeof doc?.wordCount === 'number' ? doc.wordCount : undefined,\n      canonicalUrl: doc?.canonicalUrl ? String(doc.canonicalUrl) : undefined,\n      noindex: typeof doc?.noindex === 'boolean' ? doc.noindex : undefined,\n      lastModified: doc?.lastModified ? String(doc.lastModified) : undefined,\n      \n      // Content fields\n      content,\n      html: doc?.html ? String(doc.html) : undefined,\n      compiledSource: doc?.compiledSource ? String(doc.compiledSource) : undefined,\n      \n      // Internal fields\n      id: doc?._id || slug,\n      url: doc?.url || `/blog/${slug}`,\n      draft: Boolean(doc?.draft),\n    };\n\n    // Create validated post\n    const post = PostFactory.createPost(postData);\n    \n    // Validate the post\n    const validation = Validation.validatePostMeta(post);\n    if (!validation.isValid) {\n      console.warn(`[posts] Post validation failed for ${slug}:`, validation.errors);\n      return null;\n    }\n\n    return post;\n  } catch (error) {\n    console.error('[posts] Error in mapDocToPost:', error);\n    return null;\n  }\n}\n\nfunction getPostsFromContentlayer(): PostType[] {\n  try {\n    const docs = getPublishedPostDocs();\n    const mappedPosts = docs.map(mapDocToPost).filter((post): post is PostType => post !== null);\n    \n    console.log(`[posts] Loaded ${mappedPosts.length} valid posts from Contentlayer (${docs.length - mappedPosts.length} filtered out)`);\n    return mappedPosts;\n  } catch (error) {\n    console.error('[posts] Contentlayer loading failed:', error);\n    return [];\n  }\n}\n\nfunction getSourcePosts(): PostType[] {\n  // Use cache if available and valid\n  if (Array.isArray(postsCache) && postsCache.length > 0 && postsCache.every(TypeGuards.isPost)) {\n    console.log(`[posts] Using ${postsCache.length} cached posts`);\n    return postsCache;\n  }\n  \n  const contentlayerPosts = getPostsFromContentlayer();\n  \n  // Update cache\n  postsCache = contentlayerPosts;\n  \n  return contentlayerPosts;\n}\n\nfunction validateAndFilterPosts(posts: PostType[]): PostType[] {\n  return posts.filter(post => {\n    const validation = Validation.validatePostMeta(post);\n    if (!validation.isValid) {\n      const slug = PostMetaUtils.getSlug(post);\n      console.warn(`[posts] Skipping invalid post ${slug}:`, validation.errors);\n      return false;\n    }\n    return true;\n  });\n}\n\nexport function getAllPosts(): PostForClientType[] {\n  try {\n    const sourcePosts = getSourcePosts();\n    const validPosts = validateAndFilterPosts(sourcePosts);\n    \n    return validPosts.map(post => {\n      try {\n        return PostFactory.createForClient(post);\n      } catch (error) {\n        const slug = PostMetaUtils.getSlug(post);\n        console.error(`[posts] Error transforming post ${slug}:`, error);\n        return null;\n      }\n    }).filter((post): post is PostForClientType => post !== null);\n  } catch (error) {\n    console.error('[posts] Error in getAllPosts:', error);\n    return [];\n  }\n}\n\n// ADD MISSING FUNCTION: getPostBySlugWithContent\nexport function getPostBySlugWithContent(slug: string): PostType | null {\n  const cleanedSlug = cleanSlugString(slug);\n  if (!cleanedSlug) {\n    console.warn('[posts] getPostBySlugWithContent called with empty slug');\n    return null;\n  }\n\n  const sourcePosts = getSourcePosts();\n  const post = sourcePosts.find(p => {\n    const postSlug = PostMetaUtils.getSlug(p);\n    return cleanSlugString(postSlug) === cleanedSlug;\n  });\n  \n  if (!post) {\n    console.log(`[posts] Post not found: ${cleanedSlug}`);\n    return null;\n  }\n\n  // Validate the found post\n  const validation = Validation.validatePostMeta(post);\n  if (!validation.isValid) {\n    console.warn(`[posts] Found post ${cleanedSlug} but validation failed:`, validation.errors);\n    return null;\n  }\n\n  return post;\n}\n\nexport function getPostBySlug(slug: string): PostForClientType | null {\n  try {\n    const post = getPostBySlugWithContent(slug);\n    if (!post) return null;\n    \n    return PostFactory.createForClient(post);\n  } catch (error) {\n    const cleanedSlug = cleanSlugString(slug);\n    console.error(`[posts] Error getting post by slug \"${cleanedSlug}\":`, error);\n    return null;\n  }\n}\n\nexport function getPublicPosts(): PostForClientType[] {\n  try {\n    const allPosts = getAllPosts();\n    return allPosts.filter(post => post.published !== false);\n  } catch (error) {\n    console.error('[posts] Error in getPublicPosts:', error);\n    return [];\n  }\n}\n\nexport function getFeaturedPosts(): PostForClientType[] {\n  try {\n    const sourcePosts = getSourcePosts();\n    const validPosts = validateAndFilterPosts(sourcePosts);\n    \n    // Use utility function if available, otherwise filter\n    const featuredPosts = getFeaturedPostsUtil \n      ? getFeaturedPostsUtil(validPosts)\n      : PostMetaUtils.filterFeatured(PostMetaUtils.filterPublished(validPosts));\n    \n    return featuredPosts.map(PostFactory.createForClient);\n  } catch (error) {\n    console.error('[posts] Error in getFeaturedPosts:', error);\n    \n    // Fallback: get all published posts and filter for featured\n    try {\n      const allPosts = getPublicPosts();\n      return allPosts.filter(post => post.featured === true);\n    } catch {\n      return [];\n    }\n  }\n}\n\nexport function getPostSummaries(): PostSummaryType[] {\n  try {\n    const sourcePosts = getSourcePosts();\n    const validPosts = validateAndFilterPosts(sourcePosts);\n    const sortedPosts = PostMetaUtils.sortByDate(validPosts, 'desc');\n    \n    return sortedPosts.map(post => {\n      try {\n        return PostFactory.createSummary(post);\n      } catch (error) {\n        const slug = PostMetaUtils.getSlug(post);\n        console.error(`[posts] Error creating summary for ${slug}:`, error);\n        return null;\n      }\n    }).filter((summary): summary is PostSummaryType => summary !== null);\n  } catch (error) {\n    console.error('[posts] Error in getPostSummaries:', error);\n    return [];\n  }\n}\n\nexport function searchPosts(query: string): PostSummaryType[] {\n  const cleanedQuery = cleanSlugString(query);\n  \n  if (!cleanedQuery) {\n    console.warn('[posts] searchPosts called with empty query');\n    return [];\n  }\n  \n  try {\n    const sourcePosts = getSourcePosts();\n    const validPosts = validateAndFilterPosts(sourcePosts);\n    \n    // Use utility function if available, otherwise implement basic search\n    const results = searchPostsUtil\n      ? searchPostsUtil(validPosts, cleanedQuery)\n      : validPosts.filter(post => {\n          const searchable = [\n            PostMetaUtils.getTitle(post),\n            PostMetaUtils.getExcerpt(post),\n            PostMetaUtils.getCategory(post),\n            PostMetaUtils.getAuthor(post),\n            PostMetaUtils.getTags(post).join(' '),\n            post.subtitle || '',\n            post.description || '',\n          ].join(' ').toLowerCase();\n          \n          return searchable.includes(cleanedQuery);\n        });\n    \n    return results.map(PostFactory.createSummary);\n  } catch (error) {\n    console.error(`[posts] Error searching for \"${cleanedQuery}\":`, error);\n    return [];\n  }\n}\n\nexport function getPaginatedPostSummaries(page = 1, perPage = 10): PostList {\n  try {\n    const summaries = getPostSummaries();\n    const total = summaries.length;\n    \n    // Validate pagination parameters\n    const safePage = Math.max(1, Math.floor(page));\n    const safePerPage = Math.max(1, Math.min(100, Math.floor(perPage)));\n    const totalPages = Math.ceil(total / safePerPage);\n    const currentPage = Math.min(safePage, totalPages || 1);\n    \n    // Calculate pagination slice\n    const startIndex = (currentPage - 1) * safePerPage;\n    const endIndex = Math.min(startIndex + safePerPage, total);\n    const paginatedPosts = summaries.slice(startIndex, endIndex);\n    \n    return {\n      posts: paginatedPosts,\n      total,\n      page: currentPage,\n      totalPages: totalPages || 1,\n      hasNext: currentPage < totalPages,\n      hasPrevious: currentPage > 1,\n    };\n  } catch (error) {\n    console.error('[posts] Error in getPaginatedPostSummaries:', error);\n    return {\n      posts: [],\n      total: 0,\n      page: 1,\n      totalPages: 0,\n      hasNext: false,\n      hasPrevious: false,\n    };\n  }\n}\n\n// Additional utility functions\nexport function getPostsByCategory(category: string): PostForClientType[] {\n  try {\n    const allPosts = getAllPosts();\n    const cleanCategory = category.trim().toLowerCase();\n    \n    return allPosts.filter(post => \n      PostMetaUtils.getCategory(post).toLowerCase() === cleanCategory\n    );\n  } catch (error) {\n    console.error(`[posts] Error getting posts by category \"${category}\":`, error);\n    return [];\n  }\n}\n\nexport function getPostsByTag(tag: string): PostForClientType[] {\n  try {\n    const allPosts = getAllPosts();\n    const cleanTag = tag.trim().toLowerCase();\n    \n    return allPosts.filter(post => \n      PostMetaUtils.getTags(post).some(t => t.toLowerCase() === cleanTag)\n    );\n  } catch (error) {\n    console.error(`[posts] Error getting posts by tag \"${tag}\":`, error);\n    return [];\n  }\n}\n\nexport function getRecentPosts(limit = 5): PostForClientType[] {\n  try {\n    const allPosts = getAllPosts();\n    const sorted = [...allPosts].sort((a, b) => {\n      const dateA = new Date(a.date || '').getTime();\n      const dateB = new Date(b.date || '').getTime();\n      return dateB - dateA;\n    });\n    \n    return sorted.slice(0, Math.max(0, limit));\n  } catch (error) {\n    console.error(`[posts] Error getting recent posts:`, error);\n    return [];\n  }\n}\n\nexport function clearPostsCache(): void {\n  postsCache = null;\n  console.log('[posts] Cache cleared');\n}\n\nexport const postsAPI = {\n  // Core functions\n  initializePosts,\n  getAllPosts,\n  getPublicPosts,\n  getFeaturedPosts,\n  getPostBySlug,\n  getPostBySlugWithContent,\n  getPostSummaries,\n  searchPosts,\n  getPaginatedPostSummaries,\n  \n  // Utility functions\n  getPostsByCategory,\n  getPostsByTag,\n  getRecentPosts,\n  clearPostsCache,\n  \n  // Export utilities for convenience\n  PostMetaUtils,\n  TypeGuards,\n  PostFactory,\n  Validation,\n};\n\nexport default postsAPI;","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\print-utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\prints.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\prisma.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\rate-limit.ts","messages":[{"ruleId":"import/no-anonymous-default-export","severity":1,"message":"Assign object to a variable before exporting as module default","line":596,"column":1,"nodeType":"ExportDefaultDeclaration","endLine":612,"endColumn":3}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// lib/rate-limit.ts\n// Comprehensive rate limiting with enhanced security features\n\nexport interface RateLimitConfig {\n  windowMs: number;\n  max: number;\n  keyPrefix?: string;\n  skipSuccessfulRequests?: boolean; // Don't count successful requests\n  skipFailedRequests?: boolean; // Don't count failed requests\n  blockDuration?: number; // Optional: block duration after limit exceeded (ms)\n}\n\nexport interface RateLimitResult {\n  allowed: boolean;\n  remaining: number;\n  limit: number;\n  resetAt: number;\n  blocked?: boolean; // If temporarily blocked\n  blockUntil?: number; // When block expires\n}\n\nexport const RATE_LIMIT_CONFIGS = {\n  // General API endpoints\n  API_READ: {\n    windowMs: 60_000,\n    max: 60,\n    keyPrefix: \"api_read\",\n  },\n  API_WRITE: {\n    windowMs: 60_000,\n    max: 30,\n    keyPrefix: \"api_write\",\n    skipSuccessfulRequests: true, // Only count failed writes\n  },\n  \n  // Content API\n  CONTENT_API: {\n    windowMs: 60_000,\n    max: 30,\n    keyPrefix: \"content\",\n  },\n  \n  // Shorts interactions\n  SHORTS_INTERACTIONS: {\n    windowMs: 60_000,\n    max: 30,\n    keyPrefix: \"shorts_interactions\",\n  },\n  \n  // Teaser system\n  TEASER_REQUEST: {\n    windowMs: 60_000,\n    max: 5,\n    keyPrefix: \"teaser\",\n  },\n  \n  // Newsletter\n  NEWSLETTER_SUBSCRIBE: {\n    windowMs: 60_000,\n    max: 5,\n    keyPrefix: \"newsletter\",\n    blockDuration: 300_000, // 5 min block after exceeding\n  },\n  \n  // Authentication - more strict\n  AUTH_LOGIN: {\n    windowMs: 15 * 60_000,\n    max: 5,\n    keyPrefix: \"auth_login\",\n    skipSuccessfulRequests: true, // Only count failed login attempts\n    blockDuration: 900_000, // 15 min block after 5 failed attempts\n  },\n  AUTH_REGISTER: {\n    windowMs: 60 * 60_000,\n    max: 3,\n    keyPrefix: \"auth_register\",\n    blockDuration: 3600_000, // 1 hour block\n  },\n  \n  // Inner Circle - enhanced security\n  INNER_CIRCLE_REGISTER: {\n    windowMs: 15 * 60_000,\n    max: 3,\n    keyPrefix: \"inner_circle_register_ip\",\n    blockDuration: 900_000, // 15 min block\n  },\n  INNER_CIRCLE_REGISTER_EMAIL: {\n    windowMs: 60 * 60_000,\n    max: 2,\n    keyPrefix: \"inner_circle_register_email\",\n    blockDuration: 3600_000, // 1 hour block\n  },\n  INNER_CIRCLE_UNLOCK: {\n    windowMs: 60_000,\n    max: 10,\n    keyPrefix: \"inner_circle_unlock\",\n    skipSuccessfulRequests: true, // Only count failed attempts\n    blockDuration: 300_000, // 5 min block after exceeding\n  },\n  \n  // Admin operations\n  ADMIN_OPERATIONS: {\n    windowMs: 60_000,\n    max: 30,\n    keyPrefix: \"admin\",\n  },\n  INNER_CIRCLE_ADMIN_EXPORT: {\n    windowMs: 5 * 60_000,\n    max: 5,\n    keyPrefix: \"inner_circle_admin_export\",\n  },\n  \n  // Contact forms - prevent spam\n  CONTACT_FORM: {\n    windowMs: 60_000,\n    max: 3,\n    keyPrefix: \"contact\",\n    blockDuration: 600_000, // 10 min block\n  },\n  \n  // Downloads\n  DOWNLOADS: {\n    windowMs: 60_000,\n    max: 10,\n    keyPrefix: \"downloads\",\n  },\n  \n  // Webhooks\n  WEBHOOK_RECEIVE: {\n    windowMs: 60_000,\n    max: 100,\n    keyPrefix: \"webhook\",\n  },\n  \n  // Cache busting\n  CACHE_BUST: {\n    windowMs: 10_000,\n    max: 5,\n    keyPrefix: \"cache\",\n  },\n  \n  // Suspicious activity detection\n  SUSPICIOUS_ACTIVITY: {\n    windowMs: 60_000,\n    max: 2,\n    keyPrefix: \"suspicious\",\n    blockDuration: 3600_000, // 1 hour block\n  },\n} as const;\n\ntype Bucket = {\n  count: number;\n  resetAt: number;\n  firstRequestAt: number;\n  blockUntil?: number; // Temporary block\n  suspiciousActivity?: boolean;\n};\n\nclass RateLimiter {\n  private buckets = new Map<string, Bucket>();\n  private blockedIps = new Set<string>(); // Permanent blocks\n  private cleanupInterval: NodeJS.Timeout | null = null;\n\n  constructor() {\n    this.cleanupInterval = setInterval(() => {\n      this.cleanupExpiredBuckets();\n    }, 60_000);\n  }\n\n  private cleanupExpiredBuckets(): void {\n    const now = Date.now();\n    let removed = 0;\n    \n    for (const [key, bucket] of this.buckets.entries()) {\n      // Remove if reset time passed and not blocked\n      if (bucket.resetAt <= now && (!bucket.blockUntil || bucket.blockUntil <= now)) {\n        this.buckets.delete(key);\n        removed++;\n      }\n    }\n    \n    if (removed > 0 && process.env.NODE_ENV === 'development') {\n      console.debug(`[RateLimiter] Cleaned up ${removed} expired buckets`);\n    }\n  }\n\n  isBlocked(key: string): boolean {\n    // Check permanent blocks\n    if (this.blockedIps.has(key)) {\n      return true;\n    }\n\n    // Check temporary blocks\n    const bucket = this.buckets.get(key);\n    if (bucket?.blockUntil) {\n      const now = Date.now();\n      if (bucket.blockUntil > now) {\n        return true;\n      }\n      // Block expired, clear it\n      bucket.blockUntil = undefined;\n    }\n\n    return false;\n  }\n\n  blockPermanently(key: string): void {\n    this.blockedIps.add(key);\n    console.warn(`[RateLimiter] PERMANENT BLOCK: ${key}`);\n  }\n\n  unblock(key: string): void {\n    this.blockedIps.delete(key);\n    const bucket = this.buckets.get(key);\n    if (bucket) {\n      bucket.blockUntil = undefined;\n    }\n  }\n\n  async check(\n    key: string,\n    config: RateLimitConfig = RATE_LIMIT_CONFIGS.API_READ\n  ): Promise<RateLimitResult> {\n    const now = Date.now();\n\n    // Check if blocked\n    if (this.isBlocked(key)) {\n      const bucket = this.buckets.get(key);\n      return {\n        allowed: false,\n        remaining: 0,\n        limit: config.max,\n        resetAt: bucket?.resetAt || now + config.windowMs,\n        blocked: true,\n        blockUntil: bucket?.blockUntil,\n      };\n    }\n\n    const existing = this.buckets.get(key);\n    let bucket: Bucket;\n\n    if (!existing || existing.resetAt <= now) {\n      bucket = {\n        count: 0,\n        resetAt: now + config.windowMs,\n        firstRequestAt: now,\n      };\n    } else {\n      bucket = existing;\n    }\n\n    bucket.count += 1;\n    this.buckets.set(key, bucket);\n\n    const allowed = bucket.count <= config.max;\n    const remaining = Math.max(config.max - bucket.count, 0);\n\n    // Apply block if limit exceeded and blockDuration configured\n    if (!allowed && config.blockDuration && !bucket.blockUntil) {\n      bucket.blockUntil = now + config.blockDuration;\n      console.warn(\n        `[RateLimiter] BLOCKED: ${key} (${config.keyPrefix}) until ${new Date(bucket.blockUntil).toISOString()}`\n      );\n    }\n\n    return {\n      allowed,\n      remaining,\n      limit: config.max,\n      resetAt: bucket.resetAt,\n      blocked: !!bucket.blockUntil,\n      blockUntil: bucket.blockUntil,\n    };\n  }\n\n  checkSync(\n    key: string,\n    config: RateLimitConfig = RATE_LIMIT_CONFIGS.API_READ\n  ): RateLimitResult {\n    const now = Date.now();\n\n    if (this.isBlocked(key)) {\n      const bucket = this.buckets.get(key);\n      return {\n        allowed: false,\n        remaining: 0,\n        limit: config.max,\n        resetAt: bucket?.resetAt || now + config.windowMs,\n        blocked: true,\n        blockUntil: bucket?.blockUntil,\n      };\n    }\n\n    const existing = this.buckets.get(key);\n    let bucket: Bucket;\n\n    if (!existing || existing.resetAt <= now) {\n      bucket = {\n        count: 0,\n        resetAt: now + config.windowMs,\n        firstRequestAt: now,\n      };\n    } else {\n      bucket = existing;\n    }\n\n    bucket.count += 1;\n    this.buckets.set(key, bucket);\n\n    const allowed = bucket.count <= config.max;\n    const remaining = Math.max(config.max - bucket.count, 0);\n\n    if (!allowed && config.blockDuration && !bucket.blockUntil) {\n      bucket.blockUntil = now + config.blockDuration;\n    }\n\n    return {\n      allowed,\n      remaining,\n      limit: config.max,\n      resetAt: bucket.resetAt,\n      blocked: !!bucket.blockUntil,\n      blockUntil: bucket.blockUntil,\n    };\n  }\n\n  markSuccess(key: string): void {\n    const bucket = this.buckets.get(key);\n    if (bucket && bucket.count > 0) {\n      bucket.count = Math.max(0, bucket.count - 1);\n    }\n  }\n\n  getStatus(key: string): RateLimitResult | null {\n    const bucket = this.buckets.get(key);\n    if (!bucket) return null;\n\n    const now = Date.now();\n    if (bucket.resetAt <= now && !bucket.blockUntil) return null;\n\n    const config = Object.values(RATE_LIMIT_CONFIGS).find(\n      c => c.keyPrefix && key.startsWith(c.keyPrefix)\n    ) || RATE_LIMIT_CONFIGS.API_READ;\n\n    return {\n      allowed: bucket.count <= config.max && !this.isBlocked(key),\n      remaining: Math.max(0, config.max - bucket.count),\n      limit: config.max,\n      resetAt: bucket.resetAt,\n      blocked: this.isBlocked(key),\n      blockUntil: bucket.blockUntil,\n    };\n  }\n\n  resetKey(key: string): boolean {\n    this.blockedIps.delete(key);\n    return this.buckets.delete(key);\n  }\n\n  getStats(): {\n    totalBuckets: number;\n    activeBuckets: number;\n    blockedKeys: number;\n    permanentBlocks: number;\n  } {\n    const now = Date.now();\n    let activeBuckets = 0;\n    let blockedKeys = 0;\n\n    for (const [, bucket] of this.buckets.entries()) {\n      if (bucket.resetAt > now) {\n        activeBuckets++;\n      }\n      if (bucket.blockUntil && bucket.blockUntil > now) {\n        blockedKeys++;\n      }\n    }\n\n    return {\n      totalBuckets: this.buckets.size,\n      activeBuckets,\n      blockedKeys,\n      permanentBlocks: this.blockedIps.size,\n    };\n  }\n\n  destroy(): void {\n    if (this.cleanupInterval) {\n      clearInterval(this.cleanupInterval);\n      this.cleanupInterval = null;\n    }\n    this.buckets.clear();\n    this.blockedIps.clear();\n  }\n}\n\nconst rateLimiter = new RateLimiter();\n\nexport async function rateLimitAsync(\n  key: string,\n  config: RateLimitConfig = RATE_LIMIT_CONFIGS.API_READ\n): Promise<RateLimitResult> {\n  return rateLimiter.check(key, config);\n}\n\nexport function rateLimit(\n  key: string,\n  config: RateLimitConfig = RATE_LIMIT_CONFIGS.API_READ\n): RateLimitResult {\n  return rateLimiter.checkSync(key, config);\n}\n\nexport function markRequestSuccess(key: string): void {\n  rateLimiter.markSuccess(key);\n}\n\nexport function createRateLimitHeaders(\n  result: RateLimitResult\n): Record<string, string> {\n  const headers: Record<string, string> = {\n    \"X-RateLimit-Limit\": String(result.limit),\n    \"X-RateLimit-Remaining\": String(result.remaining),\n    \"X-RateLimit-Reset\": String(Math.floor(result.resetAt / 1000)),\n  };\n\n  if (result.blocked && result.blockUntil) {\n    headers[\"X-RateLimit-Blocked-Until\"] = new Date(result.blockUntil).toISOString();\n    headers[\"Retry-After\"] = String(Math.ceil((result.blockUntil - Date.now()) / 1000));\n  }\n\n  return headers;\n}\n\nexport function getRateLimitStatus(key: string): RateLimitResult | null {\n  return rateLimiter.getStatus(key);\n}\n\nexport function resetRateLimit(key: string): boolean {\n  return rateLimiter.resetKey(key);\n}\n\nexport function blockPermanently(key: string): void {\n  rateLimiter.blockPermanently(key);\n}\n\nexport function unblock(key: string): void {\n  rateLimiter.unblock(key);\n}\n\nexport function getRateLimiterStats() {\n  return rateLimiter.getStats();\n}\n\n// FIXED: Make headers optional to match usage\nexport function getClientIpFromRequest(req: { \n  headers?: Record<string, string | string[] | undefined>; // Made optional\n  socket?: { remoteAddress?: string };\n  connection?: { remoteAddress?: string };\n}): string {\n  // Handle missing headers\n  const headers = req.headers || {};\n  \n  const headerKeys = [\n    'cf-connecting-ip',\n    'x-client-ip',\n    'x-forwarded-for',\n    'x-real-ip',\n    'forwarded-for',\n  ];\n  \n  for (const header of headerKeys) {\n    const value = headers[header];\n    if (value) {\n      const ip = Array.isArray(value) \n        ? value[0]?.split(',')[0]?.trim()\n        : value.toString().split(',')[0]?.trim();\n      \n      if (ip && isValidIp(ip)) {\n        return ip;\n      }\n    }\n  }\n  \n  const socket = req.socket || req.connection;\n  const remoteAddress = socket?.remoteAddress;\n  \n  if (remoteAddress && isValidIp(remoteAddress)) {\n    return remoteAddress;\n  }\n  \n  return 'unknown';\n}\n\nexport function isValidIp(ip: string): boolean {\n  if (!ip || ip === 'unknown') return false;\n  \n  const cleanIp = ip.split(':')[0];\n  \n  // IPv4\n  const ipv4Regex = /^(25[0-5]|2[0-4]\\d|[01]?\\d\\d?)\\.(25[0-5]|2[0-4]\\d|[01]?\\d\\d?)\\.(25[0-5]|2[0-4]\\d|[01]?\\d\\d?)\\.(25[0-5]|2[0-4]\\d|[01]?\\d\\d?)$/;\n  if (ipv4Regex.test(cleanIp)) return true;\n  \n  // IPv6\n  if (cleanIp.includes(':')) {\n    const ipWithoutScope = cleanIp.split('%')[0];\n    const parts = ipWithoutScope.split(':');\n    \n    if (parts.length >= 2 && parts[parts.length - 1].includes('.')) {\n      return ipv4Regex.test(parts[parts.length - 1]);\n    }\n    \n    if (parts.length > 8) return false;\n    return parts.every(part => \n      part === '' || /^[0-9a-fA-F]{1,4}$/.test(part)\n    );\n  }\n  \n  return false;\n}\n\nexport function anonymizeIp(ip: string): string {\n  if (!isValidIp(ip) || ip === 'unknown') return 'unknown';\n  \n  const cleanIp = ip.split(':')[0];\n  \n  if (cleanIp.includes(':')) {\n    const parts = cleanIp.split(':');\n    if (parts.length <= 3) return cleanIp;\n    return `${parts.slice(0, Math.min(2, parts.length)).join(':')}::`;\n  }\n  \n  const parts = cleanIp.split('.');\n  if (parts.length !== 4) return cleanIp;\n  return `${parts[0]}.${parts[1]}.${parts[2]}.0`;\n}\n\n// FIXED: Properly handle optional request object\nexport function generateRateLimitKey(\n  prefix: string,\n  identifier: string,\n  req?: { headers?: Record<string, string | string[] | undefined> }\n): string {\n  let key = `${prefix}_${identifier}`;\n  \n  if (req) {\n    const ip = getClientIpFromRequest(req);\n    if (ip && ip !== 'unknown') {\n      const anonymizedIp = anonymizeIp(ip);\n      key = `${prefix}_${anonymizedIp}_${identifier}`;\n    }\n  }\n  \n  return key;\n}\n\nexport async function checkRateLimit(\n  req: any,\n  res: any,\n  config: RateLimitConfig = RATE_LIMIT_CONFIGS.API_READ\n): Promise<{ allowed: boolean; headers?: Record<string, string>; result?: RateLimitResult }> {\n  const ip = getClientIpFromRequest(req);\n  const key = generateRateLimitKey(config.keyPrefix || 'default', ip, req);\n  \n  try {\n    const result = await rateLimitAsync(key, config);\n    const headers = createRateLimitHeaders(result);\n    \n    // Set headers on response\n    Object.entries(headers).forEach(([k, v]) => {\n      res.setHeader(k, v);\n    });\n    \n    if (!result.allowed) {\n      console.warn(`[RateLimit] BLOCKED: ${ip} (${config.keyPrefix})`);\n      return { allowed: false, headers, result };\n    }\n    \n    return { allowed: true, headers, result };\n  } catch (error) {\n    console.error('Rate limit check failed:', error);\n    return { allowed: true };\n  }\n}\n\n// Cleanup on process exit\nif (typeof process !== 'undefined') {\n  const cleanup = () => {\n    rateLimiter.destroy();\n  };\n  \n  process.on('SIGTERM', cleanup);\n  process.on('SIGINT', cleanup);\n  process.on('beforeExit', cleanup);\n}\n\nexport default {\n  rateLimitAsync,\n  rateLimit,\n  markRequestSuccess,\n  createRateLimitHeaders,\n  getRateLimitStatus,\n  resetRateLimit,\n  blockPermanently,\n  unblock,\n  getRateLimiterStats,\n  getClientIpFromRequest,\n  isValidIp,\n  anonymizeIp,\n  generateRateLimitKey,\n  checkRateLimit,\n  RATE_LIMIT_CONFIGS,\n};","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\recaptcha.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\recaptchaClient.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'action' is defined but never used. Allowed unused args must match /^_/u.","line":268,"column":41,"nodeType":null,"messageId":"unusedVar","endLine":268,"endColumn":47},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'action' is defined but never used. Allowed unused args must match /^_/u.","line":277,"column":45,"nodeType":null,"messageId":"unusedVar","endLine":277,"endColumn":51},{"ruleId":"import/no-anonymous-default-export","severity":1,"message":"Assign object to a variable before exporting as module default","line":310,"column":1,"nodeType":"ExportDefaultDeclaration","endLine":320,"endColumn":3}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable no-console */\n/**\n * Server-side reCAPTCHA v3 verification helper (canonical).\n * - verifyRecaptchaDetailed(): returns rich result\n * - verifyRecaptcha(): returns boolean for legacy call-sites\n * - validateRecaptchaConfig(): small config health snapshot\n */\n\nexport type RecaptchaVerificationResult = {\n  success: boolean;\n  score: number;\n  action?: string;\n  errorCodes?: string[];\n  raw?: unknown;\n};\n\nconst DEFAULT_MIN_SCORE = 0.5;\nconst VERIFY_URL = \"https://www.google.com/recaptcha/api/siteverify\";\n\nfunction getSecret(): string | null {\n  const secret = process.env.RECAPTCHA_SECRET_KEY;\n  if (!secret || secret.trim().length < 10) return null;\n  return secret.trim();\n}\n\nfunction getMinScore(): number {\n  const n = Number(process.env.RECAPTCHA_MIN_SCORE);\n  if (Number.isFinite(n)) return n;\n  return DEFAULT_MIN_SCORE;\n}\n\nfunction normalizeErrorCodes(value: unknown): string[] {\n  if (Array.isArray(value)) return value.filter((x) => typeof x === \"string\") as string[];\n  return [];\n}\n\nexport async function verifyRecaptchaDetailed(\n  token: string,\n  expectedAction?: string,\n  remoteIp?: string\n): Promise<RecaptchaVerificationResult> {\n  const secret = getSecret();\n\n  // Fail closed unless explicitly bypassing in dev\n  if (!secret) {\n    const isDev = process.env.NODE_ENV !== \"production\";\n    const allowBypass = process.env.ALLOW_RECAPTCHA_BYPASS === \"true\";\n\n    if (isDev && allowBypass) {\n      console.warn(\n        \"[reCAPTCHA] RECAPTCHA_SECRET_KEY missing â€“ bypass enabled via ALLOW_RECAPTCHA_BYPASS (development only).\"\n      );\n      return {\n        success: true,\n        score: 1,\n        action: expectedAction,\n        errorCodes: [\"bypassed:missing_secret\"],\n      };\n    }\n\n    console.error(\"[reCAPTCHA] RECAPTCHA_SECRET_KEY not set â€“ verification will fail.\");\n    return {\n      success: false,\n      score: 0,\n      action: expectedAction,\n      errorCodes: [\"missing_secret\"],\n    };\n  }\n\n  // Basic token sanity check\n  if (!token || typeof token !== \"string\" || token.length < 30) {\n    console.error(\"[reCAPTCHA] Invalid token format.\");\n    return {\n      success: false,\n      score: 0,\n      action: expectedAction,\n      errorCodes: [\"invalid_token_format\"],\n    };\n  }\n\n  const minScore = getMinScore();\n\n  try {\n    const controller = new AbortController();\n    const timeoutId = setTimeout(() => controller.abort(), 5000);\n\n    const params = new URLSearchParams();\n    params.set(\"secret\", secret);\n    params.set(\"response\", token);\n    if (remoteIp) params.set(\"remoteip\", remoteIp);\n\n    const response = await fetch(VERIFY_URL, {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/x-www-form-urlencoded\" },\n      body: params.toString(),\n      signal: controller.signal,\n    });\n\n    clearTimeout(timeoutId);\n\n    if (!response.ok) {\n      console.error(`[reCAPTCHA] HTTP error: ${response.status}`);\n      return {\n        success: false,\n        score: 0,\n        action: expectedAction,\n        errorCodes: [`http_${response.status}`],\n      };\n    }\n\n    const data: {\n      success?: boolean;\n      score?: number;\n      action?: string;\n      \"error-codes\"?: string[];\n      [key: string]: unknown;\n    } = await response.json();\n\n    const success = Boolean(data.success);\n    const score = typeof data.score === \"number\" ? data.score : 0;\n    const action = typeof data.action === \"string\" ? data.action : undefined;\n    const errorCodes = normalizeErrorCodes(data[\"error-codes\"]);\n\n    // Action mismatch = failure (security boundary)\n    if (expectedAction && action && expectedAction !== action) {\n      console.warn(\n        `[reCAPTCHA] Action mismatch: expected=\"${expectedAction}\" got=\"${action}\"`\n      );\n      return {\n        success: false,\n        score: 0,\n        action,\n        errorCodes: errorCodes.length ? errorCodes : [\"action_mismatch\"],\n        raw: data,\n      };\n    }\n\n    if (!success) {\n      console.warn(\"[reCAPTCHA] Verification failed:\", { action, score, errorCodes });\n      return {\n        success: false,\n        score,\n        action,\n        errorCodes: errorCodes.length ? errorCodes : [\"verification_failed\"],\n        raw: data,\n      };\n    }\n\n    if (score < minScore) {\n      console.warn(`[reCAPTCHA] Score below threshold: ${score} (min: ${minScore})`, { action });\n      return {\n        success: false,\n        score,\n        action,\n        errorCodes: errorCodes.length ? errorCodes : [\"low_score\"],\n        raw: data,\n      };\n    }\n\n    return {\n      success: true,\n      score,\n      action,\n      errorCodes,\n      raw: data,\n    };\n  } catch (error: unknown) {\n    const isAbort =\n      typeof error === \"object\" &&\n      error !== null &&\n      (error as { name?: string }).name === \"AbortError\";\n\n    if (isAbort) {\n      console.error(\"[reCAPTCHA] Verification timed out.\");\n      return {\n        success: false,\n        score: 0,\n        action: expectedAction,\n        errorCodes: [\"timeout\"],\n      };\n    }\n\n    console.error(\"[reCAPTCHA] Verification failed with error:\", error);\n    return {\n      success: false,\n      score: 0,\n      action: expectedAction,\n      errorCodes: [\"exception\"],\n    };\n  }\n}\n\n/**\n * Backward-compatible boolean verifier.\n */\nexport async function verifyRecaptcha(\n  token: string,\n  expectedAction?: string,\n  remoteIp?: string\n): Promise<boolean> {\n  const result = await verifyRecaptchaDetailed(token, expectedAction, remoteIp);\n  return result.success;\n}\n\nexport function validateRecaptchaConfig(): {\n  hasSecret: boolean;\n  minScore: number;\n  bypassEnabled: boolean;\n} {\n  return {\n    hasSecret: Boolean(getSecret()),\n    minScore: getMinScore(),\n    bypassEnabled: process.env.ALLOW_RECAPTCHA_BYPASS === \"true\",\n  };\n}\n\n// ----------------------------------------------------------------------\n// Client-side reCAPTCHA functions (compatible with recaptchaClient.ts)\n// ----------------------------------------------------------------------\n\n// These types and functions are exported for client-side compatibility\n// They should be imported from '@/lib/recaptchaClient' in client components\n\n// Re-export types for server-side compatibility\nexport type RecaptchaClientErrorCode = \n  | \"CONFIG_MISSING\"\n  | \"INVALID_ACTION\"\n  | \"INVALID_ACTION_FORMAT\"\n  | \"INVALID_TOKEN_FORMAT\"\n  | \"SCRIPT_LOAD_FAILED\"\n  | \"READY_FAILED\"\n  | \"TOKEN_GENERATION_FAILED\"\n  | \"TIMEOUT\"\n  | \"MAX_ATTEMPTS_EXCEEDED\"\n  | \"SERVER_SIDE_CALL\"\n  | \"UNEXPECTED_ERROR\"\n  | \"UNKNOWN_ERROR\";\n\nexport class RecaptchaClientError extends Error {\n  constructor(\n    message: string,\n    public code: RecaptchaClientErrorCode,\n    public details?: unknown\n  ) {\n    super(message);\n    this.name = \"RecaptchaClientError\";\n  }\n}\n\nexport class RecaptchaTimeoutError extends RecaptchaClientError {\n  constructor(message: string = \"reCAPTCHA operation timed out\") {\n    super(message, \"TIMEOUT\");\n    this.name = \"RecaptchaTimeoutError\";\n  }\n}\n\nexport class RecaptchaScriptError extends RecaptchaClientError {\n  constructor(message: string = \"Failed to load reCAPTCHA script\") {\n    super(message, \"SCRIPT_LOAD_FAILED\");\n    this.name = \"RecaptchaScriptError\";\n  }\n}\n\n/**\n * Server-side wrapper for client reCAPTCHA token generation\n * Returns null on server side - this is intentional\n */\nexport async function getRecaptchaToken(action: string): Promise<string | null> {\n  // This function is server-side only, return null\n  // Client components should import from '@/lib/recaptchaClient'\n  return null;\n}\n\n/**\n * Safe version that returns null instead of throwing\n */\nexport async function getRecaptchaTokenSafe(action: string): Promise<string | null> {\n  return null;\n}\n\n/**\n * Check if reCAPTCHA is available (server-side returns false)\n */\nexport async function isRecaptchaAvailable(): Promise<boolean> {\n  return false;\n}\n\n/**\n * Wait for reCAPTCHA to be ready (no-op server-side)\n */\nexport async function waitForRecaptchaReady(): Promise<void> {\n  // No-op server-side\n}\n\n/**\n * Preload reCAPTCHA script (no-op server-side)\n */\nexport function preloadRecaptcha(): void {\n  // No-op server-side\n}\n\n/**\n * Reset reCAPTCHA state (no-op server-side)\n */\nexport function resetRecaptcha(): void {\n  // No-op server-side\n}\n\n// Default export for backward compatibility\nexport default {\n  verifyRecaptchaDetailed,\n  verifyRecaptcha,\n  validateRecaptchaConfig,\n  getRecaptchaToken,\n  getRecaptchaTokenSafe,\n  isRecaptchaAvailable,\n  waitForRecaptchaReady,\n  preloadRecaptcha,\n  resetRecaptcha,\n};","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\recaptchaServer.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\rechatptcha.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\resources.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\safe-fallbacks.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\safe-json.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\safe-object.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\safe-props.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\safe-social.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\sanitize.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\searchIndex.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\security-monitor.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'RATE_LIMIT_CONFIGS' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":46},{"ruleId":"import/no-anonymous-default-export","severity":1,"message":"Assign object to a variable before exporting as module default","line":250,"column":1,"nodeType":"ExportDefaultDeclaration","endLine":261,"endColumn":3}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// lib/security-monitor.ts\r\n// Detect and respond to suspicious activity\r\n\r\nimport { blockPermanently, RATE_LIMIT_CONFIGS } from './rate-limit';\r\n\r\ninterface SecurityEvent {\r\n  type: 'sql_injection' | 'xss' | 'path_traversal' | 'suspicious_headers' | 'rapid_requests' | 'brute_force';\r\n  ip: string;\r\n  endpoint: string;\r\n  details: string;\r\n  timestamp: number;\r\n  severity: 'low' | 'medium' | 'high' | 'critical';\r\n}\r\n\r\nclass SecurityMonitor {\r\n  private events: SecurityEvent[] = [];\r\n  private readonly MAX_EVENTS = 1000;\r\n  private suspiciousIps = new Map<string, number>(); // IP -> incident count\r\n\r\n  logEvent(event: Omit<SecurityEvent, 'timestamp'>): void {\r\n    const fullEvent: SecurityEvent = {\r\n      ...event,\r\n      timestamp: Date.now(),\r\n    };\r\n\r\n    this.events.push(fullEvent);\r\n\r\n    // Keep only recent events\r\n    if (this.events.length > this.MAX_EVENTS) {\r\n      this.events = this.events.slice(-this.MAX_EVENTS);\r\n    }\r\n\r\n    // Track suspicious IPs\r\n    const count = (this.suspiciousIps.get(event.ip) || 0) + 1;\r\n    this.suspiciousIps.set(event.ip, count);\r\n\r\n    // Auto-block for critical events or repeated offenders\r\n    if (event.severity === 'critical' || count >= 5) {\r\n      blockPermanently(event.ip);\r\n      console.error(`[Security] BLOCKED IP: ${event.ip} (${count} incidents)`);\r\n    }\r\n\r\n    // Log based on severity\r\n    const logMsg = `[Security:${event.severity}] ${event.type} from ${event.ip} at ${event.endpoint}: ${event.details}`;\r\n    \r\n    switch (event.severity) {\r\n      case 'critical':\r\n      case 'high':\r\n        console.error(logMsg);\r\n        break;\r\n      case 'medium':\r\n        console.warn(logMsg);\r\n        break;\r\n      case 'low':\r\n        console.info(logMsg);\r\n        break;\r\n    }\r\n  }\r\n\r\n  getRecentEvents(limit = 100): SecurityEvent[] {\r\n    return this.events.slice(-limit);\r\n  }\r\n\r\n  getEventsByIp(ip: string): SecurityEvent[] {\r\n    return this.events.filter(e => e.ip === ip);\r\n  }\r\n\r\n  getSuspiciousIps(): Array<{ ip: string; incidents: number }> {\r\n    return Array.from(this.suspiciousIps.entries())\r\n      .map(([ip, incidents]) => ({ ip, incidents }))\r\n      .sort((a, b) => b.incidents - a.incidents);\r\n  }\r\n\r\n  clearHistory(): void {\r\n    this.events = [];\r\n    this.suspiciousIps.clear();\r\n  }\r\n}\r\n\r\nconst monitor = new SecurityMonitor();\r\n\r\n// Detection functions\r\n\r\nexport function detectSqlInjection(input: string): boolean {\r\n  const patterns = [\r\n    /(\\b(SELECT|INSERT|UPDATE|DELETE|DROP|CREATE|ALTER|EXEC|EXECUTE|UNION|DECLARE)\\b)/i,\r\n    /(--|;|\\/\\*|\\*\\/|xp_|sp_)/i,\r\n    /(\\bOR\\b.*=|1\\s*=\\s*1|'.*'.*=.*')/i,\r\n    /(WAITFOR|DELAY|BENCHMARK|SLEEP)/i,\r\n  ];\r\n  \r\n  return patterns.some(p => p.test(input));\r\n}\r\n\r\nexport function detectXss(input: string): boolean {\r\n  const patterns = [\r\n    /<script\\b[^<]*(?:(?!<\\/script>)<[^<]*)*<\\/script>/gi,\r\n    /javascript:/gi,\r\n    /on\\w+\\s*=/gi,\r\n    /<iframe/gi,\r\n    /<object/gi,\r\n    /<embed/gi,\r\n    /eval\\s*\\(/gi,\r\n    /expression\\s*\\(/gi,\r\n  ];\r\n  \r\n  return patterns.some(p => p.test(input));\r\n}\r\n\r\nexport function detectPathTraversal(input: string): boolean {\r\n  const patterns = [\r\n    /\\.\\.\\//g,\r\n    /\\.\\.\\\\/g,\r\n    /%2e%2e\\//gi,\r\n    /%252e%252e\\//gi,\r\n    /\\.\\.\\%2f/gi,\r\n  ];\r\n  \r\n  return patterns.some(p => p.test(input));\r\n}\r\n\r\nexport function detectSuspiciousHeaders(headers: Record<string, any>): string[] {\r\n  const suspicious: string[] = [];\r\n  \r\n  // Check for suspicious user agents\r\n  const ua = String(headers['user-agent'] || '').toLowerCase();\r\n  const badUserAgents = ['sqlmap', 'nikto', 'nmap', 'masscan', 'metasploit', 'havij'];\r\n  \r\n  if (badUserAgents.some(bad => ua.includes(bad))) {\r\n    suspicious.push('Suspicious user agent');\r\n  }\r\n\r\n  // Check for proxy headers manipulation\r\n  const xForwardedFor = headers['x-forwarded-for'];\r\n  if (xForwardedFor && String(xForwardedFor).split(',').length > 5) {\r\n    suspicious.push('Excessive proxy chain');\r\n  }\r\n\r\n  // Check for unusual accept headers\r\n  const accept = String(headers['accept'] || '');\r\n  if (accept && !accept.includes('text') && !accept.includes('application') && !accept.includes('*/*')) {\r\n    suspicious.push('Unusual accept header');\r\n  }\r\n\r\n  return suspicious;\r\n}\r\n\r\nexport function logSecurityEvent(\r\n  type: SecurityEvent['type'],\r\n  ip: string,\r\n  endpoint: string,\r\n  details: string,\r\n  severity: SecurityEvent['severity'] = 'medium'\r\n): void {\r\n  monitor.logEvent({ type, ip, endpoint, details, severity });\r\n}\r\n\r\nexport function getSecurityEvents(limit?: number): SecurityEvent[] {\r\n  return monitor.getRecentEvents(limit);\r\n}\r\n\r\nexport function getSecurityEventsByIp(ip: string): SecurityEvent[] {\r\n  return monitor.getEventsByIp(ip);\r\n}\r\n\r\nexport function getSuspiciousIps() {\r\n  return monitor.getSuspiciousIps();\r\n}\r\n\r\nexport function clearSecurityHistory(): void {\r\n  monitor.clearHistory();\r\n}\r\n\r\n// Middleware for API routes\r\nexport function securityMiddleware(req: any, endpoint: string): {\r\n  safe: boolean;\r\n  issues: string[];\r\n} {\r\n  const issues: string[] = [];\r\n  const ip = getIpFromRequest(req);\r\n\r\n  // Check headers\r\n  const headerIssues = detectSuspiciousHeaders(req.headers);\r\n  if (headerIssues.length > 0) {\r\n    issues.push(...headerIssues);\r\n    logSecurityEvent('suspicious_headers', ip, endpoint, headerIssues.join(', '), 'medium');\r\n  }\r\n\r\n  // Check query parameters\r\n  const query = req.query || {};\r\n  for (const [key, value] of Object.entries(query)) {\r\n    const str = String(value);\r\n    \r\n    if (detectSqlInjection(str)) {\r\n      issues.push(`SQL injection in query param: ${key}`);\r\n      logSecurityEvent('sql_injection', ip, endpoint, `Query param: ${key}`, 'critical');\r\n    }\r\n    \r\n    if (detectXss(str)) {\r\n      issues.push(`XSS attempt in query param: ${key}`);\r\n      logSecurityEvent('xss', ip, endpoint, `Query param: ${key}`, 'high');\r\n    }\r\n    \r\n    if (detectPathTraversal(str)) {\r\n      issues.push(`Path traversal in query param: ${key}`);\r\n      logSecurityEvent('path_traversal', ip, endpoint, `Query param: ${key}`, 'high');\r\n    }\r\n  }\r\n\r\n  // Check body\r\n  if (req.body && typeof req.body === 'object') {\r\n    const bodyStr = JSON.stringify(req.body);\r\n    \r\n    if (detectSqlInjection(bodyStr)) {\r\n      issues.push('SQL injection in request body');\r\n      logSecurityEvent('sql_injection', ip, endpoint, 'Request body', 'critical');\r\n    }\r\n    \r\n    if (detectXss(bodyStr)) {\r\n      issues.push('XSS attempt in request body');\r\n      logSecurityEvent('xss', ip, endpoint, 'Request body', 'high');\r\n    }\r\n  }\r\n\r\n  return {\r\n    safe: issues.length === 0,\r\n    issues,\r\n  };\r\n}\r\n\r\nfunction getIpFromRequest(req: any): string {\r\n  const headers = [\r\n    'cf-connecting-ip',\r\n    'x-client-ip',\r\n    'x-forwarded-for',\r\n    'x-real-ip',\r\n  ];\r\n  \r\n  for (const header of headers) {\r\n    const value = req.headers?.[header];\r\n    if (value) {\r\n      const ip = Array.isArray(value) ? value[0] : value;\r\n      return ip.split(',')[0].trim();\r\n    }\r\n  }\r\n  \r\n  return req.socket?.remoteAddress || 'unknown';\r\n}\r\n\r\nexport default {\r\n  detectSqlInjection,\r\n  detectXss,\r\n  detectPathTraversal,\r\n  detectSuspiciousHeaders,\r\n  logSecurityEvent,\r\n  getSecurityEvents,\r\n  getSecurityEventsByIp,\r\n  getSuspiciousIps,\r\n  clearSecurityHistory,\r\n  securityMiddleware,\r\n};","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\security.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'IncomingMessage' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import crypto from \"crypto\";\nimport type { IncomingMessage } from \"http\";\n\n/**\n * Hash email for privacy-safe storage\n */\nexport function hashEmail(email: string): string {\n  return crypto\n    .createHash(\"sha256\")\n    .update(email.trim().toLowerCase())\n    .digest(\"hex\");\n}\n\n/**\n * Mask email for display purposes\n */\nexport function maskEmail(email: string): string {\n  const [local, domain] = email.split(\"@\");\n  if (!domain) return \"****\";\n  \n  // Handle edge cases\n  if (local.length <= 2) {\n    return local.length === 1 \n      ? `*@${domain}`\n      : `${local.charAt(0)}*@${domain}`;\n  }\n  \n  // Show first 2 characters, mask the rest\n  const visible = local.slice(0, 2);\n  const masked = \"*\".repeat(Math.max(1, local.length - 2));\n  return `${visible}${masked}@${domain}`;\n}\n\n/**\n * Generate a secure random token\n */\nexport function generateSecureToken(length: number = 32): string {\n  return crypto.randomBytes(length).toString(\"hex\");\n}\n\n/**\n * Constant-time comparison to prevent timing attacks\n */\nexport function constantTimeCompare(a: string, b: string): boolean {\n  try {\n    return crypto.timingSafeEqual(\n      Buffer.from(a, \"utf8\"),\n      Buffer.from(b, \"utf8\")\n    );\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Sanitize user input for safe display\n */\nexport function sanitizeHtml(input: string): string {\n  return input\n    .replace(/&/g, \"&amp;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n    .replace(/\"/g, \"&quot;\")\n    .replace(/'/g, \"&#x27;\")\n    .replace(/\\//g, \"&#x2F;\");\n}\n\n/**\n * Validate URL for safe redirects\n */\nexport function isValidRedirectUrl(url: string, allowedDomains: string[] = []): boolean {\n  if (!url || typeof url !== \"string\") return false;\n  \n  // Must start with / for relative URLs\n  if (url.startsWith(\"/\")) {\n    return !url.includes(\"//\"); // Prevent protocol-relative URLs\n  }\n  \n  // For absolute URLs, check against allowed domains\n  try {\n    const parsed = new URL(url);\n    \n    // Check if domain is in allowed list\n    if (allowedDomains.length > 0) {\n      return allowedDomains.some(domain => \n        parsed.hostname === domain || parsed.hostname.endsWith(`.${domain}`)\n      );\n    }\n    \n    // If no allowed domains specified, allow common safe protocols\n    return [\"http:\", \"https:\"].includes(parsed.protocol);\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Generate CSRF token\n */\nexport function generateCsrfToken(): string {\n  return crypto.randomBytes(32).toString(\"hex\");\n}\n\n/**\n * Validate CSRF token (constant-time)\n */\nexport function validateCsrfToken(token: string, expectedToken: string): boolean {\n  return constantTimeCompare(token, expectedToken);\n}\n\n/**\n * Encrypt data (simple XOR for demonstration - use proper encryption in production)\n */\nexport function simpleEncrypt(data: string, key: string): string {\n  const encoder = new TextEncoder();\n  const dataBytes = encoder.encode(data);\n  const keyBytes = encoder.encode(key);\n  \n  const result = new Uint8Array(dataBytes.length);\n  for (let i = 0; i < dataBytes.length; i++) {\n    result[i] = dataBytes[i] ^ keyBytes[i % keyBytes.length];\n  }\n  \n  return Buffer.from(result).toString(\"base64\");\n}\n\n/**\n * Decrypt data\n */\nexport function simpleDecrypt(encrypted: string, key: string): string {\n  const dataBytes = Buffer.from(encrypted, \"base64\");\n  const keyBytes = new TextEncoder().encode(key);\n  \n  const result = new Uint8Array(dataBytes.length);\n  for (let i = 0; i < dataBytes.length; i++) {\n    result[i] = dataBytes[i] ^ keyBytes[i % keyBytes.length];\n  }\n  \n  return new TextDecoder().decode(result);\n}\n\n/**\n * Check if string contains SQL injection patterns\n */\nexport function containsSqlInjection(input: string): boolean {\n  const sqlPatterns = [\n    /(\\b(SELECT|INSERT|UPDATE|DELETE|DROP|UNION|EXEC|ALTER|CREATE|TRUNCATE)\\b)/i,\n    /(\\b(OR|AND)\\s+\\d+=\\d+\\b)/i,\n    /(--|\\/\\*|\\*\\/)/,\n    /(\\b(WAITFOR|DELAY)\\b)/i,\n    /(\\b(SLEEP|BENCHMARK)\\b)/i,\n  ];\n  \n  return sqlPatterns.some(pattern => pattern.test(input));\n}\n\n/**\n * Check if string contains XSS patterns\n */\nexport function containsXss(input: string): boolean {\n  const xssPatterns = [\n    /<script\\b[^>]*>(.*?)<\\/script>/i,\n    /javascript:/i,\n    /on\\w+\\s*=/i,\n    /<iframe\\b[^>]*>/i,\n    /<object\\b[^>]*>/i,\n    /<embed\\b[^>]*>/i,\n    /data:/i,\n    /vbscript:/i,\n  ];\n  \n  return xssPatterns.some(pattern => pattern.test(input));\n}\n\n/**\n * Sanitize and validate user input\n */\nexport function sanitizeUserInput(input: string): {\n  clean: string;\n  hasSqlInjection: boolean;\n  hasXss: boolean;\n  isValid: boolean;\n} {\n  const hasSql = containsSqlInjection(input);\n  const hasXss = containsXss(input);\n  \n  // Remove potentially dangerous content\n  let clean = input;\n  if (hasSql || hasXss) {\n    // For demonstration - in production use a proper sanitizer like DOMPurify\n    clean = sanitizeHtml(input);\n  }\n  \n  return {\n    clean,\n    hasSqlInjection: hasSql,\n    hasXss,\n    isValid: !hasSql && !hasXss,\n  };\n}\n\n/**\n * Create a secure session identifier\n */\nexport function createSessionId(): string {\n  return `sess_${crypto.randomBytes(16).toString(\"hex\")}_${Date.now().toString(36)}`;\n}\n\n/**\n * Validate session ID format\n */\nexport function isValidSessionId(sessionId: string): boolean {\n  return /^sess_[a-f0-9]{32}_[a-z0-9]+$/.test(sessionId);\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\security\\rateLimit.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\seo.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\server\\audit.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\server\\books-data.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'content' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":255,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":255,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'body' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":255,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":255,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// lib/server/books-data.ts - SIMPLIFIED VERSION FOR STATIC GENERATION\n// This version works with ContentLayer during build time\n\nimport { allBooks } from \"@/lib/contentlayer\";\nimport type { Book as ContentlayerBook } from \"@/lib/contentlayer\";\n\n// Use the Contentlayer type directly\nexport type Book = ContentlayerBook;\nexport type BookWithContent = ContentlayerBook;\n\n// Helper to check if book is draft\nfunction isDraft(book: any): boolean {\n  if (book.draft === true || book.draft === \"true\") return true;\n  if (book.published === false) return true;\n  if (book.status === 'draft') return true;\n  return false;\n}\n\n// Helper to normalize slug\nfunction normalizeSlug(slug: string): string {\n  return String(slug || \"\").trim().toLowerCase();\n}\n\n// Helper to get book reading time (calculate from content if needed)\nfunction getBookReadTime(book: any): string {\n  // First check if readTime is directly available\n  if (book.readTime && typeof book.readTime === 'string') {\n    return book.readTime;\n  }\n  \n  // Calculate from body content if available\n  if (book.body?.raw) {\n    const wordCount = book.body.raw.split(/\\s+/).length;\n    const readingTime = Math.ceil(wordCount / 200); // 200 words per minute\n    return `${readingTime} min`;\n  }\n  \n  // Default fallback\n  return \"5 min\";\n}\n\n// Helper to get book cover image\nfunction getBookCoverImage(book: any): string {\n  // Try various image fields in order of preference\n  if (book.coverImage) return book.coverImage;\n  if (book.image) return book.image;\n  if (book.cover) return book.cover;\n  \n  // Default fallback\n  return \"/assets/images/writing-desk.webp\";\n}\n\n/**\n * Get all books metadata (non-draft only)\n */\nexport function getAllBooksMeta(): Book[] {\n  try {\n    const books = (allBooks || []).filter(book => !isDraft(book));\n    \n    // Ensure required fields - including ContentLayer computed fields\n    return books.map(book => ({\n      ...book,\n      // Make sure computed fields are included\n      normalizedReadTime: getBookReadTime(book),\n      normalizedCoverImage: getBookCoverImage(book),\n      slug: book.slug || book._raw?.flattenedPath?.split('/').pop() || '',\n      title: book.title || \"Untitled\",\n    })) as Book[]; // Cast to Book type\n  } catch (error) {\n    console.error(\"Error fetching all books meta:\", error);\n    return [];\n  }\n}\n\n/**\n * Get book by slug\n */\nexport function getBookBySlug(slug: string): BookWithContent | null {\n  try {\n    if (!slug || typeof slug !== 'string') {\n      return null;\n    }\n    \n    const normalizedSlug = normalizeSlug(slug);\n    \n    const book = (allBooks || []).find(b => {\n      if (isDraft(b)) return false;\n      \n      const bookSlug = b.slug || b._raw?.flattenedPath?.split('/').pop() || '';\n      return normalizeSlug(bookSlug) === normalizedSlug;\n    });\n    \n    if (!book) return null;\n    \n    // Ensure computed fields are included\n    return {\n      ...book,\n      normalizedReadTime: getBookReadTime(book),\n      normalizedCoverImage: getBookCoverImage(book),\n    } as BookWithContent;\n  } catch (error) {\n    console.error(`Error fetching book by slug (${slug}):`, error);\n    return null;\n  }\n}\n\n/**\n * Get all books with content\n */\nexport function getAllBooks(): BookWithContent[] {\n  try {\n    const books = getAllBooksMeta();\n    return books as BookWithContent[];\n  } catch (error) {\n    console.error(\"Error fetching all books:\", error);\n    return [];\n  }\n}\n\n/**\n * Get book slugs for static generation\n */\nexport function getBookSlugs(): string[] {\n  try {\n    const books = getAllBooksMeta();\n    return books\n      .map(book => book.slug)\n      .filter((slug): slug is string => typeof slug === \"string\" && slug.length > 0);\n  } catch (error) {\n    console.error(\"Error fetching book slugs:\", error);\n    return [];\n  }\n}\n\n/**\n * Get featured books\n */\nexport function getFeaturedBooks(): Book[] {\n  try {\n    const books = getAllBooksMeta();\n    return books.filter(book => book.featured === true);\n  } catch (error) {\n    console.error(\"Error fetching featured books:\", error);\n    return [];\n  }\n}\n\n/**\n * Get recent books\n */\nexport function getRecentBooks(limit?: number): Book[] {\n  try {\n    const books = getAllBooksMeta();\n    \n    // Sort by date (newest first)\n    const sorted = [...books].sort((a, b) => {\n      const dateA = a.date ? new Date(a.date).getTime() : 0;\n      const dateB = b.date ? new Date(b.date).getTime() : 0;\n      return dateB - dateA;\n    });\n    \n    return limit && limit > 0 ? sorted.slice(0, limit) : sorted;\n  } catch (error) {\n    console.error(\"Error fetching recent books:\", error);\n    return [];\n  }\n}\n\n/**\n * Get books by category\n */\nexport function getBooksByCategory(category: string): Book[] {\n  try {\n    const books = getAllBooksMeta();\n    const normalizedCategory = category.toLowerCase().trim();\n    \n    return books.filter(book => \n      book.category?.toLowerCase().trim() === normalizedCategory\n    );\n  } catch (error) {\n    console.error(`Error fetching books by category (${category}):`, error);\n    return [];\n  }\n}\n\n/**\n * Search books\n */\nexport function searchBooks(query: string): Book[] {\n  try {\n    const books = getAllBooksMeta();\n    const normalizedQuery = query.toLowerCase().trim();\n    \n    if (!normalizedQuery) return books;\n    \n    return books.filter(book => {\n      // Search in various fields that are likely to exist on Book type\n      if (book.title?.toLowerCase().includes(normalizedQuery)) return true;\n      if (book.subtitle?.toLowerCase().includes(normalizedQuery)) return true;\n      if (book.description?.toLowerCase().includes(normalizedQuery)) return true;\n      if (book.excerpt?.toLowerCase().includes(normalizedQuery)) return true;\n      if (book.author?.toLowerCase().includes(normalizedQuery)) return true;\n      if (book.tags?.some(tag => tag.toLowerCase().includes(normalizedQuery))) return true;\n      if (book.category?.toLowerCase().includes(normalizedQuery)) return true;\n      \n      // Only check series if it exists on the Book type\n      if ('series' in book && (book as any).series?.toLowerCase().includes(normalizedQuery)) return true;\n      \n      return false;\n    });\n  } catch (error) {\n    console.error(`Error searching books (${query}):`, error);\n    return [];\n  }\n}\n\n/**\n * Get book statistics\n */\nexport function getBookStats() {\n  try {\n    const books = allBooks || [];\n    \n    return {\n      total: books.length,\n      published: books.filter(b => !isDraft(b)).length,\n      drafts: books.filter(isDraft).length,\n      featured: books.filter(b => b.featured && !isDraft(b)).length,\n      byFormat: {},\n      byCategory: {},\n      byYear: {},\n    };\n  } catch (error) {\n    console.error(\"Error fetching book stats:\", error);\n    return {\n      total: 0,\n      published: 0,\n      drafts: 0,\n      featured: 0,\n      byFormat: {},\n      byCategory: {},\n      byYear: {},\n    };\n  }\n}\n\n// ---------------------------------------------------------------------------\n// COMPATIBILITY FUNCTIONS FOR YOUR EXISTING CODE\n// ---------------------------------------------------------------------------\n\n/**\n * Convert Book to ContentMeta for listings (if needed)\n */\nexport function bookToContentMeta(book: Book): any {\n  const { content, body, ...meta } = book as any;\n  return meta;\n}\n\n/**\n * Convert Book to ContentEntry for backward compatibility\n */\nexport function bookToContentEntry(book: Book): any {\n  return {\n    slug: book.slug,\n    title: book.title,\n    date: book.date,\n    excerpt: book.excerpt,\n    description: book.description,\n    category: book.category,\n    tags: book.tags,\n    featured: book.featured,\n    readTime: book.normalizedReadTime || \"5 min\",\n    _raw: book._raw,\n    ...Object.fromEntries(\n      Object.entries(book)\n        .filter(([key]) => ![\n          'slug', 'title', 'date', 'excerpt', 'description', 'category',\n          'tags', 'featured', 'normalizedReadTime', '_raw', 'content', 'body'\n        ].includes(key))\n    ),\n  };\n}\n\n// ---------------------------------------------------------------------------\n// DEFAULT EXPORT\n// ---------------------------------------------------------------------------\n\nconst booksData = {\n  // Core functions\n  getAllBooksMeta,\n  getBookBySlug,\n  getAllBooks,\n  getBookSlugs,\n  \n  // Filter functions\n  getFeaturedBooks,\n  getRecentBooks,\n  getBooksByCategory,\n  searchBooks,\n  \n  // Stats\n  getBookStats,\n  \n  // Utility functions\n  bookToContentMeta,\n  bookToContentEntry,\n};\n\nexport default booksData;","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\server\\cache.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\server\\canon-data.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'content' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":249,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":249,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'body' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":249,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":249,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// lib/server/canon-data.ts\n// Canon under content/canon/* - COMPLETE ROBUST VERSION\n\nimport {\n  getMdxCollectionMeta,\n  getMdxDocumentBySlug,\n  type MdxMeta,\n  type MdxDocument,\n} from \"@/lib/server/mdx-collections\";\nimport type { Canon, ContentEntry, ContentMeta } from \"@/types/index\";\n\nexport type CanonWithContent = Canon & {\n  content: string;\n};\n\n// Extended MDX meta with canon-specific fields\ntype CanonishMdxMeta = MdxMeta & Partial<Canon> & {\n  publishDate?: string;\n  releaseDate?: string;\n  [key: string]: any;\n};\n\ntype CanonishMdxDocument = MdxDocument & {\n  content: string;\n} & Partial<Canon>;\n\n// ---------------------------------------------------------------------------\n// SAFE TYPE CONVERTERS\n// ---------------------------------------------------------------------------\n\n/**\n * Safely convert any value to string or return undefined\n */\nfunction safeString(value: unknown): string | undefined {\n  return typeof value === \"string\" && value.trim().length > 0\n    ? value.trim()\n    : undefined;\n}\n\n/**\n * Safely convert any value to number or return undefined\n */\nfunction safeNumber(value: unknown): number | undefined {\n  if (typeof value === \"number\") return value;\n  if (typeof value === \"string\") {\n    const parsed = parseInt(value, 10);\n    return Number.isNaN(parsed) ? undefined : parsed;\n  }\n  return undefined;\n}\n\n/**\n * Safely convert any value to boolean or return undefined\n */\nfunction safeBoolean(value: unknown): boolean | undefined {\n  if (typeof value === \"boolean\") return value;\n  if (typeof value === \"string\") {\n    const lower = value.toLowerCase().trim();\n    if (lower === \"true\") return true;\n    if (lower === \"false\") return false;\n    if (lower === \"yes\") return true;\n    if (lower === \"no\") return false;\n    if (lower === \"1\") return true;\n    if (lower === \"0\") return false;\n  }\n  if (typeof value === \"number\") {\n    return value === 1;\n  }\n  return undefined;\n}\n\n/**\n * Safely convert any value to array of strings or return undefined\n */\nfunction safeArray(value: unknown): string[] | undefined {\n  if (!Array.isArray(value)) return undefined;\n  const filtered = value.filter((item) => typeof item === \"string\") as string[];\n  return filtered.length > 0 ? filtered : undefined;\n}\n\n/**\n * Safely convert a value into the allowed status enum or undefined\n */\nfunction safeStatus(\n  value: unknown\n): \"draft\" | \"published\" | \"scheduled\" | \"archived\" | undefined {\n  if (value === \"draft\" || value === \"published\" || value === \"scheduled\" || value === \"archived\") {\n    return value;\n  }\n  return undefined;\n}\n\n/**\n * Safely convert access level\n */\nfunction safeAccessLevel(\n  value: unknown\n): \"public\" | \"premium\" | \"private\" | undefined {\n  if (value === \"public\" || value === \"premium\" || value === \"private\") {\n    return value;\n  }\n  return undefined;\n}\n\n/**\n * Safely convert genre array (for canon entries)\n */\nfunction safeGenreArray(value: unknown): string[] | undefined {\n  if (!Array.isArray(value)) return undefined;\n  const filtered = value.filter((item) => typeof item === \"string\") as string[];\n  return filtered.length > 0 ? filtered : undefined;\n}\n\n// ---------------------------------------------------------------------------\n// MAIN CONVERSION FUNCTIONS\n// ---------------------------------------------------------------------------\n\n/**\n * Map generic MDX meta into a fully shaped Canon.\n */\nfunction fromMdxMeta(meta: MdxMeta): Canon {\n  const m = meta as CanonishMdxMeta;\n\n  // Handle different date fields\n  const date = safeString(m.date) || safeString(m.publishDate) || safeString(m.releaseDate) || safeString(m.publishedDate);\n  \n  // Ensure required fields have defaults\n  const slug = safeString(m.slug) || \"\";\n  const title = safeString(m.title) || \"Untitled\";\n  \n  if (!slug || !title) {\n    console.warn(`Canon metadata missing slug or title: ${slug} - ${title}`);\n  }\n\n  return {\n    // Core identifiers - REQUIRED\n    slug,\n    title,\n\n    // Content fields\n    description: safeString(m.description),\n    excerpt: safeString(m.excerpt),\n    subtitle: safeString(m.subtitle),\n\n    // Metadata\n    date,\n    author: safeString(m.author),\n    category: safeString(m.category), // This should be in Canon type\n    tags: safeArray(m.tags),\n    featured: safeBoolean(m.featured),\n    readTime: safeString(m.readTime) || safeNumber(m.readTime),\n\n    // Visual\n    coverImage: safeString(m.coverImage) || safeString(m.image),\n\n    // Canon-specific fields\n    originalTitle: safeString(m.originalTitle),\n    translatedBy: safeString(m.translatedBy),\n    yearWritten: safeNumber(m.yearWritten),\n    yearPublished: safeNumber(m.yearPublished),\n    period: safeString(m.period),\n    movement: safeString(m.movement),\n    genre: safeGenreArray(m.genre),\n    literaryForm: safeString(m.literaryForm),\n    language: safeString(m.language),\n    country: safeString(m.country),\n    themes: safeArray(m.themes),\n    characters: safeArray(m.characters),\n    setting: safeString(m.setting),\n    symbolism: safeString(m.symbolism),\n    awards: safeArray(m.awards),\n    adaptations: safeArray(m.adaptations),\n    criticism: safeString(m.criticism),\n    influence: safeString(m.influence),\n    significance: safeString(m.significance),\n    isbn: safeString(m.isbn),\n    publisher: safeString(m.publisher),\n    publishedDate: safeString(m.publishedDate),\n    price: safeString(m.price),\n    purchaseLink: safeString(m.purchaseLink),\n    pages: safeNumber(m.pages),\n    format: safeString(m.format),\n    series: safeString(m.series),\n    volume: safeNumber(m.volume) || safeString(m.volume),\n    edition: safeString(m.edition),\n    rating: safeNumber(m.rating),\n    lastModified: safeString(m.lastModified),\n\n    // Additional fields\n    translator: safeString(m.translator),\n    editor: safeString(m.editor),\n    forewordBy: safeString(m.forewordBy),\n    introductionBy: safeString(m.introductionBy),\n\n    // State\n    draft: safeBoolean(m.draft),\n    published: safeBoolean(m.published),\n    status: safeStatus(m.status),\n\n    // Access\n    accessLevel: safeAccessLevel(m.accessLevel) || \"public\",\n    lockMessage: safeString(m.lockMessage),\n\n    // System fields\n    _raw: m._raw,\n    _id: safeString(m._id),\n    url: safeString(m.url),\n    type: safeString(m.type) || \"canon\",\n\n    // Preserve any additional fields\n    ...Object.fromEntries(\n      Object.entries(m)\n        .filter(([key]) => ![\n          'slug', 'title', 'description', 'excerpt', 'subtitle',\n          'date', 'author', 'category', 'tags', 'featured', 'readTime',\n          'coverImage', 'image', 'originalTitle', 'translatedBy', 'yearWritten',\n          'yearPublished', 'period', 'movement', 'genre', 'literaryForm', 'language',\n          'country', 'themes', 'characters', 'setting', 'symbolism', 'awards',\n          'adaptations', 'criticism', 'influence', 'significance', 'isbn', 'publisher',\n          'publishedDate', 'price', 'purchaseLink', 'pages', 'format', 'series',\n          'volume', 'edition', 'rating', 'lastModified', 'translator', 'editor',\n          'forewordBy', 'introductionBy', 'draft', 'published', 'status',\n          'accessLevel', 'lockMessage', '_raw', '_id', 'url', 'type', 'publishDate', 'releaseDate'\n        ].includes(key))\n        .map(([key, value]) => [key, value])\n    ),\n  };\n}\n\n/**\n * Attach MDX content to a typed Canon.\n */\nfunction fromMdxDocument(doc: MdxDocument): CanonWithContent {\n  const canonDoc = doc as CanonishMdxDocument;\n  const { content, ...rest } = canonDoc;\n  const meta = fromMdxMeta(rest);\n  \n  return { \n    ...meta, \n    content: typeof content === \"string\" ? content : \"\",\n    body: canonDoc.body || undefined,\n  };\n}\n\n/**\n * Convert Canon to ContentMeta for listings\n */\nexport function canonToContentMeta(canon: Canon): ContentMeta {\n  const { content, body, ...meta } = canon;\n  return {\n    ...meta,\n    category: canon.category, // Ensure category is included\n  };\n}\n\n/**\n * Convert Canon to ContentEntry for backward compatibility\n */\nexport function canonToContentEntry(canon: Canon): ContentEntry {\n  return {\n    slug: canon.slug,\n    title: canon.title,\n    date: canon.date,\n    excerpt: canon.excerpt,\n    description: canon.description,\n    category: canon.category,\n    tags: canon.tags,\n    featured: canon.featured,\n    readTime: canon.readTime,\n    _raw: canon._raw,\n    ...Object.fromEntries(\n      Object.entries(canon)\n        .filter(([key]) => ![\n          'slug', 'title', 'date', 'excerpt', 'description', 'category',\n          'tags', 'featured', 'readTime', '_raw', 'content', 'body'\n        ].includes(key))\n    ),\n  };\n}\n\n// ---------------------------------------------------------------------------\n// PUBLIC API FUNCTIONS\n// ---------------------------------------------------------------------------\n\n/**\n * All canon entries â€“ meta only.\n */\nexport function getAllCanonMeta(): Canon[] {\n  try {\n    const metas = getMdxCollectionMeta(\"canon\");\n    if (!metas || !Array.isArray(metas)) {\n      console.warn(\"No canon metadata found or metadata is not an array\");\n      return [];\n    }\n    \n    const canonEntries = metas.map((m) => fromMdxMeta(m));\n    \n    // Filter out invalid entries (missing required fields)\n    const validCanon = canonEntries.filter(canon => {\n      const isValid = canon.slug && canon.title;\n      if (!isValid) {\n        console.warn(`Invalid canon entry skipped: ${canon.slug || 'no-slug'} - ${canon.title || 'no-title'}`);\n      }\n      return isValid;\n    });\n    \n    console.log(`Found ${validCanon.length} valid canon entries out of ${metas.length} total`);\n    return validCanon;\n  } catch (error) {\n    console.error(\"Error fetching all canon meta:\", error);\n    return [];\n  }\n}\n\n/**\n * Single canon entry â€“ meta + content.\n */\nexport function getCanonBySlug(slug: string): CanonWithContent | null {\n  try {\n    if (!slug || typeof slug !== 'string') {\n      console.error(\"getCanonBySlug called with invalid slug:\", slug);\n      return null;\n    }\n    \n    const doc = getMdxDocumentBySlug(\"canon\", slug);\n    if (!doc) {\n      console.warn(`No canon entry found for slug: ${slug}`);\n      return null;\n    }\n    \n    return fromMdxDocument(doc);\n  } catch (error) {\n    console.error(`Error fetching canon by slug (${slug}):`, error);\n    return null;\n  }\n}\n\n/**\n * Get all canon entries with content\n */\nexport function getAllCanon(): CanonWithContent[] {\n  try {\n    const metas = getAllCanonMeta();\n    if (metas.length === 0) return [];\n    \n    const canonWithContent: CanonWithContent[] = [];\n    \n    for (const meta of metas) {\n      const canon = getCanonBySlug(meta.slug);\n      if (canon) {\n        canonWithContent.push(canon);\n      } else {\n        console.warn(`Could not load content for canon: ${meta.slug}`);\n      }\n    }\n    \n    return canonWithContent;\n  } catch (error) {\n    console.error(\"Error fetching all canon:\", error);\n    return [];\n  }\n}\n\n/**\n * Get canon entries by period\n */\nexport function getCanonByPeriod(period: string): Canon[] {\n  try {\n    const canonEntries = getAllCanonMeta();\n    if (!period || typeof period !== 'string') return [];\n    \n    const normalizedPeriod = period.toLowerCase().trim();\n    \n    return canonEntries.filter(canon => {\n      const canonPeriod = canon.period?.toLowerCase().trim();\n      return canonPeriod === normalizedPeriod;\n    });\n  } catch (error) {\n    console.error(`Error fetching canon by period (${period}):`, error);\n    return [];\n  }\n}\n\n/**\n * Get canon entries by movement\n */\nexport function getCanonByMovement(movement: string): Canon[] {\n  try {\n    const canonEntries = getAllCanonMeta();\n    if (!movement || typeof movement !== 'string') return [];\n    \n    const normalizedMovement = movement.toLowerCase().trim();\n    \n    return canonEntries.filter(canon => {\n      const canonMovement = canon.movement?.toLowerCase().trim();\n      return canonMovement === normalizedMovement;\n    });\n  } catch (error) {\n    console.error(`Error fetching canon by movement (${movement}):`, error);\n    return [];\n  }\n}\n\n/**\n * Get canon entries by genre\n */\nexport function getCanonByGenre(genre: string): Canon[] {\n  try {\n    const canonEntries = getAllCanonMeta();\n    if (!genre || typeof genre !== 'string') return [];\n    \n    const normalizedGenre = genre.toLowerCase().trim();\n    \n    return canonEntries.filter(canon => {\n      return canon.genre?.some(g => g.toLowerCase().trim() === normalizedGenre);\n    });\n  } catch (error) {\n    console.error(`Error fetching canon by genre (${genre}):`, error);\n    return [];\n  }\n}\n\n/**\n * Get canon entries by country\n */\nexport function getCanonByCountry(country: string): Canon[] {\n  try {\n    const canonEntries = getAllCanonMeta();\n    if (!country || typeof country !== 'string') return [];\n    \n    const normalizedCountry = country.toLowerCase().trim();\n    \n    return canonEntries.filter(canon => {\n      const canonCountry = canon.country?.toLowerCase().trim();\n      return canonCountry === normalizedCountry;\n    });\n  } catch (error) {\n    console.error(`Error fetching canon by country (${country}):`, error);\n    return [];\n  }\n}\n\n/**\n * Get canon entries by language\n */\nexport function getCanonByLanguage(language: string): Canon[] {\n  try {\n    const canonEntries = getAllCanonMeta();\n    if (!language || typeof language !== 'string') return [];\n    \n    const normalizedLanguage = language.toLowerCase().trim();\n    \n    return canonEntries.filter(canon => {\n      const canonLanguage = canon.language?.toLowerCase().trim();\n      return canonLanguage === normalizedLanguage;\n    });\n  } catch (error) {\n    console.error(`Error fetching canon by language (${language}):`, error);\n    return [];\n  }\n}\n\n/**\n * Get canon entries by category\n */\nexport function getCanonByCategory(category: string): Canon[] {\n  try {\n    const canonEntries = getAllCanonMeta();\n    if (!category || typeof category !== 'string') return [];\n    \n    const normalizedCategory = category.toLowerCase().trim();\n    \n    return canonEntries.filter(canon => {\n      const canonCategory = canon.category?.toLowerCase().trim();\n      return canonCategory === normalizedCategory;\n    });\n  } catch (error) {\n    console.error(`Error fetching canon by category (${category}):`, error);\n    return [];\n  }\n}\n\n/**\n * Get canon entries by tag\n */\nexport function getCanonByTag(tag: string): Canon[] {\n  try {\n    const canonEntries = getAllCanonMeta();\n    if (!tag || typeof tag !== 'string') return [];\n    \n    const normalizedTag = tag.toLowerCase().trim();\n    \n    return canonEntries.filter(canon => {\n      return canon.tags?.some(t => t.toLowerCase().trim() === normalizedTag);\n    });\n  } catch (error) {\n    console.error(`Error fetching canon by tag (${tag}):`, error);\n    return [];\n  }\n}\n\n/**\n * Get featured canon entries\n */\nexport function getFeaturedCanon(): Canon[] {\n  try {\n    const canonEntries = getAllCanonMeta();\n    return canonEntries.filter(canon => canon.featured === true);\n  } catch (error) {\n    console.error(\"Error fetching featured canon:\", error);\n    return [];\n  }\n}\n\n/**\n * Get published canon entries only (filter out drafts)\n */\nexport function getPublishedCanon(): Canon[] {\n  try {\n    const canonEntries = getAllCanonMeta();\n    return canonEntries.filter(canon => \n      canon.draft !== true && \n      canon.status !== \"draft\" && \n      (canon.published === true || canon.status === \"published\")\n    );\n  } catch (error) {\n    console.error(\"Error fetching published canon:\", error);\n    return [];\n  }\n}\n\n/**\n * Search canon entries by multiple fields\n */\nexport function searchCanon(query: string): Canon[] {\n  try {\n    const canonEntries = getAllCanonMeta();\n    const normalizedQuery = query.toLowerCase().trim();\n    \n    if (!normalizedQuery) return canonEntries;\n    \n    return canonEntries.filter(canon => {\n      // Search in title\n      if (canon.title?.toLowerCase().includes(normalizedQuery)) return true;\n      \n      // Search in original title\n      if (canon.originalTitle?.toLowerCase().includes(normalizedQuery)) return true;\n      \n      // Search in subtitle\n      if (canon.subtitle?.toLowerCase().includes(normalizedQuery)) return true;\n      \n      // Search in description\n      if (canon.description?.toLowerCase().includes(normalizedQuery)) return true;\n      \n      // Search in excerpt\n      if (canon.excerpt?.toLowerCase().includes(normalizedQuery)) return true;\n      \n      // Search in author\n      if (canon.author?.toLowerCase().includes(normalizedQuery)) return true;\n      \n      // Search in translator\n      if (canon.translator?.toLowerCase().includes(normalizedQuery)) return true;\n      \n      // Search in tags\n      if (canon.tags?.some(tag => tag.toLowerCase().includes(normalizedQuery))) return true;\n      \n      // Search in category\n      if (canon.category?.toLowerCase().includes(normalizedQuery)) return true;\n      \n      // Search in period\n      if (canon.period?.toLowerCase().includes(normalizedQuery)) return true;\n      \n      // Search in movement\n      if (canon.movement?.toLowerCase().includes(normalizedQuery)) return true;\n      \n      // Search in genre\n      if (canon.genre?.some(g => g.toLowerCase().includes(normalizedQuery))) return true;\n      \n      // Search in themes\n      if (canon.themes?.some(theme => theme.toLowerCase().includes(normalizedQuery))) return true;\n      \n      return false;\n    });\n  } catch (error) {\n    console.error(`Error searching canon (${query}):`, error);\n    return [];\n  }\n}\n\n/**\n * Get recent canon entries (sorted by date, newest first)\n */\nexport function getRecentCanon(limit?: number): Canon[] {\n  try {\n    const canonEntries = getAllCanonMeta();\n    \n    // Sort by date (newest first), then by title for same dates\n    const sorted = canonEntries.sort((a, b) => {\n      const dateA = a.date ? new Date(a.date).getTime() : 0;\n      const dateB = b.date ? new Date(b.date).getTime() : 0;\n      \n      if (dateB !== dateA) return dateB - dateA;\n      \n      // Same date, sort alphabetically by title\n      return (a.title || '').localeCompare(b.title || '');\n    });\n    \n    return limit && limit > 0 ? sorted.slice(0, limit) : sorted;\n  } catch (error) {\n    console.error(\"Error fetching recent canon:\", error);\n    return [];\n  }\n}\n\n/**\n * Get all unique periods from canon\n */\nexport function getAllCanonPeriods(): string[] {\n  try {\n    const canonEntries = getAllCanonMeta();\n    const periods = canonEntries\n      .map(canon => canon.period)\n      .filter((period): period is string => \n        typeof period === \"string\" && period.trim().length > 0\n      );\n    \n    // Remove duplicates and sort alphabetically\n    return [...new Set(periods)].sort();\n  } catch (error) {\n    console.error(\"Error fetching canon periods:\", error);\n    return [];\n  }\n}\n\n/**\n * Get all unique movements from canon\n */\nexport function getAllCanonMovements(): string[] {\n  try {\n    const canonEntries = getAllCanonMeta();\n    const movements = canonEntries\n      .map(canon => canon.movement)\n      .filter((movement): movement is string => \n        typeof movement === \"string\" && movement.trim().length > 0\n      );\n    \n    // Remove duplicates and sort alphabetically\n    return [...new Set(movements)].sort();\n  } catch (error) {\n    console.error(\"Error fetching canon movements:\", error);\n    return [];\n  }\n}\n\n/**\n * Get all unique genres from canon\n */\nexport function getAllCanonGenres(): string[] {\n  try {\n    const canonEntries = getAllCanonMeta();\n    const allGenres = canonEntries\n      .flatMap(canon => canon.genre || [])\n      .filter((genre): genre is string => typeof genre === \"string\");\n    \n    // Remove duplicates and sort alphabetically\n    return [...new Set(allGenres)].sort();\n  } catch (error) {\n    console.error(\"Error fetching canon genres:\", error);\n    return [];\n  }\n}\n\n/**\n * Get all unique countries from canon\n */\nexport function getAllCanonCountries(): string[] {\n  try {\n    const canonEntries = getAllCanonMeta();\n    const countries = canonEntries\n      .map(canon => canon.country)\n      .filter((country): country is string => \n        typeof country === \"string\" && country.trim().length > 0\n      );\n    \n    // Remove duplicates and sort alphabetically\n    return [...new Set(countries)].sort();\n  } catch (error) {\n    console.error(\"Error fetching canon countries:\", error);\n    return [];\n  }\n}\n\n/**\n * Get all unique languages from canon\n */\nexport function getAllCanonLanguages(): string[] {\n  try {\n    const canonEntries = getAllCanonMeta();\n    const languages = canonEntries\n      .map(canon => canon.language)\n      .filter((language): language is string => \n        typeof language === \"string\" && language.trim().length > 0\n      );\n    \n    // Remove duplicates and sort alphabetically\n    return [...new Set(languages)].sort();\n  } catch (error) {\n    console.error(\"Error fetching canon languages:\", error);\n    return [];\n  }\n}\n\n/**\n * Get all unique categories from canon\n */\nexport function getAllCanonCategories(): string[] {\n  try {\n    const canonEntries = getAllCanonMeta();\n    const categories = canonEntries\n      .map(canon => canon.category)\n      .filter((category): category is string => \n        typeof category === \"string\" && category.trim().length > 0\n      );\n    \n    // Remove duplicates and sort alphabetically\n    return [...new Set(categories)].sort();\n  } catch (error) {\n    console.error(\"Error fetching canon categories:\", error);\n    return [];\n  }\n}\n\n/**\n * Get all unique tags from canon\n */\nexport function getAllCanonTags(): string[] {\n  try {\n    const canonEntries = getAllCanonMeta();\n    const allTags = canonEntries\n      .flatMap(canon => canon.tags || [])\n      .filter((tag): tag is string => typeof tag === \"string\");\n    \n    // Remove duplicates and sort alphabetically\n    return [...new Set(allTags)].sort();\n  } catch (error) {\n    console.error(\"Error fetching canon tags:\", error);\n    return [];\n  }\n}\n\n/**\n * Get all unique authors from canon\n */\nexport function getAllCanonAuthors(): string[] {\n  try {\n    const canonEntries = getAllCanonMeta();\n    const authors = canonEntries\n      .map(canon => canon.author)\n      .filter((author): author is string => \n        typeof author === \"string\" && author.trim().length > 0\n      );\n    \n    // Remove duplicates and sort alphabetically\n    return [...new Set(authors)].sort();\n  } catch (error) {\n    console.error(\"Error fetching canon authors:\", error);\n    return [];\n  }\n}\n\n/**\n * Get all unique translators from canon\n */\nexport function getAllCanonTranslators(): string[] {\n  try {\n    const canonEntries = getAllCanonMeta();\n    const translators = canonEntries\n      .map(canon => canon.translator)\n      .filter((translator): translator is string => \n        typeof translator === \"string\" && translator.trim().length > 0\n      );\n    \n    // Remove duplicates and sort alphabetically\n    return [...new Set(translators)].sort();\n  } catch (error) {\n    console.error(\"Error fetching canon translators:\", error);\n    return [];\n  }\n}\n\n/**\n * Get canon slugs for static generation\n */\nexport function getAllCanonSlugs(): string[] {\n  try {\n    const canonEntries = getAllCanonMeta();\n    return canonEntries\n      .map(canon => canon.slug)\n      .filter((slug): slug is string => typeof slug === \"string\" && slug.length > 0);\n  } catch (error) {\n    console.error(\"Error fetching canon slugs:\", error);\n    return [];\n  }\n}\n\n/**\n * Get statistics about canon entries\n */\nexport function getCanonStats(): {\n  total: number;\n  published: number;\n  drafts: number;\n  featured: number;\n  byPeriod: Record<string, number>;\n  byMovement: Record<string, number>;\n  byCountry: Record<string, number>;\n  byLanguage: Record<string, number>;\n  byYear: Record<string, number>;\n} {\n  try {\n    const canonEntries = getAllCanonMeta();\n    \n    const stats = {\n      total: canonEntries.length,\n      published: canonEntries.filter(c => c.published === true || c.status === \"published\").length,\n      drafts: canonEntries.filter(c => c.draft === true || c.status === \"draft\").length,\n      featured: canonEntries.filter(c => c.featured === true).length,\n      byPeriod: {} as Record<string, number>,\n      byMovement: {} as Record<string, number>,\n      byCountry: {} as Record<string, number>,\n      byLanguage: {} as Record<string, number>,\n      byYear: {} as Record<string, number>,\n    };\n    \n    canonEntries.forEach(canon => {\n      // Count by period\n      if (canon.period) {\n        stats.byPeriod[canon.period] = (stats.byPeriod[canon.period] || 0) + 1;\n      }\n      \n      // Count by movement\n      if (canon.movement) {\n        stats.byMovement[canon.movement] = (stats.byMovement[canon.movement] || 0) + 1;\n      }\n      \n      // Count by country\n      if (canon.country) {\n        stats.byCountry[canon.country] = (stats.byCountry[canon.country] || 0) + 1;\n      }\n      \n      // Count by language\n      if (canon.language) {\n        stats.byLanguage[canon.language] = (stats.byLanguage[canon.language] || 0) + 1;\n      }\n      \n      // Count by year\n      if (canon.date) {\n        const year = new Date(canon.date).getFullYear().toString();\n        stats.byYear[year] = (stats.byYear[year] || 0) + 1;\n      }\n    });\n    \n    return stats;\n  } catch (error) {\n    console.error(\"Error fetching canon stats:\", error);\n    return {\n      total: 0,\n      published: 0,\n      drafts: 0,\n      featured: 0,\n      byPeriod: {},\n      byMovement: {},\n      byCountry: {},\n      byLanguage: {},\n      byYear: {},\n    };\n  }\n}\n\n// ---------------------------------------------------------------------------\n// DEFAULT EXPORT\n// ---------------------------------------------------------------------------\n\nconst canonData = {\n  // Core functions\n  getAllCanonMeta,\n  getCanonBySlug,\n  getAllCanon,\n  \n  // Filter functions\n  getCanonByPeriod,\n  getCanonByMovement,\n  getCanonByGenre,\n  getCanonByCountry,\n  getCanonByLanguage,\n  getCanonByCategory,\n  getCanonByTag,\n  getFeaturedCanon,\n  getPublishedCanon,\n  searchCanon,\n  getRecentCanon,\n  \n  // List functions\n  getAllCanonPeriods,\n  getAllCanonMovements,\n  getAllCanonGenres,\n  getAllCanonCountries,\n  getAllCanonLanguages,\n  getAllCanonCategories,\n  getAllCanonTags,\n  getAllCanonAuthors,\n  getAllCanonTranslators,\n  getAllCanonSlugs,\n  \n  // Stats\n  getCanonStats,\n  \n  // Utility functions\n  canonToContentMeta,\n  canonToContentEntry,\n};\n\nexport default canonData;","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\server\\content-data.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\server\\content.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\server\\contentlayer-helper.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\server\\db.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\server\\downloads-data.ts","messages":[{"ruleId":"import/no-anonymous-default-export","severity":1,"message":"Assign object to a variable before exporting as module default","line":138,"column":1,"nodeType":"ExportDefaultDeclaration","endLine":142,"endColumn":3}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// lib/server/downloads-data.ts\nimport {\n  getMdxCollectionMeta,\n  getMdxDocumentBySlug,\n  type MdxMeta,\n  type MdxDocument,\n} from \"@/lib/server/mdx-collections\";\nimport type { Download } from \"@/types/index\";\n\nexport type DownloadWithContent = Download & {\n  content: string;\n};\n\n// Safe converters (same pattern as posts)\nfunction safeString(value: any): string | undefined {\n  return typeof value === \"string\" && value.trim() ? value.trim() : undefined;\n}\n\nfunction safeArray(value: any): string[] | undefined {\n  if (!Array.isArray(value)) return undefined;\n  return value.filter(item => typeof item === \"string\");\n}\n\nfunction safeNumber(value: any): number | undefined {\n  if (typeof value === \"number\") return value;\n  if (typeof value === \"string\") {\n    const parsed = parseInt(value, 10);\n    return isNaN(parsed) ? undefined : parsed;\n  }\n  return undefined;\n}\n\nfunction fromMdxMeta(meta: MdxMeta): Download {\n  const m = meta as any;\n  \n  const slug = safeString(m.slug) || safeString(m._raw?.flattenedPath) || \"\";\n  \n  return {\n    // Required\n    slug,\n    title: safeString(m.title) || \"Untitled Download\",\n    \n    // Content\n    description: safeString(m.description) || safeString(m.excerpt),\n    excerpt: safeString(m.excerpt) || safeString(m.description),\n    \n    // Metadata\n    date: safeString(m.date),\n    author: safeString(m.author),\n    category: safeString(m.category),\n    tags: safeArray(m.tags),\n    featured: m.featured === true,\n    \n    // Visual\n    coverImage: safeString(m.coverImage) || safeString(m.image),\n    \n    // State\n    draft: m.draft === true,\n    published: m.published === true,\n    \n    // Download-specific\n    fileName: safeString(m.fileName),\n    fileSize: safeString(m.fileSize) || safeNumber(m.fileSize)?.toString(),\n    fileFormat: safeString(m.fileFormat),\n    fileUrl: safeString(m.fileUrl),\n    downloadUrl: safeString(m.downloadUrl),\n    version: safeString(m.version),\n    versionDate: safeString(m.versionDate),\n    changelog: safeArray(m.changelog),\n    requirements: safeArray(m.requirements),\n    compatibility: safeArray(m.compatibility),\n    systemRequirements: safeString(m.systemRequirements),\n    license: safeString(m.license),\n    licenseUrl: safeString(m.licenseUrl),\n    termsOfUse: safeString(m.termsOfUse),\n    useCases: safeArray(m.useCases),\n    applications: safeArray(m.applications),\n    industries: safeArray(m.industries),\n    framework: safeString(m.framework),\n    dependencies: safeArray(m.dependencies),\n    installation: safeString(m.installation),\n    supportEmail: safeString(m.supportEmail),\n    documentationUrl: safeString(m.documentationUrl),\n    tutorialUrl: safeString(m.tutorialUrl),\n    \n    // System\n    _raw: m._raw,\n    url: safeString(m.url),\n    type: \"download\",\n  };\n}\n\nfunction fromMdxDocument(doc: MdxDocument): DownloadWithContent {\n  const { content, ...rest } = doc as any;\n  const meta = fromMdxMeta(rest);\n  \n  return {\n    ...meta,\n    content: typeof content === \"string\" ? content : \"\",\n  };\n}\n\nexport function getAllDownloadsMeta(): Download[] {\n  try {\n    const metas = getMdxCollectionMeta(\"downloads\");\n    return metas.map(m => fromMdxMeta(m));\n  } catch (error) {\n    console.error(\"[downloads-data] Error getting all downloads meta:\", error);\n    return [];\n  }\n}\n\nexport function getDownloadBySlug(slug: string): DownloadWithContent | null {\n  try {\n    const doc = getMdxDocumentBySlug(\"downloads\", slug);\n    if (!doc) {\n      console.warn(`[downloads-data] Download not found: ${slug}`);\n      return null;\n    }\n    \n    return fromMdxDocument(doc);\n  } catch (error) {\n    console.error(`[downloads-data] Error getting download ${slug}:`, error);\n    return null;\n  }\n}\n\nexport function getFeaturedDownloads(): Download[] {\n  try {\n    return getAllDownloadsMeta()\n      .filter(d => d.featured && !d.draft);\n  } catch (error) {\n    console.error(\"[downloads-data] Error getting featured downloads:\", error);\n    return [];\n  }\n}\n\nexport default {\n  getAllDownloadsMeta,\n  getDownloadBySlug,\n  getFeaturedDownloads,\n};","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\server\\email.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\server\\events-data.ts","messages":[{"ruleId":"import/no-anonymous-default-export","severity":1,"message":"Assign object to a variable before exporting as module default","line":187,"column":1,"nodeType":"ExportDefaultDeclaration","endLine":192,"endColumn":3}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// lib/server/events-data.ts\nimport {\n  getMdxCollectionMeta,\n  getMdxDocumentBySlug,\n  type MdxMeta,\n  type MdxDocument,\n} from \"@/lib/server/mdx-collections\";\nimport type { Event } from \"@/types/index\";\n\nexport type EventWithContent = Event & {\n  content: string;\n};\n\n// Safe converters\nfunction safeString(value: any): string | undefined {\n  return typeof value === \"string\" && value.trim() ? value.trim() : undefined;\n}\n\nfunction safeArray(value: any): string[] | undefined {\n  if (!Array.isArray(value)) return undefined;\n  return value.filter(item => typeof item === \"string\");\n}\n\nfunction safeNumber(value: any): number | undefined {\n  if (typeof value === \"number\") return value;\n  if (typeof value === \"string\") {\n    const parsed = parseInt(value, 10);\n    return isNaN(parsed) ? undefined : parsed;\n  }\n  return undefined;\n}\n\nfunction safeBoolean(value: any): boolean {\n  if (typeof value === \"boolean\") return value;\n  if (typeof value === \"string\") {\n    const lower = value.toLowerCase().trim();\n    return lower === \"true\" || lower === \"yes\" || lower === \"1\";\n  }\n  return false;\n}\n\nfunction fromMdxMeta(meta: MdxMeta): Event {\n  const m = meta as any;\n  \n  const slug = safeString(m.slug) || safeString(m._raw?.flattenedPath) || \"\";\n  \n  return {\n    // Required\n    slug,\n    title: safeString(m.title) || \"Untitled Event\",\n    \n    // Content\n    description: safeString(m.description) || safeString(m.excerpt),\n    excerpt: safeString(m.excerpt) || safeString(m.description),\n    \n    // Metadata\n    date: safeString(m.date),\n    author: safeString(m.author),\n    category: safeString(m.category),\n    tags: safeArray(m.tags),\n    featured: safeBoolean(m.featured),\n    \n    // Visual\n    coverImage: safeString(m.coverImage) || safeString(m.image),\n    \n    // State\n    draft: safeBoolean(m.draft),\n    published: safeBoolean(m.published),\n    \n    // Event-specific\n    eventDate: safeString(m.eventDate),\n    startTime: safeString(m.startTime),\n    endTime: safeString(m.endTime),\n    timezone: safeString(m.timezone),\n    duration: safeString(m.duration),\n    location: safeString(m.location),\n    venue: safeString(m.venue),\n    address: safeString(m.address),\n    city: safeString(m.city),\n    country: safeString(m.country),\n    isOnline: safeBoolean(m.isOnline),\n    onlineUrl: safeString(m.onlineUrl),\n    registrationUrl: safeString(m.registrationUrl),\n    registrationDeadline: safeString(m.registrationDeadline),\n    price: safeString(m.price) || safeNumber(m.price)?.toString(),\n    currency: safeString(m.currency),\n    capacity: safeNumber(m.capacity),\n    seatsAvailable: safeNumber(m.seatsAvailable),\n    speakers: safeArray(m.speakers),\n    host: safeString(m.host),\n    organizer: safeString(m.organizer),\n    eventType: safeString(m.eventType) as any,\n    level: safeString(m.level) as any,\n    requirements: safeArray(m.requirements),\n    materials: safeArray(m.materials),\n    takeaways: safeArray(m.takeaways),\n    isUpcoming: safeBoolean(m.isUpcoming),\n    isPast: safeBoolean(m.isPast),\n    isCancelled: safeBoolean(m.isCancelled),\n    \n    // System\n    _raw: m._raw,\n    url: safeString(m.url),\n    type: \"event\",\n  };\n}\n\nfunction fromMdxDocument(doc: MdxDocument): EventWithContent {\n  const { content, ...rest } = doc as any;\n  const meta = fromMdxMeta(rest);\n  \n  return {\n    ...meta,\n    content: typeof content === \"string\" ? content : \"\",\n  };\n}\n\nexport function getAllEventsMeta(): Event[] {\n  try {\n    const metas = getMdxCollectionMeta(\"events\");\n    return metas.map(m => fromMdxMeta(m));\n  } catch (error) {\n    console.error(\"[events-data] Error getting all events meta:\", error);\n    return [];\n  }\n}\n\nexport function getEventBySlug(slug: string): EventWithContent | null {\n  try {\n    const doc = getMdxDocumentBySlug(\"events\", slug);\n    if (!doc) {\n      console.warn(`[events-data] Event not found: ${slug}`);\n      return null;\n    }\n    \n    return fromMdxDocument(doc);\n  } catch (error) {\n    console.error(`[events-data] Error getting event ${slug}:`, error);\n    return null;\n  }\n}\n\nexport function getUpcomingEvents(): Event[] {\n  try {\n    const now = new Date();\n    return getAllEventsMeta()\n      .filter(e => {\n        if (e.draft) return false;\n        if (!e.eventDate) return false;\n        \n        const eventDate = new Date(e.eventDate);\n        return eventDate >= now && !e.isCancelled;\n      })\n      .sort((a, b) => {\n        const dateA = a.eventDate ? new Date(a.eventDate).getTime() : 0;\n        const dateB = b.eventDate ? new Date(b.eventDate).getTime() : 0;\n        return dateA - dateB;\n      });\n  } catch (error) {\n    console.error(\"[events-data] Error getting upcoming events:\", error);\n    return [];\n  }\n}\n\nexport function getPastEvents(): Event[] {\n  try {\n    const now = new Date();\n    return getAllEventsMeta()\n      .filter(e => {\n        if (e.draft) return false;\n        if (!e.eventDate) return false;\n        \n        const eventDate = new Date(e.eventDate);\n        return eventDate < now;\n      })\n      .sort((a, b) => {\n        const dateA = a.eventDate ? new Date(a.eventDate).getTime() : 0;\n        const dateB = b.eventDate ? new Date(b.eventDate).getTime() : 0;\n        return dateB - dateA;\n      });\n  } catch (error) {\n    console.error(\"[events-data] Error getting past events:\", error);\n    return [];\n  }\n}\n\nexport default {\n  getAllEventsMeta,\n  getEventBySlug,\n  getUpcomingEvents,\n  getPastEvents,\n};","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\server\\guards.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\server\\http.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\server\\inner-circle-export.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'sha256Hex' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// lib/server/inner-circle-export.ts\r\nimport crypto from \"node:crypto\";\r\nimport { Pool } from \"pg\";\r\n\r\nfunction sha256Hex(value: string): string {\r\n  return crypto.createHash(\"sha256\").update(value, \"utf8\").digest(\"hex\");\r\n}\r\n\r\nlet pool: Pool | null = null;\r\n\r\nfunction getPool(): Pool | null {\r\n  const conn = process.env.INNER_CIRCLE_DB_URL ?? process.env.DATABASE_URL;\r\n  if (!conn) return null;\r\n\r\n  if (!pool) {\r\n    pool = new Pool({\r\n      connectionString: conn,\r\n      max: 5,\r\n      ssl: conn.includes(\"localhost\")\r\n        ? undefined\r\n        : { rejectUnauthorized: false },\r\n    });\r\n  }\r\n  return pool;\r\n}\r\n\r\n/**\r\n * Privacy-safe export for admin dashboards:\r\n * - Never returns full keys (only suffix + metadata)\r\n * - Never returns raw email (only hash prefix)\r\n */\r\nexport async function getPrivacySafeKeyExport(): Promise<\r\n  Array<{\r\n    memberId: string;\r\n    emailHashPrefix: string;\r\n    name: string | null;\r\n    keySuffix: string;\r\n    status: string;\r\n    createdAt: string | null;\r\n    expiresAt: string | null;\r\n    totalUnlocks: number;\r\n    lastUsedAt: string | null;\r\n  }>\r\n> {\r\n  const p = getPool();\r\n  if (!p) return [];\r\n\r\n  const client = await p.connect();\r\n  try {\r\n    const res = await client.query(\r\n      `\r\n      SELECT\r\n        m.id as \"memberId\",\r\n        COALESCE(m.email_hash_prefix, SUBSTRING(m.email_hash, 1, 10)) as \"emailHashPrefix\",\r\n        m.name as \"name\",\r\n        k.key_suffix as \"keySuffix\",\r\n        k.status as \"status\",\r\n        k.created_at as \"createdAt\",\r\n        k.expires_at as \"expiresAt\",\r\n        COALESCE(k.total_unlocks, 0) as \"totalUnlocks\",\r\n        k.last_used_at as \"lastUsedAt\"\r\n      FROM inner_circle_keys k\r\n      JOIN inner_circle_members m ON m.id = k.member_id\r\n      ORDER BY k.created_at DESC\r\n      LIMIT 2000\r\n      `\r\n    );\r\n\r\n    return (res.rows ?? []).map((r: any) => ({\r\n      memberId: String(r.memberId),\r\n      emailHashPrefix: String(r.emailHashPrefix ?? \"\"),\r\n      name: r.name ?? null,\r\n      keySuffix: String(r.keySuffix ?? \"\"),\r\n      status: String(r.status ?? \"\"),\r\n      createdAt: r.createdAt ? new Date(r.createdAt).toISOString() : null,\r\n      expiresAt: r.expiresAt ? new Date(r.expiresAt).toISOString() : null,\r\n      totalUnlocks: Number(r.totalUnlocks ?? 0),\r\n      lastUsedAt: r.lastUsedAt ? new Date(r.lastUsedAt).toISOString() : null,\r\n    }));\r\n  } finally {\r\n    client.release();\r\n  }\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\server\\inner-circle-store.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\server\\innerCircleCrypto.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\server\\ip.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\server\\log.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\server\\md-utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\server\\mdx-collections.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\server\\pages-data.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'content' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":201,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":201,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'body' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":201,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":201,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// lib/server/pages-data.ts - FIXED VERSION\n// Pages under content/pages/* - Using MDX collections\n\nimport {\n  getMdxCollectionMeta,\n  getMdxDocumentBySlug,\n  type MdxMeta,\n  type MdxDocument,\n} from \"@/lib/server/mdx-collections\";\nimport type { Page, ContentEntry, ContentMeta } from \"@/types/index\";\n\nexport type PageWithContent = Page & {\n  content: string;\n};\n\n// Extended MDX meta with page-specific fields\ntype PageishMdxMeta = MdxMeta & Partial<Page> & {\n  publishDate?: string;\n  releaseDate?: string;\n  [key: string]: any;\n};\n\ntype PageishMdxDocument = MdxDocument & {\n  content: string;\n} & Partial<Page>;\n\n// ---------------------------------------------------------------------------\n// SAFE TYPE CONVERTERS\n// ---------------------------------------------------------------------------\n\nfunction safeString(value: unknown): string | undefined {\n  return typeof value === \"string\" && value.trim().length > 0\n    ? value.trim()\n    : undefined;\n}\n\nfunction safeNumber(value: unknown): number | undefined {\n  if (typeof value === \"number\") return value;\n  if (typeof value === \"string\") {\n    const parsed = parseInt(value, 10);\n    return Number.isNaN(parsed) ? undefined : parsed;\n  }\n  return undefined;\n}\n\nfunction safeBoolean(value: unknown): boolean | undefined {\n  if (typeof value === \"boolean\") return value;\n  if (typeof value === \"string\") {\n    const lower = value.toLowerCase().trim();\n    if (lower === \"true\") return true;\n    if (lower === \"false\") return false;\n    if (lower === \"yes\") return true;\n    if (lower === \"no\") return false;\n    if (lower === \"1\") return true;\n    if (lower === \"0\") return false;\n  }\n  if (typeof value === \"number\") {\n    return value === 1;\n  }\n  return undefined;\n}\n\nfunction safeArray(value: unknown): string[] | undefined {\n  if (!Array.isArray(value)) return undefined;\n  const filtered = value.filter((item) => typeof item === \"string\") as string[];\n  return filtered.length > 0 ? filtered : undefined;\n}\n\nfunction safeStatus(\n  value: unknown\n): \"draft\" | \"published\" | \"scheduled\" | \"archived\" | undefined {\n  if (value === \"draft\" || value === \"published\" || value === \"scheduled\" || value === \"archived\") {\n    return value;\n  }\n  return undefined;\n}\n\nfunction safeAccessLevel(\n  value: unknown\n): \"public\" | \"premium\" | \"private\" | undefined {\n  if (value === \"public\" || value === \"premium\" || value === \"private\") {\n    return value;\n  }\n  return undefined;\n}\n\n/**\n * Safely convert layout field to allowed values\n */\nfunction safeLayout(\n  value: unknown\n): \"narrow\" | \"default\" | \"wide\" | \"fullscreen\" | undefined {\n  if (typeof value === \"string\") {\n    const lowerValue = value.toLowerCase().trim();\n    if (lowerValue === \"narrow\") return \"narrow\";\n    if (lowerValue === \"default\") return \"default\";\n    if (lowerValue === \"wide\") return \"wide\";\n    if (lowerValue === \"fullscreen\") return \"fullscreen\";\n  }\n  return undefined;\n}\n\n// ---------------------------------------------------------------------------\n// MAIN CONVERSION FUNCTIONS\n// ---------------------------------------------------------------------------\n\nfunction fromMdxMeta(meta: MdxMeta): Page {\n  const m = meta as PageishMdxMeta;\n\n  // Handle different date fields\n  const date = safeString(m.date) || safeString(m.publishDate) || safeString(m.releaseDate);\n  \n  // Ensure required fields have defaults\n  const slug = safeString(m.slug) || \"\";\n  const title = safeString(m.title) || \"Untitled Page\";\n  \n  if (!slug || !title) {\n    console.warn(`Page metadata missing slug or title: ${slug} - ${title}`);\n  }\n\n  return {\n    // Core identifiers\n    slug,\n    title,\n\n    // Content fields\n    description: safeString(m.description),\n    excerpt: safeString(m.excerpt),\n    subtitle: safeString(m.subtitle),\n\n    // Metadata\n    date,\n    author: safeString(m.author),\n    category: safeString(m.category),\n    tags: safeArray(m.tags),\n    featured: safeBoolean(m.featured),\n    readTime: safeString(m.readTime) || safeNumber(m.readTime),\n\n    // Visual\n    coverImage: safeString(m.coverImage) || safeString(m.image),\n\n    // Page-specific fields\n    pageType: safeString(m.pageType) || \"page\",\n    parentPage: safeString(m.parentPage),\n    order: safeNumber(m.order),\n    template: safeString(m.template),\n    layout: safeLayout(m.layout) || \"default\", // Use safeLayout converter with default\n    showInNav: safeBoolean(m.showInNav),\n    navOrder: safeNumber(m.navOrder),\n    navTitle: safeString(m.navTitle),\n    metaTitle: safeString(m.metaTitle),\n    metaDescription: safeString(m.metaDescription),\n    keywords: safeArray(m.keywords),\n    lastModified: safeString(m.lastModified),\n\n    // State\n    draft: safeBoolean(m.draft),\n    published: safeBoolean(m.published),\n    status: safeStatus(m.status),\n\n    // Access\n    accessLevel: safeAccessLevel(m.accessLevel) || \"public\",\n    lockMessage: safeString(m.lockMessage),\n\n    // System fields\n    _raw: m._raw,\n    _id: safeString(m._id),\n    url: safeString(m.url),\n    type: safeString(m.type) || \"page\",\n\n    // Preserve any additional fields\n    ...Object.fromEntries(\n      Object.entries(m)\n        .filter(([key]) => ![\n          'slug', 'title', 'description', 'excerpt', 'subtitle',\n          'date', 'author', 'category', 'tags', 'featured', 'readTime',\n          'coverImage', 'image', 'pageType', 'parentPage', 'order',\n          'template', 'layout', 'showInNav', 'navOrder', 'navTitle',\n          'metaTitle', 'metaDescription', 'keywords', 'lastModified',\n          'draft', 'published', 'status', 'accessLevel', 'lockMessage',\n          '_raw', '_id', 'url', 'type', 'publishDate', 'releaseDate'\n        ].includes(key))\n        .map(([key, value]) => [key, value])\n    ),\n  };\n}\n\nfunction fromMdxDocument(doc: MdxDocument): PageWithContent {\n  const pageDoc = doc as PageishMdxDocument;\n  const { content, ...rest } = pageDoc;\n  const meta = fromMdxMeta(rest);\n  \n  return { \n    ...meta, \n    content: typeof content === \"string\" ? content : \"\",\n    body: pageDoc.body || undefined,\n  };\n}\n\nexport function pageToContentMeta(page: Page): ContentMeta {\n  const { content, body, ...meta } = page;\n  return meta;\n}\n\nexport function pageToContentEntry(page: Page): ContentEntry {\n  return {\n    slug: page.slug,\n    title: page.title,\n    date: page.date,\n    excerpt: page.excerpt,\n    description: page.description,\n    category: page.category,\n    tags: page.tags,\n    featured: page.featured,\n    readTime: page.readTime,\n    _raw: page._raw,\n    ...Object.fromEntries(\n      Object.entries(page)\n        .filter(([key]) => ![\n          'slug', 'title', 'date', 'excerpt', 'description', 'category',\n          'tags', 'featured', 'readTime', '_raw', 'content', 'body'\n        ].includes(key))\n    ),\n  };\n}\n\n// ---------------------------------------------------------------------------\n// PUBLIC API FUNCTIONS\n// ---------------------------------------------------------------------------\n\nexport function getAllPagesMeta(): Page[] {\n  try {\n    const metas = getMdxCollectionMeta(\"pages\");\n    if (!metas || !Array.isArray(metas)) {\n      console.warn(\"No pages metadata found or metadata is not an array\");\n      return [];\n    }\n    \n    const pages = metas.map((m) => fromMdxMeta(m));\n    \n    // Filter out invalid pages (missing required fields)\n    const validPages = pages.filter(page => {\n      const isValid = page.slug && page.title;\n      if (!isValid) {\n        console.warn(`Invalid page skipped: ${page.slug || 'no-slug'} - ${page.title || 'no-title'}`);\n      }\n      return isValid;\n    });\n    \n    console.log(`Found ${validPages.length} valid pages out of ${metas.length} total`);\n    return validPages;\n  } catch (error) {\n    console.error(\"Error fetching all pages meta:\", error);\n    return [];\n  }\n}\n\nexport function getPageBySlug(slug: string): PageWithContent | null {\n  try {\n    if (!slug || typeof slug !== 'string') {\n      console.error(\"getPageBySlug called with invalid slug:\", slug);\n      return null;\n    }\n    \n    const doc = getMdxDocumentBySlug(\"pages\", slug);\n    if (!doc) {\n      console.warn(`No page found for slug: ${slug}`);\n      return null;\n    }\n    \n    return fromMdxDocument(doc);\n  } catch (error) {\n    console.error(`Error fetching page by slug (${slug}):`, error);\n    return null;\n  }\n}\n\nexport function getAllPages(): PageWithContent[] {\n  try {\n    const metas = getAllPagesMeta();\n    if (metas.length === 0) return [];\n    \n    const pagesWithContent: PageWithContent[] = [];\n    \n    for (const meta of metas) {\n      const page = getPageBySlug(meta.slug);\n      if (page) {\n        pagesWithContent.push(page);\n      } else {\n        console.warn(`Could not load content for page: ${meta.slug}`);\n      }\n    }\n    \n    return pagesWithContent;\n  } catch (error) {\n    console.error(\"Error fetching all pages:\", error);\n    return [];\n  }\n}\n\nexport function getPagesByCategory(category: string): Page[] {\n  try {\n    const pages = getAllPagesMeta();\n    if (!category || typeof category !== 'string') return [];\n    \n    const normalizedCategory = category.toLowerCase().trim();\n    \n    return pages.filter(page => {\n      const pageCategory = page.category?.toLowerCase().trim();\n      return pageCategory === normalizedCategory;\n    });\n  } catch (error) {\n    console.error(`Error fetching pages by category (${category}):`, error);\n    return [];\n  }\n}\n\nexport function getPagesByTag(tag: string): Page[] {\n  try {\n    const pages = getAllPagesMeta();\n    if (!tag || typeof tag !== 'string') return [];\n    \n    const normalizedTag = tag.toLowerCase().trim();\n    \n    return pages.filter(page => {\n      return page.tags?.some(t => t.toLowerCase().trim() === normalizedTag);\n    });\n  } catch (error) {\n    console.error(`Error fetching pages by tag (${tag}):`, error);\n    return [];\n  }\n}\n\nexport function getFeaturedPages(): Page[] {\n  try {\n    const pages = getAllPagesMeta();\n    return pages.filter(page => page.featured === true);\n  } catch (error) {\n    console.error(\"Error fetching featured pages:\", error);\n    return [];\n  }\n}\n\nexport function getPublishedPages(): Page[] {\n  try {\n    const pages = getAllPagesMeta();\n    return pages.filter(page => \n      page.draft !== true && \n      page.status !== \"draft\" && \n      (page.published === true || page.status === \"published\")\n    );\n  } catch (error) {\n    console.error(\"Error fetching published pages:\", error);\n    return [];\n  }\n}\n\nexport function getNavPages(): Page[] {\n  try {\n    const pages = getPublishedPages();\n    return pages\n      .filter(page => page.showInNav !== false)\n      .sort((a, b) => {\n        // Sort by navOrder, then by title\n        const orderA = a.navOrder || 999;\n        const orderB = b.navOrder || 999;\n        if (orderA !== orderB) return orderA - orderB;\n        return (a.navTitle || a.title || '').localeCompare(b.navTitle || b.title || '');\n      });\n  } catch (error) {\n    console.error(\"Error fetching nav pages:\", error);\n    return [];\n  }\n}\n\nexport function getChildPages(parentSlug: string): Page[] {\n  try {\n    const pages = getPublishedPages();\n    if (!parentSlug || typeof parentSlug !== 'string') return [];\n    \n    return pages\n      .filter(page => page.parentPage === parentSlug)\n      .sort((a, b) => {\n        // Sort by order, then by title\n        const orderA = a.order || 999;\n        const orderB = b.order || 999;\n        if (orderA !== orderB) return orderA - orderB;\n        return (a.title || '').localeCompare(b.title || '');\n      });\n  } catch (error) {\n    console.error(`Error fetching child pages for ${parentSlug}:`, error);\n    return [];\n  }\n}\n\nexport function getPagesByType(pageType: string): Page[] {\n  try {\n    const pages = getPublishedPages();\n    if (!pageType || typeof pageType !== 'string') return [];\n    \n    const normalizedType = pageType.toLowerCase().trim();\n    \n    return pages.filter(page => \n      page.pageType?.toLowerCase().trim() === normalizedType\n    );\n  } catch (error) {\n    console.error(`Error fetching pages by type (${pageType}):`, error);\n    return [];\n  }\n}\n\nexport function searchPages(query: string): Page[] {\n  try {\n    const pages = getPublishedPages();\n    const normalizedQuery = query.toLowerCase().trim();\n    \n    if (!normalizedQuery) return pages;\n    \n    return pages.filter(page => {\n      // Search in title\n      if (page.title?.toLowerCase().includes(normalizedQuery)) return true;\n      \n      // Search in subtitle\n      if (page.subtitle?.toLowerCase().includes(normalizedQuery)) return true;\n      \n      // Search in description\n      if (page.description?.toLowerCase().includes(normalizedQuery)) return true;\n      \n      // Search in excerpt\n      if (page.excerpt?.toLowerCase().includes(normalizedQuery)) return true;\n      \n      // Search in tags\n      if (page.tags?.some(tag => tag.toLowerCase().includes(normalizedQuery))) return true;\n      \n      // Search in category\n      if (page.category?.toLowerCase().includes(normalizedQuery)) return true;\n      \n      return false;\n    });\n  } catch (error) {\n    console.error(`Error searching pages (${query}):`, error);\n    return [];\n  }\n}\n\nexport function getRecentPages(limit?: number): Page[] {\n  try {\n    const pages = getPublishedPages();\n    \n    // Sort by date (newest first), then by title for same dates\n    const sorted = pages.sort((a, b) => {\n      const dateA = a.date ? new Date(a.date).getTime() : 0;\n      const dateB = b.date ? new Date(b.date).getTime() : 0;\n      \n      if (dateB !== dateA) return dateB - dateA;\n      \n      // Same date, sort alphabetically by title\n      return (a.title || '').localeCompare(b.title || '');\n    });\n    \n    return limit && limit > 0 ? sorted.slice(0, limit) : sorted;\n  } catch (error) {\n    console.error(\"Error fetching recent pages:\", error);\n    return [];\n  }\n}\n\nexport function getAllPageCategories(): string[] {\n  try {\n    const pages = getAllPagesMeta();\n    const categories = pages\n      .map(page => page.category)\n      .filter((category): category is string => \n        typeof category === \"string\" && category.trim().length > 0\n      );\n    \n    // Remove duplicates and sort alphabetically\n    return [...new Set(categories)].sort();\n  } catch (error) {\n    console.error(\"Error fetching page categories:\", error);\n    return [];\n  }\n}\n\nexport function getAllPageTags(): string[] {\n  try {\n    const pages = getAllPagesMeta();\n    const allTags = pages\n      .flatMap(page => page.tags || [])\n      .filter((tag): tag is string => typeof tag === \"string\");\n    \n    // Remove duplicates and sort alphabetically\n    return [...new Set(allTags)].sort();\n  } catch (error) {\n    console.error(\"Error fetching page tags:\", error);\n    return [];\n  }\n}\n\nexport function getAllPageAuthors(): string[] {\n  try {\n    const pages = getAllPagesMeta();\n    const authors = pages\n      .map(page => page.author)\n      .filter((author): author is string => \n        typeof author === \"string\" && author.trim().length > 0\n      );\n    \n    // Remove duplicates and sort alphabetically\n    return [...new Set(authors)].sort();\n  } catch (error) {\n    console.error(\"Error fetching page authors:\", error);\n    return [];\n  }\n}\n\nexport function getAllPageSlugs(): string[] {\n  try {\n    const pages = getAllPagesMeta();\n    return pages\n      .map(page => page.slug)\n      .filter((slug): slug is string => typeof slug === \"string\" && slug.length > 0);\n  } catch (error) {\n    console.error(\"Error fetching page slugs:\", error);\n    return [];\n  }\n}\n\nexport function getHomePage(): PageWithContent | null {\n  try {\n    // Try common home page slugs\n    const homeSlugs = [\"\", \"/\", \"home\", \"index\", \"welcome\"];\n    \n    for (const slug of homeSlugs) {\n      const page = getPageBySlug(slug);\n      if (page) {\n        return page;\n      }\n    }\n    \n    // Try to find any page marked as home\n    const pages = getAllPagesMeta();\n    const homePage = pages.find(page => \n      page.pageType === \"home\" || \n      page.template === \"home\" ||\n      page.tags?.includes(\"home\")\n    );\n    \n    if (homePage) {\n      return getPageBySlug(homePage.slug);\n    }\n    \n    // Return first published page as fallback\n    const publishedPages = getPublishedPages();\n    if (publishedPages.length > 0) {\n      return getPageBySlug(publishedPages[0].slug);\n    }\n    \n    return null;\n  } catch (error) {\n    console.error(\"Error fetching home page:\", error);\n    return null;\n  }\n}\n\nexport function getPageStats(): {\n  total: number;\n  published: number;\n  drafts: number;\n  featured: number;\n  byCategory: Record<string, number>;\n  byType: Record<string, number>;\n  byYear: Record<string, number>;\n} {\n  try {\n    const pages = getAllPagesMeta();\n    \n    const stats = {\n      total: pages.length,\n      published: pages.filter(p => p.published === true || p.status === \"published\").length,\n      drafts: pages.filter(p => p.draft === true || p.status === \"draft\").length,\n      featured: pages.filter(p => p.featured === true).length,\n      byCategory: {} as Record<string, number>,\n      byType: {} as Record<string, number>,\n      byYear: {} as Record<string, number>,\n    };\n    \n    pages.forEach(page => {\n      // Count by category\n      if (page.category) {\n        stats.byCategory[page.category] = (stats.byCategory[page.category] || 0) + 1;\n      }\n      \n      // Count by type\n      if (page.pageType) {\n        stats.byType[page.pageType] = (stats.byType[page.pageType] || 0) + 1;\n      }\n      \n      // Count by year\n      if (page.date) {\n        const year = new Date(page.date).getFullYear().toString();\n        stats.byYear[year] = (stats.byYear[year] || 0) + 1;\n      }\n    });\n    \n    return stats;\n  } catch (error) {\n    console.error(\"Error fetching page stats:\", error);\n    return {\n      total: 0,\n      published: 0,\n      drafts: 0,\n      featured: 0,\n      byCategory: {},\n      byType: {},\n      byYear: {},\n    };\n  }\n}\n\n// ---------------------------------------------------------------------------\n// DEFAULT EXPORT\n// ---------------------------------------------------------------------------\n\nconst pagesData = {\n  // Core functions\n  getAllPagesMeta,\n  getPageBySlug,\n  getAllPages,\n  \n  // Filter functions\n  getPagesByCategory,\n  getPagesByTag,\n  getFeaturedPages,\n  getPublishedPages,\n  getNavPages,\n  getChildPages,\n  getPagesByType,\n  searchPages,\n  getRecentPages,\n  \n  // Special pages\n  getHomePage,\n  \n  // List functions\n  getAllPageCategories,\n  getAllPageTags,\n  getAllPageAuthors,\n  getAllPageSlugs,\n  \n  // Stats\n  getPageStats,\n  \n  // Utility functions\n  pageToContentMeta,\n  pageToContentEntry,\n};\n\nexport default pagesData;","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\server\\posts-data.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'content' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":183,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":183,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'body' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":183,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":183,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// lib/server/posts-data.ts\n// Posts under content/posts/* - COMPLETE ROBUST VERSION\n\nimport {\n  getMdxCollectionMeta,\n  getMdxDocumentBySlug,\n  type MdxMeta,\n  type MdxDocument,\n} from \"@/lib/server/mdx-collections\";\nimport type { Post, ContentEntry, ContentMeta } from \"@/types/index\";\n\nexport type PostWithContent = Post & {\n  content: string;\n};\n\n// Extended MDX meta with post-specific fields\ntype PostishMdxMeta = MdxMeta & Partial<Post> & {\n  publishDate?: string;\n  releaseDate?: string;\n  [key: string]: any;\n};\n\ntype PostishMdxDocument = MdxDocument & {\n  content: string;\n} & Partial<Post>;\n\n// ---------------------------------------------------------------------------\n// SAFE TYPE CONVERTERS\n// ---------------------------------------------------------------------------\n\nfunction safeString(value: unknown): string | undefined {\n  return typeof value === \"string\" && value.trim().length > 0\n    ? value.trim()\n    : undefined;\n}\n\nfunction safeNumber(value: unknown): number | undefined {\n  if (typeof value === \"number\") return value;\n  if (typeof value === \"string\") {\n    const parsed = parseInt(value, 10);\n    return Number.isNaN(parsed) ? undefined : parsed;\n  }\n  return undefined;\n}\n\nfunction safeBoolean(value: unknown): boolean | undefined {\n  if (typeof value === \"boolean\") return value;\n  if (typeof value === \"string\") {\n    const lower = value.toLowerCase().trim();\n    if (lower === \"true\") return true;\n    if (lower === \"false\") return false;\n    if (lower === \"yes\") return true;\n    if (lower === \"no\") return false;\n    if (lower === \"1\") return true;\n    if (lower === \"0\") return false;\n  }\n  if (typeof value === \"number\") {\n    return value === 1;\n  }\n  return undefined;\n}\n\nfunction safeArray(value: unknown): string[] | undefined {\n  if (!Array.isArray(value)) return undefined;\n  const filtered = value.filter((item) => typeof item === \"string\") as string[];\n  return filtered.length > 0 ? filtered : undefined;\n}\n\nfunction safeStatus(\n  value: unknown\n): \"draft\" | \"published\" | \"scheduled\" | \"archived\" | undefined {\n  if (value === \"draft\" || value === \"published\" || value === \"scheduled\" || value === \"archived\") {\n    return value;\n  }\n  return undefined;\n}\n\nfunction safeAccessLevel(\n  value: unknown\n): \"public\" | \"premium\" | \"private\" | undefined {\n  if (value === \"public\" || value === \"premium\" || value === \"private\") {\n    return value;\n  }\n  return undefined;\n}\n\n// ---------------------------------------------------------------------------\n// MAIN CONVERSION FUNCTIONS\n// ---------------------------------------------------------------------------\n\nfunction fromMdxMeta(meta: MdxMeta): Post {\n  const m = meta as PostishMdxMeta;\n\n  // Handle different date fields\n  const date = safeString(m.date) || safeString(m.publishDate) || safeString(m.releaseDate);\n  \n  // Ensure required fields have defaults\n  const slug = safeString(m.slug) || \"\";\n  const title = safeString(m.title) || \"Untitled Post\";\n  \n  if (!slug || !title) {\n    console.warn(`Post metadata missing slug or title: ${slug} - ${title}`);\n  }\n\n  return {\n    // Core identifiers\n    slug,\n    title,\n\n    // Content fields\n    description: safeString(m.description),\n    excerpt: safeString(m.excerpt),\n    subtitle: safeString(m.subtitle),\n\n    // Metadata\n    date,\n    author: safeString(m.author),\n    category: safeString(m.category),\n    tags: safeArray(m.tags),\n    featured: safeBoolean(m.featured),\n    readTime: safeString(m.readTime) || safeNumber(m.readTime),\n\n    // Visual\n    coverImage: safeString(m.coverImage) || safeString(m.image),\n\n    // Post-specific fields\n    postType: safeString(m.postType) || \"article\",\n    series: safeString(m.series),\n    seriesOrder: safeNumber(m.seriesOrder),\n    updateDate: safeString(m.updateDate),\n    canonicalUrl: safeString(m.canonicalUrl),\n    metaTitle: safeString(m.metaTitle),\n    metaDescription: safeString(m.metaDescription),\n    keywords: safeArray(m.keywords),\n    lastModified: safeString(m.lastModified),\n\n    // State\n    draft: safeBoolean(m.draft),\n    published: safeBoolean(m.published),\n    status: safeStatus(m.status),\n\n    // Access\n    accessLevel: safeAccessLevel(m.accessLevel) || \"public\",\n    lockMessage: safeString(m.lockMessage),\n\n    // System fields\n    _raw: m._raw,\n    _id: safeString(m._id),\n    url: safeString(m.url),\n    type: safeString(m.type) || \"post\",\n\n    // Preserve any additional fields\n    ...Object.fromEntries(\n      Object.entries(m)\n        .filter(([key]) => ![\n          'slug', 'title', 'description', 'excerpt', 'subtitle',\n          'date', 'author', 'category', 'tags', 'featured', 'readTime',\n          'coverImage', 'image', 'postType', 'series', 'seriesOrder',\n          'updateDate', 'canonicalUrl', 'metaTitle', 'metaDescription',\n          'keywords', 'lastModified', 'draft', 'published', 'status',\n          'accessLevel', 'lockMessage', '_raw', '_id', 'url', 'type',\n          'publishDate', 'releaseDate'\n        ].includes(key))\n        .map(([key, value]) => [key, value])\n    ),\n  };\n}\n\nfunction fromMdxDocument(doc: MdxDocument): PostWithContent {\n  const postDoc = doc as PostishMdxDocument;\n  const { content, body, ...rest } = postDoc;\n  const meta = fromMdxMeta(rest);\n  \n  return { \n    ...meta, \n    content: typeof content === \"string\" ? content : \"\",\n    // Safely handle body which might have a specific type\n    body: body || undefined,\n  };\n}\n\nexport function postToContentMeta(post: Post): ContentMeta {\n  const { content, body, ...meta } = post;\n  return meta;\n}\n\nexport function postToContentEntry(post: Post): ContentEntry {\n  return {\n    slug: post.slug,\n    title: post.title,\n    date: post.date,\n    excerpt: post.excerpt,\n    description: post.description,\n    category: post.category,\n    tags: post.tags,\n    featured: post.featured,\n    readTime: post.readTime,\n    _raw: post._raw,\n    ...Object.fromEntries(\n      Object.entries(post)\n        .filter(([key]) => ![\n          'slug', 'title', 'date', 'excerpt', 'description', 'category',\n          'tags', 'featured', 'readTime', '_raw', 'content', 'body'\n        ].includes(key))\n    ),\n  };\n}\n\n// ---------------------------------------------------------------------------\n// PUBLIC API FUNCTIONS\n// ---------------------------------------------------------------------------\n\nexport function getAllPostsMeta(): Post[] {\n  try {\n    const metas = getMdxCollectionMeta(\"posts\");\n    if (!metas || !Array.isArray(metas)) {\n      console.warn(\"No posts metadata found or metadata is not an array\");\n      return [];\n    }\n    \n    const posts = metas.map((m) => fromMdxMeta(m));\n    \n    // Filter out invalid posts (missing required fields)\n    const validPosts = posts.filter(post => {\n      const isValid = post.slug && post.title;\n      if (!isValid) {\n        console.warn(`Invalid post skipped: ${post.slug || 'no-slug'} - ${post.title || 'no-title'}`);\n      }\n      return isValid;\n    });\n    \n    console.log(`Found ${validPosts.length} valid posts out of ${metas.length} total`);\n    return validPosts;\n  } catch (error) {\n    console.error(\"Error fetching all posts meta:\", error);\n    return [];\n  }\n}\n\nexport function getPostBySlug(slug: string): PostWithContent | null {\n  try {\n    if (!slug || typeof slug !== 'string') {\n      console.error(\"getPostBySlug called with invalid slug:\", slug);\n      return null;\n    }\n    \n    const doc = getMdxDocumentBySlug(\"posts\", slug);\n    if (!doc) {\n      console.warn(`No post found for slug: ${slug}`);\n      return null;\n    }\n    \n    return fromMdxDocument(doc);\n  } catch (error) {\n    console.error(`Error fetching post by slug (${slug}):`, error);\n    return null;\n  }\n}\n\nexport function getAllPosts(): PostWithContent[] {\n  try {\n    const metas = getAllPostsMeta();\n    if (metas.length === 0) return [];\n    \n    const postsWithContent: PostWithContent[] = [];\n    \n    for (const meta of metas) {\n      const post = getPostBySlug(meta.slug);\n      if (post) {\n        postsWithContent.push(post);\n      } else {\n        console.warn(`Could not load content for post: ${meta.slug}`);\n      }\n    }\n    \n    return postsWithContent;\n  } catch (error) {\n    console.error(\"Error fetching all posts:\", error);\n    return [];\n  }\n}\n\nexport function getPostsByCategory(category: string): Post[] {\n  try {\n    const posts = getAllPostsMeta();\n    if (!category || typeof category !== 'string') return [];\n    \n    const normalizedCategory = category.toLowerCase().trim();\n    \n    return posts.filter(post => {\n      const postCategory = post.category?.toLowerCase().trim();\n      return postCategory === normalizedCategory;\n    });\n  } catch (error) {\n    console.error(`Error fetching posts by category (${category}):`, error);\n    return [];\n  }\n}\n\nexport function getPostsByTag(tag: string): Post[] {\n  try {\n    const posts = getAllPostsMeta();\n    if (!tag || typeof tag !== 'string') return [];\n    \n    const normalizedTag = tag.toLowerCase().trim();\n    \n    return posts.filter(post => {\n      return post.tags?.some(t => t.toLowerCase().trim() === normalizedTag);\n    });\n  } catch (error) {\n    console.error(`Error fetching posts by tag (${tag}):`, error);\n    return [];\n  }\n}\n\nexport function getFeaturedPosts(): Post[] {\n  try {\n    const posts = getAllPostsMeta();\n    return posts.filter(post => post.featured === true);\n  } catch (error) {\n    console.error(\"Error fetching featured posts:\", error);\n    return [];\n  }\n}\n\nexport function getPublishedPosts(): Post[] {\n  try {\n    const posts = getAllPostsMeta();\n    return posts.filter(post => \n      post.draft !== true && \n      post.status !== \"draft\" && \n      (post.published === true || post.status === \"published\")\n    );\n  } catch (error) {\n    console.error(\"Error fetching published posts:\", error);\n    return [];\n  }\n}\n\nexport function getPostsBySeries(series: string): Post[] {\n  try {\n    const posts = getAllPostsMeta();\n    if (!series || typeof series !== 'string') return [];\n    \n    const normalizedSeries = series.toLowerCase().trim();\n    \n    return posts\n      .filter(post => post.series?.toLowerCase().trim() === normalizedSeries)\n      .sort((a, b) => {\n        // Sort by seriesOrder, then by date\n        const orderA = a.seriesOrder || 999;\n        const orderB = b.seriesOrder || 999;\n        if (orderA !== orderB) return orderA - orderB;\n        \n        const dateA = a.date ? new Date(a.date).getTime() : 0;\n        const dateB = b.date ? new Date(b.date).getTime() : 0;\n        return dateA - dateB;\n      });\n  } catch (error) {\n    console.error(`Error fetching posts by series (${series}):`, error);\n    return [];\n  }\n}\n\nexport function searchPosts(query: string): Post[] {\n  try {\n    const posts = getPublishedPosts();\n    const normalizedQuery = query.toLowerCase().trim();\n    \n    if (!normalizedQuery) return posts;\n    \n    return posts.filter(post => {\n      // Search in title\n      if (post.title?.toLowerCase().includes(normalizedQuery)) return true;\n      \n      // Search in subtitle\n      if (post.subtitle?.toLowerCase().includes(normalizedQuery)) return true;\n      \n      // Search in description\n      if (post.description?.toLowerCase().includes(normalizedQuery)) return true;\n      \n      // Search in excerpt\n      if (post.excerpt?.toLowerCase().includes(normalizedQuery)) return true;\n      \n      // Search in author\n      if (post.author?.toLowerCase().includes(normalizedQuery)) return true;\n      \n      // Search in tags\n      if (post.tags?.some(tag => tag.toLowerCase().includes(normalizedQuery))) return true;\n      \n      // Search in category\n      if (post.category?.toLowerCase().includes(normalizedQuery)) return true;\n      \n      // Search in series\n      if (post.series?.toLowerCase().includes(normalizedQuery)) return true;\n      \n      return false;\n    });\n  } catch (error) {\n    console.error(`Error searching posts (${query}):`, error);\n    return [];\n  }\n}\n\nexport function getRecentPosts(limit?: number): Post[] {\n  try {\n    const posts = getPublishedPosts();\n    \n    // Sort by date (newest first), then by title for same dates\n    const sorted = posts.sort((a, b) => {\n      const dateA = a.date ? new Date(a.date).getTime() : 0;\n      const dateB = b.date ? new Date(b.date).getTime() : 0;\n      \n      if (dateB !== dateA) return dateB - dateA;\n      \n      // Same date, sort alphabetically by title\n      return (a.title || '').localeCompare(b.title || '');\n    });\n    \n    return limit && limit > 0 ? sorted.slice(0, limit) : sorted;\n  } catch (error) {\n    console.error(\"Error fetching recent posts:\", error);\n    return [];\n  }\n}\n\nexport function getAllPostCategories(): string[] {\n  try {\n    const posts = getAllPostsMeta();\n    const categories = posts\n      .map(post => post.category)\n      .filter((category): category is string => \n        typeof category === \"string\" && category.trim().length > 0\n      );\n    \n    // Remove duplicates and sort alphabetically\n    return [...new Set(categories)].sort();\n  } catch (error) {\n    console.error(\"Error fetching post categories:\", error);\n    return [];\n  }\n}\n\nexport function getAllPostTags(): string[] {\n  try {\n    const posts = getAllPostsMeta();\n    const allTags = posts\n      .flatMap(post => post.tags || [])\n      .filter((tag): tag is string => typeof tag === \"string\");\n    \n    // Remove duplicates and sort alphabetically\n    return [...new Set(allTags)].sort();\n  } catch (error) {\n    console.error(\"Error fetching post tags:\", error);\n    return [];\n  }\n}\n\nexport function getAllPostAuthors(): string[] {\n  try {\n    const posts = getAllPostsMeta();\n    const authors = posts\n      .map(post => post.author)\n      .filter((author): author is string => \n        typeof author === \"string\" && author.trim().length > 0\n      );\n    \n    // Remove duplicates and sort alphabetically\n    return [...new Set(authors)].sort();\n  } catch (error) {\n    console.error(\"Error fetching post authors:\", error);\n    return [];\n  }\n}\n\nexport function getAllPostSeries(): string[] {\n  try {\n    const posts = getAllPostsMeta();\n    const series = posts\n      .map(post => post.series)\n      .filter((series): series is string => \n        typeof series === \"string\" && series.trim().length > 0\n      );\n    \n    // Remove duplicates and sort alphabetically\n    return [...new Set(series)].sort();\n  } catch (error) {\n    console.error(\"Error fetching post series:\", error);\n    return [];\n  }\n}\n\nexport function getAllPostSlugs(): string[] {\n  try {\n    const posts = getAllPostsMeta();\n    return posts\n      .map(post => post.slug)\n      .filter((slug): slug is string => typeof slug === \"string\" && slug.length > 0);\n  } catch (error) {\n    console.error(\"Error fetching post slugs:\", error);\n    return [];\n  }\n}\n\nexport function getPostStats(): {\n  total: number;\n  published: number;\n  drafts: number;\n  featured: number;\n  byCategory: Record<string, number>;\n  byYear: Record<string, number>;\n  byAuthor: Record<string, number>;\n} {\n  try {\n    const posts = getAllPostsMeta();\n    \n    const stats = {\n      total: posts.length,\n      published: posts.filter(p => p.published === true || p.status === \"published\").length,\n      drafts: posts.filter(p => p.draft === true || p.status === \"draft\").length,\n      featured: posts.filter(p => p.featured === true).length,\n      byCategory: {} as Record<string, number>,\n      byYear: {} as Record<string, number>,\n      byAuthor: {} as Record<string, number>,\n    };\n    \n    posts.forEach(post => {\n      // Count by category\n      if (post.category) {\n        stats.byCategory[post.category] = (stats.byCategory[post.category] || 0) + 1;\n      }\n      \n      // Count by year\n      if (post.date) {\n        const year = new Date(post.date).getFullYear().toString();\n        stats.byYear[year] = (stats.byYear[year] || 0) + 1;\n      }\n      \n      // Count by author\n      if (post.author) {\n        stats.byAuthor[post.author] = (stats.byAuthor[post.author] || 0) + 1;\n      }\n    });\n    \n    return stats;\n  } catch (error) {\n    console.error(\"Error fetching post stats:\", error);\n    return {\n      total: 0,\n      published: 0,\n      drafts: 0,\n      featured: 0,\n      byCategory: {},\n      byYear: {},\n      byAuthor: {},\n    };\n  }\n}\n\n// ---------------------------------------------------------------------------\n// DEFAULT EXPORT\n// ---------------------------------------------------------------------------\n\nconst postsData = {\n  // Core functions\n  getAllPostsMeta,\n  getPostBySlug,\n  getAllPosts,\n  \n  // Filter functions\n  getPostsByCategory,\n  getPostsByTag,\n  getFeaturedPosts,\n  getPublishedPosts,\n  getPostsBySeries,\n  searchPosts,\n  getRecentPosts,\n  \n  // List functions\n  getAllPostCategories,\n  getAllPostTags,\n  getAllPostAuthors,\n  getAllPostSeries,\n  getAllPostSlugs,\n  \n  // Stats\n  getPostStats,\n  \n  // Utility functions\n  postToContentMeta,\n  postToContentEntry,\n};\n\nexport default postsData;","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\server\\prints-data.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'content' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":229,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":229,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'body' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":229,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":229,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// lib/server/prints-data.ts\n// Prints under content/prints/* - COMPLETE ROBUST VERSION\n\nimport {\n  getMdxCollectionMeta,\n  getMdxDocumentBySlug,\n  type MdxMeta,\n  type MdxDocument,\n} from \"@/lib/server/mdx-collections\";\nimport type { Print, ContentEntry, ContentMeta } from \"@/types/index\";\n\nexport type PrintWithContent = Print & {\n  content: string;\n};\n\n// Extended MDX meta with print-specific fields\ntype PrintishMdxMeta = MdxMeta & Partial<Print> & {\n  publishDate?: string;\n  releaseDate?: string;\n  [key: string]: any;\n};\n\ntype PrintishMdxDocument = MdxDocument & {\n  content: string;\n} & Partial<Print>;\n\n// ---------------------------------------------------------------------------\n// SAFE TYPE CONVERTERS\n// ---------------------------------------------------------------------------\n\nfunction safeString(value: unknown): string | undefined {\n  return typeof value === \"string\" && value.trim().length > 0\n    ? value.trim()\n    : undefined;\n}\n\nfunction safeNumber(value: unknown): number | undefined {\n  if (typeof value === \"number\") return value;\n  if (typeof value === \"string\") {\n    const parsed = parseInt(value, 10);\n    return Number.isNaN(parsed) ? undefined : parsed;\n  }\n  return undefined;\n}\n\nfunction safeBoolean(value: unknown): boolean | undefined {\n  if (typeof value === \"boolean\") return value;\n  if (typeof value === \"string\") {\n    const lower = value.toLowerCase().trim();\n    if (lower === \"true\") return true;\n    if (lower === \"false\") return false;\n    if (lower === \"yes\") return true;\n    if (lower === \"no\") return false;\n    if (lower === \"1\") return true;\n    if (lower === \"0\") return false;\n  }\n  if (typeof value === \"number\") {\n    return value === 1;\n  }\n  return undefined;\n}\n\nfunction safeArray(value: unknown): string[] | undefined {\n  if (!Array.isArray(value)) return undefined;\n  const filtered = value.filter((item) => typeof item === \"string\") as string[];\n  return filtered.length > 0 ? filtered : undefined;\n}\n\nfunction safeStatus(\n  value: unknown\n): \"draft\" | \"published\" | \"scheduled\" | \"archived\" | undefined {\n  if (value === \"draft\" || value === \"published\" || value === \"scheduled\" || value === \"archived\") {\n    return value;\n  }\n  return undefined;\n}\n\nfunction safeAccessLevel(\n  value: unknown\n): \"public\" | \"premium\" | \"private\" | undefined {\n  if (value === \"public\" || value === \"premium\" || value === \"private\") {\n    return value;\n  }\n  return undefined;\n}\n\n/**\n * Safely convert print type field\n */\nfunction safePrintType(\n  value: unknown\n): \"digital\" | \"physical\" | \"limited\" | \"open\" | undefined {\n  if (typeof value === \"string\") {\n    const lowerValue = value.toLowerCase().trim();\n    if (lowerValue === \"digital\") return \"digital\";\n    if (lowerValue === \"physical\") return \"physical\";\n    if (lowerValue === \"limited\") return \"limited\";\n    if (lowerValue === \"open\") return \"open\";\n  }\n  return undefined;\n}\n\n/**\n * Safely convert print status field\n */\nfunction safePrintStatus(\n  value: unknown\n): \"available\" | \"sold-out\" | \"coming-soon\" | \"discontinued\" | undefined {\n  if (typeof value === \"string\") {\n    const lowerValue = value.toLowerCase().trim();\n    if (lowerValue === \"available\") return \"available\";\n    if (lowerValue === \"sold-out\") return \"sold-out\";\n    if (lowerValue === \"coming-soon\") return \"coming-soon\";\n    if (lowerValue === \"discontinued\") return \"discontinued\";\n  }\n  return undefined;\n}\n\n// ---------------------------------------------------------------------------\n// MAIN CONVERSION FUNCTIONS\n// ---------------------------------------------------------------------------\n\nfunction fromMdxMeta(meta: MdxMeta): Print {\n  const m = meta as PrintishMdxMeta;\n\n  // Handle different date fields\n  const date = safeString(m.date) || safeString(m.publishDate) || safeString(m.releaseDate);\n  \n  // Ensure required fields have defaults\n  const slug = safeString(m.slug) || \"\";\n  const title = safeString(m.title) || \"Untitled Print\";\n  \n  if (!slug || !title) {\n    console.warn(`Print metadata missing slug or title: ${slug} - ${title}`);\n  }\n\n  return {\n    // Core identifiers\n    slug,\n    title,\n\n    // Content fields\n    description: safeString(m.description),\n    excerpt: safeString(m.excerpt),\n    subtitle: safeString(m.subtitle),\n\n    // Metadata\n    date,\n    author: safeString(m.author),\n    category: safeString(m.category),\n    tags: safeArray(m.tags),\n    featured: safeBoolean(m.featured),\n    readTime: safeString(m.readTime) || safeNumber(m.readTime),\n\n    // Visual\n    coverImage: safeString(m.coverImage) || safeString(m.image),\n\n    // Print-specific fields\n    printType: safePrintType(m.printType) || \"digital\",\n    printStatus: safePrintStatus(m.printStatus) || \"available\",\n    price: safeNumber(m.price),\n    originalPrice: safeNumber(m.originalPrice),\n    currency: safeString(m.currency) || \"USD\",\n    dimensions: safeString(m.dimensions),\n    paperType: safeString(m.paperType),\n    printSize: safeString(m.printSize),\n    editionSize: safeNumber(m.editionSize),\n    editionNumber: safeNumber(m.editionNumber),\n    signature: safeBoolean(m.signature),\n    numbered: safeBoolean(m.numbered),\n    certificate: safeBoolean(m.certificate),\n    frameIncluded: safeBoolean(m.frameIncluded),\n    inStock: safeBoolean(m.inStock) || true, // Default to true\n    stockQuantity: safeNumber(m.stockQuantity),\n    purchaseUrl: safeString(m.purchaseUrl),\n    maxPurchaseQuantity: safeNumber(m.maxPurchaseQuantity),\n    sale: safeBoolean(m.sale),\n    saleEndDate: safeString(m.saleEndDate),\n    lastModified: safeString(m.lastModified),\n\n    // State\n    draft: safeBoolean(m.draft),\n    published: safeBoolean(m.published),\n    status: safeStatus(m.status),\n\n    // Access\n    accessLevel: safeAccessLevel(m.accessLevel) || \"public\",\n    lockMessage: safeString(m.lockMessage),\n\n    // System fields\n    _raw: m._raw,\n    _id: safeString(m._id),\n    url: safeString(m.url),\n    type: safeString(m.type) || \"print\",\n\n    // Preserve any additional fields\n    ...Object.fromEntries(\n      Object.entries(m)\n        .filter(([key]) => ![\n          'slug', 'title', 'description', 'excerpt', 'subtitle',\n          'date', 'author', 'category', 'tags', 'featured', 'readTime',\n          'coverImage', 'image', 'printType', 'printStatus', 'price',\n          'originalPrice', 'currency', 'dimensions', 'paperType',\n          'printSize', 'editionSize', 'editionNumber', 'signature',\n          'numbered', 'certificate', 'frameIncluded', 'inStock',\n          'stockQuantity', 'purchaseUrl', 'maxPurchaseQuantity', 'sale',\n          'saleEndDate', 'lastModified', 'draft', 'published', 'status',\n          'accessLevel', 'lockMessage', '_raw', '_id', 'url', 'type',\n          'publishDate', 'releaseDate'\n        ].includes(key))\n        .map(([key, value]) => [key, value])\n    ),\n  };\n}\n\nfunction fromMdxDocument(doc: MdxDocument): PrintWithContent {\n  const printDoc = doc as PrintishMdxDocument;\n  const { content, body, ...rest } = printDoc;\n  const meta = fromMdxMeta(rest);\n  \n  return { \n    ...meta, \n    content: typeof content === \"string\" ? content : \"\",\n    body: body || undefined,\n  };\n}\n\nexport function printToContentMeta(print: Print): ContentMeta {\n  const { content, body, ...meta } = print;\n  return meta;\n}\n\nexport function printToContentEntry(print: Print): ContentEntry {\n  return {\n    slug: print.slug,\n    title: print.title,\n    date: print.date,\n    excerpt: print.excerpt,\n    description: print.description,\n    category: print.category,\n    tags: print.tags,\n    featured: print.featured,\n    readTime: print.readTime,\n    _raw: print._raw,\n    ...Object.fromEntries(\n      Object.entries(print)\n        .filter(([key]) => ![\n          'slug', 'title', 'date', 'excerpt', 'description', 'category',\n          'tags', 'featured', 'readTime', '_raw', 'content', 'body'\n        ].includes(key))\n    ),\n  };\n}\n\n// ---------------------------------------------------------------------------\n// PUBLIC API FUNCTIONS\n// ---------------------------------------------------------------------------\n\nexport function getAllPrintsMeta(): Print[] {\n  try {\n    const metas = getMdxCollectionMeta(\"prints\");\n    if (!metas || !Array.isArray(metas)) {\n      console.warn(\"No prints metadata found or metadata is not an array\");\n      return [];\n    }\n    \n    const prints = metas.map((m) => fromMdxMeta(m));\n    \n    // Filter out invalid prints (missing required fields)\n    const validPrints = prints.filter(print => {\n      const isValid = print.slug && print.title;\n      if (!isValid) {\n        console.warn(`Invalid print skipped: ${print.slug || 'no-slug'} - ${print.title || 'no-title'}`);\n      }\n      return isValid;\n    });\n    \n    console.log(`Found ${validPrints.length} valid prints out of ${metas.length} total`);\n    return validPrints;\n  } catch (error) {\n    console.error(\"Error fetching all prints meta:\", error);\n    return [];\n  }\n}\n\nexport function getPrintBySlug(slug: string): PrintWithContent | null {\n  try {\n    if (!slug || typeof slug !== 'string') {\n      console.error(\"getPrintBySlug called with invalid slug:\", slug);\n      return null;\n    }\n    \n    const doc = getMdxDocumentBySlug(\"prints\", slug);\n    if (!doc) {\n      console.warn(`No print found for slug: ${slug}`);\n      return null;\n    }\n    \n    return fromMdxDocument(doc);\n  } catch (error) {\n    console.error(`Error fetching print by slug (${slug}):`, error);\n    return null;\n  }\n}\n\nexport function getAllPrints(): PrintWithContent[] {\n  try {\n    const metas = getAllPrintsMeta();\n    if (metas.length === 0) return [];\n    \n    const printsWithContent: PrintWithContent[] = [];\n    \n    for (const meta of metas) {\n      const print = getPrintBySlug(meta.slug);\n      if (print) {\n        printsWithContent.push(print);\n      } else {\n        console.warn(`Could not load content for print: ${meta.slug}`);\n      }\n    }\n    \n    return printsWithContent;\n  } catch (error) {\n    console.error(\"Error fetching all prints:\", error);\n    return [];\n  }\n}\n\nexport function getPrintsByCategory(category: string): Print[] {\n  try {\n    const prints = getAllPrintsMeta();\n    if (!category || typeof category !== 'string') return [];\n    \n    const normalizedCategory = category.toLowerCase().trim();\n    \n    return prints.filter(print => {\n      const printCategory = print.category?.toLowerCase().trim();\n      return printCategory === normalizedCategory;\n    });\n  } catch (error) {\n    console.error(`Error fetching prints by category (${category}):`, error);\n    return [];\n  }\n}\n\nexport function getPrintsByTag(tag: string): Print[] {\n  try {\n    const prints = getAllPrintsMeta();\n    if (!tag || typeof tag !== 'string') return [];\n    \n    const normalizedTag = tag.toLowerCase().trim();\n    \n    return prints.filter(print => {\n      return print.tags?.some(t => t.toLowerCase().trim() === normalizedTag);\n    });\n  } catch (error) {\n    console.error(`Error fetching prints by tag (${tag}):`, error);\n    return [];\n  }\n}\n\nexport function getFeaturedPrints(): Print[] {\n  try {\n    const prints = getAllPrintsMeta();\n    return prints.filter(print => print.featured === true);\n  } catch (error) {\n    console.error(\"Error fetching featured prints:\", error);\n    return [];\n  }\n}\n\nexport function getPublishedPrints(): Print[] {\n  try {\n    const prints = getAllPrintsMeta();\n    return prints.filter(print => \n      print.draft !== true && \n      print.status !== \"draft\" && \n      (print.published === true || print.status === \"published\")\n    );\n  } catch (error) {\n    console.error(\"Error fetching published prints:\", error);\n    return [];\n  }\n}\n\nexport function getAvailablePrints(): Print[] {\n  try {\n    return getAllPrintsMeta()\n      .filter(p => \n        !p.draft && \n        (p.inStock === true || (p.stockQuantity !== undefined && p.stockQuantity > 0))\n      );\n  } catch (error) {\n    console.error(\"[prints-data] Error getting available prints:\", error);\n    return [];\n  }\n}\n\nexport function getPrintsByType(printType: string): Print[] {\n  try {\n    const prints = getAllPrintsMeta();\n    if (!printType || typeof printType !== 'string') return [];\n    \n    const normalizedType = printType.toLowerCase().trim();\n    \n    return prints.filter(print => \n      print.printType?.toLowerCase().trim() === normalizedType\n    );\n  } catch (error) {\n    console.error(`Error fetching prints by type (${printType}):`, error);\n    return [];\n  }\n}\n\nexport function getPrintsByStatus(status: string): Print[] {\n  try {\n    const prints = getAllPrintsMeta();\n    if (!status || typeof status !== 'string') return [];\n    \n    const normalizedStatus = status.toLowerCase().trim();\n    \n    return prints.filter(print => \n      print.printStatus?.toLowerCase().trim() === normalizedStatus\n    );\n  } catch (error) {\n    console.error(`Error fetching prints by status (${status}):`, error);\n    return [];\n  }\n}\n\nexport function getPrintsOnSale(): Print[] {\n  try {\n    const prints = getAvailablePrints();\n    return prints.filter(print => print.sale === true);\n  } catch (error) {\n    console.error(\"Error fetching prints on sale:\", error);\n    return [];\n  }\n}\n\nexport function searchPrints(query: string): Print[] {\n  try {\n    const prints = getAvailablePrints();\n    const normalizedQuery = query.toLowerCase().trim();\n    \n    if (!normalizedQuery) return prints;\n    \n    return prints.filter(print => {\n      // Search in title\n      if (print.title?.toLowerCase().includes(normalizedQuery)) return true;\n      \n      // Search in subtitle\n      if (print.subtitle?.toLowerCase().includes(normalizedQuery)) return true;\n      \n      // Search in description\n      if (print.description?.toLowerCase().includes(normalizedQuery)) return true;\n      \n      // Search in excerpt\n      if (print.excerpt?.toLowerCase().includes(normalizedQuery)) return true;\n      \n      // Search in author\n      if (print.author?.toLowerCase().includes(normalizedQuery)) return true;\n      \n      // Search in tags\n      if (print.tags?.some(tag => tag.toLowerCase().includes(normalizedQuery))) return true;\n      \n      // Search in category\n      if (print.category?.toLowerCase().includes(normalizedQuery)) return true;\n      \n      // Search in paper type\n      if (print.paperType?.toLowerCase().includes(normalizedQuery)) return true;\n      \n      // Search in dimensions\n      if (print.dimensions?.toLowerCase().includes(normalizedQuery)) return true;\n      \n      return false;\n    });\n  } catch (error) {\n    console.error(`Error searching prints (${query}):`, error);\n    return [];\n  }\n}\n\nexport function getRecentPrints(limit?: number): Print[] {\n  try {\n    const prints = getAvailablePrints();\n    \n    // Sort by date (newest first), then by title for same dates\n    const sorted = prints.sort((a, b) => {\n      const dateA = a.date ? new Date(a.date).getTime() : 0;\n      const dateB = b.date ? new Date(b.date).getTime() : 0;\n      \n      if (dateB !== dateA) return dateB - dateA;\n      \n      // Same date, sort alphabetically by title\n      return (a.title || '').localeCompare(b.title || '');\n    });\n    \n    return limit && limit > 0 ? sorted.slice(0, limit) : sorted;\n  } catch (error) {\n    console.error(\"Error fetching recent prints:\", error);\n    return [];\n  }\n}\n\nexport function getLimitedEditionPrints(): Print[] {\n  try {\n    const prints = getAvailablePrints();\n    return prints.filter(print => \n      print.printType === \"limited\" || \n      print.editionSize !== undefined\n    );\n  } catch (error) {\n    console.error(\"Error fetching limited edition prints:\", error);\n    return [];\n  }\n}\n\nexport function getDigitalPrints(): Print[] {\n  try {\n    const prints = getAvailablePrints();\n    return prints.filter(print => print.printType === \"digital\");\n  } catch (error) {\n    console.error(\"Error fetching digital prints:\", error);\n    return [];\n  }\n}\n\nexport function getPhysicalPrints(): Print[] {\n  try {\n    const prints = getAvailablePrints();\n    return prints.filter(print => print.printType === \"physical\");\n  } catch (error) {\n    console.error(\"Error fetching physical prints:\", error);\n    return [];\n  }\n}\n\nexport function getAllPrintCategories(): string[] {\n  try {\n    const prints = getAllPrintsMeta();\n    const categories = prints\n      .map(print => print.category)\n      .filter((category): category is string => \n        typeof category === \"string\" && category.trim().length > 0\n      );\n    \n    // Remove duplicates and sort alphabetically\n    return [...new Set(categories)].sort();\n  } catch (error) {\n    console.error(\"Error fetching print categories:\", error);\n    return [];\n  }\n}\n\nexport function getAllPrintTags(): string[] {\n  try {\n    const prints = getAllPrintsMeta();\n    const allTags = prints\n      .flatMap(print => print.tags || [])\n      .filter((tag): tag is string => typeof tag === \"string\");\n    \n    // Remove duplicates and sort alphabetically\n    return [...new Set(allTags)].sort();\n  } catch (error) {\n    console.error(\"Error fetching print tags:\", error);\n    return [];\n  }\n}\n\nexport function getAllPrintAuthors(): string[] {\n  try {\n    const prints = getAllPrintsMeta();\n    const authors = prints\n      .map(print => print.author)\n      .filter((author): author is string => \n        typeof author === \"string\" && author.trim().length > 0\n      );\n    \n    // Remove duplicates and sort alphabetically\n    return [...new Set(authors)].sort();\n  } catch (error) {\n    console.error(\"Error fetching print authors:\", error);\n    return [];\n  }\n}\n\nexport function getAllPrintSlugs(): string[] {\n  try {\n    const prints = getAllPrintsMeta();\n    return prints\n      .map(print => print.slug)\n      .filter((slug): slug is string => typeof slug === \"string\" && slug.length > 0);\n  } catch (error) {\n    console.error(\"Error fetching print slugs:\", error);\n    return [];\n  }\n}\n\nexport function getPrintStats(): {\n  total: number;\n  published: number;\n  drafts: number;\n  featured: number;\n  available: number;\n  digital: number;\n  physical: number;\n  limited: number;\n  onSale: number;\n  byCategory: Record<string, number>;\n  byYear: Record<string, number>;\n} {\n  try {\n    const prints = getAllPrintsMeta();\n    const availablePrints = getAvailablePrints();\n    \n    const stats = {\n      total: prints.length,\n      published: prints.filter(p => p.published === true || p.status === \"published\").length,\n      drafts: prints.filter(p => p.draft === true || p.status === \"draft\").length,\n      featured: prints.filter(p => p.featured === true).length,\n      available: availablePrints.length,\n      digital: availablePrints.filter(p => p.printType === \"digital\").length,\n      physical: availablePrints.filter(p => p.printType === \"physical\").length,\n      limited: availablePrints.filter(p => p.printType === \"limited\").length,\n      onSale: availablePrints.filter(p => p.sale === true).length,\n      byCategory: {} as Record<string, number>,\n      byYear: {} as Record<string, number>,\n    };\n    \n    prints.forEach(print => {\n      // Count by category\n      if (print.category) {\n        stats.byCategory[print.category] = (stats.byCategory[print.category] || 0) + 1;\n      }\n      \n      // Count by year\n      if (print.date) {\n        const year = new Date(print.date).getFullYear().toString();\n        stats.byYear[year] = (stats.byYear[year] || 0) + 1;\n      }\n    });\n    \n    return stats;\n  } catch (error) {\n    console.error(\"Error fetching print stats:\", error);\n    return {\n      total: 0,\n      published: 0,\n      drafts: 0,\n      featured: 0,\n      available: 0,\n      digital: 0,\n      physical: 0,\n      limited: 0,\n      onSale: 0,\n      byCategory: {},\n      byYear: {},\n    };\n  }\n}\n\n// ---------------------------------------------------------------------------\n// DEFAULT EXPORT\n// ---------------------------------------------------------------------------\n\nconst printsData = {\n  // Core functions\n  getAllPrintsMeta,\n  getPrintBySlug,\n  getAllPrints,\n  \n  // Filter functions\n  getPrintsByCategory,\n  getPrintsByTag,\n  getFeaturedPrints,\n  getPublishedPrints,\n  getAvailablePrints,\n  getPrintsByType,\n  getPrintsByStatus,\n  getPrintsOnSale,\n  searchPrints,\n  getRecentPrints,\n  getLimitedEditionPrints,\n  getDigitalPrints,\n  getPhysicalPrints,\n  \n  // List functions\n  getAllPrintCategories,\n  getAllPrintTags,\n  getAllPrintAuthors,\n  getAllPrintSlugs,\n  \n  // Stats\n  getPrintStats,\n  \n  // Utility functions\n  printToContentMeta,\n  printToContentEntry,\n};\n\nexport default printsData;","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\server\\query.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\server\\rate-limit.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\server\\rateLimit.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\server\\rateLimit.ts","messages":[{"ruleId":"import/no-anonymous-default-export","severity":1,"message":"Assign object to a variable before exporting as module default","line":540,"column":1,"nodeType":"ExportDefaultDeclaration","endLine":552,"endColumn":3}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// lib/server/rateLimit.ts\n// =========================================================================\n// Advanced Rate Limiting - In-Memory & Redis Support (Hardened)\n// + Backward-compatible wrappers for older imports (isRateLimited / rateLimit config style)\n// =========================================================================\n\nimport type { NextApiRequest } from \"next\";\nimport crypto from \"crypto\";\n\n// -------------------------------------------------------------------------\n// Types\n// -------------------------------------------------------------------------\n\nexport interface RateLimitOptions {\n  limit: number;\n  windowMs: number;\n  keyPrefix?: string;\n  useRedis?: boolean;\n  redisClient?: BasicRedisClient | null;\n}\n\nexport interface RateLimitEntry {\n  count: number;\n  first: number;\n  resetTime: number;\n}\n\nexport interface RateLimitResult {\n  allowed: boolean;\n  remaining: number;\n  retryAfterMs: number;\n  resetTime: number;\n  limit: number;\n  windowMs: number;\n}\n\nexport interface CombinedRateLimitResult {\n  ipResult: RateLimitResult;\n  emailResult: RateLimitResult | null;\n  ip: string;\n  email: string | null;\n  allowed: boolean;\n  hitIpLimit: boolean;\n  hitEmailLimit: boolean;\n}\n\n// Minimal Redis interfaces (vendor-neutral & no `any`)\nexport interface BasicRedisMulti {\n  incr(key: string): BasicRedisMulti;\n  expire(key: string, seconds: number): BasicRedisMulti;\n  get(key: string): BasicRedisMulti;\n  exec(): Promise<unknown>;\n}\n\nexport interface BasicRedisClient {\n  multi(): BasicRedisMulti;\n}\n\n// -------------------------------------------------------------------------\n// Privacy-conscious logging\n// -------------------------------------------------------------------------\n\nfunction logRateLimitAction(\n  action: string,\n  metadata: Record<string, unknown> = {}\n): void {\n  // In production, avoid logging identifiable inputs (IPs/emails).\n  // Leave logging enabled for security observability; keep it privacy-safe.\n  // eslint-disable-next-line no-console\n  console.log(`ðŸ›¡ï¸ Rate Limit: ${action}`, {\n    timestamp: new Date().toISOString(),\n    ...metadata,\n  });\n}\n\n// -------------------------------------------------------------------------\n// In-memory store with automatic cleanup\n// -------------------------------------------------------------------------\n\nclass RateLimitStore {\n  private store = new Map<string, RateLimitEntry>();\n  private cleanupInterval: ReturnType<typeof setInterval> | null = null;\n\n  constructor() {\n    if (typeof setInterval !== \"undefined\") {\n      this.cleanupInterval = setInterval(() => this.cleanup(), 60 * 60 * 1000); // hourly\n    }\n  }\n\n  get(key: string): RateLimitEntry | undefined {\n    return this.store.get(key);\n  }\n\n  set(key: string, entry: RateLimitEntry): void {\n    this.store.set(key, entry);\n  }\n\n  delete(key: string): void {\n    this.store.delete(key);\n  }\n\n  private cleanup(): void {\n    const now = Date.now();\n    let cleaned = 0;\n\n    for (const [key, entry] of this.store.entries()) {\n      if (now > entry.resetTime) {\n        this.store.delete(key);\n        cleaned++;\n      }\n    }\n\n    if (cleaned > 0) logRateLimitAction(\"store_cleanup\", { cleanedEntries: cleaned });\n  }\n\n  destroy(): void {\n    if (this.cleanupInterval) {\n      clearInterval(this.cleanupInterval);\n      this.cleanupInterval = null;\n    }\n    this.store.clear();\n    logRateLimitAction(\"store_destroyed\");\n  }\n}\n\n// -------------------------------------------------------------------------\n// Redis-based rate limiting (optional, async)\n// -------------------------------------------------------------------------\n\nclass RedisRateLimit {\n  constructor(private redisClient: BasicRedisClient) {}\n\n  async check(key: string, limit: number, windowMs: number): Promise<RateLimitResult> {\n    const now = Date.now();\n    const resetTime = now + windowMs;\n    const keyWithPrefix = `rate_limit:${key}`;\n\n    try {\n      const ttlSeconds = Math.ceil(windowMs / 1000);\n\n      const multi = this.redisClient.multi();\n      multi.incr(keyWithPrefix);\n      multi.expire(keyWithPrefix, ttlSeconds);\n      multi.get(keyWithPrefix);\n\n      const rawResult = await multi.exec();\n\n      // Expect something like: [ [err, incrCount], [err, \"OK\"], [err, \"currentCount\"] ]\n      let count = 1;\n\n      if (Array.isArray(rawResult)) {\n        // Try 3rd item first, then fall back to last.\n        const pick = (idx: number) => rawResult[idx] as unknown;\n        const decode = (v: unknown) => {\n          if (Array.isArray(v) && v.length >= 2) {\n            const value = v[1] as unknown;\n            const num = Number(value);\n            if (!Number.isNaN(num) && num > 0) return num;\n          }\n          return null;\n        };\n\n        const third = decode(pick(2));\n        if (third !== null) count = third;\n        else {\n          const last = decode(rawResult[rawResult.length - 1] as unknown);\n          if (last !== null) count = last;\n        }\n      }\n\n      const remaining = Math.max(0, limit - count);\n      const elapsed = now - (resetTime - windowMs);\n\n      return {\n        allowed: count <= limit,\n        remaining,\n        retryAfterMs: count > limit ? Math.max(0, windowMs - elapsed) : 0,\n        resetTime,\n        limit,\n        windowMs,\n      };\n    } catch (error) {\n      // Fail open but log â€“ do NOT block legitimate traffic because Redis died\n      logRateLimitAction(\"redis_error\", {\n        error: error instanceof Error ? error.message : \"Unknown error\",\n      });\n\n      return {\n        allowed: true,\n        remaining: Math.max(0, limit - 1),\n        retryAfterMs: 0,\n        resetTime,\n        limit,\n        windowMs,\n      };\n    }\n  }\n}\n\n// -------------------------------------------------------------------------\n// Global memory store instance + clean shutdown\n// -------------------------------------------------------------------------\n\nconst memoryStore = new RateLimitStore();\n\nif (typeof process !== \"undefined\" && typeof process.on === \"function\") {\n  process.on(\"SIGTERM\", () => memoryStore.destroy());\n  process.on(\"SIGINT\", () => memoryStore.destroy());\n}\n\n// -------------------------------------------------------------------------\n// Core limiter (sync)\n// -------------------------------------------------------------------------\n\nfunction assertValidKey(key: string): void {\n  if (!key || typeof key !== \"string\") {\n    throw new Error(\"Rate limit key must be a non-empty string\");\n  }\n}\n\nfunction assertValidOptions(options: RateLimitOptions): void {\n  if (!options || typeof options !== \"object\") {\n    throw new Error(\"Rate limit options are required\");\n  }\n  if (options.limit < 1 || options.windowMs < 1000) {\n    throw new Error(\"Invalid rate limit parameters\");\n  }\n}\n\n/**\n * SYNC limiter.\n * NOTE: If useRedis=true, we log a warning and still run in-memory (sync cannot await Redis safely).\n */\nexport function rateLimit(key: string, options: RateLimitOptions): RateLimitResult;\nexport function rateLimit(config: RateLimitOptions): RateLimitOptions;\n/**\n * Backward-compatible overload:\n * - rateLimit(key, options) => RateLimitResult\n * - rateLimit(options) => returns options (factory-style)\n */\nexport function rateLimit(arg1: string | RateLimitOptions, arg2?: RateLimitOptions) {\n  if (typeof arg1 !== \"string\") {\n    // factory-style (older code sometimes does: const cfg = rateLimit({limit,...}))\n    assertValidOptions(arg1);\n    return arg1;\n  }\n\n  const key = arg1;\n  const options = arg2 as RateLimitOptions;\n  assertValidKey(key);\n  assertValidOptions(options);\n\n  const { limit, windowMs, keyPrefix = \"rl\", useRedis = false, redisClient } = options;\n\n  const now = Date.now();\n  const storeKey = `${keyPrefix}:${key}`;\n  const resetTime = now + windowMs;\n\n  if (useRedis && redisClient) {\n    logRateLimitAction(\"sync_redis_warning\", { keyPrefix });\n  }\n\n  const entry = memoryStore.get(storeKey);\n\n  if (!entry) {\n    const newEntry: RateLimitEntry = { count: 1, first: now, resetTime };\n    memoryStore.set(storeKey, newEntry);\n\n    return {\n      allowed: true,\n      remaining: limit - 1,\n      retryAfterMs: 0,\n      resetTime,\n      limit,\n      windowMs,\n    };\n  }\n\n  const elapsed = now - entry.first;\n\n  if (elapsed > windowMs) {\n    const newEntry: RateLimitEntry = { count: 1, first: now, resetTime };\n    memoryStore.set(storeKey, newEntry);\n\n    return {\n      allowed: true,\n      remaining: limit - 1,\n      retryAfterMs: 0,\n      resetTime,\n      limit,\n      windowMs,\n    };\n  }\n\n  if (entry.count >= limit) {\n    logRateLimitAction(\"rate_limit_hit\", { key: storeKey, count: entry.count, limit, windowMs });\n\n    return {\n      allowed: false,\n      remaining: 0,\n      retryAfterMs: Math.max(0, windowMs - elapsed),\n      resetTime: entry.resetTime,\n      limit,\n      windowMs,\n    };\n  }\n\n  entry.count += 1;\n  memoryStore.set(storeKey, entry);\n\n  return {\n    allowed: true,\n    remaining: Math.max(0, limit - entry.count),\n    retryAfterMs: 0,\n    resetTime: entry.resetTime,\n    limit,\n    windowMs,\n  };\n}\n\n// -------------------------------------------------------------------------\n// Async variant â€“ proper Redis support\n// -------------------------------------------------------------------------\n\nexport async function rateLimitAsync(key: string, options: RateLimitOptions): Promise<RateLimitResult> {\n  assertValidKey(key);\n  assertValidOptions(options);\n\n  const { useRedis = false, redisClient, limit, windowMs, keyPrefix = \"rl\" } = options;\n\n  if (useRedis && redisClient) {\n    const redisLimiter = new RedisRateLimit(redisClient);\n    return redisLimiter.check(`${keyPrefix}:${key}`, limit, windowMs);\n  }\n\n  return rateLimit(key, options) as RateLimitResult;\n}\n\n// -------------------------------------------------------------------------\n// Headers helper\n// -------------------------------------------------------------------------\n\nexport function createRateLimitHeaders(result: RateLimitResult): Record<string, string> {\n  const headers: Record<string, string> = {\n    \"X-RateLimit-Limit\": result.limit.toString(),\n    \"X-RateLimit-Remaining\": result.remaining.toString(),\n    \"X-RateLimit-Reset\": Math.ceil(result.resetTime / 1000).toString(),\n  };\n\n  if (result.retryAfterMs > 0) {\n    headers[\"Retry-After\"] = Math.ceil(result.retryAfterMs / 1000).toString();\n  }\n\n  return headers;\n}\n\n// -------------------------------------------------------------------------\n// IP extraction helper (Netlify / proxies / Node)\n// -------------------------------------------------------------------------\n\nexport function getClientIp(req: NextApiRequest): string {\n  const forwarded = req.headers[\"x-forwarded-for\"];\n  if (typeof forwarded === \"string\" && forwarded.length > 0) {\n    const parts = forwarded.split(\",\").map((p) => p.trim());\n    if (parts[0]) return parts[0];\n  }\n\n  const netlifyIpHeader = req.headers[\"x-nf-client-connection-ip\"];\n  if (typeof netlifyIpHeader === \"string\" && netlifyIpHeader.length > 0) {\n    return netlifyIpHeader;\n  }\n\n  const socketAddr =\n    typeof req.socket?.remoteAddress === \"string\" ? req.socket.remoteAddress : \"unknown\";\n\n  return socketAddr;\n}\n\n// -------------------------------------------------------------------------\n// Email-based rate limiting helper\n// -------------------------------------------------------------------------\n\nexport function rateLimitForEmail(\n  email: string,\n  label: string,\n  options: RateLimitOptions\n): { result: RateLimitResult; email: string } {\n  const normalizedEmail = email.toLowerCase().trim();\n  const emailHash = crypto.createHash(\"sha256\").update(normalizedEmail).digest(\"hex\");\n  const key = `${label}:${emailHash}`;\n  const result = rateLimit(key, options) as RateLimitResult;\n\n  logRateLimitAction(\"email_rate_limit_check\", {\n    label,\n    allowed: result.allowed,\n    remaining: result.remaining,\n  });\n\n  return { result, email: normalizedEmail };\n}\n\nexport function rateLimitForRequestIp(\n  req: NextApiRequest,\n  label: string,\n  options: RateLimitOptions\n): { result: RateLimitResult; ip: string } {\n  const ip = getClientIp(req);\n\n  const anonymizedIp = ip.includes(\":\")\n    ? ip.split(\":\").slice(0, 3).join(\":\") + \"::\"\n    : ip.split(\".\").slice(0, 3).join(\".\") + \".0\";\n\n  const key = `${label}:${anonymizedIp}`;\n  const result = rateLimit(key, options) as RateLimitResult;\n\n  logRateLimitAction(\"ip_rate_limit_check\", {\n    label,\n    allowed: result.allowed,\n    remaining: result.remaining,\n  });\n\n  return { result, ip };\n}\n\nexport function combinedRateLimit(\n  req: NextApiRequest,\n  email: string | null,\n  label: string,\n  ipOptions: RateLimitOptions,\n  emailOptions?: RateLimitOptions\n): CombinedRateLimitResult {\n  const { result: ipResult, ip } = rateLimitForRequestIp(req, label, ipOptions);\n\n  let emailResult: RateLimitResult | null = null;\n  let normalizedEmail: string | null = null;\n\n  if (email && emailOptions) {\n    const emailLimit = rateLimitForEmail(email, `${label}-email`, emailOptions);\n    emailResult = emailLimit.result;\n    normalizedEmail = emailLimit.email;\n  }\n\n  const hitIpLimit = !ipResult.allowed;\n  const hitEmailLimit = emailResult ? !emailResult.allowed : false;\n  const allowed = ipResult.allowed && (!emailResult || emailResult.allowed);\n\n  if (!allowed) {\n    logRateLimitAction(\"combined_rate_limit_hit\", {\n      label,\n      hitIpLimit,\n      hitEmailLimit,\n      ipRemaining: ipResult.remaining,\n      emailRemaining: emailResult?.remaining,\n    });\n  }\n\n  return {\n    ipResult,\n    emailResult,\n    ip,\n    email: normalizedEmail,\n    allowed,\n    hitIpLimit,\n    hitEmailLimit,\n  };\n}\n\n// -------------------------------------------------------------------------\n// Backward-compat wrapper expected by your analytics route:\n//   const r = await isRateLimited(key, bucket, limit);\n//   if (r.limited) ...\n// -------------------------------------------------------------------------\n\nexport type LegacyIsRateLimitedResult = {\n  limited: boolean;\n  retryAfter: number; // seconds\n  limit: number;\n  remaining: number;\n};\n\nexport async function isRateLimited(\n  key: string,\n  bucketType: string,\n  limit: number,\n  windowMs = 5 * 60 * 1000\n): Promise<LegacyIsRateLimitedResult> {\n  const result = await rateLimitAsync(`${bucketType}:${key}`, {\n    limit,\n    windowMs,\n    keyPrefix: \"api\",\n    useRedis: false,\n    redisClient: null,\n  });\n\n  return {\n    limited: !result.allowed,\n    retryAfter: Math.ceil(result.retryAfterMs / 1000),\n    limit: result.limit,\n    remaining: result.remaining,\n  };\n}\n\n// -------------------------------------------------------------------------\n// Pre-configured configs\n// -------------------------------------------------------------------------\n\nexport const RATE_LIMIT_CONFIGS = {\n  TEASER_REQUEST: { limit: 5, windowMs: 15 * 60 * 1000, keyPrefix: \"teaser\" },\n  NEWSLETTER_SUBSCRIBE: { limit: 5, windowMs: 10 * 60 * 1000, keyPrefix: \"newsletter\" },\n  CONTACT_FORM: { limit: 5, windowMs: 10 * 60 * 1000, keyPrefix: \"contact\" },\n  AUTHENTICATION: { limit: 5, windowMs: 5 * 60 * 1000, keyPrefix: \"auth\" },\n  API_GENERAL: { limit: 100, windowMs: 60 * 60 * 1000, keyPrefix: \"api\" },\n  INNER_CIRCLE_REGISTER: { limit: 20, windowMs: 15 * 60 * 1000, keyPrefix: \"ic-reg\" },\n  INNER_CIRCLE_REGISTER_EMAIL: { limit: 3, windowMs: 60 * 60 * 1000, keyPrefix: \"ic-reg-email\" },\n  INNER_CIRCLE_UNLOCK: { limit: 50, windowMs: 10 * 60 * 1000, keyPrefix: \"ic-unlock\" },\n  INNER_CIRCLE_RESEND: { limit: 3, windowMs: 15 * 60 * 1000, keyPrefix: \"ic-resend\" },\n  INNER_CIRCLE_RESEND_EMAIL: { limit: 2, windowMs: 60 * 60 * 1000, keyPrefix: \"ic-resend-email\" },\n  INNER_CIRCLE_ADMIN_EXPORT: { limit: 10, windowMs: 60 * 1000, keyPrefix: \"ic-admin-export\" },\n  ADMIN_OPERATIONS: { limit: 10, windowMs: 60 * 60 * 1000, keyPrefix: \"admin-ops\" },\n  ADMIN_LOGIN: { limit: 5, windowMs: 15 * 60 * 1000, keyPrefix: \"admin-login\" },\n  ADMIN_API: { limit: 100, windowMs: 5 * 60 * 1000, keyPrefix: \"admin-api\" },\n} as const;\n\nexport type RateLimitConfigKey = keyof typeof RATE_LIMIT_CONFIGS;\n\nexport function getRateLimitConfig(key: RateLimitConfigKey): RateLimitOptions {\n  const config = RATE_LIMIT_CONFIGS[key];\n  if (!config) throw new Error(`Rate limit configuration \"${key}\" not found`);\n  return config;\n}\n\nexport function hasRateLimitConfig(key: string): key is RateLimitConfigKey {\n  return key in RATE_LIMIT_CONFIGS;\n}\n\n// -------------------------------------------------------------------------\n// Default export for convenience\n// -------------------------------------------------------------------------\n\nexport default {\n  rateLimit,\n  rateLimitAsync,\n  isRateLimited,\n  createRateLimitHeaders,\n  getClientIp,\n  rateLimitForEmail,\n  rateLimitForRequestIp,\n  combinedRateLimit,\n  RATE_LIMIT_CONFIGS,\n  getRateLimitConfig,\n  hasRateLimitConfig,\n};","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\server\\recaptchaUtils.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'RecaptchaVerificationResult' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":35}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// lib/server/recaptchaUtils.ts\r\nimport { \r\n  verifyRecaptcha, \r\n  verifyRecaptchaDetailed, \r\n  type RecaptchaVerificationResult \r\n} from \"@/lib/recaptchaServer\";\r\n\r\nexport type RecaptchaProcessedResult = {\r\n  success: boolean;\r\n  score: number;\r\n  action?: string;\r\n  errorCodes?: string[];\r\n};\r\n\r\nexport async function processRecaptchaToken(\r\n  token: string,\r\n  expectedAction?: string,\r\n  ip?: string,\r\n  useDetailed: boolean = true\r\n): Promise<RecaptchaProcessedResult | null> {\r\n  try {\r\n    if (useDetailed) {\r\n      // Use detailed version for full data\r\n      const result = await verifyRecaptchaDetailed(token, expectedAction, ip);\r\n      return {\r\n        success: result.success,\r\n        score: result.score,\r\n        action: result.action,\r\n        errorCodes: result.errorCodes,\r\n      };\r\n    } else {\r\n      // Use simple boolean version\r\n      const success = await verifyRecaptcha(token, expectedAction, ip);\r\n      return {\r\n        success,\r\n        score: success ? 1.0 : 0.0,\r\n      };\r\n    }\r\n  } catch (error) {\r\n    console.error(\"[reCAPTCHA] Processing error:\", error);\r\n    return null;\r\n  }\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\server\\resources-data.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'safeNumber' is defined but never used. Allowed unused vars must match /^_/u.","line":24,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":20},{"ruleId":"import/no-anonymous-default-export","severity":1,"message":"Assign object to a variable before exporting as module default","line":150,"column":1,"nodeType":"ExportDefaultDeclaration","endLine":155,"endColumn":3}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// lib/server/resources-data.ts\nimport {\n  getMdxCollectionMeta,\n  getMdxDocumentBySlug,\n  type MdxMeta,\n  type MdxDocument,\n} from \"@/lib/server/mdx-collections\";\nimport type { Resource } from \"@/types/index\";\n\nexport type ResourceWithContent = Resource & {\n  content: string;\n};\n\n// Safe converters\nfunction safeString(value: any): string | undefined {\n  return typeof value === \"string\" && value.trim() ? value.trim() : undefined;\n}\n\nfunction safeArray(value: any): string[] | undefined {\n  if (!Array.isArray(value)) return undefined;\n  return value.filter(item => typeof item === \"string\");\n}\n\nfunction safeNumber(value: any): number | undefined {\n  if (typeof value === \"number\") return value;\n  if (typeof value === \"string\") {\n    const parsed = parseInt(value, 10);\n    return isNaN(parsed) ? undefined : parsed;\n  }\n  return undefined;\n}\n\nfunction safeBoolean(value: any): boolean {\n  if (typeof value === \"boolean\") return value;\n  if (typeof value === \"string\") {\n    const lower = value.toLowerCase().trim();\n    return lower === \"true\" || lower === \"yes\" || lower === \"1\";\n  }\n  return false;\n}\n\nfunction fromMdxMeta(meta: MdxMeta): Resource {\n  const m = meta as any;\n  \n  const slug = safeString(m.slug) || safeString(m._raw?.flattenedPath) || \"\";\n  \n  return {\n    // Required\n    slug,\n    title: safeString(m.title) || \"Untitled Resource\",\n    \n    // Content\n    description: safeString(m.description) || safeString(m.excerpt),\n    excerpt: safeString(m.excerpt) || safeString(m.description),\n    \n    // Metadata\n    date: safeString(m.date),\n    author: safeString(m.author),\n    category: safeString(m.category),\n    tags: safeArray(m.tags),\n    featured: safeBoolean(m.featured),\n    \n    // Visual\n    coverImage: safeString(m.coverImage) || safeString(m.image),\n    \n    // State\n    draft: safeBoolean(m.draft),\n    published: safeBoolean(m.published),\n    \n    // Resource-specific\n    resourceType: safeString(m.resourceType) as any,\n    applications: safeArray(m.applications),\n    useCases: safeArray(m.useCases),\n    industries: safeArray(m.industries),\n    format: safeString(m.format) as any,\n    complexity: safeString(m.complexity) as any,\n    timeRequired: safeString(m.timeRequired),\n    version: safeString(m.version),\n    lastUpdated: safeString(m.lastUpdated),\n    prerequisites: safeArray(m.prerequisites),\n    toolsRequired: safeArray(m.toolsRequired),\n    deliverables: safeArray(m.deliverables),\n    outcomes: safeArray(m.outcomes),\n    instructions: safeString(m.instructions),\n    examples: safeArray(m.examples),\n    tips: safeArray(m.tips),\n    \n    // System\n    _raw: m._raw,\n    url: safeString(m.url),\n    type: \"resource\",\n  };\n}\n\nfunction fromMdxDocument(doc: MdxDocument): ResourceWithContent {\n  const { content, ...rest } = doc as any;\n  const meta = fromMdxMeta(rest);\n  \n  return {\n    ...meta,\n    content: typeof content === \"string\" ? content : \"\",\n  };\n}\n\nexport function getAllResourcesMeta(): Resource[] {\n  try {\n    const metas = getMdxCollectionMeta(\"resources\");\n    return metas.map(m => fromMdxMeta(m));\n  } catch (error) {\n    console.error(\"[resources-data] Error getting all resources meta:\", error);\n    return [];\n  }\n}\n\nexport function getResourceBySlug(slug: string): ResourceWithContent | null {\n  try {\n    const doc = getMdxDocumentBySlug(\"resources\", slug);\n    if (!doc) {\n      console.warn(`[resources-data] Resource not found: ${slug}`);\n      return null;\n    }\n    \n    return fromMdxDocument(doc);\n  } catch (error) {\n    console.error(`[resources-data] Error getting resource ${slug}:`, error);\n    return null;\n  }\n}\n\nexport function getResourcesByType(type: string): Resource[] {\n  try {\n    return getAllResourcesMeta()\n      .filter(r => !r.draft && r.resourceType?.toLowerCase() === type.toLowerCase());\n  } catch (error) {\n    console.error(`[resources-data] Error getting resources by type ${type}:`, error);\n    return [];\n  }\n}\n\nexport function getFeaturedResources(): Resource[] {\n  try {\n    return getAllResourcesMeta()\n      .filter(r => r.featured && !r.draft);\n  } catch (error) {\n    console.error(\"[resources-data] Error getting featured resources:\", error);\n    return [];\n  }\n}\n\nexport default {\n  getAllResourcesMeta,\n  getResourceBySlug,\n  getResourcesByType,\n  getFeaturedResources,\n};","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\server\\serialize.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\server\\strategies-data.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'safeNumber' is defined but never used. Allowed unused vars must match /^_/u.","line":24,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":20},{"ruleId":"import/no-anonymous-default-export","severity":1,"message":"Assign object to a variable before exporting as module default","line":153,"column":1,"nodeType":"ExportDefaultDeclaration","endLine":158,"endColumn":3}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// lib/server/strategies-data.ts\r\nimport {\r\n  getMdxCollectionMeta,\r\n  getMdxDocumentBySlug,\r\n  type MdxMeta,\r\n  type MdxDocument,\r\n} from \"@/lib/server/mdx-collections\";\r\nimport type { Strategy } from \"@/types/index\";\r\n\r\nexport type StrategyWithContent = Strategy & {\r\n  content: string;\r\n};\r\n\r\n// Safe converters\r\nfunction safeString(value: any): string | undefined {\r\n  return typeof value === \"string\" && value.trim() ? value.trim() : undefined;\r\n}\r\n\r\nfunction safeArray(value: any): string[] | undefined {\r\n  if (!Array.isArray(value)) return undefined;\r\n  return value.filter(item => typeof item === \"string\");\r\n}\r\n\r\nfunction safeNumber(value: any): number | undefined {\r\n  if (typeof value === \"number\") return value;\r\n  if (typeof value === \"string\") {\r\n    const parsed = parseInt(value, 10);\r\n    return isNaN(parsed) ? undefined : parsed;\r\n  }\r\n  return undefined;\r\n}\r\n\r\nfunction safeBoolean(value: any): boolean {\r\n  if (typeof value === \"boolean\") return value;\r\n  if (typeof value === \"string\") {\r\n    const lower = value.toLowerCase().trim();\r\n    return lower === \"true\" || lower === \"yes\" || lower === \"1\";\r\n  }\r\n  return false;\r\n}\r\n\r\nfunction fromMdxMeta(meta: MdxMeta): Strategy {\r\n  const m = meta as any;\r\n  \r\n  const slug = safeString(m.slug) || safeString(m._raw?.flattenedPath) || \"\";\r\n  \r\n  return {\r\n    // Required\r\n    slug,\r\n    title: safeString(m.title) || \"Untitled Strategy\",\r\n    \r\n    // Content\r\n    description: safeString(m.description) || safeString(m.excerpt),\r\n    excerpt: safeString(m.excerpt) || safeString(m.description),\r\n    \r\n    // Metadata\r\n    date: safeString(m.date),\r\n    author: safeString(m.author),\r\n    category: safeString(m.category),\r\n    tags: safeArray(m.tags),\r\n    featured: safeBoolean(m.featured),\r\n    \r\n    // Visual\r\n    coverImage: safeString(m.coverImage) || safeString(m.image),\r\n    \r\n    // State\r\n    draft: safeBoolean(m.draft),\r\n    published: safeBoolean(m.published),\r\n    \r\n    // Strategy-specific\r\n    strategyType: safeString(m.strategyType) as any,\r\n    framework: safeString(m.framework),\r\n    methodology: safeString(m.methodology),\r\n    scope: safeString(m.scope) as any,\r\n    scale: safeString(m.scale) as any,\r\n    timeframe: safeString(m.timeframe) as any,\r\n    implementationTime: safeString(m.implementationTime),\r\n    kpis: safeArray(m.kpis),\r\n    successMetrics: safeArray(m.successMetrics),\r\n    roi: safeString(m.roi),\r\n    steps: safeArray(m.steps),\r\n    phases: safeArray(m.phases),\r\n    milestones: safeArray(m.milestones),\r\n    risks: safeArray(m.risks),\r\n    challenges: safeArray(m.challenges),\r\n    mitigation: safeArray(m.mitigation),\r\n    tools: safeArray(m.tools),\r\n    templates: safeArray(m.templates),\r\n    software: safeArray(m.software),\r\n    \r\n    // System\r\n    _raw: m._raw,\r\n    url: safeString(m.url),\r\n    type: \"strategy\",\r\n  };\r\n}\r\n\r\nfunction fromMdxDocument(doc: MdxDocument): StrategyWithContent {\r\n  const { content, ...rest } = doc as any;\r\n  const meta = fromMdxMeta(rest);\r\n  \r\n  return {\r\n    ...meta,\r\n    content: typeof content === \"string\" ? content : \"\",\r\n  };\r\n}\r\n\r\nexport function getAllStrategiesMeta(): Strategy[] {\r\n  try {\r\n    const metas = getMdxCollectionMeta(\"strategies\");\r\n    return metas.map(m => fromMdxMeta(m));\r\n  } catch (error) {\r\n    console.error(\"[strategies-data] Error getting all strategies meta:\", error);\r\n    return [];\r\n  }\r\n}\r\n\r\nexport function getStrategyBySlug(slug: string): StrategyWithContent | null {\r\n  try {\r\n    const doc = getMdxDocumentBySlug(\"strategies\", slug);\r\n    if (!doc) {\r\n      console.warn(`[strategies-data] Strategy not found: ${slug}`);\r\n      return null;\r\n    }\r\n    \r\n    return fromMdxDocument(doc);\r\n  } catch (error) {\r\n    console.error(`[strategies-data] Error getting strategy ${slug}:`, error);\r\n    return null;\r\n  }\r\n}\r\n\r\nexport function getStrategiesByType(type: string): Strategy[] {\r\n  try {\r\n    return getAllStrategiesMeta()\r\n      .filter(s => !s.draft && s.strategyType?.toLowerCase() === type.toLowerCase());\r\n  } catch (error) {\r\n    console.error(`[strategies-data] Error getting strategies by type ${type}:`, error);\r\n    return [];\r\n  }\r\n}\r\n\r\nexport function getFeaturedStrategies(): Strategy[] {\r\n  try {\r\n    return getAllStrategiesMeta()\r\n      .filter(s => s.featured && !s.draft);\r\n  } catch (error) {\r\n    console.error(\"[strategies-data] Error getting featured strategies:\", error);\r\n    return [];\r\n  }\r\n}\r\n\r\nexport default {\r\n  getAllStrategiesMeta,\r\n  getStrategyBySlug,\r\n  getStrategiesByType,\r\n  getFeaturedStrategies,\r\n};","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\server\\subscription.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\server\\unified-content.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'toSummaryType' is defined but never used. Allowed unused vars must match /^_/u.","line":87,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":87,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// lib/server/unified-content.ts\n// Server-side unified content system for Abraham of London\n// Now wired to Contentlayer via contentlayer-helper\n\nimport {\n  getPublishedPosts,\n  getAllBooks,\n  getAllCanons,\n  getAllDownloads,\n  getAllEvents,\n  getAllPrints,\n  getAllResources,\n  getAllStrategies,\n} from \"@/lib/contentlayer-helper\";\n\n/* -------------------------------------------------------------------------- */\n/* STEP 2: Types                                                              */\n/* -------------------------------------------------------------------------- */\n\nexport interface BaseContent {\n  slug: string;\n  title: string;\n  excerpt?: string;\n  description?: string;\n  date?: string;\n  coverImage?: string;\n  tags?: string[];\n  featured?: boolean;\n  draft?: boolean;\n  published?: boolean;\n  status?: string;\n  author?: string | { name: string; [key: string]: any } | null;\n  category?: string;\n  [key: string]: any;\n}\n\nexport type ContentType =\n  | \"essay\"\n  | \"book\"\n  | \"download\"\n  | \"event\"\n  | \"print\"\n  | \"resource\"\n  | \"canon\"\n  | \"strategy\"\n  | \"page\";\n\nexport interface UnifiedContent extends BaseContent {\n  id: string;\n  type: ContentType;\n  url: string;\n\n  readTime?: string | number;\n  accessLevel?: string;\n  lockMessage?: string;\n\n  volumeNumber?: number;\n  order?: number;\n  resourceType?: string;\n  applications?: string[];\n  downloadFile?: string;\n  fileSize?: string;\n  eventDate?: string;\n  location?: string;\n  isbn?: string;\n  format?: string;\n  publisher?: string;\n  pages?: number;\n}\n\n// Client-facing summary type (exported for client compatibility)\nexport type UnifiedContentSummaryType = \"page\" | \"download\" | \"event\";\n\n/* -------------------------------------------------------------------------- */\n/* Helpers                                                                    */\n/* -------------------------------------------------------------------------- */\n\nfunction getAuthorName(item: any): string | undefined {\n  if (!item || !item.author) return undefined;\n  if (typeof item.author === \"string\") return item.author;\n  if (typeof item.author === \"object\" && item.author !== null) {\n    return item.author.name;\n  }\n  return undefined;\n}\n\nfunction toSummaryType(type: ContentType): UnifiedContentSummaryType {\n  const typeMap: Record<string, UnifiedContentSummaryType> = {\n    download: \"download\",\n    event: \"event\",\n    essay: \"page\",\n    book: \"page\",\n    print: \"page\",\n    resource: \"page\",\n    canon: \"page\",\n    strategy: \"page\",\n    page: \"page\",\n  };\n  return typeMap[type] || \"page\";\n}\n\nasync function safeLoadContent(\n  label: string,\n  loader: () => Promise<any[]> | any[] | undefined,\n  type: ContentType,\n): Promise<UnifiedContent[]> {\n  try {\n    console.log(`[unified-content] Loading ${label}...`);\n\n    let result: any[] | undefined;\n    try {\n      const data = loader();\n      result = data instanceof Promise ? await data : data;\n    } catch (loaderError) {\n      console.warn(\n        `[unified-content] Loader for ${label} failed:`,\n        loaderError,\n      );\n      return [];\n    }\n\n    if (!result || !Array.isArray(result)) {\n      console.warn(\n        `[unified-content] ${label} returned invalid data:`,\n        typeof result,\n      );\n      return [];\n    }\n\n    const unified: UnifiedContent[] = result\n      .filter(\n        (item) =>\n          item &&\n          typeof item === \"object\" &&\n          (item as any).slug &&\n          (item as any).title,\n      )\n      .map((item: any) => ({\n        id: `${type}-${item.slug}`,\n        type,\n        slug: item.slug,\n        title: item.title,\n        url: getContentUrl(type, item.slug),\n\n        excerpt: item.excerpt,\n        description: item.description,\n        date: item.date,\n        coverImage: item.coverImage || item.image || item.heroImage,\n        tags: Array.isArray(item.tags) ? item.tags : [],\n        featured: Boolean(item.featured),\n        draft: Boolean(item.draft),\n        published: item.published !== false,\n        status: item.status || (item.draft ? \"draft\" : \"published\"),\n        author: getAuthorName(item),\n        category: item.category,\n\n        readTime: item.readTime || item.readingTime,\n        accessLevel: item.accessLevel,\n        lockMessage: item.lockMessage,\n\n        ...(type === \"book\" || type === \"canon\"\n          ? {\n              volumeNumber: item.volumeNumber,\n              order: item.order,\n            }\n          : {}),\n\n        ...(type === \"resource\"\n          ? {\n              resourceType: item.resourceType,\n              applications: item.applications,\n            }\n          : {}),\n\n        ...(type === \"download\"\n          ? {\n              downloadFile: item.downloadFile,\n              fileSize: item.fileSize,\n            }\n          : {}),\n\n        ...(type === \"event\"\n          ? {\n              eventDate: item.eventDate,\n              location: item.location,\n            }\n          : {}),\n\n        ...(type === \"book\"\n          ? {\n              isbn: item.isbn,\n              format: item.format,\n              publisher: item.publisher,\n              pages: item.pages,\n            }\n          : {}),\n\n        _raw: item,\n      }));\n\n    console.log(`[unified-content] Loaded ${label}: ${unified.length} items`);\n    return unified;\n  } catch (error) {\n    console.error(`[unified-content] Error loading ${label}:`, error);\n    return [];\n  }\n}\n\n/* -------------------------------------------------------------------------- */\n/* Main API functions                                                         */\n/* -------------------------------------------------------------------------- */\n\nexport async function getAllUnifiedContent(): Promise<UnifiedContent[]> {\n  console.time(\"[unified-content] Total load time\");\n\n  try {\n    const loaders = [\n      {\n        label: \"essays\",\n        loader: () => getPublishedPosts(),\n        type: \"essay\" as ContentType,\n      },\n      {\n        label: \"books\",\n        loader: () => getAllBooks(),\n        type: \"book\" as ContentType,\n      },\n      {\n        label: \"canon\",\n        loader: () => getAllCanons(),\n        type: \"canon\" as ContentType,\n      },\n      {\n        label: \"downloads\",\n        loader: () => getAllDownloads(),\n        type: \"download\" as ContentType,\n      },\n      {\n        label: \"events\",\n        loader: () => getAllEvents(),\n        type: \"event\" as ContentType,\n      },\n      {\n        label: \"prints\",\n        loader: () => getAllPrints(),\n        type: \"print\" as ContentType,\n      },\n      {\n        label: \"resources\",\n        loader: () => getAllResources(),\n        type: \"resource\" as ContentType,\n      },\n      {\n        label: \"strategies\",\n        loader: () => getAllStrategies(),\n        type: \"strategy\" as ContentType,\n      },\n    ];\n\n    const results = await Promise.all(\n      loaders.map(({ label, loader, type }) =>\n        safeLoadContent(label, loader, type),\n      ),\n    );\n\n    const allContent = results.flat();\n\n    allContent.sort((a, b) => {\n      const dateA = a.date ? new Date(a.date).getTime() : 0;\n      const dateB = b.date ? new Date(b.date).getTime() : 0;\n      return dateB - dateA;\n    });\n\n    console.timeEnd(\"[unified-content] Total load time\");\n    console.log(\n      `[unified-content] Total items loaded: ${allContent.length}`,\n    );\n\n    return allContent;\n  } catch (error) {\n    console.error(\"[unified-content] Critical error loading content:\", error);\n    return [];\n  }\n}\n\nexport async function getUnifiedContentByType(\n  type: ContentType,\n): Promise<UnifiedContent[]> {\n  try {\n    const allContent = await getAllUnifiedContent();\n    return allContent.filter((item) => item.type === type);\n  } catch (error) {\n    console.error(\n      \"[unified-content] Error getting content by type:\",\n      error,\n    );\n    return [];\n  }\n}\n\nexport async function getUnifiedContentBySlug(\n  slug: string,\n  type?: ContentType,\n): Promise<UnifiedContent | null> {\n  try {\n    const allContent = await getAllUnifiedContent();\n\n    const filteredContent = allContent.filter((item) => {\n      const slugMatch = item.slug === slug;\n      if (type) {\n        return slugMatch && item.type === type;\n      }\n      return slugMatch;\n    });\n\n    if (filteredContent.length === 0) return null;\n    return filteredContent[0];\n  } catch (error) {\n    console.error(\n      \"[unified-content] Error getting content by slug:\",\n      error,\n    );\n    return null;\n  }\n}\n\nexport async function getPublishedUnifiedContent(): Promise<UnifiedContent[]> {\n  try {\n    const allContent = await getAllUnifiedContent();\n    return allContent.filter((item) => {\n      const isDraft = item.draft === true;\n      const isNotPublished = item.published === false;\n      const isStatusDraft = item.status === \"draft\";\n      const isStatusArchived = item.status === \"archived\";\n      const isStatusPrivate = item.status === \"private\";\n      const isStatusScheduled = item.status === \"scheduled\";\n\n      return !(\n        isDraft ||\n        isNotPublished ||\n        isStatusDraft ||\n        isStatusArchived ||\n        isStatusPrivate ||\n        isStatusScheduled\n      );\n    });\n  } catch (error) {\n    console.error(\n      \"[unified-content] Error getting published content:\",\n      error,\n    );\n    return [];\n  }\n}\n\n/* -------------------------------------------------------------------------- */\n/* Query & search                                                             */\n/* -------------------------------------------------------------------------- */\n\nexport interface ContentQuery {\n  type?: ContentType | ContentType[];\n  tag?: string;\n  featured?: boolean;\n  author?: string;\n  year?: string;\n  search?: string;\n  limit?: number;\n  skip?: number;\n  sortBy?: \"date\" | \"title\" | \"featured\";\n  sortOrder?: \"asc\" | \"desc\";\n}\n\nexport async function queryUnifiedContent(\n  options: ContentQuery = {},\n): Promise<UnifiedContent[]> {\n  try {\n    let content = await getPublishedUnifiedContent();\n\n    if (options.type) {\n      const types = Array.isArray(options.type)\n        ? options.type\n        : [options.type];\n      content = content.filter((item) => types.includes(item.type));\n    }\n\n    if (options.tag) {\n      content = content.filter((item) =>\n        item.tags?.some(\n          (tag) => tag.toLowerCase() === options.tag!.toLowerCase(),\n        ),\n      );\n    }\n\n    if (options.featured !== undefined) {\n      content = content.filter((item) => item.featured === options.featured);\n    }\n\n    if (options.author) {\n      const searchAuthor = options.author.toLowerCase();\n      content = content.filter((item) =>\n        (item.author || \"\").toLowerCase().includes(searchAuthor),\n      );\n    }\n\n    if (options.year) {\n      content = content.filter((item) => {\n        if (!item.date) return false;\n        const year = getYearFromDate(item.date);\n        return year === options.year;\n      });\n    }\n\n    if (options.search) {\n      const searchTerm = options.search.toLowerCase();\n      content = content.filter(\n        (item) =>\n          item.title.toLowerCase().includes(searchTerm) ||\n          item.excerpt?.toLowerCase().includes(searchTerm) ||\n          item.description?.toLowerCase().includes(searchTerm),\n      );\n    }\n\n    const sortBy = options.sortBy || \"date\";\n    const sortOrder = options.sortOrder || \"desc\";\n\n    content.sort((a, b) => {\n      let aVal: any;\n      let bVal: any;\n\n      switch (sortBy) {\n        case \"date\":\n          aVal = a.date ? new Date(a.date).getTime() : 0;\n          bVal = b.date ? new Date(b.date).getTime() : 0;\n          break;\n        case \"title\":\n          aVal = a.title.toLowerCase();\n          bVal = b.title.toLowerCase();\n          break;\n        case \"featured\":\n          aVal = a.featured ? 1 : 0;\n          bVal = b.featured ? 1 : 0;\n          break;\n        default:\n          return 0;\n      }\n\n      if (sortOrder === \"desc\") {\n        return aVal < bVal ? 1 : aVal > bVal ? -1 : 0;\n      }\n      return aVal > bVal ? 1 : aVal < bVal ? -1 : 0;\n    });\n\n    const skip = options.skip || 0;\n    const limit = options.limit || content.length;\n\n    return content.slice(skip, skip + limit);\n  } catch (error) {\n    console.error(\"[unified-content] Error querying content:\", error);\n    return [];\n  }\n}\n\nexport async function searchUnifiedContent(\n  query: string,\n): Promise<UnifiedContent[]> {\n  return queryUnifiedContent({ search: query });\n}\n\n/* -------------------------------------------------------------------------- */\n/* Utilities                                                                  */\n/* -------------------------------------------------------------------------- */\n\nexport function getContentUrl(type: ContentType, slug: string): string {\n  const typeMap: Record<ContentType, string> = {\n    essay: \"blog\",\n    book: \"books\",\n    download: \"downloads\",\n    event: \"events\",\n    print: \"prints\",\n    resource: \"resources\",\n    canon: \"canon\",\n    strategy: \"strategies\",\n    page: \"\",\n  };\n  const path = typeMap[type];\n  return path ? `/${path}/${slug}` : `/${slug}`;\n}\n\nexport function formatReadTime(\n  readTime?: string | number,\n): string | undefined {\n  if (readTime === undefined || readTime === null) return undefined;\n\n  if (typeof readTime === \"number\") {\n    return `${readTime} min read`;\n  }\n\n  if (typeof readTime === \"string\") {\n    const trimmed = readTime.trim();\n    if (!trimmed) return undefined;\n\n    const lower = trimmed.toLowerCase();\n    if (lower.includes(\"min\") || lower.includes(\"read\")) {\n      return trimmed;\n    }\n\n    const asNumber = Number(trimmed);\n    if (!isNaN(asNumber)) {\n      return `${asNumber} min read`;\n    }\n\n    return trimmed;\n  }\n\n  return undefined;\n}\n\nexport function getYearFromDate(date?: string): string {\n  if (!date) return \"Undated\";\n  try {\n    const year = new Date(date).getFullYear();\n    return isNaN(year) ? \"Undated\" : year.toString();\n  } catch {\n    return \"Undated\";\n  }\n}\n\n/* -------------------------------------------------------------------------- */\n/* Stats & default export                                                     */\n/* -------------------------------------------------------------------------- */\n\nexport interface ContentStats {\n  total: number;\n  byType: Record<ContentType, number>;\n  byYear: Record<string, number>;\n  featured: number;\n}\n\nexport async function getContentStats(): Promise<ContentStats> {\n  const allContent = await getAllUnifiedContent();\n\n  const stats: ContentStats = {\n    total: allContent.length,\n    byType: {\n      essay: 0,\n      book: 0,\n      download: 0,\n      event: 0,\n      print: 0,\n      resource: 0,\n      canon: 0,\n      strategy: 0,\n      page: 0,\n    },\n    byYear: {},\n    featured: 0,\n  };\n\n  allContent.forEach((item) => {\n    stats.byType[item.type]++;\n\n    if (item.date) {\n      const year = getYearFromDate(item.date);\n      stats.byYear[year] = (stats.byYear[year] || 0) + 1;\n    }\n\n    if (item.featured) stats.featured++;\n  });\n\n  return stats;\n}\n\nconst unifiedContent = {\n  getAllUnifiedContent,\n  getUnifiedContentByType,\n  getUnifiedContentBySlug,\n  getPublishedUnifiedContent,\n  queryUnifiedContent,\n  searchUnifiedContent,\n  getContentStats,\n  getContentUrl,\n  formatReadTime,\n  getYearFromDate,\n  type: {} as {\n    UnifiedContent: UnifiedContent;\n    ContentType: ContentType;\n    UnifiedContentSummaryType: UnifiedContentSummaryType;\n    ContentQuery: ContentQuery;\n    ContentStats: ContentStats;\n  },\n};\n\nexport default unifiedContent;","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\server\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\server\\validation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\session.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\shorts.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isPublished' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":36}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// lib/shorts.ts\nimport { allShorts } from \"@/lib/contentlayer\";\nimport { normalizeSlug, isPublished } from \"./contentlayer-helper\";\n\n/**\n * Unified type for Shorts Indexing.\n * Matches the shape expected by pages/shorts/index.tsx\n */\nexport type ShortIndexItem = {\n  _id: string;\n  slug: string;\n  title: string;\n  excerpt?: string | null;\n  date?: string | null;\n  readTime?: string | null;\n  tags?: string[];\n  theme?: string | null;\n  draft?: boolean;\n  published?: boolean;\n};\n\n/**\n * Robust getter for public-facing Shorts.\n * 1. Safely extracts the array.\n * 2. Uses the CENTRALIZED normalizeSlug to prevent dead links.\n * 3. Filters by your custom publication rules.\n */\nexport function getPublicShorts(): ShortIndexItem[] {\n  // Defensive check for empty generated content\n  const docs = allShorts ?? [];\n\n  const items: ShortIndexItem[] = docs.map((d: any) => ({\n    _id: d._id,\n    // âœ… SYNCED: Uses the robust helper logic to ensure URLs match routes\n    slug: normalizeSlug(d),\n    title: d.title ?? \"Untitled\",\n    excerpt: d.excerpt ?? d.description ?? null,\n    date: d.date ? String(d.date) : null,\n    readTime: d.readTime ?? d.readtime ?? \"2 min\",\n    tags: Array.isArray(d.tags) ? d.tags : [],\n    theme: d.theme ?? \"General\",\n    draft: Boolean(d.draft),\n    published: typeof d.published === \"boolean\" ? d.published : true,\n  }));\n\n  // Application of \"Public Rule\": (Not a draft) AND (Not explicitly un-published)\n  return items\n    .filter((s) => !s.draft && s.published !== false)\n    .sort((a, b) => {\n      const aTime = a.date ? new Date(a.date).getTime() : 0;\n      const bTime = b.date ? new Date(b.date).getTime() : 0;\n      return bTime - aTime; // Newest first\n    });\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\simple-ssr-json.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\siteConfig.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\social.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\strategies.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\stringUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\subscribe.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\test-books.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\types\\content-types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\unified-content.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\utils\\content-filters.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\utils\\docs.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\verify-types-fixed.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\verify-types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\verifyRecaptcha.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\lib\\websocket\\WebSocketService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\middleware.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\netlify\\emails\\TeaserEmail.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\netlify\\emails\\WelcomeLaunchEmail.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\netlify\\emails\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\netlify\\functions\\_email.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\netlify\\functions\\_utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\netlify\\functions\\clear-cache.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\netlify\\functions\\contact.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\netlify\\functions\\health-check.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'context' is defined but never used. Allowed unused args must match /^_/u.","line":286,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":286,"endColumn":10}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// netlify/functions/health-check.ts\r\nimport type {\r\n  Handler,\r\n  HandlerEvent,\r\n  HandlerContext,\r\n  HandlerResponse,\r\n} from \"@netlify/functions\";\r\n\r\n// ---------------------------------------------------------------------------\r\n// Types & Interfaces\r\n// ---------------------------------------------------------------------------\r\n\r\ninterface BasicCheck {\r\n  status: \"pass\" | \"fail\" | \"warn\";\r\n  details?: string;\r\n}\r\n\r\ninterface TimedCheck extends BasicCheck {\r\n  duration: number;\r\n  [key: string]: unknown;\r\n}\r\n\r\ninterface DependencyStatus {\r\n  status: \"healthy\" | \"unhealthy\" | \"unknown\";\r\n  responseTime?: number;\r\n  version?: string;\r\n  error?: string;\r\n}\r\n\r\ninterface HealthCheckResult {\r\n  status: \"healthy\" | \"degraded\" | \"unhealthy\";\r\n  timestamp: string;\r\n  version: string;\r\n  environment: string;\r\n\r\n  checks: {\r\n    [key: string]: TimedCheck;\r\n  };\r\n\r\n  dependencies: {\r\n    [key: string]: DependencyStatus;\r\n  };\r\n\r\n  system: {\r\n    nodeVersion: string;\r\n    platform: string;\r\n    memory: {\r\n      used: number;\r\n      total: number;\r\n      percentage: number;\r\n    };\r\n    uptime: number;\r\n  };\r\n\r\n  services: {\r\n    [key: string]: {\r\n      status: \"operational\" | \"degraded\" | \"down\" | \"unknown\";\r\n      lastChecked: string;\r\n    };\r\n  };\r\n}\r\n\r\ninterface HealthCheckConfig {\r\n  timeout: number;\r\n  enableDetailedMetrics: boolean;\r\n  checkDependencies: boolean;\r\n  allowedOrigins: string[];\r\n}\r\n\r\n// ---------------------------------------------------------------------------\r\n// Configuration\r\n// ---------------------------------------------------------------------------\r\n\r\nconst CONFIG: HealthCheckConfig = {\r\n  timeout: 10000,\r\n  enableDetailedMetrics: process.env.NODE_ENV === \"production\",\r\n  checkDependencies: process.env.HEALTH_CHECK_FULL === \"true\",\r\n  allowedOrigins: (\r\n    process.env.ALLOWED_ORIGINS ||\r\n    \"http://localhost:3000,http://localhost:8888\"\r\n  ).split(\",\"),\r\n};\r\n\r\n// ---------------------------------------------------------------------------\r\n// Utility Functions\r\n// ---------------------------------------------------------------------------\r\n\r\nfunction getCorsHeaders(origin?: string) {\r\n  const allowedOrigin = CONFIG.allowedOrigins.includes(origin || \"\")\r\n    ? origin\r\n    : CONFIG.allowedOrigins[0];\r\n\r\n  return {\r\n    \"Content-Type\": \"application/json; charset=utf-8\",\r\n    \"Access-Control-Allow-Origin\": allowedOrigin || \"*\",\r\n    \"Access-Control-Allow-Methods\": \"GET, POST, OPTIONS, HEAD\",\r\n    \"Access-Control-Allow-Headers\":\r\n      \"Content-Type, Authorization, X-Health-Check-Token\",\r\n    \"Access-Control-Max-Age\": \"86400\",\r\n    \"X-Health-Check-Version\": \"1.0.0\",\r\n    \"X-Response-Time\": Date.now().toString(),\r\n  };\r\n}\r\n\r\nfunction formatResponse(\r\n  statusCode: number,\r\n  data: unknown,\r\n  origin?: string,\r\n  extraHeaders: Record<string, string> = {}\r\n): HandlerResponse {\r\n  return {\r\n    statusCode,\r\n    headers: {\r\n      ...getCorsHeaders(origin),\r\n      ...extraHeaders,\r\n    },\r\n    body: JSON.stringify(data, null, CONFIG.enableDetailedMetrics ? 2 : 0),\r\n  };\r\n}\r\n\r\nfunction measureTime<T>(\r\n  fn: () => Promise<T> | T\r\n): Promise<{ result: T; duration: number }> {\r\n  const start = Date.now();\r\n  const result = fn();\r\n\r\n  if (result instanceof Promise) {\r\n    return result.then((res) => ({\r\n      result: res,\r\n      duration: Date.now() - start,\r\n    }));\r\n  }\r\n\r\n  return Promise.resolve({\r\n    result,\r\n    duration: Date.now() - start,\r\n  });\r\n}\r\n\r\n// ---------------------------------------------------------------------------\r\n// Health Check Components\r\n// ---------------------------------------------------------------------------\r\n\r\nasync function checkEnvironment(): Promise<BasicCheck> {\r\n  const requiredEnvVars = [\"NODE_ENV\", \"NEXT_PUBLIC_SITE_URL\"];\r\n  const optionalEnvVars = [\"RECAPTCHA_SECRET_KEY\", \"CLEAR_CACHE_SECRET\", \"RESEND_API_KEY\"];\r\n\r\n  const missingRequired = requiredEnvVars.filter((env) => !process.env[env]);\r\n  const missingOptional = optionalEnvVars.filter((env) => !process.env[env]);\r\n\r\n  if (missingRequired.length > 0) {\r\n    return {\r\n      status: \"fail\",\r\n      details: `Missing required environment variables: ${missingRequired.join(\", \")}`,\r\n    };\r\n  }\r\n\r\n  if (missingOptional.length > 0) {\r\n    return {\r\n      status: \"warn\",\r\n      details: `Missing optional environment variables: ${missingOptional.join(\", \")}`,\r\n    };\r\n  }\r\n\r\n  return { status: \"pass\" };\r\n}\r\n\r\nasync function checkSystemResources(): Promise<BasicCheck> {\r\n  try {\r\n    const memoryUsage = process.memoryUsage();\r\n    const total = Math.round(memoryUsage.heapTotal / 1024 / 1024);\r\n    const used = Math.round(memoryUsage.heapUsed / 1024 / 1024);\r\n    const pct = (used / total) * 100;\r\n\r\n    if (pct > 90) {\r\n      return {\r\n        status: \"fail\",\r\n        details: `High memory usage: ${used}MB/${total}MB (${pct.toFixed(1)}%)`,\r\n      };\r\n    }\r\n\r\n    if (pct > 80) {\r\n      return {\r\n        status: \"warn\",\r\n        details: `Elevated memory usage: ${used}MB/${total}MB (${pct.toFixed(1)}%)`,\r\n      };\r\n    }\r\n\r\n    return {\r\n      status: \"pass\",\r\n      details: `Memory OK: ${used}MB/${total}MB (${pct.toFixed(1)}%)`,\r\n    };\r\n  } catch {\r\n    return { status: \"warn\", details: \"Unable to read system resources\" };\r\n  }\r\n}\r\n\r\nasync function checkFunctionConnectivity(): Promise<BasicCheck> {\r\n  try {\r\n    return { status: \"pass\", details: \"Function loaded successfully\" };\r\n  } catch (error) {\r\n    return {\r\n      status: \"fail\",\r\n      details: error instanceof Error ? error.message : \"Unknown error\",\r\n    };\r\n  }\r\n}\r\n\r\nasync function checkExternalDependencies(): Promise<Record<string, DependencyStatus>> {\r\n  const dependencies: Record<string, DependencyStatus> = {};\r\n\r\n  // reCAPTCHA\r\n  try {\r\n    const start = Date.now();\r\n    const response = await fetch(\"https://www.google.com/recaptcha/api/siteverify\", {\r\n      method: \"HEAD\",\r\n      signal: AbortSignal.timeout(5000),\r\n    });\r\n\r\n    dependencies.recaptcha = {\r\n      status: response.ok ? \"healthy\" : \"unhealthy\",\r\n      responseTime: Date.now() - start,\r\n    };\r\n  } catch (error) {\r\n    dependencies.recaptcha = {\r\n      status: \"unhealthy\",\r\n      error: error instanceof Error ? error.message : \"Connection failed\",\r\n    };\r\n  }\r\n\r\n  // Main website\r\n  if (process.env.NEXT_PUBLIC_SITE_URL) {\r\n    try {\r\n      const start = Date.now();\r\n      const response = await fetch(process.env.NEXT_PUBLIC_SITE_URL, {\r\n        method: \"HEAD\",\r\n        signal: AbortSignal.timeout(5000),\r\n      });\r\n\r\n      dependencies.website = {\r\n        status: response.ok ? \"healthy\" : \"unhealthy\",\r\n        responseTime: Date.now() - start,\r\n      };\r\n    } catch (error) {\r\n      dependencies.website = {\r\n        status: \"unhealthy\",\r\n        error: error instanceof Error ? error.message : \"Connection failed\",\r\n      };\r\n    }\r\n  }\r\n\r\n  return dependencies;\r\n}\r\n\r\n// ---------------------------------------------------------------------------\r\n// FIX â€” Flatten measureTime() results (resolves your TS error)\r\n// ---------------------------------------------------------------------------\r\n\r\nfunction flattenCheck(\r\n  settled: PromiseSettledResult<{\r\n    result: BasicCheck;\r\n    duration: number;\r\n  }>\r\n): TimedCheck {\r\n  if (settled.status === \"fulfilled\") {\r\n    return {\r\n      status: settled.value.result.status,\r\n      duration: settled.value.duration,\r\n      details: settled.value.result.details,\r\n    };\r\n  }\r\n\r\n  return {\r\n    status: \"fail\",\r\n    duration: 0,\r\n    details: \"Check failed\",\r\n  };\r\n}\r\n\r\n// ---------------------------------------------------------------------------\r\n// Main Handler\r\n// ---------------------------------------------------------------------------\r\n\r\nexport const handler: Handler = async (\r\n  event: HandlerEvent,\r\n  context: HandlerContext\r\n): Promise<HandlerResponse> => {\r\n  const origin = event.headers.origin || event.headers.Origin;\r\n  const requestStartTime = Date.now();\r\n  const isDetailed = event.queryStringParameters?.detailed === \"true\";\r\n  const token = event.headers[\"x-health-check-token\"] as string | undefined;\r\n\r\n  if (event.httpMethod === \"OPTIONS\") {\r\n    return formatResponse(204, {}, origin);\r\n  }\r\n\r\n  if (isDetailed && process.env.HEALTH_CHECK_TOKEN && token !== process.env.HEALTH_CHECK_TOKEN) {\r\n    return formatResponse(401, { error: \"Unauthorized\" }, origin);\r\n  }\r\n\r\n  try {\r\n    const overallStatus: HealthCheckResult = {\r\n      status: \"healthy\",\r\n      timestamp: new Date().toISOString(),\r\n      version: process.env.npm_package_version || \"1.0.0\",\r\n      environment: process.env.NODE_ENV || \"development\",\r\n      checks: {},\r\n      dependencies: {},\r\n      system: {\r\n        nodeVersion: process.version,\r\n        platform: process.platform,\r\n        memory: {\r\n          used: Math.round(process.memoryUsage().heapUsed / 1024 / 1024),\r\n          total: Math.round(process.memoryUsage().heapTotal / 1024 / 1024),\r\n          percentage: Math.round(\r\n            (process.memoryUsage().heapUsed / process.memoryUsage().heapTotal) * 100\r\n          ),\r\n        },\r\n        uptime: Math.round(process.uptime()),\r\n      },\r\n      services: {},\r\n    };\r\n\r\n    // Run checks simultaneously\r\n    const checks = await Promise.allSettled([\r\n      measureTime(checkEnvironment),\r\n      measureTime(checkSystemResources),\r\n      measureTime(checkFunctionConnectivity),\r\n    ]);\r\n\r\n    // ----- FIXED ASSIGNMENTS -----\r\n    overallStatus.checks.environment = flattenCheck(checks[0]);\r\n    overallStatus.checks.system = flattenCheck(checks[1]);\r\n    overallStatus.checks.connectivity = flattenCheck(checks[2]);\r\n    // -----------------------------\r\n\r\n    if (CONFIG.checkDependencies && isDetailed) {\r\n      overallStatus.dependencies = await checkExternalDependencies();\r\n    }\r\n\r\n    const failed = Object.values(overallStatus.checks).filter((c) => c.status === \"fail\").length;\r\n    const warns = Object.values(overallStatus.checks).filter((c) => c.status === \"warn\").length;\r\n\r\n    if (failed > 0) overallStatus.status = \"unhealthy\";\r\n    else if (warns > 0) overallStatus.status = \"degraded\";\r\n\r\n    const responseTime = Date.now() - requestStartTime;\r\n\r\n    return formatResponse(\r\n      overallStatus.status === \"unhealthy\" ? 503 : 200,\r\n      overallStatus,\r\n      origin,\r\n      {\r\n        \"X-Response-Time\": responseTime.toString(),\r\n        \"X-Health-Status\": overallStatus.status,\r\n      }\r\n    );\r\n  } catch (error) {\r\n    const errorResponse = {\r\n      status: \"unhealthy\" as const,\r\n      timestamp: new Date().toISOString(),\r\n      error: \"Health check system failure\",\r\n      details:\r\n        process.env.NODE_ENV === \"production\"\r\n          ? undefined\r\n          : error instanceof Error\r\n          ? error.message\r\n          : \"Unknown error\",\r\n    };\r\n\r\n    return formatResponse(503, errorResponse, origin, {\r\n      \"X-Health-Status\": \"unhealthy\",\r\n      \"X-Response-Time\": (Date.now() - requestStartTime).toString(),\r\n    });\r\n  }\r\n};\r\n\r\n// ---------------------------------------------------------------------------\r\n// Testing Exports\r\n// ---------------------------------------------------------------------------\r\n\r\nexport const healthCheckComponents = {\r\n  checkEnvironment,\r\n  checkSystemResources,\r\n  checkFunctionConnectivity,\r\n  checkExternalDependencies,\r\n};","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\netlify\\functions\\ping.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\netlify\\functions\\send-teaser.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\netlify\\functions\\subscribe-launch.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\netlify\\functions\\subscribe.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\netlify\\functions\\test-email.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\netlify\\submissions\\submission-created.js","messages":[{"ruleId":null,"fatal":true,"severity":2,"message":"Parsing error: ',' expected.","line":20,"column":22,"nodeType":null}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// netlify/functions/submissions/submissions-created.ts\r\nimport type { Handler } from \"@netlify/functions\";\r\nimport {\r\n  ok,\r\n  bad,\r\n  readJson,\r\n  withSecurity,\r\n  normalizeEmail,\r\n  escapeHtml,\r\n  getSiteUrl,\r\n  validateRequiredFields,\r\n} from \"../_utils\";\r\n\r\nexport const handler: Handler = withSecurity(\r\n  async (event) => {\r\n    const origin = event.headers.origin || event.headers.Origin || \"*\";\r\n\r\n    try {\r\n      const body = await readJson<{\r\n        email?: string;\r\n        name?: string;\r\n        message?: string;\r\n        subject?: string;\r\n        data?: Record<string, unknown>;\r\n      }>({\r\n        headers: event.headers,\r\n        body: event.body || \"\",\r\n      });\r\n\r\n      const { email, name, message, subject, data } = body;\r\n\r\n      console.log(\"New form submission received:\", {\r\n        email: email ? normalizeEmail(email) : \"No email\",\r\n        name: name ? escapeHtml(name) : \"No name\",\r\n        subject: subject || \"No subject\",\r\n        timestamp: new Date().toISOString(),\r\n      });\r\n\r\n      const validation = validateRequiredFields(body, [\r\n        \"email\",\r\n        \"name\",\r\n        \"message\",\r\n      ]);\r\n      if (!validation.isValid) {\r\n        return bad(\r\n          `Missing required fields: ${validation.missing.join(\", \")}`,\r\n          422,\r\n          origin\r\n        );\r\n      }\r\n\r\n      const normalizedEmail = normalizeEmail(email);\r\n      if (!normalizedEmail) {\r\n        return bad(\"Invalid email address\", 422, origin);\r\n      }\r\n\r\n      await processSubmission({\r\n        email: normalizedEmail,\r\n        name: escapeHtml(name!),\r\n        message: escapeHtml(message!),\r\n        subject: escapeHtml(subject || \"Contact Form Submission\"),\r\n        additionalData: data,\r\n        submittedAt: new Date().toISOString(),\r\n        siteUrl: getSiteUrl(),\r\n      });\r\n\r\n      return ok(\r\n        \"Submission processed successfully\",\r\n        {\r\n          receivedAt: new Date().toISOString(),\r\n        },\r\n        origin\r\n      );\r\n    } catch (error: unknown) {\r\n      const message =\r\n        error instanceof Error\r\n          ? error.message\r\n          : \"Unknown error processing request\";\r\n      console.error(\"Error processing submission:\", message);\r\n      return bad(\"Internal server error\", 500, origin);\r\n    }\r\n  },\r\n  {\r\n    requireRecaptcha: true,\r\n    expectedAction: \"contact_form\",\r\n    requireHoneypot: true,\r\n  }\r\n);\r\n\r\nasync function processSubmission(submission: {\r\n  email: string;\r\n  name: string;\r\n  message: string;\r\n  subject: string;\r\n  additionalData?: Record<string, unknown>;\r\n  submittedAt: string;\r\n  siteUrl: string;\r\n}): Promise<void> {\r\n  console.log(\"Processing submission:\", {\r\n    email: submission.email,\r\n    name: submission.name,\r\n    subject: submission.subject,\r\n    timestamp: submission.submittedAt,\r\n  });\r\n\r\n  // TODO:\r\n  // 1. Send confirmation email\r\n  // 2. Store in external database / CRM\r\n  // 3. Send admin notification\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\next-env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\next-sitemap.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\404.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\[slug].tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'router' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":197,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":197,"endColumn":15}],"suppressedMessages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":62,"column":9,"nodeType":"JSXOpeningElement","endLine":66,"endColumn":11,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// pages/[slug].tsx\nimport * as React from \"react\";\nimport Head from \"next/head\";\nimport type { GetStaticPaths, GetStaticProps } from \"next\";\nimport Link from \"next/link\";\nimport { useRouter } from \"next/router\";\nimport { serialize } from \"next-mdx-remote/serialize\";\nimport { MDXRemote, type MDXRemoteSerializeResult } from \"next-mdx-remote\";\n\nimport remarkGfm from \"remark-gfm\";\nimport rehypeSlug from \"rehype-slug\";\nimport rehypeAutolinkHeadings from \"rehype-autolink-headings\";\n\nimport Layout from \"@/components/Layout\";\nimport mdxComponents from \"@/components/mdx-components\";\nimport {\n  assertContentlayerHasDocs,\n  getPublishedDocuments,\n  getDocHref,\n  getDocKind,\n  normalizeSlug,\n  resolveDocCoverImage,\n  getAccessLevel,\n  resolveDocDownloadUrl,\n} from \"@/lib/contentlayer-helper\";\n\n/* -------------------------------------------------------------------------- */\n/* PREMIUM COMPONENTS                                                         */\n/* -------------------------------------------------------------------------- */\n\ninterface ArticleHeroProps {\n  title: string;\n  subtitle?: string;\n  category: string;\n  date?: string | null;\n  readTime?: string | null;\n  coverImage?: string;\n  coverAspect?: \"book\" | \"wide\" | \"square\";\n  coverFit?: \"cover\" | \"contain\";\n}\n\nconst ArticleHero: React.FC<ArticleHeroProps> = ({\n  title,\n  subtitle,\n  category,\n  date,\n  readTime,\n  coverImage,\n}) => {\n  const [isVisible, setIsVisible] = React.useState(false);\n\n  React.useEffect(() => {\n    setIsVisible(true);\n  }, []);\n\n  const bg = coverImage || \"/assets/images/writing-desk.webp\";\n\n  return (\n    <section className=\"relative min-h-[70vh] overflow-hidden border-b border-[#2a2a2a]\">\n      <div className=\"absolute inset-0\">\n        {/* eslint-disable-next-line @next/next/no-img-element */}\n        <img\n          src={bg}\n          alt=\"\"\n          className=\"h-full w-full object-cover opacity-35\"\n        />\n        <div className=\"absolute inset-0 bg-gradient-to-b from-black/70 via-[#0a0a0a]/80 to-[#0a0a0a]\" />\n      </div>\n\n      <div className=\"relative mx-auto flex min-h-[70vh] max-w-4xl items-end px-4 pb-16 pt-28\">\n        <div\n          className={`transition-all duration-1000 ${\n            isVisible ? \"opacity-100 translate-y-0\" : \"opacity-0 translate-y-6\"\n          }`}\n        >\n          <div className=\"mb-4 inline-flex items-center gap-3\">\n            <span className=\"h-2 w-2 animate-pulse rounded-full bg-[#d4af37]\" />\n            <span className=\"text-xs tracking-[0.35em] uppercase text-[#d4af37]\">\n              {category}\n            </span>\n          </div>\n\n          <h1 className=\"font-serif text-3xl font-semibold leading-tight text-cream sm:text-5xl\">\n            {title}\n          </h1>\n\n          {subtitle ? (\n            <p className=\"mt-5 max-w-2xl text-base leading-relaxed text-[#ccc] sm:text-lg\">\n              {subtitle}\n            </p>\n          ) : null}\n\n          <div className=\"mt-6 flex flex-wrap items-center gap-x-4 gap-y-2 text-sm text-gray-400\">\n            {date ? (\n              <span>\n                {new Date(date).toLocaleDateString(\"en-GB\", {\n                  year: \"numeric\",\n                  month: \"long\",\n                  day: \"numeric\",\n                })}\n              </span>\n            ) : null}\n            {readTime ? <span>â€¢ {readTime}</span> : null}\n          </div>\n        </div>\n      </div>\n    </section>\n  );\n};\n\n/* -------------------------------------------------------------------------- */\n/* MAIN PAGE                                                                  */\n/* -------------------------------------------------------------------------- */\n\ntype PageMeta = {\n  slug?: string; // canonical root slug ONLY (single segment)\n  url?: string; // canonical href from contentlayer-helper\n  kind?: string;\n\n  title: string;\n  excerpt?: string | null;\n  description?: string | null;\n\n  category?: string | null;\n  tags?: string[] | null;\n\n  readTime?: string | number | null;\n  date?: string | null;\n\n  coverImage?: string | { src?: string } | null;\n  coverAspect?: \"book\" | \"wide\" | \"square\";\n  coverFit?: \"cover\" | \"contain\";\n\n  accessLevel?: string;\n  lockMessage?: string | null;\n\n  author?: string | null;\n\n  // Optional: useful for downloads/resources, etc.\n  downloadUrl?: string | null;\n\n  [key: string]: unknown;\n};\n\ntype PageProps = {\n  meta: PageMeta;\n  mdxSource: MDXRemoteSerializeResult;\n};\n\nconst SITE = \"https://www.abrahamoflondon.org\";\n\n/* -------------------------------------------------------------------------- */\n/* SLUG / ROUTE NORMALISATION                                                 */\n/* -------------------------------------------------------------------------- */\n\n/**\n * Canonicalise any incoming slug-like value into a \"single segment\" slug:\n * - strips domain\n * - strips query/hash\n * - keeps last segment if path was provided\n */\nfunction toCanonicalSingleSlug(input: unknown): string {\n  let s = String(input ?? \"\").trim();\n  if (!s) return \"\";\n\n  s = s.split(\"#\")[0]?.split(\"?\")[0] ?? s;\n  s = s.replace(/^https?:\\/\\/[^/]+/i, \"\");\n  s = s.toLowerCase();\n  s = s.replace(/\\/+$/, \"\");\n  s = s.replace(/^\\/+/, \"\");\n  if (!s) return \"\";\n\n  const parts = s.split(\"/\").filter(Boolean);\n  return parts.length ? parts[parts.length - 1] : s;\n}\n\nfunction isSingleSegmentHref(href: string): boolean {\n  const clean = String(href ?? \"\")\n    .trim()\n    .split(\"#\")[0]\n    ?.split(\"?\")[0]\n    ?.trim();\n  if (!clean) return false;\n\n  const withoutTrailing = clean.replace(/\\/+$/, \"\");\n  const parts = withoutTrailing.split(\"/\").filter(Boolean);\n  // \"/foo\" -> [\"foo\"] âœ…\n  // \"/blog/foo\" -> [\"blog\",\"foo\"] âŒ\n  return parts.length === 1;\n}\n\n/* -------------------------------------------------------------------------- */\n/* COMPONENT                                                                  */\n/* -------------------------------------------------------------------------- */\n\nfunction ContentPage({ meta, mdxSource }: PageProps): JSX.Element {\n  const router = useRouter();\n\n  const {\n    title,\n    description,\n    excerpt,\n    category,\n    tags,\n    date,\n    readTime,\n    coverImage,\n    coverAspect,\n    coverFit,\n    accessLevel,\n    lockMessage,\n    slug,\n    author,\n    url,\n    kind,\n  } = meta;\n\n  const [hasAccess, setHasAccess] = React.useState(false);\n  const [checkedAccess, setCheckedAccess] = React.useState(false);\n  const [isContentVisible, setIsContentVisible] = React.useState(false);\n\n  React.useEffect(() => {\n    setHasAccess(\n      typeof document !== \"undefined\" &&\n        document.cookie\n          .split(\";\")\n          .some((c) => c.trim().startsWith(\"innerCircleAccess=true\")),\n    );\n    setCheckedAccess(true);\n\n    const timer = window.setTimeout(() => setIsContentVisible(true), 300);\n    return () => window.clearTimeout(timer);\n  }, []);\n\n  const displaySubtitle = excerpt || description || undefined;\n  const primaryCategory =\n    category || (Array.isArray(tags) && tags.length > 0 ? String(tags[0]) : \"Content\");\n\n  const canonicalTitle = title || \"\";\n  const displayDescription = description || excerpt || \"\";\n  const effectiveSlug = slug || \"\";\n  const canonicalPath = (url && String(url).startsWith(\"/\")) ? String(url) : `/${effectiveSlug}`;\n  const canonicalUrl = `${SITE}${canonicalPath}`;\n\n  const isInnerCircle = accessLevel === \"inner-circle\";\n  const isLocked = isInnerCircle && (!checkedAccess || !hasAccess);\n\n  const returnToPath = canonicalPath;\n  const joinUrl = `/inner-circle?returnTo=${encodeURIComponent(returnToPath)}`;\n\n  const resolvedCoverImage =\n    typeof coverImage === \"string\" ? coverImage : coverImage?.src || undefined;\n\n  const structuredData = {\n    \"@context\": \"https://schema.org\",\n    \"@type\": kind === \"post\" ? \"Article\" : \"WebPage\",\n    headline: canonicalTitle,\n    description: displayDescription,\n    datePublished: date || new Date().toISOString(),\n    dateModified: date || new Date().toISOString(),\n    author: {\n      \"@type\": \"Person\",\n      name: author || \"Abraham of London\",\n      url: SITE,\n    },\n    publisher: {\n      \"@type\": \"Organization\",\n      name: \"Abraham of London\",\n    },\n    ...(resolvedCoverImage ? { image: resolvedCoverImage } : {}),\n  };\n\n  return (\n    <Layout\n      title={canonicalTitle}\n      description={displayDescription}\n      canonicalUrl={canonicalUrl}\n      ogImage={resolvedCoverImage}\n      ogType={kind === \"post\" ? \"article\" : \"website\"}\n      structuredData={structuredData}\n      keywords={Array.isArray(tags) ? tags : []}\n    >\n      <Head>\n        {resolvedCoverImage ? (\n          <>\n            <meta property=\"og:image:width\" content=\"1200\" />\n            <meta property=\"og:image:height\" content=\"630\" />\n          </>\n        ) : null}\n      </Head>\n\n      <ArticleHero\n        title={title}\n        subtitle={displaySubtitle}\n        category={primaryCategory}\n        date={date}\n        readTime={typeof readTime === \"number\" ? `${readTime} min read` : readTime ?? null}\n        coverImage={resolvedCoverImage}\n        coverAspect={coverAspect}\n        coverFit={coverFit}\n      />\n\n      {isInnerCircle ? (\n        <div\n          className={`mx-auto max-w-4xl px-4 pt-8 transition-all duration-1000 delay-300 ${\n            isContentVisible ? \"opacity-100 translate-y-0\" : \"opacity-0 translate-y-4\"\n          }`}\n        >\n          <div className=\"relative overflow-hidden rounded-xl border border-[#d4af37]/30 bg-gradient-to-r from-[#0a0a0a] via-[#1a1a1a] to-[#0a0a0a] p-6\">\n            <div className=\"absolute -right-8 -top-8 h-32 w-32 rounded-full bg-gradient-to-br from-[#d4af37]/10 to-transparent blur-2xl\" />\n            <div className=\"relative\">\n              <div className=\"mb-4 flex items-center gap-3\">\n                <div className=\"h-2 w-2 animate-pulse rounded-full bg-[#d4af37]\" />\n                <div className=\"text-sm uppercase tracking-widest text-[#d4af37]\">\n                  Inner Circle Structure\n                </div>\n              </div>\n\n              <p className=\"mb-6 leading-relaxed text-[#ccc]\">\n                {lockMessage ||\n                  \"This architectural framework is reserved for Inner Circle members. Unlock complete structural access.\"}\n              </p>\n\n              {!hasAccess ? (\n                <div className=\"flex flex-wrap items-center gap-4\">\n                  <Link\n                    href={joinUrl}\n                    className=\"group inline-flex items-center gap-2 rounded-lg bg-gradient-to-r from-[#d4af37] to-[#b8941f] px-6 py-3 text-sm font-medium text-black hover:opacity-90\"\n                  >\n                    <span>Access Structure</span>\n                    <span className=\"transition-transform group-hover:translate-x-1\">\n                      â†’\n                    </span>\n                  </Link>\n\n                  <Link\n                    href=\"/inner-circle\"\n                    className=\"text-sm text-[#999] transition-colors hover:text-[#d4af37]\"\n                  >\n                    Learn about Inner Circle\n                  </Link>\n                </div>\n              ) : null}\n            </div>\n          </div>\n        </div>\n      ) : null}\n\n      <main\n        className={`relative transition-all duration-1000 delay-500 ${\n          isContentVisible ? \"opacity-100 translate-y-0\" : \"opacity-0 translate-y-8\"\n        }`}\n      >\n        <div className=\"absolute inset-0 -z-10\">\n          <div className=\"absolute inset-0 bg-gradient-to-b from-transparent via-[#0a0a0a]/50 to-[#0a0a0a]\" />\n        </div>\n\n        <article className=\"mx-auto max-w-4xl px-4 pb-32 pt-16\">\n          <div className=\"relative\">\n            <div className=\"absolute bottom-0 left-0 top-0 hidden w-32 -translate-x-40 lg:block\">\n              <div className=\"sticky top-32\">\n                <div className=\"relative\">\n                  <div className=\"h-px w-24 bg-gradient-to-r from-transparent to-[#3a3a3a]/50\" />\n                  <div className=\"mt-4 text-xs text-[#666]\">Structural Depth</div>\n                  <div className=\"mt-2 h-48 w-px bg-gradient-to-b from-[#d4af37]/30 via-transparent to-transparent\" />\n                </div>\n              </div>\n            </div>\n\n            <div className=\"relative\">\n              {isInnerCircle && isLocked ? (\n                <div className=\"rounded-2xl border border-[#2a2a2a] bg-gradient-to-b from-[#1a1a1a] to-[#0a0a0a] p-12 text-center\">\n                  <div className=\"mb-6 text-6xl opacity-10\">ð“ƒ²</div>\n                  <h3 className=\"mb-6 text-2xl font-light\">\n                    Architectural Framework Locked\n                  </h3>\n                  <p className=\"mx-auto mb-8 max-w-md leading-relaxed text-[#999]\">\n                    This structural analysis requires Inner Circle access. Join to unlock\n                    the complete architectural framework.\n                  </p>\n                  <Link\n                    href={joinUrl}\n                    className=\"group inline-flex items-center gap-3 rounded-lg bg-gradient-to-r from-[#d4af37] to-[#b8941f] px-8 py-4 text-base font-medium text-black hover:opacity-90\"\n                  >\n                    <span>Unlock Structure</span>\n                    <span className=\"transition-transform group-hover:translate-x-2\">\n                      â† \n                    </span>\n                  </Link>\n                </div>\n              ) : (\n                <div\n                  className=\"prose prose-lg max-w-none\n                  prose-headings:font-light prose-headings:leading-tight\n                  prose-h1:text-4xl prose-h2:text-3xl prose-h3:text-2xl\n                  prose-p:text-[#ccc] prose-p:leading-relaxed prose-p:text-base\n                  prose-strong:text-[#fff] prose-strong:font-medium\n                  prose-a:text-[#d4af37] prose-a:no-underline hover:prose-a:underline\n                  prose-ul:text-[#ccc] prose-ol:text-[#ccc]\n                  prose-li:marker:text-[#d4af37]/50\n                  prose-blockquote:border-l-[#d4af37]/30 prose-blockquote:text-[#ccc] prose-blockquote:pl-6\n                  prose-hr:border-[#2a2a2a] prose-hr:my-12\n                  prose-img:rounded-xl prose-img:border prose-img:border-[#2a2a2a] prose-img:shadow-2xl\n                  prose-pre:bg-[#0a0a0a] prose-pre:border prose-pre:border-[#2a2a3a] prose-pre:rounded-xl prose-pre:shadow-lg\n                  prose-code:text-[#d4af37] prose-code:bg-[#1a1a1a] prose-code:px-1 prose-code:py-0.5 prose-code:rounded\n                  prose-table:text-[#ccc] prose-table:border prose-table:border-[#2a2a2a]\n                  prose-th:border-b prose-th:border-[#2a2a2a] prose-th:text-[#d4af37]\n                  prose-td:border-t prose-td:border-[#2a2a2a]\"\n                >\n                  <MDXRemote {...mdxSource} components={mdxComponents} />\n                </div>\n              )}\n            </div>\n\n            <div className=\"absolute bottom-0 right-0 top-0 hidden w-48 translate-x-48 xl:block\">\n              <div className=\"sticky top-32\">\n                {Array.isArray(tags) && tags.length > 0 ? (\n                  <div className=\"mb-8\">\n                    <div className=\"mb-3 text-xs uppercase tracking-widest text-[#666]\">\n                      Structural Tags\n                    </div>\n                    <div className=\"flex flex-wrap gap-2\">\n                      {tags.slice(0, 5).map((tag, index) => (\n                        <span\n                          key={index}\n                          className=\"rounded border border-[#2a2a2a] px-2 py-1 text-xs text-[#999]\"\n                        >\n                          {tag}\n                        </span>\n                      ))}\n                    </div>\n                  </div>\n                ) : null}\n\n                <div className=\"border-t border-[#2a2a2a] pt-8\">\n                  <div className=\"mb-3 text-xs uppercase tracking-widest text-[#666]\">\n                    Reading Progress\n                  </div>\n                  <div className=\"h-1 overflow-hidden rounded-full bg-[#2a2a2a]\">\n                    <div\n                      id=\"aol-reading-progress\"\n                      className=\"h-full rounded-full bg-gradient-to-r from-[#d4af37] to-[#b8941f]\"\n                      style={{ width: \"0%\" }}\n                    />\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </article>\n\n        <div className=\"border-t border-[#2a2a2a]\">\n          <div className=\"mx-auto max-w-4xl px-4 py-16\">\n            <div className=\"flex items-center justify-between\">\n              <Link\n                href=\"/content\"\n                className=\"group flex items-center gap-3 text-sm text-[#999] transition-colors hover:text-[#d4af37]\"\n              >\n                <span className=\"transition-transform group-hover:-translate-x-1\">\n                  â†\n                </span>\n                <span>Return to Collection</span>\n              </Link>\n\n              <div className=\"text-sm text-[#666]\">Structural Layer Complete</div>\n            </div>\n          </div>\n        </div>\n      </main>\n\n      <div className=\"pointer-events-none fixed inset-0 z-50\">\n        <div\n          className=\"absolute h-64 w-64 rounded-full bg-gradient-to-r from-[#d4af37]/5 to-transparent blur-3xl\"\n          style={{\n            transform: \"translate(var(--mouse-x), var(--mouse-y))\",\n            transition: \"transform 0.1s ease-out\",\n          }}\n        />\n      </div>\n\n      <script\n        // NOTE: This is intentionally inline (your current approach).\n        // Itâ€™s safe here because it uses only DOM APIs and does not interpolate user data.\n        dangerouslySetInnerHTML={{\n          __html: `\n            document.addEventListener('mousemove', (e) => {\n              document.documentElement.style.setProperty('--mouse-x', e.clientX + 'px');\n              document.documentElement.style.setProperty('--mouse-y', e.clientY + 'px');\n            });\n\n            window.addEventListener('scroll', () => {\n              const winScroll = document.body.scrollTop || document.documentElement.scrollTop;\n              const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;\n              const scrolled = height > 0 ? (winScroll / height) * 100 : 0;\n              const progressBar = document.getElementById('aol-reading-progress');\n              if (progressBar) {\n                progressBar.style.width = scrolled + '%';\n              }\n            });\n          `,\n        }}\n      />\n    </Layout>\n  );\n}\n\n/* -------------------------------------------------------------------------- */\n/* STATIC GENERATION - REAL FIX                                                */\n/* -------------------------------------------------------------------------- */\n\nexport const getStaticPaths: GetStaticPaths = async () => {\n  assertContentlayerHasDocs(\"pages/[slug].tsx getStaticPaths\");\n\n  // KEY FIX:\n  // This route MUST NOT generate /blog/*, /books/*, etc.\n  // It is only for root-level single-segment slugs like:\n  //   /fathering-without-fear\n  // NOT:\n  //   /blog/christianity-not-extremism\n  const docs = getPublishedDocuments();\n\n  const seen = new Set<string>();\n  const paths = docs\n    .map((doc) => {\n      const href = getDocHref(doc);\n      if (!href || !isSingleSegmentHref(href)) return null;\n\n      const s = toCanonicalSingleSlug(href);\n      if (!s) return null;\n\n      if (seen.has(s)) return null;\n      seen.add(s);\n\n      return { params: { slug: s } };\n    })\n    .filter(Boolean) as { params: { slug: string } }[];\n\n  return { paths, fallback: \"blocking\" };\n};\n\nexport const getStaticProps: GetStaticProps<PageProps> = async ({ params }) => {\n  assertContentlayerHasDocs(\"pages/[slug].tsx getStaticProps\");\n\n  const requested = toCanonicalSingleSlug(params?.slug);\n  if (!requested) return { notFound: true };\n\n  const docs = getPublishedDocuments();\n\n  // Find doc by canonical last-segment slug (stable across computed url/flattenedPath)\n  const found =\n    docs.find((d) => toCanonicalSingleSlug(normalizeSlug(d)) === requested) ??\n    docs.find((d) => toCanonicalSingleSlug(getDocHref(d)) === requested) ??\n    null;\n\n  if (!found) return { notFound: true };\n\n  const canonicalHref = getDocHref(found);\n\n  // If content actually belongs under a base route (/blog, /books, /downloads, etc.),\n  // DO NOT render it here. Permanently redirect to canonical.\n  if (!isSingleSegmentHref(canonicalHref)) {\n    return {\n      redirect: {\n        destination: canonicalHref,\n        permanent: true,\n      },\n    };\n  }\n\n  const kind = getDocKind(found);\n  const accessLevel = getAccessLevel(found);\n  const cover = resolveDocCoverImage(found);\n\n  const raw = String((found as any)?.body?.raw ?? \"\");\n  let mdxSource: MDXRemoteSerializeResult;\n\n  try {\n    mdxSource = await serialize(raw, {\n      mdxOptions: {\n        remarkPlugins: [remarkGfm],\n        rehypePlugins: [[rehypeSlug], [rehypeAutolinkHeadings, { behavior: \"wrap\" }]],\n      },\n    });\n  } catch (err) {\n    // Avoid build hard-fail on a single broken MDX document.\n    mdxSource = await serialize(\"Content is being prepared.\");\n  }\n\n  const meta: PageMeta = {\n    kind,\n    url: canonicalHref,\n    slug: requested,\n\n    title: String((found as any)?.title ?? \"Content\"),\n    description:\n      (typeof (found as any)?.description === \"string\" ? (found as any).description : null) ??\n      null,\n    excerpt: (typeof (found as any)?.excerpt === \"string\" ? (found as any).excerpt : null) ?? null,\n\n    category: (typeof (found as any)?.category === \"string\" ? (found as any).category : null) ?? null,\n    tags: Array.isArray((found as any)?.tags) ? (found as any).tags : null,\n\n    readTime:\n      (typeof (found as any)?.readTime === \"string\" ? (found as any).readTime : null) ??\n      (typeof (found as any)?.readingTime === \"string\" ? (found as any).readingTime : null) ??\n      null,\n\n    date: (found as any)?.date ? new Date((found as any).date).toISOString() : null,\n\n    coverImage: cover,\n\n    coverAspect: (found as any)?.coverAspect ?? undefined,\n    coverFit: (found as any)?.coverFit ?? undefined,\n\n    accessLevel,\n    lockMessage: (typeof (found as any)?.lockMessage === \"string\" ? (found as any).lockMessage : null) ?? null,\n\n    author: (typeof (found as any)?.author === \"string\" ? (found as any).author : null) ?? null,\n\n    downloadUrl: resolveDocDownloadUrl(found),\n  };\n\n  // Ensure JSON-safe props (Next export can be picky)\n  const safeMeta = JSON.parse(JSON.stringify(meta)) as PageMeta;\n\n  return {\n    props: {\n      meta: safeMeta,\n      mdxSource,\n    },\n    revalidate: 3600,\n  };\n};\n\nexport default ContentPage;","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\_app.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\_document.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\about.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\accessibility-statement.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\accessibility.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\admin\\inner-circle\\index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\api\\admin\\inner-circle\\export.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\api\\analytics\\downloads\\summary.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\api\\auth\\[...nextauth].ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\api\\contact.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\api\\debug-books.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\api\\dl\\[token].ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\api\\downloads\\[slug].ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\api\\health.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\api\\inner-circle\\admin\\cleanup.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\api\\inner-circle\\admin\\delete.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\api\\inner-circle\\admin\\revoke.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\api\\inner-circle\\admin\\stats.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\api\\inner-circle\\exit-preview.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\api\\inner-circle\\preview.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\api\\inner-circle\\register.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\api\\inner-circle\\resend.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\api\\inner-circle\\status.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\api\\inner-circle\\unlock.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\api\\inner-circle\\verify.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\api\\newsletter.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\api\\rate-limit\\stats.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\api\\shorts\\[slug]\\interactions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\api\\shorts\\[slug]\\like.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\api\\shorts\\[slug]\\save.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\api\\subscribe.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\api\\teaser.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\api\\verify-newsletter.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\auth\\signin.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":18,"column":43,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[791,871],"text":"\r\n              Use any email with password &quot;demo\" for development\r\n            "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[791,871],"text":"\r\n              Use any email with password &ldquo;demo\" for development\r\n            "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[791,871],"text":"\r\n              Use any email with password &#34;demo\" for development\r\n            "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[791,871],"text":"\r\n              Use any email with password &rdquo;demo\" for development\r\n            "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":18,"column":48,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[791,871],"text":"\r\n              Use any email with password \"demo&quot; for development\r\n            "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[791,871],"text":"\r\n              Use any email with password \"demo&ldquo; for development\r\n            "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[791,871],"text":"\r\n              Use any email with password \"demo&#34; for development\r\n            "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[791,871],"text":"\r\n              Use any email with password \"demo&rdquo; for development\r\n            "},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// pages/auth/signin.tsx\r\nimport { getServerSession } from \"next-auth/next\";\r\nimport { authOptions } from \"@/pages/api/auth/[...nextauth]\";\r\nimport { signIn } from \"next-auth/react\";\r\nimport { GetServerSideProps } from \"next\";\r\nimport Layout from \"@/components/Layout\";\r\n\r\nexport default function SignIn() {\r\n  return (\r\n    <Layout title=\"Sign In\">\r\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 py-12 px-4 sm:px-6 lg:px-8\">\r\n        <div className=\"max-w-md w-full space-y-8\">\r\n          <div>\r\n            <h2 className=\"mt-6 text-center text-3xl font-extrabold text-gray-900 dark:text-white\">\r\n              Sign in to your account\r\n            </h2>\r\n            <p className=\"mt-2 text-center text-sm text-gray-600 dark:text-gray-400\">\r\n              Use any email with password \"demo\" for development\r\n            </p>\r\n          </div>\r\n          <form className=\"mt-8 space-y-6\" onSubmit={(e) => {\r\n            e.preventDefault();\r\n            const formData = new FormData(e.target as HTMLFormElement);\r\n            signIn(\"credentials\", {\r\n              email: formData.get(\"email\"),\r\n              password: formData.get(\"password\"),\r\n              callbackUrl: \"/\",\r\n            });\r\n          }}>\r\n            <div className=\"rounded-md shadow-sm -space-y-px\">\r\n              <div>\r\n                <label htmlFor=\"email\" className=\"sr-only\">\r\n                  Email address\r\n                </label>\r\n                <input\r\n                  id=\"email\"\r\n                  name=\"email\"\r\n                  type=\"email\"\r\n                  autoComplete=\"email\"\r\n                  required\r\n                  className=\"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 dark:border-gray-700 placeholder-gray-500 dark:placeholder-gray-400 text-gray-900 dark:text-white rounded-t-md focus:outline-none focus:ring-amber-500 focus:border-amber-500 focus:z-10 sm:text-sm dark:bg-gray-800\"\r\n                  placeholder=\"Email address\"\r\n                />\r\n              </div>\r\n              <div>\r\n                <label htmlFor=\"password\" className=\"sr-only\">\r\n                  Password\r\n                </label>\r\n                <input\r\n                  id=\"password\"\r\n                  name=\"password\"\r\n                  type=\"password\"\r\n                  autoComplete=\"current-password\"\r\n                  required\r\n                  className=\"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 dark:border-gray-700 placeholder-gray-500 dark:placeholder-gray-400 text-gray-900 dark:text-white rounded-b-md focus:outline-none focus:ring-amber-500 focus:border-amber-500 focus:z-10 sm:text-sm dark:bg-gray-800\"\r\n                  placeholder=\"Password (use 'demo' for development)\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            <div>\r\n              <button\r\n                type=\"submit\"\r\n                className=\"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-amber-600 hover:bg-amber-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500\"\r\n              >\r\n                Sign in\r\n              </button>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </Layout>\r\n  );\r\n}\r\n\r\nexport const getServerSideProps: GetServerSideProps = async (context) => {\r\n  const session = await getServerSession(context.req, context.res, authOptions);\r\n\r\n  if (session) {\r\n    return {\r\n      redirect: {\r\n        destination: \"/\",\r\n        permanent: false,\r\n      },\r\n    };\r\n  }\r\n\r\n  return {\r\n    props: {},\r\n  };\r\n};","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\blog\\[slug].tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\blog\\index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\books\\[slug].tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\books\\index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\books\\the-architecture-of-human-purpose-landing.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":297,"column":41,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[15046,15334],"text":"\r\n                      This prelude doesn&apos;t present another layer of thinking â€” it reveals the bedrock \r\n                      beneath all meaningful thought. The architectural principles that govern purpose, \r\n                      civilisation, and human destiny.\r\n                    "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[15046,15334],"text":"\r\n                      This prelude doesn&lsquo;t present another layer of thinking â€” it reveals the bedrock \r\n                      beneath all meaningful thought. The architectural principles that govern purpose, \r\n                      civilisation, and human destiny.\r\n                    "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[15046,15334],"text":"\r\n                      This prelude doesn&#39;t present another layer of thinking â€” it reveals the bedrock \r\n                      beneath all meaningful thought. The architectural principles that govern purpose, \r\n                      civilisation, and human destiny.\r\n                    "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[15046,15334],"text":"\r\n                      This prelude doesn&rsquo;t present another layer of thinking â€” it reveals the bedrock \r\n                      beneath all meaningful thought. The architectural principles that govern purpose, \r\n                      civilisation, and human destiny.\r\n                    "},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":304,"column":25,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[15500,15701],"text":"\r\n                        &quot;Human flourishing is not accidental. It follows a design â€” \r\n                        an architecture that can be understood, applied, and built upon.\"\r\n                      "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[15500,15701],"text":"\r\n                        &ldquo;Human flourishing is not accidental. It follows a design â€” \r\n                        an architecture that can be understood, applied, and built upon.\"\r\n                      "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[15500,15701],"text":"\r\n                        &#34;Human flourishing is not accidental. It follows a design â€” \r\n                        an architecture that can be understood, applied, and built upon.\"\r\n                      "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[15500,15701],"text":"\r\n                        &rdquo;Human flourishing is not accidental. It follows a design â€” \r\n                        an architecture that can be understood, applied, and built upon.\"\r\n                      "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":305,"column":89,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[15500,15701],"text":"\r\n                        \"Human flourishing is not accidental. It follows a design â€” \r\n                        an architecture that can be understood, applied, and built upon.&quot;\r\n                      "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[15500,15701],"text":"\r\n                        \"Human flourishing is not accidental. It follows a design â€” \r\n                        an architecture that can be understood, applied, and built upon.&ldquo;\r\n                      "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[15500,15701],"text":"\r\n                        \"Human flourishing is not accidental. It follows a design â€” \r\n                        an architecture that can be understood, applied, and built upon.&#34;\r\n                      "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[15500,15701],"text":"\r\n                        \"Human flourishing is not accidental. It follows a design â€” \r\n                        an architecture that can be understood, applied, and built upon.&rdquo;\r\n                      "},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// pages/books/the-architecture-of-human-purpose-landing.tsx\r\nimport * as React from \"react\";\r\nimport type { NextPage } from \"next\";\r\nimport Head from \"next/head\";\r\nimport Link from \"next/link\";\r\nimport Image from \"next/image\";\r\nimport { useRouter } from \"next/router\";\r\n\r\nimport Layout from \"@/components/Layout\";\r\n\r\nconst PurposeLandingPage: NextPage = () => {\r\n  const router = useRouter();\r\n  const SITE_URL = process.env.NEXT_PUBLIC_SITE_URL ?? \"https://www.abrahamoflondon.org\";\r\n  const canonicalUrl = `${SITE_URL}${router.pathname}`;\r\n\r\n  // Animation states\r\n  const [isHeroVisible, setIsHeroVisible] = React.useState(false);\r\n  const [isContentVisible, setIsContentVisible] = React.useState(false);\r\n  const [mousePosition, setMousePosition] = React.useState({ x: 0, y: 0 });\r\n\r\n  React.useEffect(() => {\r\n    const timer1 = setTimeout(() => setIsHeroVisible(true), 100);\r\n    const timer2 = setTimeout(() => setIsContentVisible(true), 300);\r\n    \r\n    const handleMouseMove = (e: MouseEvent) => {\r\n      setMousePosition({ x: e.clientX, y: e.clientY });\r\n    };\r\n\r\n    window.addEventListener('mousemove', handleMouseMove);\r\n\r\n    // Smooth scroll for anchor links\r\n    const handleAnchorClick = (e: MouseEvent) => {\r\n      const target = e.target as HTMLElement;\r\n      const anchor = target.closest('a[href^=\"#\"]');\r\n      if (anchor) {\r\n        e.preventDefault();\r\n        const href = anchor.getAttribute('href');\r\n        if (href) {\r\n          const targetElement = document.querySelector(href);\r\n          if (targetElement) {\r\n            targetElement.scrollIntoView({\r\n              behavior: 'smooth',\r\n              block: 'start'\r\n            });\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    document.addEventListener('click', handleAnchorClick);\r\n\r\n    return () => {\r\n      clearTimeout(timer1);\r\n      clearTimeout(timer2);\r\n      window.removeEventListener('mousemove', handleMouseMove);\r\n      document.removeEventListener('click', handleAnchorClick);\r\n    };\r\n  }, []);\r\n\r\n  const structuredData = {\r\n    \"@context\": \"https://schema.org\",\r\n    \"@type\": \"Book\",\r\n    \"name\": \"The Architecture of Human Purpose\",\r\n    \"alternateName\": \"Volume Zero\",\r\n    \"author\": {\r\n      \"@type\": \"Organization\",\r\n      \"name\": \"Abraham of London\"\r\n    },\r\n    \"datePublished\": \"2024\",\r\n    \"bookEdition\": \"Prelude Edition\",\r\n    \"bookFormat\": \"https://schema.org/DigitalDocument\",\r\n    \"description\": \"Volume Zero of the Canon. The foundational architecture for purpose, civilisation, governance, and human destiny.\",\r\n    \"publisher\": \"Abraham of London\",\r\n    \"image\": `${SITE_URL}/assets/images/books/the-architecture-of-human-purpose.jpg`,\r\n    \"offers\": {\r\n      \"@type\": \"Offer\",\r\n      \"availability\": \"https://schema.org/InStock\",\r\n      \"price\": \"0\",\r\n      \"priceCurrency\": \"USD\"\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Layout \r\n      title=\"The Architecture of Human Purpose â€” Prelude\" \r\n      description=\"Volume Zero: The foundational scaffolding for purpose, civilisation, and human destiny. A limited-release prelude.\"\r\n      structuredData={structuredData}\r\n      ogType=\"book\"\r\n    >\r\n      <Head>\r\n        <title>The Architecture of Human Purpose â€” Prelude | Volume Zero</title>\r\n        <meta\r\n          name=\"description\"\r\n          content=\"Volume Zero of the Canon. The foundational architecture for purpose, civilisation, governance, and human destiny. Limited prelude release.\"\r\n        />\r\n        <link rel=\"canonical\" href={canonicalUrl} />\r\n        <meta name=\"theme-color\" content=\"#1a1a1a\" />\r\n\r\n        {/* Open Graph */}\r\n        <meta property=\"og:title\" content=\"The Architecture of Human Purpose â€” Volume Zero\" />\r\n        <meta property=\"og:description\" content=\"Human flourishing is not accidental. It is architectural. This prelude sketches the scaffolding behind purpose, civilisation, and destiny.\" />\r\n        <meta property=\"og:type\" content=\"book\" />\r\n        <meta property=\"og:url\" content={canonicalUrl} />\r\n        <meta property=\"og:image\" content={`${SITE_URL}/api/og/books/the-architecture-of-human-purpose`} />\r\n        <meta property=\"og:image:width\" content=\"1200\" />\r\n        <meta property=\"og:image:height\" content=\"630\" />\r\n\r\n        {/* Twitter */}\r\n        <meta name=\"twitter:card\" content=\"summary_large_image\" />\r\n        <meta name=\"twitter:site\" content=\"@abrahamoflondon\" />\r\n        <meta name=\"twitter:title\" content=\"The Architecture of Human Purpose â€” Volume Zero\" />\r\n        <meta name=\"twitter:description\" content=\"Volume Zero of the Canon. Limited prelude release.\" />\r\n        <meta name=\"twitter:image\" content={`${SITE_URL}/api/og/books/the-architecture-of-human-purpose`} />\r\n      </Head>\r\n\r\n      <main className=\"min-h-screen\">\r\n        {/* Background Canvas */}\r\n        <div className=\"fixed inset-0 -z-10 overflow-hidden\">\r\n          <div className=\"absolute inset-0 bg-[#0a0a0a]\" />\r\n          <div className=\"absolute inset-0\" \r\n            style={{\r\n              backgroundImage: `radial-gradient(circle at 20% 50%, rgba(120, 90, 40, 0.03) 0%, transparent 50%), \r\n                                radial-gradient(circle at 80% 20%, rgba(40, 40, 60, 0.05) 0%, transparent 50%)`\r\n            }}\r\n          />\r\n          {/* Subtle Grid */}\r\n          <div className=\"absolute inset-0 opacity-[0.02]\"\r\n            style={{\r\n              backgroundImage: `\r\n                linear-gradient(rgba(255,255,255,0.1) 1px, transparent 1px),\r\n                linear-gradient(90deg, rgba(255,255,255,0.1) 1px, transparent 1px)\r\n              `,\r\n              backgroundSize: '50px 50px'\r\n            }}\r\n          />\r\n        </div>\r\n\r\n        {/* Mouse trail effect */}\r\n        <div \r\n          className=\"fixed inset-0 pointer-events-none z-50\"\r\n          style={{\r\n            background: `radial-gradient(800px at ${mousePosition.x}px ${mousePosition.y}px, rgba(212, 175, 55, 0.05) 0%, transparent 80%)`,\r\n            transition: 'background 0.1s ease-out'\r\n          }}\r\n        />\r\n\r\n        {/* Hero Section - Volume Zero */}\r\n        <section className=\"relative min-h-[90vh] overflow-hidden\">\r\n          {/* Architectural Lines */}\r\n          <div className=\"absolute inset-0 pointer-events-none\">\r\n            <div className=\"absolute left-1/2 top-0 h-full w-px -translate-x-1/2 bg-gradient-to-b from-transparent via-[#3a3a3a]/30 to-transparent\" />\r\n            <div className=\"absolute top-1/2 left-0 right-0 h-px bg-gradient-to-r from-transparent via-[#3a3a3a]/20 to-transparent\" />\r\n          </div>\r\n\r\n          <div className={`relative mx-auto max-w-7xl px-4 pt-24 transition-all duration-1000 ${isHeroVisible ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-8'}`}>\r\n            <div className=\"grid lg:grid-cols-2 gap-12 items-center\">\r\n              {/* Left Column - Text */}\r\n              <div className=\"space-y-8\">\r\n                {/* Volume Badge */}\r\n                <div className=\"inline-flex items-center gap-3\">\r\n                  <div className=\"h-px w-12 bg-gradient-to-r from-transparent to-[#d4af37]/40\" />\r\n                  <div className=\"text-sm tracking-[0.3em] uppercase font-medium text-[#d4af37]/70\">\r\n                    Volume Zero Â· Prelude\r\n                  </div>\r\n                  <div className=\"h-px w-12 bg-gradient-to-l from-transparent to-[#d4af37]/40\" />\r\n                </div>\r\n\r\n                {/* Title */}\r\n                <div className=\"space-y-4\">\r\n                  <h1 className=\"text-5xl md:text-6xl lg:text-7xl font-light tracking-tight leading-[0.95]\">\r\n                    The Architecture\r\n                    <span className=\"block mt-4 text-[#d4af37] font-medium\">of Human Purpose</span>\r\n                  </h1>\r\n                  \r\n                  <div className=\"h-px w-24 bg-gradient-to-r from-[#d4af37]/50 via-[#d4af37]/30 to-transparent\" />\r\n                  \r\n                  <p className=\"text-lg text-[#999] leading-relaxed max-w-xl\">\r\n                    A limited-release prelude to the Canon. Not motivation, but scaffolding â€” \r\n                    the structural principles behind purpose, civilisation, governance, and destiny.\r\n                  </p>\r\n                </div>\r\n\r\n                {/* CTAs */}\r\n                <div className=\"flex flex-col sm:flex-row gap-4 pt-4\">\r\n                  <Link\r\n                    href=\"/books/the-architecture-of-human-purpose\"\r\n                    className=\"group relative overflow-hidden inline-flex items-center justify-center gap-3 px-8 py-4 text-base font-medium text-white transition-all duration-300 hover:scale-[1.02]\"\r\n                  >\r\n                    <div className=\"absolute inset-0 bg-gradient-to-r from-[#d4af37] to-[#b8941f] opacity-90 group-hover:opacity-100 transition-opacity\" />\r\n                    <div className=\"absolute inset-0 bg-gradient-to-r from-[#d4af37] to-[#b8941f] opacity-0 group-hover:opacity-100 blur-xl transition-opacity duration-500\" />\r\n                    <span className=\"relative\">Begin Reading</span>\r\n                    <span className=\"relative transition-transform duration-300 group-hover:translate-x-1\">â†’</span>\r\n                  </Link>\r\n\r\n                  <Link\r\n                    href=\"/inner-circle\"\r\n                    className=\"group relative overflow-hidden inline-flex items-center justify-center gap-3 px-8 py-4 text-base font-medium text-white border border-[#d4af37]/30 hover:border-[#d4af37]/60 transition-all duration-300 hover:scale-[1.02]\"\r\n                  >\r\n                    <div className=\"absolute inset-0 bg-gradient-to-r from-transparent via-[#d4af37]/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500\" />\r\n                    <span className=\"relative\">Inner Circle Access</span>\r\n                    <span className=\"relative text-[#d4af37]\">â†—</span>\r\n                  </Link>\r\n                </div>\r\n\r\n                {/* Stats */}\r\n                <div className=\"pt-8 border-t border-[#2a2a2a]\">\r\n                  <div className=\"flex gap-8 text-sm\">\r\n                    <div>\r\n                      <div className=\"text-[#d4af37] font-medium\">Volume 0</div>\r\n                      <div className=\"text-[#666] mt-1\">Canon Foundation</div>\r\n                    </div>\r\n                    <div>\r\n                      <div className=\"text-[#d4af37] font-medium\">Limited</div>\r\n                      <div className=\"text-[#666] mt-1\">Prelude Release</div>\r\n                    </div>\r\n                    <div>\r\n                      <div className=\"text-[#d4af37] font-medium\">Architectural</div>\r\n                      <div className=\"text-[#666] mt-1\">Framework</div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Right Column - Book Presentation */}\r\n              <div className=\"relative\">\r\n                {/* Floating Container */}\r\n                <div className=\"relative group\">\r\n                  {/* Glow Effect */}\r\n                  <div className=\"absolute -inset-8 bg-gradient-to-r from-[#d4af37]/10 via-transparent to-[#d4af37]/5 blur-3xl opacity-0 group-hover:opacity-50 transition-opacity duration-700\" />\r\n                  \r\n                  {/* Book Container */}\r\n                  <div className=\"relative bg-gradient-to-br from-[#1a1a1a] to-[#0a0a0a] border border-[#2a2a2a] rounded-2xl p-8 shadow-2xl transform transition-all duration-500 group-hover:scale-[1.01] group-hover:shadow-[0_40px_80px_rgba(212,175,55,0.1)]\">\r\n                    {/* Book Cover */}\r\n                    <div className=\"relative\">\r\n                      {/* Embossed Effect */}\r\n                      <div className=\"absolute -inset-4 bg-gradient-to-br from-[#d4af37]/5 via-transparent to-transparent rounded-xl blur-xl\" />\r\n                      \r\n                      <div className=\"relative w-full aspect-[3/4] rounded-xl border border-[#d4af37]/20 shadow-2xl overflow-hidden\">\r\n                        <Image\r\n                          src=\"/assets/images/books/the-architecture-of-human-purpose.jpg\"\r\n                          alt=\"The Architecture of Human Purpose â€” Volume Zero\"\r\n                          fill\r\n                          className=\"object-cover\"\r\n                          sizes=\"(max-width: 768px) 100vw, 50vw\"\r\n                          priority\r\n                        />\r\n                      </div>\r\n                      \r\n                      {/* Overlay Glint */}\r\n                      <div className=\"absolute inset-0 rounded-xl bg-gradient-to-br from-transparent via-transparent to-[#d4af37]/5 pointer-events-none\" />\r\n                    </div>\r\n                    \r\n                    {/* Status Indicator */}\r\n                    <div className=\"mt-6 flex items-center justify-center gap-3\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <div className=\"h-2 w-2 rounded-full bg-[#d4af37] animate-pulse\" />\r\n                        <span className=\"text-sm text-[#d4af37]/80\">Active Prelude</span>\r\n                      </div>\r\n                      <div className=\"h-px flex-1 bg-gradient-to-r from-transparent via-[#3a3a3a] to-transparent\" />\r\n                      <div className=\"text-xs text-[#666]\">Canon Shelf</div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Decorative Elements */}\r\n                  <div className=\"absolute -top-4 -right-4 w-24 h-24 border-t border-r border-[#d4af37]/20 rounded-tr-2xl\" />\r\n                  <div className=\"absolute -bottom-4 -left-4 w-24 h-24 border-b border-l border-[#d4af37]/20 rounded-bl-2xl\" />\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Scroll Indicator */}\r\n          <div className=\"absolute bottom-12 left-1/2 -translate-x-1/2\">\r\n            <div className=\"flex flex-col items-center gap-3\">\r\n              <div className=\"h-10 w-px bg-gradient-to-b from-[#d4af37]/50 to-transparent\" />\r\n              <span className=\"text-xs tracking-widest text-[#666] uppercase\">Explore</span>\r\n            </div>\r\n          </div>\r\n        </section>\r\n\r\n        {/* Content Architecture Section */}\r\n        <section className={`relative py-24 transition-all duration-1000 delay-300 ${isContentVisible ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-8'}`}>\r\n          <div className=\"absolute inset-0 bg-gradient-to-b from-transparent via-[#0a0a0a]/50 to-transparent\" />\r\n          \r\n          <div className=\"relative mx-auto max-w-6xl px-4\">\r\n            <div className=\"grid lg:grid-cols-2 gap-12\">\r\n              {/* Left - Core Proposition */}\r\n              <div className=\"space-y-8\">\r\n                <div>\r\n                  <h2 className=\"text-3xl md:text-4xl font-light mb-6\">\r\n                    The Foundation Before<br />\r\n                    <span className=\"text-[#d4af37]\">The Structure</span>\r\n                  </h2>\r\n                  \r\n                  <div className=\"space-y-6\">\r\n                    <p className=\"text-[#999] leading-relaxed\">\r\n                      This prelude doesn't present another layer of thinking â€” it reveals the bedrock \r\n                      beneath all meaningful thought. The architectural principles that govern purpose, \r\n                      civilisation, and human destiny.\r\n                    </p>\r\n                    \r\n                    <div className=\"relative pl-6 border-l border-[#d4af37]/20\">\r\n                      <p className=\"text-[#ccc] italic\">\r\n                        \"Human flourishing is not accidental. It follows a design â€” \r\n                        an architecture that can be understood, applied, and built upon.\"\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Key Principles */}\r\n                <div className=\"pt-8 border-t border-[#2a2a2a]\">\r\n                  <h3 className=\"text-sm tracking-widest uppercase text-[#d4af37]/70 mb-6\">Core Distinctions</h3>\r\n                  <div className=\"space-y-4\">\r\n                    {[\r\n                      { title: \"Calling\", desc: \"Beyond occupation into destiny\" },\r\n                      { title: \"Authority\", desc: \"The architecture of legitimate power\" },\r\n                      { title: \"Covenant\", desc: \"Structural bonds over contractual\" },\r\n                      { title: \"Time\", desc: \"Not just chronology but kairos\" }\r\n                    ].map((item, index) => (\r\n                      <div key={index} className=\"flex items-start gap-4 group\">\r\n                        <div className=\"w-8 h-8 rounded-full border border-[#d4af37]/30 flex items-center justify-center flex-shrink-0 group-hover:border-[#d4af37]/60 transition-colors\">\r\n                          <div className=\"w-2 h-2 rounded-full bg-[#d4af37]\" />\r\n                        </div>\r\n                        <div>\r\n                          <div className=\"font-medium text-white group-hover:text-[#d4af37] transition-colors\">\r\n                            {item.title}\r\n                          </div>\r\n                          <div className=\"text-sm text-[#666] mt-1\">\r\n                            {item.desc}\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Right - Detail Panel */}\r\n              <div className=\"space-y-8\">\r\n                {/* Insight Panel */}\r\n                <div className=\"relative bg-gradient-to-b from-[#1a1a1a] to-[#0a0a0a] border border-[#2a2a2a] rounded-2xl p-8\">\r\n                  <div className=\"absolute -top-3 left-8 px-4 py-1 bg-[#0a0a0a] border border-[#2a2a2a] rounded-lg\">\r\n                    <span className=\"text-xs tracking-widest text-[#d4af37]/70\">Inside Volume Zero</span>\r\n                  </div>\r\n                  \r\n                  <div className=\"pt-4 space-y-6\">\r\n                    {[\r\n                      \"Why purpose cannot exist in isolation from civilisation and covenant structures\",\r\n                      \"The critical difference between calling, assignment, and occupation\",\r\n                      \"How time, authority, and responsibility architect destiny more than talent alone\",\r\n                      \"Why fatherhood and stewardship form the load-bearing walls of culture\"\r\n                    ].map((item, index) => (\r\n                      <div key={index} className=\"flex items-start gap-4 group cursor-pointer\">\r\n                        <div className=\"w-6 h-6 rounded-full border border-[#3a3a3a] flex items-center justify-center flex-shrink-0 group-hover:border-[#d4af37]/50 transition-colors\">\r\n                          <div className=\"w-1.5 h-1.5 rounded-full bg-[#666] group-hover:bg-[#d4af37] transition-colors\" />\r\n                        </div>\r\n                        <p className=\"text-[#ccc] leading-relaxed group-hover:text-white transition-colors\">\r\n                          {item}\r\n                        </p>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                  \r\n                  <div className=\"pt-6 mt-6 border-t border-[#2a2a2a]\">\r\n                    <p className=\"text-sm text-[#666]\">\r\n                      Written for those who build â€” fathers, founders, stewards â€” \r\n                      who require not inspiration, but an architectural framework for a fragmenting world.\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Progress Indicator */}\r\n                <div className=\"relative\">\r\n                  <div className=\"flex items-center justify-between text-sm text-[#666] mb-2\">\r\n                    <span>Prelude Status</span>\r\n                    <span>Volume Zero</span>\r\n                  </div>\r\n                  <div className=\"h-1 bg-[#2a2a2a] rounded-full overflow-hidden\">\r\n                    <div \r\n                      className=\"h-full bg-gradient-to-r from-[#d4af37] to-[#b8941f] rounded-full\"\r\n                      style={{ width: '100%' }}\r\n                    />\r\n                  </div>\r\n                  <div className=\"flex justify-between text-xs text-[#666] mt-2\">\r\n                    <span>Architecture</span>\r\n                    <span>Complete</span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </section>\r\n\r\n        {/* Final CTA - Immersive */}\r\n        <section className=\"relative py-32 overflow-hidden\">\r\n          {/* Background Pattern */}\r\n          <div className=\"absolute inset-0\">\r\n            <div className=\"absolute inset-0 bg-[linear-gradient(45deg,transparent_48%,#1a1a1a_48%,#1a1a1a_52%,transparent_52%)] bg-[length:40px_40px] opacity-5\" />\r\n            <div className=\"absolute inset-0 bg-gradient-to-t from-[#0a0a0a] via-transparent to-transparent\" />\r\n          </div>\r\n          \r\n          <div className=\"relative mx-auto max-w-4xl px-4 text-center\">\r\n            <div className=\"inline-block mb-8\">\r\n              <div className=\"text-6xl opacity-10\">âˆž</div>\r\n            </div>\r\n            \r\n            <h2 className=\"text-3xl md:text-4xl font-light mb-6 text-white\">\r\n              The Prelude Awaits\r\n            </h2>\r\n            \r\n            <p className=\"text-[#999] leading-relaxed max-w-2xl mx-auto mb-12\">\r\n              Volume Zero of the Canon. Begin with the architectural principles, \r\n              then track the unfolding structure as subsequent volumes are released.\r\n            </p>\r\n            \r\n            <div className=\"flex flex-col sm:flex-row gap-4 justify-center\">\r\n              <Link\r\n                href=\"/books/the-architecture-of-human-purpose\"\r\n                className=\"group relative overflow-hidden inline-flex items-center justify-center gap-3 px-10 py-5 text-lg font-medium text-white transition-all duration-500 hover:scale-[1.02]\"\r\n              >\r\n                <div className=\"absolute inset-0 bg-gradient-to-r from-[#d4af37] to-[#b8941f]\" />\r\n                <div className=\"absolute inset-0 bg-gradient-to-r from-[#d4af37] to-[#b8941f] opacity-0 group-hover:opacity-100 blur-xl transition-opacity duration-500\" />\r\n                <span className=\"relative\">Enter Volume Zero</span>\r\n                <span className=\"relative transition-transform duration-300 group-hover:translate-x-2\">â† </span>\r\n              </Link>\r\n              \r\n              <Link\r\n                href=\"/content\"\r\n                className=\"group relative overflow-hidden inline-flex items-center justify-center gap-3 px-10 py-5 text-lg font-medium text-white border border-[#3a3a3a] hover:border-[#d4af37]/40 transition-all duration-300 hover:scale-[1.02]\"\r\n              >\r\n                <div className=\"absolute inset-0 bg-gradient-to-r from-transparent via-[#1a1a1a] to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500\" />\r\n                <span className=\"relative\">Explore the Canon</span>\r\n                <span className=\"relative text-[#d4af37] transition-transform duration-300 group-hover:translate-x-2\">â†’</span>\r\n              </Link>\r\n            </div>\r\n            \r\n            {/* Microcopy */}\r\n            <p className=\"mt-8 text-sm text-[#666]\">\r\n              This is where structural thinking begins â€” before application, before execution, \r\n              before legacy. The foundation.\r\n            </p>\r\n          </div>\r\n        </section>\r\n      </main>\r\n    </Layout>\r\n  );\r\n};\r\n\r\nexport default PurposeLandingPage;","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\brands\\index.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":213,"column":51,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[8223,8418],"text":"\n                Have a vision for a movement that aligns with our values of\n                faith, fatherhood, and legacy? Let&apos;s explore how we can build\n                together.\n              "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[8223,8418],"text":"\n                Have a vision for a movement that aligns with our values of\n                faith, fatherhood, and legacy? Let&lsquo;s explore how we can build\n                together.\n              "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[8223,8418],"text":"\n                Have a vision for a movement that aligns with our values of\n                faith, fatherhood, and legacy? Let&#39;s explore how we can build\n                together.\n              "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[8223,8418],"text":"\n                Have a vision for a movement that aligns with our values of\n                faith, fatherhood, and legacy? Let&rsquo;s explore how we can build\n                together.\n              "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// pages/brands/index.tsx - FIXED\nimport * as React from \"react\";\nimport Head from \"next/head\";\nimport Link from \"next/link\";\nimport { motion } from \"framer-motion\";\nimport {\n  Users,\n  Shield,\n  Target,\n  ArrowRight,\n  Star,\n  Zap,\n  Heart,\n} from \"lucide-react\";\nimport Layout from \"@/components/Layout\";\nimport { getPageTitle } from '@/lib/imports';\n\ninterface Brand {\n  id: string;\n  title: string;\n  description: string;\n  href: string;\n  status: \"active\" | \"building\" | \"legacy\";\n  foundingYear: number;\n  focus: string[];\n  icon: React.ReactNode;\n  color: string;\n  cta: string;\n}\n\nexport default function BrandsIndex() {\n  const pageTitle = \"Brands & Movements\";\n\n  const brands: Brand[] = [\n    {\n      id: \"fathering-without-fear\",\n      title: \"Fathering Without Fear\",\n      description:\n        \"A movement for men committed to intentional fatherhood, courageous love, and multi-generational legacy. We provide frameworks, communities, and resources for fathers who refuse to outsource their responsibility.\",\n      href: \"/brands/fathering-without-fear\",\n      status: \"active\",\n      foundingYear: 2020,\n      focus: [\"Fatherhood\", \"Legacy\", \"Family Leadership\"],\n      icon: <Shield className=\"h-8 w-8\" />,\n      color: \"from-blue-600/20 to-cyan-400/10\",\n      cta: \"Join the Movement\",\n    },\n    {\n      id: \"brotherhood-covenant\",\n      title: \"Brotherhood Covenant\",\n      description:\n        \"Structured circles of men committed to sharpening, accountability, and honour â€“ not just casual friendship. We build brotherhoods that last through seasons of challenge and celebration.\",\n      href: \"/brands/brotherhood-covenant\",\n      status: \"active\",\n      foundingYear: 2021,\n      focus: [\"Brotherhood\", \"Accountability\", \"Spiritual Growth\"],\n      icon: <Users className=\"h-8 w-8\" />,\n      color: \"from-emerald-600/20 to-green-400/10\",\n      cta: \"Explore Brotherhood\",\n    },\n    {\n      id: \"legacy-builders\",\n      title: \"Legacy Builders\",\n      description:\n        \"For founders and leaders building beyond their lifetime. We provide strategic frameworks for legacy planning, succession, and creating organizations that outlive their founders.\",\n      href: \"/brands/legacy-builders\",\n      status: \"building\",\n      foundingYear: 2023,\n      focus: [\"Legacy Planning\", \"Succession\", \"Multi-generational Impact\"],\n      icon: <Target className=\"h-8 w-8\" />,\n      color: \"from-purple-600/20 to-pink-400/10\",\n      cta: \"Build Legacy\",\n    },\n  ];\n\n  const activeBrands = brands.filter((brand) => brand.status === \"active\");\n  const buildingBrands = brands.filter((brand) => brand.status === \"building\");\n\n  return (\n    <Layout title={pageTitle}>\n      <Head>\n        <title>{getPageTitle(pageTitle)}</title>\n        <meta\n          name=\"description\"\n          content=\"Strategic brands and movements under the Abraham of London umbrella. From fatherhood to brotherhood to legacy building, each movement carries a distinct mission.\"\n        />\n      </Head>\n\n      <div className=\"min-h-screen bg-gradient-to-b from-charcoal to-black\">\n        {/* Hero Section */}\n        <section className=\"relative overflow-hidden border-b border-gold/20\">\n          <div className=\"absolute inset-0 bg-gradient-to-br from-gold/5 via-transparent to-amber-200/5\" />\n          <div className=\"relative mx-auto max-w-6xl px-4 py-16 sm:px-6 lg:px-8\">\n            <motion.div\n              className=\"text-center\"\n              initial={{ opacity: 0, y: 20 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ duration: 0.7 }}\n            >\n              <motion.p\n                className=\"text-xs font-semibold uppercase tracking-[0.25em] text-gold/70 mb-4\"\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                transition={{ delay: 0.2 }}\n              >\n                Strategic Movements\n              </motion.p>\n              <motion.h1\n                className=\"font-serif text-4xl font-bold text-cream sm:text-5xl lg:text-6xl mb-6\"\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ delay: 0.3 }}\n              >\n                Brands & Movements\n              </motion.h1>\n              <motion.p\n                className=\"mx-auto max-w-2xl text-lg text-gold/70 leading-relaxed\"\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                transition={{ delay: 0.4 }}\n              >\n                Expressions of a single conviction: men who lead, love, and\n                build with fear of God and respect for legacy. Each movement\n                carries a distinct mission.\n              </motion.p>\n            </motion.div>\n          </div>\n        </section>\n\n        {/* Active Brands */}\n        <section className=\"py-16\">\n          <div className=\"mx-auto max-w-6xl px-4 sm:px-6 lg:px-8\">\n            <motion.div\n              className=\"mb-12 text-center\"\n              initial={{ opacity: 0, y: 20 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ duration: 0.6 }}\n            >\n              <div className=\"inline-flex items-center gap-2 rounded-full bg-gold/10 px-4 py-2 text-sm font-semibold text-gold mb-4\">\n                <Star className=\"h-4 w-4\" />\n                Established Movements\n              </div>\n              <h2 className=\"font-serif text-3xl font-bold text-cream mb-4\">\n                Active Brands\n              </h2>\n              <p className=\"text-gold/70 max-w-2xl mx-auto\">\n                These movements have matured through years of refinement and\n                community building. Each represents a pillar of the Abraham of\n                London vision.\n              </p>\n            </motion.div>\n\n            <div className=\"grid gap-8 md:grid-cols-2\">\n              {activeBrands.map((brand, index) => (\n                <BrandCard key={brand.id} brand={brand} index={index} />\n              ))}\n            </div>\n          </div>\n        </section>\n\n        {/* Building Brands */}\n        {buildingBrands.length > 0 && (\n          <section className=\"py-16 border-t border-gold/20\">\n            <div className=\"mx-auto max-w-6xl px-4 sm:px-6 lg:px-8\">\n              <motion.div\n                className=\"mb-12 text-center\"\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ duration: 0.6 }}\n              >\n                <div className=\"inline-flex items-center gap-2 rounded-full bg-gold/10 px-4 py-2 text-sm font-semibold text-gold mb-4\">\n                  <Zap className=\"h-4 w-4\" />\n                  In Development\n                </div>\n                <h2 className=\"font-serif text-3xl font-bold text-cream mb-4\">\n                  Building Phase\n                </h2>\n                <p className=\"text-gold/70 max-w-2xl mx-auto\">\n                  These movements are currently being developed and refined.\n                  Early access and founding member opportunities may be\n                  available.\n                </p>\n              </motion.div>\n\n              <div className=\"grid gap-8 md:grid-cols-2 lg:grid-cols-3\">\n                {buildingBrands.map((brand, index) => (\n                  <BrandCard\n                    key={brand.id}\n                    brand={brand}\n                    index={index}\n                    isBuilding={true}\n                  />\n                ))}\n              </div>\n            </div>\n          </section>\n        )}\n\n        {/* CTA Section */}\n        <section className=\"py-16 border-t border-gold/20\">\n          <div className=\"mx-auto max-w-4xl px-4 sm:px-6 lg:px-8 text-center\">\n            <motion.div\n              className=\"rounded-2xl border border-gold/20 bg-gradient-to-br from-gold/5 to-gold/10 p-12\"\n              initial={{ opacity: 0, y: 20 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ duration: 0.6 }}\n            >\n              <h2 className=\"font-serif text-3xl font-bold text-cream mb-4\">\n                Start Your Own Movement\n              </h2>\n              <p className=\"text-gold/70 mb-8 max-w-2xl mx-auto text-lg leading-relaxed\">\n                Have a vision for a movement that aligns with our values of\n                faith, fatherhood, and legacy? Let's explore how we can build\n                together.\n              </p>\n              <div className=\"flex flex-wrap justify-center gap-4\">\n                <Link\n                  href=\"/contact\"\n                  className=\"inline-flex items-center gap-3 rounded-xl bg-gold px-8 py-4 font-semibold text-charcoal transition-all hover:bg-amber-200\"\n                >\n                  <Heart className=\"h-5 w-5\" />\n                  Discuss Partnership\n                </Link>\n                <Link\n                  href=\"/ventures\"\n                  className=\"inline-flex items-center gap-3 rounded-xl border border-gold px-8 py-4 font-semibold text-gold transition-all hover:bg-gold/10\"\n                >\n                  <ArrowRight className=\"h-5 w-5\" />\n                  Explore Ventures\n                </Link>\n              </div>\n            </motion.div>\n          </div>\n        </section>\n\n        {/* Values Section */}\n        <section className=\"py-16 border-t border-gold/20\">\n          <div className=\"mx-auto max-w-6xl px-4 sm:px-6 lg:px-8\">\n            <motion.div\n              className=\"text-center mb-12\"\n              initial={{ opacity: 0, y: 20 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ duration: 0.6 }}\n            >\n              <h2 className=\"font-serif text-3xl font-bold text-cream mb-4\">\n                Our Movement DNA\n              </h2>\n              <p className=\"text-gold/70 max-w-2xl mx-auto\">\n                Every brand under the Abraham of London umbrella shares these\n                core principles that define our approach and distinguish our\n                impact.\n              </p>\n            </motion.div>\n\n            <div className=\"grid gap-8 md:grid-cols-3\">\n              {[\n                {\n                  icon: <Shield className=\"h-8 w-8\" />,\n                  title: \"Faith-Rooted\",\n                  description:\n                    \"Built on biblical principles and spiritual foundation, not just business models or trends.\",\n                },\n                {\n                  icon: <Users className=\"h-8 w-8\" />,\n                  title: \"Community-Focused\",\n                  description:\n                    \"Designed to build genuine connection and accountability, not just audiences or customers.\",\n                },\n                {\n                  icon: <Target className=\"h-8 w-8\" />,\n                  title: \"Legacy-Minded\",\n                  description:\n                    \"Focused on multi-generational impact and sustainable transformation, not quick wins.\",\n                },\n              ].map((value, index) => (\n                <motion.div\n                  key={value.title}\n                  className=\"text-center p-6\"\n                  initial={{ opacity: 0, y: 20 }}\n                  animate={{ opacity: 1, y: 0 }}\n                  transition={{ duration: 0.6, delay: index * 0.1 }}\n                >\n                  <div className=\"inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-gold/10 text-gold mb-4\">\n                    {value.icon}\n                  </div>\n                  <h3 className=\"font-serif text-xl font-semibold text-cream mb-3\">\n                    {value.title}\n                  </h3>\n                  <p className=\"text-gold/70 text-sm leading-relaxed\">\n                    {value.description}\n                  </p>\n                </motion.div>\n              ))}\n            </div>\n          </div>\n        </section>\n      </div>\n    </Layout>\n  );\n}\n\n// Brand Card Component\nfunction BrandCard({\n  brand,\n  index,\n  isBuilding = false,\n}: {\n  brand: Brand;\n  index: number;\n  isBuilding?: boolean;\n}) {\n  return (\n    <motion.article\n      className=\"group overflow-hidden rounded-2xl border border-gold/20 bg-charcoal/60 backdrop-blur-sm transition-all hover:border-gold/40 hover:bg-charcoal/70\"\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ duration: 0.6, delay: index * 0.1 }}\n      whileHover={{ y: -5 }}\n    >\n      <Link href={brand.href} className=\"block h-full\">\n        <div className={`h-2 bg-gradient-to-r ${brand.color}`} />\n\n        <div className=\"p-6\">\n          {/* Header */}\n          <div className=\"flex items-start justify-between mb-4\">\n            <div className=\"flex items-center gap-3\">\n              <div\n                className={`rounded-xl p-3 bg-gradient-to-br ${brand.color} text-gold`}\n              >\n                {brand.icon}\n              </div>\n              <div>\n                <h3 className=\"font-serif text-xl font-semibold text-cream group-hover:text-gold transition-colors\">\n                  {brand.title}\n                </h3>\n                <div className=\"flex items-center gap-2 mt-1\">\n                  <span className=\"text-xs font-medium text-gold/70\">\n                    Since {brand.foundingYear}\n                  </span>\n                  {isBuilding && (\n                    <span className=\"rounded-full bg-gold/20 px-2 py-1 text-xs font-semibold text-gold\">\n                      Building\n                    </span>\n                  )}\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* Description */}\n          <p className=\"text-gold/70 text-sm leading-relaxed mb-4 line-clamp-3\">\n            {brand.description}\n          </p>\n\n          {/* Focus Areas */}\n          <div className=\"mb-6\">\n            <p className=\"text-xs font-semibold uppercase tracking-wider text-gold/60 mb-2\">\n              Focus Areas\n            </p>\n            <div className=\"flex flex-wrap gap-2\">\n              {brand.focus.map((area) => (\n                <span\n                  key={area}\n                  className=\"rounded-full bg-gold/10 px-3 py-1 text-xs font-medium text-gold\"\n                >\n                  {area}\n                </span>\n              ))}\n            </div>\n          </div>\n\n          {/* CTA */}\n          <div className=\"flex items-center justify-between pt-4 border-t border-gold/20\">\n            <span className=\"text-sm font-semibold text-gold group-hover:underline flex items-center gap-2\">\n              {brand.cta}\n              <ArrowRight className=\"h-4 w-4 transition-transform group-hover:translate-x-1\" />\n            </span>\n            <span className=\"text-xs text-gold/50\">\n              {isBuilding ? \"Early Access\" : \"Join Now\"}\n            </span>\n          </div>\n        </div>\n      </Link>\n    </motion.article>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\canon-campaign\\index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\canon.page-disabled.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\canon\\[slug].tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\canon\\index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\chatham-rooms\\index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\consulting\\index.tsx","messages":[{"ruleId":null,"fatal":true,"severity":2,"message":"Parsing error: Expression expected.","line":107,"column":40,"nodeType":null}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\nimport Link from \"next/link\";\nimport { motion } from \"framer-motion\";\nimport { ArrowRight, CheckCircle, Users, Target, Globe, ShieldCheck } from \"lucide-react\";\n\nimport Layout from \"@/components/Layout\";\nimport MandateStatement from \"@/components/MandateStatement\";\nimport StrategicFunnelStrip from \"@/components/homepage/StrategicFunnelStrip\";\n\nexport default function ConsultingPage(): JSX.Element {\n  return (\n    <Layout\n      title=\"Advisory & Strategy\"\n      description=\"Strategic counsel for founders and boards who refuse to outsource responsibility.\"\n      className=\"bg-black text-cream\"\n    >\n      {/* Hero Section */}\n      <section className=\"relative overflow-hidden border-b border-gold/10 bg-gradient-to-b from-black via-zinc-950 to-black pt-24 pb-16 lg:pt-32 lg:pb-24\">\n        <div className=\"absolute inset-0 bg-[url('/assets/images/texture-grain.png')] opacity-20 mix-blend-overlay\" />\n        \n        <div className=\"relative mx-auto max-w-6xl px-6 lg:px-8\">\n          <motion.header\n            className=\"max-w-3xl\"\n            initial={{ opacity: 0, y: 30 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ duration: 0.8, ease: \"easeOut\" }}\n          >\n            <p className=\"text-[10px] font-bold uppercase tracking-[0.4em] text-gold\">\n              Private Advisory\n            </p>\n\n            <h1 className=\"mt-6 font-serif text-4xl font-semibold leading-tight text-white sm:text-5xl lg:text-6xl\">\n              Strategy for those who \n              <span className=\"block text-gold/90\">carry the weight.</span>\n            </h1>\n\n            <p className=\"mt-8 text-lg leading-relaxed text-gray-400 sm:text-xl\">\n              I work with leaders who refuse to outsource responsibility â€” founders, boards, and builders \n              who carry weight for families, organisations, and nations. The work sits at the intersection \n              of high-stakes strategy and personal character.\n            </p>\n\n            <div className=\"mt-10 flex flex-col gap-4 sm:flex-row sm:items-center\">\n              <Link\n                href=\"/contact\"\n                className=\"group relative inline-flex items-center justify-center overflow-hidden rounded-xl bg-gold px-8 py-4 text-sm font-bold uppercase tracking-widest text-black transition-all hover:bg-gold/80\"\n              >\n                Request Consultation\n                <ArrowRight className=\"ml-2 h-4 w-4 transition-transform group-hover:translate-x-1\" />\n              </Link>\n\n              <Link\n                href=\"/events\"\n                className=\"inline-flex items-center justify-center rounded-xl border border-white/10 bg-white/5 px-8 py-4 text-sm font-bold uppercase tracking-widest text-cream transition-colors hover:bg-white/10\"\n              >\n                View Salons\n              </Link>\n            </div>\n          </motion.header>\n        </div>\n      </section>\n\n      {/* Mandate + Strategic Funnel */}\n      <section className=\"bg-black py-16 lg:py-24\">\n        <div className=\"mx-auto max-w-6xl px-6 lg:px-8\">\n          <MandateStatement />\n        </div>\n        <div className=\"mt-16\">\n           <StrategicFunnelStrip />\n        </div>\n      </section>\n\n      {/* Service Pillars */}\n      <section className=\"relative bg-zinc-950 py-20 lg:py-32\">\n        <div className=\"mx-auto max-w-6xl px-6 lg:px-8\">\n          <div className=\"mb-16 max-w-2xl\">\n            <h2 className=\"font-serif text-3xl font-semibold text-white sm:text-4xl\">Areas of Engagement</h2>\n            <p className=\"mt-4 text-gray-400\">Formal advisory focused on consequence, culture, and long-term legitimacy.</p>\n          </div>\n\n          <motion.div\n            className=\"grid gap-8 lg:grid-cols-3\"\n            initial={{ opacity: 0, y: 20 }}\n            whileInView={{ opacity: 1, y: 0 }}\n            transition={{ duration: 0.6 }}\n            viewport={{ once: true }}\n          >\n            {[\n              {\n                icon: Users,\n                title: \"Board & Executive Strategy\",\n                description: \"Deep support for C-suite and boards on governance and execution with an eye on multi-generational impact.\",\n                points: [\"Scenario thinking & clarification\", \"Board-level challenge (not flattery)\", \"Political & stakeholder mapping\"],\n              },\n              {\n                icon: Target,\n                title: \"Founder Advisory\",\n                description: \"One-to-one confidential support for decision makers navigating crises or scaling significant mandates.\",\n                points: [\"Confidential sounding board\", \"Decision frameworks\", \"Escalation discipline\"],\n              },\n              {\n                icon: Globe,\n                title: \"Frontier Market Strategy\",\n                description: \"Specialist advisory for operators engaging Nigeria and wider Africa with honest context on risk and reality.\",\n                points: [\"Partnership & Entry strategy\", \"Stakeholder navigation\", \"Execution discipline\"],\n              },\n            items.map((item, _index) => ...)\n              <div\n                key={service.title}\n                className=\"group rounded-2xl border border-white/5 bg-white/[0.02] p-8 transition-all hover:border-gold/30 hover:bg-white/[0.04]\"\n              >\n                <service.icon className=\"mb-6 h-10 w-10 text-gold/80\" />\n                <h3 className=\"mb-4 font-serif text-xl font-semibold text-cream group-hover:text-gold transition-colors\">\n                  {service.title}\n                </h3>\n                <p className=\"mb-8 text-sm leading-relaxed text-gray-400\">\n                  {service.description}\n                </p>\n                <ul className=\"space-y-3\">\n                  {service.points.map((point, idx) => (\n                    <li key={idx} className=\"flex items-start gap-3 text-xs text-gray-300\">\n                      <CheckCircle className=\"mt-0.5 h-3.5 w-3.5 flex-shrink-0 text-gold/60\" />\n                      <span>{point}</span>\n                    </li>\n                  ))}\n                </ul>\n              </div>\n            ))}\n          </motion.div>\n        </div>\n      </section>\n\n      {/* Methodology & Qualification */}\n      <section className=\"bg-black py-20 lg:py-32\">\n        <div className=\"mx-auto max-w-6xl px-6 lg:px-8\">\n          <div className=\"grid gap-16 lg:grid-cols-2\">\n            <div>\n              <h2 className=\"font-serif text-3xl font-semibold text-white\">How I Work</h2>\n              <p className=\"mt-6 text-lg text-gray-400 leading-relaxed\">\n                I am not a motivational coach. I am a strategist and advisor. The work is structured, \n                documented, and accountable â€” anchored in conviction and integrity.\n              </p>\n\n              <div className=\"mt-12 space-y-8\">\n                {[\n                  { step: \"Initial Call\", desc: \"45 minutes to understand context, stakes, and fit.\" },\n                  { step: \"Diagnostic\", desc: \"Clear articulation of the real problem, not the fashionable one.\" },\n                  { step: \"Engagement\", desc: \"Defined scope, cadence, and clear measures of success.\" },\n                ].map((item, i) => (\n                  <div key={i} className=\"flex gap-6\">\n                    <div className=\"flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-gold/10 font-mono text-sm font-bold text-gold border border-gold/20\">\n                      0{i + 1}\n                    </div>\n                    <div>\n                      <h4 className=\"font-bold uppercase tracking-widest text-cream\">{item.step}</h4>\n                      <p className=\"mt-1 text-sm text-gray-500\">{item.desc}</p>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n\n            <div className=\"rounded-3xl border border-gold/20 bg-gold/5 p-8 lg:p-12\">\n              <ShieldCheck className=\"mb-6 h-10 w-10 text-gold\" />\n              <h3 className=\"font-serif text-2xl font-semibold text-cream\">Is this for you?</h3>\n              <p className=\"mt-4 text-gray-400\">This advisory is reserved for leaders who:</p>\n              \n              <ul className=\"mt-8 space-y-4\">\n                {[\n                  \"Carry responsibility for others' livelihoods\",\n                  \"Want strategy that respects both Faith and Data\",\n                  \"Are willing to be challenged, not entertained\",\n                ].map((item, i) => (\n                  <li key={i} className=\"flex items-center gap-3 text-sm font-medium text-cream/90\">\n                    <div className=\"h-1.5 w-1.5 rounded-full bg-gold\" />\n                    {item}\n                  </li>\n                ))}\n              </ul>\n\n              <div className=\"mt-12\">\n                <Link\n                  href=\"/contact\"\n                  className=\"inline-flex w-full items-center justify-center gap-2 rounded-xl border border-gold/50 py-4 text-sm font-bold uppercase tracking-widest text-gold transition-all hover:bg-gold hover:text-black\"\n                >\n                  Share Context Note\n                  <ArrowRight className=\"h-4 w-4\" />\n                </Link>\n                <p className=\"mt-4 text-center text-[10px] uppercase tracking-tighter text-gray-500\">\n                  strictly confidential Â· limited mandates available\n                </p>\n              </div>\n            </div>\n          </div>\n        </div>\n      </section>\n    </Layout>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\contact.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":240,"column":49,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[8124,8192],"text":"We&apos;ll respond within 2-3 business days. Thank you for your interest."},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[8124,8192],"text":"We&lsquo;ll respond within 2-3 business days. Thank you for your interest."},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[8124,8192],"text":"We&#39;ll respond within 2-3 business days. Thank you for your interest."},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[8124,8192],"text":"We&rsquo;ll respond within 2-3 business days. Thank you for your interest."},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// pages/contact.tsx - FIXED (console statements removed)\nimport * as React from \"react\";\nimport Head from \"next/head\";\nimport Link from \"next/link\";\nimport {\n  Moon,\n  SunMedium,\n  Mail,\n  Phone,\n  MapPin,\n  Clock,\n  Users,\n  Target,\n  CheckCircle,\n  Shield,\n  Calendar,\n} from \"lucide-react\";\nimport Layout from \"@/components/Layout\";\nimport { getPageTitle, siteConfig } from \"@/lib/imports\";\nimport PolicyFooter from \"@/components/PolicyFooter\";\n\nconst ContactPage = (): JSX.Element => {\n  const pageTitle = \"Contact Abraham of London\";\n  const [isDark, setIsDark] = React.useState(true);\n  const [mounted, setMounted] = React.useState(false);\n  const [isSubmitting, setIsSubmitting] = React.useState(false);\n  const [submitStatus, setSubmitStatus] = React.useState<'idle' | 'success' | 'error'>('idle');\n\n  // Safe phone number with fallback\n  const contactPhone =\n    (siteConfig as { phone?: string }).phone ?? \"+44 20 8622 5909\";\n\n  // Theme management\n  React.useEffect(() => {\n    setMounted(true);\n    try {\n      const stored = localStorage.getItem(\"aof-theme\");\n      if (stored === \"light\" || stored === \"dark\") {\n        setIsDark(stored === \"dark\");\n        return;\n      }\n      const prefersDark = window.matchMedia?.(\n        \"(prefers-color-scheme: dark)\"\n      ).matches;\n      setIsDark(prefersDark);\n    } catch {\n      // ignore localStorage errors\n    }\n  }, []);\n\n  const toggleTheme = () => {\n    setIsDark((prev) => {\n      const next = !prev;\n      try {\n        localStorage.setItem(\"aof-theme\", next ? \"dark\" : \"light\");\n      } catch {\n        // ignore localStorage errors\n      }\n      return next;\n    });\n  };\n\n  // Form submission handler - FIXED: removed console.log\n  const handleSubmit = async (event: React.FormEvent<HTMLFormElement>) => {\n    event.preventDefault();\n    setIsSubmitting(true);\n    setSubmitStatus('idle');\n\n    try {\n      const formData = new FormData(event.currentTarget);\n      const data = Object.fromEntries(formData.entries());\n\n      // Basic honeypot protection - FIXED: removed console.log\n      if (data.website || data.middleName) {\n        // Honeypot triggered - silently ignore\n        return;\n      }\n\n      const response = await fetch('/api/contact', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(data),\n      });\n\n      if (response.ok) {\n        setSubmitStatus('success');\n        (event.target as HTMLFormElement).reset();\n      } else {\n        setSubmitStatus('error');\n      }\n    } catch (error) {\n      // FIXED: removed console.error for production\n      setSubmitStatus('error');\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  // Reset submit status when form changes\n  const handleFormChange = () => {\n    if (submitStatus !== 'idle') {\n      setSubmitStatus('idle');\n    }\n  };\n\n  // Avoid hydration mismatch\n  if (!mounted) {\n    return (\n      <Layout title={pageTitle}>\n        <div className=\"min-h-screen bg-gray-100\" />\n      </Layout>\n    );\n  }\n\n  // Theme classes\n  const shellClass = isDark\n    ? \"min-h-screen bg-gradient-to-br from-deepCharcoal via-gray-900 to-black text-cream\"\n    : \"min-h-screen bg-gradient-to-br from-warmWhite via-cream to-white text-ink\";\n\n  const cardClass = isDark\n    ? \"border-white/10 bg-white/5 backdrop-blur-sm hover:border-softGold/30 transition-all duration-300\"\n    : \"border-lightGrey bg-white shadow-lg hover:shadow-xl transition-all duration-300\";\n\n  const inputClass = isDark\n    ? \"border-white/20 bg-white/5 text-cream placeholder-gray-400 focus:border-softGold/60 focus:bg-white/10 focus:ring-softGold/40\"\n    : \"border-lightGrey bg-warmWhite/60 text-ink placeholder-gray-500 focus:border-forest/60 focus:bg-white focus:ring-forest/40\";\n\n  const primaryTextClass = isDark ? \"text-cream\" : \"text-deepCharcoal\";\n  const secondaryTextClass = isDark ? \"text-gray-300\" : \"text-slate-700\";\n  const accentTextClass = isDark ? \"text-softGold\" : \"text-forest\";\n\n  const buttonClass = isDark\n    ? \"bg-softGold text-deepCharcoal hover:bg-softGold/90 shadow-lg hover:shadow-softGold/25\"\n    : \"bg-forest text-cream hover:bg-forest/90 shadow-lg hover:shadow-forest/25\";\n\n  const successClass = isDark \n    ? \"border-green-500/30 bg-green-500/10 text-green-300\"\n    : \"border-green-500/30 bg-green-50 text-green-700\";\n\n  const errorClass = isDark\n    ? \"border-red-500/30 bg-red-500/10 text-red-300\"\n    : \"border-red-500/30 bg-red-50 text-red-700\";\n\n  return (\n    <Layout title={pageTitle}>\n      <Head>\n        <title>{getPageTitle(pageTitle)}</title>\n        <meta\n          name=\"description\"\n          content=\"Connect with Abraham of London for strategic conversations around leadership, legacy, and principled ventures. Enquiries are considered based on clarity of brief and strategic fit.\"\n        />\n        <meta name=\"theme-color\" content={isDark ? \"#0f172a\" : \"#f7f5ee\"} />\n        <script\n          type=\"application/ld+json\"\n          dangerouslySetInnerHTML={{\n            __html: JSON.stringify({\n              \"@context\": \"https://schema.org\",\n              \"@type\": \"ContactPage\",\n              \"name\": \"Contact Abraham of London\",\n              \"description\": \"Strategic partnership and advisory contact page\",\n              \"telephone\": contactPhone,\n              \"email\": siteConfig.email,\n              \"address\": {\n                \"@type\": \"PostalAddress\",\n                \"addressLocality\": \"London\",\n                \"addressCountry\": \"UK\"\n              }\n            })\n          }}\n        />\n      </Head>\n\n      <div className={shellClass}>\n        <div className=\"mx-auto max-w-6xl px-4 py-12 md:py-20\">\n          {/* Header with theme toggle */}\n          <div className=\"flex items-start justify-between gap-4 mb-12\">\n            <div>\n              <p\n                className={`text-sm font-semibold uppercase tracking-[0.2em] ${accentTextClass}`}\n              >\n                Strategic Partnership\n              </p>\n            </div>\n\n            {/* Theme Toggle */}\n            <button\n              type=\"button\"\n              onClick={toggleTheme}\n              className={`inline-flex items-center gap-2 rounded-full border px-4 py-2 text-xs font-semibold shadow-sm transition-all ${\n                isDark\n                  ? \"border-white/15 bg-white/5 text-cream hover:bg-white/10\"\n                  : \"border-lightGrey bg-white text-ink hover:bg-warmWhite\"\n              }`}\n              aria-label=\"Toggle light/dark mode\"\n            >\n              {isDark ? (\n                <>\n                  <SunMedium className=\"h-4 w-4\" />\n                  <span>Light Mode</span>\n                </>\n              ) : (\n                <>\n                  <Moon className=\"h-4 w-4\" />\n                  <span>Dark Mode</span>\n                </>\n              )}\n            </button>\n          </div>\n\n          {/* Hero Section */}\n          <header className=\"text-center mb-16\">\n            <p\n              className={`text-[0.7rem] font-semibold uppercase tracking-[0.24em] ${accentTextClass}`}\n            >\n              Begin the Dialogue\n            </p>\n            <h1\n              className={`mt-4 font-serif text-4xl font-bold md:text-5xl ${primaryTextClass}`}\n            >\n              Contact Abraham of London\n            </h1>\n            <p\n              className={`mt-6 max-w-2xl mx-auto text-lg leading-relaxed ${secondaryTextClass}`}\n            >\n              For strategic advisory, fatherhood advocacy, legacy building, and\n              venture leadership. Enquiries are prioritised where there is clear\n              alignment of vision, values, and impact.\n            </p>\n          </header>\n\n          {/* Submission Status Messages */}\n          {submitStatus === 'success' && (\n            <div className={`mb-6 rounded-xl border p-4 ${successClass}`}>\n              <div className=\"flex items-center gap-3\">\n                <CheckCircle className=\"h-5 w-5\" />\n                <div>\n                  <p className=\"font-semibold\">Enquiry Submitted Successfully</p>\n                  <p className=\"text-sm mt-1\">We'll respond within 2-3 business days. Thank you for your interest.</p>\n                </div>\n              </div>\n            </div>\n          )}\n\n          {submitStatus === 'error' && (\n            <div className={`mb-6 rounded-xl border p-4 ${errorClass}`}>\n              <div className=\"flex items-center gap-3\">\n                <Shield className=\"h-5 w-5\" />\n                <div>\n                  <p className=\"font-semibold\">Submission Failed</p>\n                  <p className=\"text-sm mt-1\">Please try again or email us directly at {siteConfig.email}</p>\n                </div>\n              </div>\n            </div>\n          )}\n\n          <div className=\"grid gap-12 lg:grid-cols-3\">\n            {/* Contact Information Sidebar */}\n            <div className=\"lg:col-span-1\">\n              <div className={`rounded-2xl border p-8 h-full ${cardClass}`}>\n                <h2\n                  className={`font-serif text-2xl font-semibold mb-6 ${primaryTextClass}`}\n                >\n                  Direct Contact\n                </h2>\n\n                <div className=\"space-y-6\">\n                  <div className=\"flex items-start gap-4\">\n                    <div\n                      className={`rounded-lg p-3 ${isDark ? \"bg-softGold/10\" : \"bg-forest/10\"}`}\n                    >\n                      <Mail\n                        className={\n                          isDark\n                            ? \"h-5 w-5 text-softGold\"\n                            : \"h-5 w-5 text-forest\"\n                        }\n                      />\n                    </div>\n                    <div>\n                      <h3 className={`font-semibold mb-1 ${primaryTextClass}`}>\n                        Email\n                      </h3>\n                      <a\n                        href={`mailto:${siteConfig.email}`}\n                        className={`text-sm hover:underline ${accentTextClass}`}\n                      >\n                        {siteConfig.email}\n                      </a>\n                    </div>\n                  </div>\n\n                  <div className=\"flex items-start gap-4\">\n                    <div\n                      className={`rounded-lg p-3 ${isDark ? \"bg-softGold/10\" : \"bg-forest/10\"}`}\n                    >\n                      <Phone\n                        className={\n                          isDark\n                            ? \"h-5 w-5 text-softGold\"\n                            : \"h-5 w-5 text-forest\"\n                        }\n                      />\n                    </div>\n                    <div>\n                      <h3 className={`font-semibold mb-1 ${primaryTextClass}`}>\n                        Phone\n                      </h3>\n                      <a\n                        href={`tel:${contactPhone.replace(/\\s/g, \"\")}`}\n                        className={`text-sm hover:underline ${accentTextClass}`}\n                      >\n                        {contactPhone}\n                      </a>\n                    </div>\n                  </div>\n\n                  <div className=\"flex items-start gap-4\">\n                    <div\n                      className={`rounded-lg p-3 ${isDark ? \"bg-softGold/10\" : \"bg-forest/10\"}`}\n                    >\n                      <MapPin\n                        className={\n                          isDark\n                            ? \"h-5 w-5 text-softGold\"\n                            : \"h-5 w-5 text-forest\"\n                        }\n                      />\n                    </div>\n                    <div>\n                      <h3 className={`font-semibold mb-1 ${primaryTextClass}`}>\n                        Location\n                      </h3>\n                      <p className={`text-sm ${secondaryTextClass}`}>\n                        London, United Kingdom\n                      </p>\n                    </div>\n                  </div>\n\n                  <div className=\"flex items-start gap-4\">\n                    <div\n                      className={`rounded-lg p-3 ${isDark ? \"bg-softGold/10\" : \"bg-forest/10\"}`}\n                    >\n                      <Clock\n                        className={\n                          isDark\n                            ? \"h-5 w-5 text-softGold\"\n                            : \"h-5 w-5 text-forest\"\n                        }\n                      />\n                    </div>\n                    <div>\n                      <h3 className={`font-semibold mb-1 ${primaryTextClass}`}>\n                        Response Time\n                      </h3>\n                      <p className={`text-sm ${secondaryTextClass}`}>\n                        We aim to respond to qualified enquiries within 2â€“3\n                        business days. Depending on volume and strategic fit, we\n                        may not be able to reply to every message individually.\n                      </p>\n                    </div>\n                  </div>\n                </div>\n\n                <div\n                  className={`mt-8 pt-6 border-t ${isDark ? \"border-white/10\" : \"border-lightGrey\"}`}\n                >\n                  <h3 className={`font-semibold mb-3 ${primaryTextClass}`}>\n                    Priority Consideration\n                  </h3>\n                  <ul className={`text-sm space-y-2 ${secondaryTextClass}`}>\n                    <li className=\"flex items-center gap-2\">\n                      <Target className=\"h-3 w-3 text-softGold\" />\n                      Strategic alignment with core values\n                    </li>\n                    <li className=\"flex items-center gap-2\">\n                      <Users className=\"h-3 w-3 text-softGold\" />\n                      Clear vision and execution capability\n                    </li>\n                    <li className=\"flex items-center gap-2\">\n                      <Calendar className=\"h-3 w-3 text-softGold\" />\n                      Long-term impact potential\n                    </li>\n                  </ul>\n                </div>\n\n                <div\n                  className={`mt-6 pt-4 border-t text-xs ${\n                    isDark\n                      ? \"border-white/10 text-gray-400\"\n                      : \"border-lightGrey text-slate-600\"\n                  }`}\n                >\n                  <p className=\"mb-1\">\n                    Submitting an enquiry does not create a client, advisory, or\n                    fiduciary relationship.\n                  </p>\n                  <p>\n                    Please avoid including confidential, highly sensitive, or\n                    case-specific legal, financial, or medical details at this\n                    stage.\n                  </p>\n                </div>\n              </div>\n            </div>\n\n            {/* Main Contact Form */}\n            <div className=\"lg:col-span-2\">\n              <div className={`rounded-2xl border p-8 ${cardClass}`}>\n                <div className=\"mb-8\">\n                  <h2\n                    className={`font-serif text-2xl font-semibold mb-3 ${primaryTextClass}`}\n                  >\n                    Strategic Enquiry Form\n                  </h2>\n                  <p className={`text-sm ${secondaryTextClass}`}>\n                    For speaking invitations, strategic advisory, media\n                    enquiries, or collaboration opportunities. Responses are\n                    prioritised based on clarity of brief, timing, and strategic\n                    fit.\n                  </p>\n                </div>\n\n                <form \n                  method=\"post\" \n                  action=\"/api/contact\" \n                  className=\"space-y-6\"\n                  onSubmit={handleSubmit}\n                  onChange={handleFormChange}\n                >\n                  {/* Honeypot fields - hidden from users */}\n                  <div className=\"hidden\">\n                    <input type=\"text\" name=\"website\" tabIndex={-1} autoComplete=\"off\" />\n                    <input type=\"text\" name=\"middleName\" tabIndex={-1} autoComplete=\"off\" />\n                  </div>\n\n                  <div className=\"grid gap-6 sm:grid-cols-2\">\n                    <div>\n                      <label\n                        htmlFor=\"name\"\n                        className={`block text-sm font-semibold mb-2 ${primaryTextClass}`}\n                      >\n                        Full Name *\n                      </label>\n                      <input\n                        id=\"name\"\n                        name=\"name\"\n                        type=\"text\"\n                        required\n                        autoComplete=\"name\"\n                        className={`w-full rounded-xl border px-4 py-3 text-sm outline-none ring-0 transition focus:ring-2 ${inputClass}`}\n                        placeholder=\"Your full name\"\n                        minLength={2}\n                        maxLength={100}\n                      />\n                    </div>\n\n                    <div>\n                      <label\n                        htmlFor=\"email\"\n                        className={`block text-sm font-semibold mb-2 ${primaryTextClass}`}\n                      >\n                        Email Address *\n                      </label>\n                      <input\n                        id=\"email\"\n                        name=\"email\"\n                        type=\"email\"\n                        required\n                        autoComplete=\"email\"\n                        className={`w-full rounded-xl border px-4 py-3 text-sm outline-none ring-0 transition focus:ring-2 ${inputClass}`}\n                        placeholder=\"your.email@example.com\"\n                        pattern=\"[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{2,}$\"\n                      />\n                    </div>\n                  </div>\n\n                  <div>\n                    <label\n                      htmlFor=\"subject\"\n                      className={`block text-sm font-semibold mb-2 ${primaryTextClass}`}\n                    >\n                      Subject *\n                    </label>\n                    <input\n                      id=\"subject\"\n                      name=\"subject\"\n                      type=\"text\"\n                      required\n                      className={`w-full rounded-xl border px-4 py-3 text-sm outline-none ring-0 transition focus:ring-2 ${inputClass}`}\n                      placeholder=\"Brief summary of your enquiry\"\n                      minLength={5}\n                      maxLength={200}\n                    />\n                  </div>\n\n                  <div>\n                    <label\n                      htmlFor=\"enquiryType\"\n                      className={`block text-sm font-semibold mb-2 ${primaryTextClass}`}\n                    >\n                      Type of Enquiry *\n                    </label>\n                    <select\n                      id=\"enquiryType\"\n                      name=\"enquiryType\"\n                      required\n                      className={`w-full rounded-xl border px-4 py-3 text-sm outline-none ring-0 transition focus:ring-2 ${inputClass}`}\n                    >\n                      <option value=\"\">Select an option</option>\n                      <option value=\"strategic-advisory\">\n                        Strategic Advisory\n                      </option>\n                      <option value=\"speaking-engagement\">\n                        Speaking Engagement\n                      </option>\n                      <option value=\"media-interview\">Media Interview</option>\n                      <option value=\"venture-partnership\">\n                        Venture Partnership\n                      </option>\n                      <option value=\"fatherhood-advocacy\">\n                        Fatherhood Advocacy\n                      </option>\n                      <option value=\"legacy-consulting\">\n                        Legacy Consulting\n                      </option>\n                      <option value=\"other\">Other</option>\n                    </select>\n                  </div>\n\n                  <div>\n                    <label\n                      htmlFor=\"message\"\n                      className={`block text-sm font-semibold mb-2 ${primaryTextClass}`}\n                    >\n                      Detailed Message *\n                    </label>\n                    <textarea\n                      id=\"message\"\n                      name=\"message\"\n                      rows={6}\n                      required\n                      className={`w-full rounded-xl border px-4 py-3 text-sm leading-relaxed outline-none ring-0 transition focus:ring-2 ${inputClass}`}\n                      placeholder=\"Provide context, objectives, timelines, stakeholders, and decision-makers involved.\"\n                      minLength={20}\n                      maxLength={2000}\n                    />\n                    <p className={`mt-2 text-xs ${secondaryTextClass}`}>\n                      Precision helps us assess strategic fit and determine\n                      whether we are the right counterpart for your enquiry.\n                    </p>\n                  </div>\n\n                  <div className=\"flex flex-wrap items-center justify-between gap-4 pt-4\">\n                    <p className={`text-sm ${secondaryTextClass}`}>\n                      Prefer direct communication?{\" \"}\n                      <a\n                        href={`mailto:${siteConfig.email}`}\n                        className={`font-semibold underline-offset-2 hover:underline ${accentTextClass}`}\n                      >\n                        Email directly\n                      </a>\n                      .\n                    </p>\n\n                    <button\n                      type=\"submit\"\n                      disabled={isSubmitting}\n                      className={`inline-flex items-center rounded-full px-8 py-3 text-sm font-semibold uppercase tracking-wide transition-all duration-200 transform hover:-translate-y-0.5 hover:scale-105 disabled:opacity-50 disabled:transform-none disabled:hover:scale-100 ${buttonClass}`}\n                    >\n                      {isSubmitting ? (\n                        <>\n                          <div className=\"h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent mr-2\" />\n                          Submitting...\n                        </>\n                      ) : (\n                        'Submit Strategic Enquiry'\n                      )}\n                    </button>\n                  </div>\n\n                  <p className={`mt-4 text-xs ${secondaryTextClass}`}>\n                    By submitting this form, you acknowledge that you have read\n                    our{\" \"}\n                    <Link\n                      href=\"/privacy-policy\"\n                      className={`underline underline-offset-2 ${accentTextClass} hover:opacity-90`}\n                    >\n                      Privacy Policy\n                    </Link>{\" \"}\n                    and{\" \"}\n                    <Link\n                      href=\"/terms-of-service\"\n                      className={`underline underline-offset-2 ${accentTextClass} hover:opacity-90`}\n                    >\n                      Terms of Service\n                    </Link>\n                    .\n                  </p>\n                </form>\n              </div>\n\n              {/* Additional Context Section */}\n              <div className={`mt-8 rounded-2xl border p-6 ${cardClass}`}>\n                <h3\n                  className={`font-serif text-lg font-semibold mb-3 ${primaryTextClass}`}\n                >\n                  About Abraham of London\n                </h3>\n                <p className={`text-sm leading-relaxed ${secondaryTextClass}`}>\n                  Abraham of London curates a family of ventures focused on\n                  legacy building, fatherhood advocacy, and principled\n                  leadership. Through platforms such as Alomarada, InnovateHub,\n                  and Endureluxe, we bring together strategic advisory, founder\n                  support, and community initiatives aimed at durable impact.\n                </p>\n              </div>\n            </div>\n          </div>\n\n          <PolicyFooter isDark={isDark} />\n        </div>\n      </div>\n    </Layout>\n  );\n};\n\nexport default ContactPage;","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\content\\[slug].tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\content\\index.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AnimatePresence' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":33}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\r\nimport type { GetStaticProps, NextPage } from \"next\";\r\nimport Link from \"next/link\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport { Search, ArrowRight, Box, Terminal } from \"lucide-react\";\r\nimport Layout from \"@/components/Layout\";\r\nimport {\r\n  getPublishedDocuments,\r\n  getDocHref,\r\n  getDocKind,\r\n  normalizeSlug,\r\n  resolveDocCoverImage,\r\n} from \"@/lib/contentlayer-helper\";\r\n\r\ntype Item = {\r\n  key: string;\r\n  kind: string;\r\n  title: string;\r\n  href: string;\r\n  excerpt?: string | null;\r\n  date?: string | null;\r\n  image?: string | null;\r\n};\r\n\r\ntype Props = { items: Item[] };\r\n\r\nexport const getStaticProps: GetStaticProps<Props> = async () => {\r\n  // Fetches using the immutable Core Engine logic\r\n  const docs = getPublishedDocuments();\r\n\r\n  const items: Item[] = docs\r\n    .map((d) => ({\r\n      key: d._id ?? `${getDocKind(d)}:${normalizeSlug(d)}`,\r\n      kind: getDocKind(d),\r\n      title: d.title ?? \"Untitled Framework\",\r\n      href: getDocHref(d),\r\n      excerpt: d.excerpt ?? d.description ?? null,\r\n      date: d.date ? String(d.date) : null,\r\n      image: resolveDocCoverImage(d),\r\n    }))\r\n    .filter((x) => x.href && x.title)\r\n    .sort((a, b) => (b.date ? new Date(b.date).getTime() : 0) - (a.date ? new Date(a.date).getTime() : 0));\r\n\r\n  return { props: { items }, revalidate: 1800 };\r\n};\r\n\r\nconst ContentIndexPage: NextPage<Props> = ({ items }) => {\r\n  const [q, setQ] = React.useState(\"\");\r\n\r\n  const filtered = React.useMemo(() => {\r\n    const s = q.trim().toLowerCase();\r\n    if (!s) return items;\r\n    return items.filter(it => \r\n      it.title.toLowerCase().includes(s) || \r\n      it.kind.toLowerCase().includes(s) ||\r\n      (it.excerpt ?? \"\").toLowerCase().includes(s)\r\n    );\r\n  }, [q, items]);\r\n\r\n  const groups = React.useMemo(() => {\r\n    const map: Record<string, Item[]> = {};\r\n    filtered.forEach(it => {\r\n      const groupName = it.kind;\r\n      if (!map[groupName]) map[groupName] = [];\r\n      map[groupName].push(it);\r\n    });\r\n    return Object.entries(map).sort(([a], [b]) => a.localeCompare(b));\r\n  }, [filtered]);\r\n\r\n  return (\r\n    <Layout title=\"The Kingdom Vault\" description=\"Centralized Strategic Repository.\">\r\n      <main className=\"min-h-screen bg-[#050505] text-cream\">\r\n        \r\n        {/* Header Section */}\r\n        <section className=\"relative overflow-hidden border-b border-white/5 pb-16 pt-32 lg:pt-40\">\r\n          <div className=\"absolute inset-0 opacity-[0.02] [background-image:radial-gradient(circle_at_center,_#d4af37_1px,_transparent_1px)] [background-size:32px_32px]\" />\r\n          \r\n          <div className=\"relative z-10 mx-auto max-w-5xl px-6\">\r\n            <div className=\"mb-6 inline-flex items-center gap-2 rounded-full border border-gold/30 bg-gold/5 px-4 py-1\">\r\n              <Terminal size={12} className=\"text-gold\" />\r\n              <span className=\"text-[10px] font-black uppercase tracking-[0.3em] text-gold\">System: Central Vault</span>\r\n            </div>\r\n            \r\n            <h1 className=\"font-serif text-4xl font-bold tracking-tight text-white sm:text-6xl\">\r\n              Everything. <span className=\"italic text-gold/80\">Organised.</span>\r\n            </h1>\r\n            \r\n            <div className=\"mt-12 relative group max-w-2xl\">\r\n              <Search className=\"absolute left-5 top-1/2 -translate-y-1/2 text-gray-500 transition-colors group-focus-within:text-gold\" size={18} />\r\n              <input\r\n                value={q}\r\n                onChange={(e) => setQ(e.target.value)}\r\n                placeholder=\"Search collections, themes, or keywords...\"\r\n                className=\"w-full rounded-2xl border border-white/10 bg-white/5 py-5 pl-14 pr-6 text-base text-cream outline-none transition-all focus:border-gold/40 focus:ring-4 focus:ring-gold/5\"\r\n              />\r\n              {q && (\r\n                <button \r\n                  onClick={() => setQ(\"\")}\r\n                  className=\"absolute right-5 top-1/2 -translate-y-1/2 text-[10px] font-black uppercase tracking-widest text-gray-500 hover:text-gold\"\r\n                >\r\n                  Clear\r\n                </button>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </section>\r\n\r\n        {/* Unified Collections Grid */}\r\n        <section className=\"mx-auto max-w-5xl px-6 py-20\">\r\n          {groups.length === 0 ? (\r\n            <motion.div \r\n              initial={{ opacity: 0 }} \r\n              animate={{ opacity: 1 }}\r\n              className=\"rounded-3xl border border-dashed border-white/10 py-32 text-center\"\r\n            >\r\n              <Box className=\"mx-auto mb-4 text-gray-700\" size={40} />\r\n              <p className=\"font-serif text-xl italic text-gray-500\">No assets matching the current query.</p>\r\n            </motion.div>\r\n          ) : (\r\n            <div className=\"space-y-24\">\r\n              {groups.map(([kind, kindItems]) => (\r\n                <div key={kind} className=\"space-y-10\">\r\n                  <div className=\"flex items-center gap-6\">\r\n                    <h2 className=\"font-serif text-2xl font-bold uppercase tracking-tight text-gold/90 sm:text-3xl\">\r\n                      {kind === 'post' ? 'Essays' : `${kind}s`}\r\n                    </h2>\r\n                    <div className=\"h-px flex-1 bg-gradient-to-r from-gold/20 to-transparent\" />\r\n                    <span className=\"font-mono text-[10px] text-gray-600 uppercase tracking-widest\">{kindItems.length} Volumes</span>\r\n                  </div>\r\n                  \r\n                  <div className=\"grid grid-cols-1 gap-6 sm:grid-cols-2\">\r\n                    {kindItems.map((it) => (\r\n                      <motion.div\r\n                        key={it.key}\r\n                        whileHover={{ y: -4 }}\r\n                        className=\"group relative flex flex-col justify-between rounded-3xl border border-white/5 bg-gradient-to-br from-white/[0.03] to-transparent p-8 transition-all hover:border-gold/30 hover:shadow-2xl hover:shadow-gold/5\"\r\n                      >\r\n                        <Link href={it.href} className=\"flex h-full flex-col\">\r\n                          <h3 className=\"mb-4 font-serif text-2xl font-semibold leading-tight text-cream group-hover:text-gold transition-colors\">\r\n                            {it.title}\r\n                          </h3>\r\n                          \r\n                          {it.excerpt && (\r\n                            <p className=\"mb-8 text-sm leading-relaxed text-gray-400 line-clamp-2\">\r\n                              {it.excerpt}\r\n                            </p>\r\n                          )}\r\n                          \r\n                          <div className=\"mt-auto flex items-center justify-between pt-6 border-t border-white/5\">\r\n                            <span className=\"font-mono text-[9px] uppercase tracking-widest text-gray-600 group-hover:text-gold/50 transition-colors\">\r\n                              {it.href.replace(/^\\//, '').replace(/\\//g, ' Â· ')}\r\n                            </span>\r\n                            <ArrowRight size={16} className=\"text-gold opacity-0 -translate-x-2 transition-all group-hover:opacity-100 group-hover:translate-x-0\" />\r\n                          </div>\r\n                        </Link>\r\n                      </motion.div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </section>\r\n      </main>\r\n    </Layout>\r\n  );\r\n};\r\n\r\nexport default ContentIndexPage;","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\content\\simple.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\cookie-policy.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\cookies.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\debug\\content.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\downloads\\[slug].tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\downloads\\index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\events\\[slug].tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isPublished' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MDXRemote' is defined but never used. Allowed unused vars must match /^_/u.","line":10,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\nimport type { GetStaticPaths, GetStaticProps, NextPage } from \"next\";\nimport Head from \"next/head\";\nimport Layout from \"@/components/Layout\";\nimport { \n  getAllEvents, \n  normalizeSlug, \n  isPublished \n} from \"@/lib/contentlayer-helper\";\nimport { MDXRemote, type MDXRemoteSerializeResult } from \"next-mdx-remote\";\nimport { serialize } from \"next-mdx-remote/serialize\";\nimport remarkGfm from \"remark-gfm\";\nimport rehypeSlug from \"rehype-slug\";\nimport rehypeAutolinkHeadings from \"rehype-autolink-headings\";\nimport mdxComponents from \"@/components/mdx-components\";\nimport SafeMDXRemote from \"@/components/SafeMDXRemote\";\n\ntype Props = {\n  event: any;\n  source: MDXRemoteSerializeResult;\n};\n\nexport const getStaticPaths: GetStaticPaths = async () => {\n  // Use the robust helper to get all published events\n  const events = getAllEvents();\n  \n  const paths = events\n    .map((event) => {\n      const slug = normalizeSlug(event);\n      return slug ? { params: { slug } } : null;\n    })\n    .filter(Boolean) as { params: { slug: string } }[];\n\n  return {\n    paths,\n    fallback: \"blocking\",\n  };\n};\n\nexport const getStaticProps: GetStaticProps<Props> = async ({ params }) => {\n  const slug = String(params?.slug ?? \"\").trim().toLowerCase();\n  \n  if (!slug) return { notFound: true };\n\n  const events = getAllEvents();\n  // Lookup using the centralized normalization logic to ensure a match\n  const event = events.find((e) => normalizeSlug(e) === slug);\n\n  if (!event) {\n    return { notFound: true };\n  }\n\n  // Ensure we have raw content for serialization\n  const rawContent = event.body?.raw ?? \"\";\n  \n  let source: MDXRemoteSerializeResult;\n  try {\n    source = await serialize(rawContent, {\n      mdxOptions: {\n        remarkPlugins: [remarkGfm],\n        rehypePlugins: [\n          rehypeSlug,\n          [rehypeAutolinkHeadings, { behavior: \"wrap\" }],\n        ],\n      },\n    });\n  } catch (err) {\n    console.error(`[Events Serialize Error] ${slug}:`, err);\n    source = await serialize(\"Event details are being updated.\");\n  }\n\n  return {\n    props: {\n      event,\n      source,\n    },\n    revalidate: 1800, // 30 mins\n  };\n};\n\nconst EventPage: NextPage<Props> = ({ event, source }) => {\n  const title = event.title ?? \"Event\";\n  \n  // Robust Date Parsing\n  const formattedDate = React.useMemo(() => {\n    if (!event.eventDate) return null;\n    const date = new Date(event.eventDate);\n    return isNaN(date.getTime()) \n      ? null \n      : date.toLocaleString(\"en-GB\", {\n          day: \"2-digit\",\n          month: \"short\",\n          year: \"numeric\",\n          hour: \"2-digit\",\n          minute: \"2-digit\",\n        });\n  }, [event.eventDate]);\n\n  return (\n    <Layout title={title}>\n      <Head>\n        {event.excerpt && <meta name=\"description\" content={event.excerpt} />}\n        <meta property=\"og:title\" content={`${title} | Abraham of London`} />\n        <title>{title} | Events | Abraham of London</title>\n      </Head>\n\n      <main className=\"mx-auto max-w-3xl px-6 py-12 sm:py-16 lg:py-20\">\n        <header className=\"mb-12 space-y-4 border-b border-gold/10 pb-10\">\n          <p className=\"text-[10px] font-bold uppercase tracking-[0.3em] text-gold\">\n            Private Gathering\n          </p>\n          <h1 className=\"font-serif text-3xl font-semibold text-cream sm:text-4xl lg:text-5xl\">\n            {title}\n          </h1>\n\n          <div className=\"flex flex-wrap gap-3 pt-2\">\n            {formattedDate && (\n              <span className=\"inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/5 px-4 py-1 text-[11px] font-medium text-gray-300\">\n                {formattedDate}\n              </span>\n            )}\n            {event.location && (\n              <span className=\"inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/5 px-4 py-1 text-[11px] font-medium text-gray-300\">\n                {event.location}\n              </span>\n            )}\n          </div>\n\n          {event.excerpt && (\n            <p className=\"mt-6 text-base leading-relaxed text-gray-400\">\n              {event.excerpt}\n            </p>\n          )}\n\n          {event.registrationUrl && (\n            <div className=\"pt-6\">\n              <a\n                href={event.registrationUrl}\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n                className=\"inline-flex items-center justify-center rounded-xl bg-gold px-8 py-3 text-sm font-bold uppercase tracking-widest text-black transition-all hover:bg-gold/80 hover:scale-[1.02]\"\n              >\n                Request a Seat\n              </a>\n            </div>\n          )}\n        </header>\n\n        <article className=\"prose prose-invert max-w-none prose-headings:font-serif prose-headings:text-cream prose-a:text-gold\">\n          <SafeMDXRemote source={source} components={mdxComponents} />\n        </article>\n      </main>\n    </Layout>\n  );\n};\n\nexport default EventPage;","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\events\\index.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":136,"column":50,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[4480,4600],"text":"\n              Once the first rooms have run, they&apos;ll live here as part of the\n              Canon archive.\n            "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[4480,4600],"text":"\n              Once the first rooms have run, they&lsquo;ll live here as part of the\n              Canon archive.\n            "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[4480,4600],"text":"\n              Once the first rooms have run, they&#39;ll live here as part of the\n              Canon archive.\n            "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[4480,4600],"text":"\n              Once the first rooms have run, they&rsquo;ll live here as part of the\n              Canon archive.\n            "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// pages/events/index.tsx\nimport * as React from \"react\";\nimport type { GetStaticProps, NextPage } from \"next\";\nimport Link from \"next/link\";\nimport Layout from \"@/components/Layout\";\nimport {\n  assertContentlayerHasDocs,\n  getAllEvents,\n  normalizeSlug,\n} from \"@/lib/contentlayer-helper\";\n\ntype EventItem = {\n  _id: string;\n  slug: string;\n  title: string;\n  excerpt: string | null;\n  eventDate: string | null;\n  location: string | null;\n};\n\ntype Props = {\n  upcoming: EventItem[];\n  past: EventItem[];\n};\n\nexport const getStaticProps: GetStaticProps<Props> = async () => {\n  assertContentlayerHasDocs(\"pages/events/index.tsx getStaticProps\");\n\n  const eventsRaw = getAllEvents();\n  const now = new Date();\n\n  const events: EventItem[] = eventsRaw.map((e: any) => ({\n    _id: String(e._id ?? `${normalizeSlug(e)}-${e.date ?? \"\"}`),\n    slug: normalizeSlug(e),\n    title: e.title ?? \"Untitled Event\",\n    excerpt: e.excerpt ?? e.description ?? null,\n    eventDate: (e.eventDate ?? e.date ?? null) as any,\n    location: e.location ?? null,\n  }));\n\n  const upcoming = events\n    .filter((e) => e.eventDate && new Date(e.eventDate) >= now)\n    .sort(\n      (a, b) =>\n        new Date(a.eventDate || \"\").getTime() -\n        new Date(b.eventDate || \"\").getTime()\n    );\n\n  const past = events\n    .filter((e) => !e.eventDate || new Date(e.eventDate) < now)\n    .sort(\n      (a, b) =>\n        new Date(b.eventDate || \"\").getTime() -\n        new Date(a.eventDate || \"\").getTime()\n    );\n\n  return { props: { upcoming, past }, revalidate: 1800 };\n};\n\nconst EventsIndexPage: NextPage<Props> = ({ upcoming, past }) => {\n  return (\n    <Layout title=\"Events\">\n      <main className=\"mx-auto max-w-5xl px-4 py-12 sm:py-16 lg:py-20\">\n        <header className=\"mb-8 space-y-2\">\n          <p className=\"text-xs font-semibold uppercase tracking-[0.25em] text-gold/70\">\n            Canon Â· Gatherings\n          </p>\n          <h1 className=\"font-serif text-3xl font-semibold text-cream sm:text-4xl\">\n            Events & Rooms\n          </h1>\n          <p className=\"text-sm text-gray-300\">\n            Private rooms, salons and workshops designed for builders who take\n            responsibility seriously.\n          </p>\n        </header>\n\n        <section className=\"space-y-4\">\n          <h2 className=\"text-sm font-semibold uppercase tracking-[0.25em] text-gold/70\">\n            Upcoming\n          </h2>\n\n          {upcoming.length === 0 && (\n            <p className=\"text-sm text-gray-400\">\n              No upcoming events announced yet. Join the newsletter to hear\n              first when the next room opens.\n            </p>\n          )}\n\n          {upcoming.length > 0 && (\n            <ul className=\"space-y-4\">\n              {upcoming.map((event) => (\n                <li\n                  key={event._id}\n                  className=\"rounded-2xl border border-white/5 bg-black/40 p-4 transition hover:border-gold/60 hover:bg-black/70\"\n                >\n                  <Link\n                    href={`/events/${event.slug}`}\n                    className=\"block space-y-1 no-underline\"\n                  >\n                    <p className=\"text-xs uppercase tracking-[0.25em] text-gold/70\">\n                      {event.location || \"Private Room\"}\n                    </p>\n                    <h3 className=\"font-serif text-lg font-semibold text-cream\">\n                      {event.title}\n                    </h3>\n                    <p className=\"text-xs text-gray-300\">\n                      {event.eventDate\n                        ? new Date(event.eventDate).toLocaleString(\"en-GB\", {\n                            day: \"2-digit\",\n                            month: \"short\",\n                            year: \"numeric\",\n                            hour: \"2-digit\",\n                            minute: \"2-digit\",\n                          })\n                        : \"Date TBC\"}\n                    </p>\n                    {event.excerpt && (\n                      <p className=\"mt-2 text-sm text-gray-300\">\n                        {event.excerpt}\n                      </p>\n                    )}\n                  </Link>\n                </li>\n              ))}\n            </ul>\n          )}\n        </section>\n\n        <section className=\"mt-10 space-y-4\">\n          <h2 className=\"text-sm font-semibold uppercase tracking-[0.25em] text-gold/70\">\n            Archive\n          </h2>\n\n          {past.length === 0 && (\n            <p className=\"text-sm text-gray-400\">\n              Once the first rooms have run, they'll live here as part of the\n              Canon archive.\n            </p>\n          )}\n\n          {past.length > 0 && (\n            <ul className=\"space-y-3 text-sm text-gray-400\">\n              {past.map((event) => (\n                <li key={event._id} className=\"flex items-baseline gap-3\">\n                  <span className=\"w-32 shrink-0 text-xs text-gray-500\">\n                    {event.eventDate\n                      ? new Date(event.eventDate).toLocaleDateString(\"en-GB\", {\n                          day: \"2-digit\",\n                          month: \"short\",\n                          year: \"numeric\",\n                        })\n                      : \"Past\"}\n                  </span>\n                  <Link\n                    href={`/events/${event.slug}`}\n                    className=\"flex-1 text-cream hover:text-gold\"\n                  >\n                    {event.title}\n                  </Link>\n                </li>\n              ))}\n            </ul>\n          )}\n        </section>\n      </main>\n    </Layout>\n  );\n};\n\nexport default EventsIndexPage;","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\fatherhood\\index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\founders\\index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\inner-circle-portal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\inner-circle\\admin.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Download' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":52,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":60},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Trash2' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":62,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":68},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'loading' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":11,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// pages/inner-circle/admin.tsx\r\n\r\nimport * as React from \"react\";\r\nimport type { NextPage } from \"next\";\r\nimport { LayoutGrid, Users, ShieldAlert, Database, Download, Trash2 } from \"lucide-react\";\r\nimport Layout from \"@/components/Layout\";\r\n\r\nconst AdminInnerCirclePage: NextPage = () => {\r\n  const [adminKey, setAdminKey] = React.useState(\"\");\r\n  const [data, setData] = React.useState<any>(null);\r\n  const [loading, setLoading] = React.useState(false);\r\n\r\n  const fetchStats = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const res = await fetch(\"/api/admin/inner-circle/export\", {\r\n        headers: { \"x-inner-circle-admin-key\": adminKey }\r\n      });\r\n      const json = await res.json();\r\n      if (json.ok) setData(json);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Layout title=\"IC Admin\">\r\n      <main className=\"min-h-screen bg-black text-cream pt-32 px-6\">\r\n        <div className=\"mx-auto max-w-6xl\">\r\n          <header className=\"flex justify-between items-end mb-12 border-b border-white/10 pb-8\">\r\n            <div>\r\n              <h1 className=\"font-serif text-4xl font-bold\">Inner Circle Console</h1>\r\n              <p className=\"text-gray-500 text-sm mt-2 font-mono uppercase tracking-widest\">Privacy-Safe Membership Management</p>\r\n            </div>\r\n            <div className=\"flex gap-4\">\r\n              <input type=\"password\" value={adminKey} onChange={e => setAdminKey(e.target.value)} placeholder=\"System Admin Key\" className=\"bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-xs font-mono\" />\r\n              <button onClick={fetchStats} className=\"bg-gold text-black px-6 py-2 rounded-lg text-xs font-bold uppercase tracking-widest\">Authorize</button>\r\n            </div>\r\n          </header>\r\n\r\n          {data && (\r\n            <div className=\"grid gap-6 md:grid-cols-4 mb-12\">\r\n               <StatCard label=\"Total Members\" val={data.stats.totalMembers} icon={Users} />\r\n               <StatCard label=\"Active Keys\" val={data.stats.totalKeys} icon={Database} />\r\n               <StatCard label=\"Total Unlocks\" val={data.stats.totalUnlocks} icon={ShieldAlert} />\r\n               <StatCard label=\"System Health\" val=\"Stable\" icon={LayoutGrid} color=\"text-emerald-400\" />\r\n            </div>\r\n          )}\r\n\r\n          <div className=\"bg-zinc-900/50 rounded-3xl border border-white/5 overflow-hidden\">\r\n            <table className=\"w-full text-left text-xs\">\r\n              <thead className=\"bg-white/5 font-mono uppercase tracking-tighter text-gray-500\">\r\n                <tr>\r\n                  <th className=\"p-4\">Timestamp</th>\r\n                  <th className=\"p-4\">Identity (Hash)</th>\r\n                  <th className=\"p-4\">Key Suffix</th>\r\n                  <th className=\"p-4\">Status</th>\r\n                  <th className=\"p-4 text-right\">Activity</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody className=\"divide-y divide-white/5\">\r\n                {data?.rows.map((row: any, i: number) => (\r\n                  <tr key={i} className=\"hover:bg-white/[0.02] transition-colors\">\r\n                    <td className=\"p-4 text-gray-400\">{new Date(row.created_at).toLocaleDateString()}</td>\r\n                    <td className=\"p-4 font-mono text-gold/60\">{row.email_hash_prefix}...</td>\r\n                    <td className=\"p-4 font-mono\">****{row.key_suffix}</td>\r\n                    <td className=\"p-4\"><span className=\"bg-emerald-500/10 text-emerald-400 px-2 py-0.5 rounded uppercase font-bold text-[9px]\">{row.status}</span></td>\r\n                    <td className=\"p-4 text-right font-mono\">{row.total_unlocks} Unlocks</td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        </div>\r\n      </main>\r\n    </Layout>\r\n  );\r\n};\r\n\r\nconst StatCard = ({ label, val, icon: Icon, color = \"text-gold\" }: any) => (\r\n  <div className=\"bg-white/5 border border-white/10 p-6 rounded-2xl\">\r\n    <div className=\"flex items-center gap-3 mb-2 text-gray-500\">\r\n      <Icon size={14} />\r\n      <span className=\"text-[9px] font-black uppercase tracking-widest\">{label}</span>\r\n    </div>\r\n    <div className={`text-2xl font-mono font-bold ${color}`}>{val}</div>\r\n  </div>\r\n);\r\n\r\nexport default AdminInnerCirclePage;","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\inner-circle\\index.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ArrowRight' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":40,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":50}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\nimport type { NextPage } from \"next\";\nimport { useRouter } from \"next/router\";\nimport { motion } from \"framer-motion\";\nimport { ShieldCheck, Key, Mail, User, ArrowRight, RefreshCw, CheckCircle } from \"lucide-react\";\n\nimport Layout from \"@/components/Layout\";\nimport useAnalytics from \"@/hooks/useAnalytics\";\nimport { getRecaptchaTokenSafe } from \"@/lib/recaptchaClient\";\n\nconst INNER_CIRCLE_COOKIE_NAME = \"innerCircleAccess\";\n\nfunction hasInnerCircleCookie(): boolean {\n  if (typeof document === \"undefined\") return false;\n  return document.cookie\n    .split(\";\")\n    .map((c) => c.trim())\n    .some((c) => c.startsWith(`${INNER_CIRCLE_COOKIE_NAME}=true`));\n}\n\nconst InnerCirclePage: NextPage = () => {\n  const router = useRouter();\n  const { trackEvent } = useAnalytics();\n\n  const [email, setEmail] = React.useState(\"\");\n  const [name, setName] = React.useState(\"\");\n  const [accessKey, setAccessKey] = React.useState(\"\");\n  const [registerStatus, setRegisterStatus] = React.useState<\"idle\" | \"submitting\" | \"success\" | \"error\">(\"idle\");\n  const [unlockStatus, setUnlockStatus] = React.useState<\"idle\" | \"submitting\" | \"success\" | \"error\">(\"idle\");\n  const [feedback, setFeedback] = React.useState<{ type: \"register\" | \"unlock\"; msg: string } | null>(null);\n  const [alreadyUnlocked, setAlreadyUnlocked] = React.useState(false);\n\n  const returnTo = typeof router.query.returnTo === \"string\" ? router.query.returnTo : \"/canon\";\n\n  React.useEffect(() => {\n    setAlreadyUnlocked(hasInnerCircleCookie());\n  }, []);\n\n  const handleRegister = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setRegisterStatus(\"submitting\");\n    setFeedback(null);\n\n    const token = await getRecaptchaTokenSafe(\"inner_circle_register\");\n    if (!token) {\n      setRegisterStatus(\"error\");\n      setFeedback({ type: \"register\", msg: \"Security verification failed. Please refresh.\" });\n      return;\n    }\n\n    try {\n      const res = await fetch(\"/api/inner-circle/register\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ email, name, returnTo, recaptchaToken: token }),\n      });\n      const data = await res.json();\n\n      if (!data.ok) throw new Error(data.error || \"Registration failed\");\n\n      setRegisterStatus(\"success\");\n      setFeedback({ type: \"register\", msg: \"Access key dispatched. Check your inbox.\" });\n      trackEvent(\"inner_circle_register_success\", { domain: email.split(\"@\")[1] });\n    } catch (err: any) {\n      setRegisterStatus(\"error\");\n      setFeedback({ type: \"register\", msg: err.message });\n    }\n  };\n\n  const handleUnlock = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setUnlockStatus(\"submitting\");\n    setFeedback(null);\n\n    try {\n      const res = await fetch(\"/api/inner-circle/unlock\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ key: accessKey, returnTo }),\n      });\n      const data = await res.json();\n\n      if (!data.ok) throw new Error(data.error || \"Invalid key\");\n\n      setUnlockStatus(\"success\");\n      setAlreadyUnlocked(true);\n      setTimeout(() => void router.push(data.redirectTo || returnTo), 1000);\n    } catch (err: any) {\n      setUnlockStatus(\"error\");\n      setFeedback({ type: \"unlock\", msg: err.message });\n    }\n  };\n\n  return (\n    <Layout title=\"Inner Circle\" description=\"Private access to the Abraham of London archives.\">\n      <main className=\"min-h-screen bg-[#050505] text-cream pt-32 pb-20\">\n        <section className=\"mx-auto max-w-5xl px-6\">\n          \n          <header className=\"mb-20 text-center\">\n            <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} className=\"mb-6 inline-flex items-center gap-2 rounded-full border border-gold/30 bg-gold/5 px-4 py-1.5\">\n              <ShieldCheck size={14} className=\"text-gold\" />\n              <span className=\"text-[10px] font-black uppercase tracking-[0.3em] text-gold\">Membership Authority</span>\n            </motion.div>\n            <h1 className=\"font-serif text-5xl font-bold text-white sm:text-7xl\">Inner Circle</h1>\n            <p className=\"mx-auto mt-6 max-w-2xl text-lg text-gray-400\">\n              Access exclusive strategic volumes, early drafts, and architectural notes. \n              Entry is reserved for those who carry the weight of responsibility.\n            </p>\n          </header>\n\n          <div className=\"grid gap-12 lg:grid-cols-2\">\n            {/* REGISTER */}\n            <motion.div className=\"rounded-[2.5rem] border border-white/5 bg-zinc-900/30 p-10 backdrop-blur-xl\">\n              <h2 className=\"font-serif text-2xl font-bold text-white mb-8\">Request Entry</h2>\n              <form onSubmit={handleRegister} className=\"space-y-6\">\n                <div className=\"space-y-2\">\n                  <label className=\"flex items-center gap-2 text-[10px] font-bold uppercase tracking-widest text-gold/60\"><User size={12}/> Name</label>\n                  <input type=\"text\" required value={name} onChange={e => setName(e.target.value)} className=\"w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 outline-none focus:border-gold/50 transition-all\" placeholder=\"Legal or common name\" />\n                </div>\n                <div className=\"space-y-2\">\n                  <label className=\"flex items-center gap-2 text-[10px] font-bold uppercase tracking-widest text-gold/60\"><Mail size={12}/> Email</label>\n                  <input type=\"email\" required value={email} onChange={e => setEmail(e.target.value)} className=\"w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 outline-none focus:border-gold/50 transition-all\" placeholder=\"advisory@firm.com\" />\n                </div>\n                <button disabled={registerStatus === \"submitting\"} className=\"w-full bg-gold text-black py-4 rounded-xl font-black uppercase tracking-widest text-xs hover:bg-white transition-all flex justify-center items-center gap-2\">\n                  {registerStatus === \"submitting\" ? <RefreshCw className=\"animate-spin\" size={16}/> : \"Dispatch Access Key\"}\n                </button>\n                {feedback?.type === \"register\" && (\n                  <p className={`text-xs font-bold text-center ${registerStatus === \"error\" ? \"text-rose-400\" : \"text-emerald-400\"}`}>{feedback.msg}</p>\n                )}\n              </form>\n            </motion.div>\n\n            {/* UNLOCK */}\n            <motion.div className=\"rounded-[2.5rem] border border-gold/20 bg-gold/5 p-10 backdrop-blur-xl\">\n              <h2 className=\"font-serif text-2xl font-bold text-white mb-8\">Unlock Vault</h2>\n              <form onSubmit={handleUnlock} className=\"space-y-6\">\n                <div className=\"space-y-2\">\n                  <label className=\"flex items-center gap-2 text-[10px] font-bold uppercase tracking-widest text-gold/60\"><Key size={12}/> Access Key</label>\n                  <input type=\"password\" required value={accessKey} onChange={e => setAccessKey(e.target.value)} className=\"w-full bg-black/40 border border-gold/20 rounded-xl px-4 py-3 font-mono text-gold outline-none focus:border-gold transition-all\" placeholder=\"ic_â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢\" />\n                </div>\n                <button disabled={unlockStatus === \"submitting\" || alreadyUnlocked} className=\"w-full border border-gold text-gold py-4 rounded-xl font-black uppercase tracking-widest text-xs hover:bg-gold hover:text-black transition-all flex justify-center items-center gap-2\">\n                  {alreadyUnlocked ? <CheckCircle size={16}/> : unlockStatus === \"submitting\" ? <RefreshCw className=\"animate-spin\" size={16}/> : \"Apply Security Key\"}\n                </button>\n                {feedback?.type === \"unlock\" && (\n                  <p className=\"text-xs font-bold text-center text-rose-400\">{feedback.msg}</p>\n                )}\n              </form>\n              <div className=\"mt-8 pt-8 border-t border-gold/10 text-center\">\n                <p className=\"text-[10px] text-gray-500 uppercase tracking-widest\">Access persists on this device until cleared</p>\n              </div>\n            </motion.div>\n          </div>\n\n        </section>\n      </main>\n    </Layout>\n  );\n};\n\nexport default InnerCirclePage;","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\inner-circle\\locked.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\inner-circle\\resend.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\leadership\\index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\newsletter.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\prints\\[slug].tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Head' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":12}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\nimport type { GetStaticPaths, GetStaticProps, NextPage } from \"next\";\nimport Head from \"next/head\";\nimport Layout from \"@/components/Layout\";\nimport { getAllPrints, getPrintBySlug } from \"@/lib/contentlayer-helper\";\nimport { serialize } from \"next-mdx-remote/serialize\";\nimport mdxComponents from \"@/components/mdx-components\";\nimport { MDXRemote } from \"next-mdx-remote\";\n\nexport const getStaticPaths: GetStaticPaths = async () => {\n  const paths = getAllPrints().map((p) => ({\n    params: { slug: p.slug }\n  }));\n  return { paths, fallback: false };\n};\n\nexport const getStaticProps: GetStaticProps = async ({ params }) => {\n  const slug = String(params?.slug ?? \"\").toLowerCase().trim();\n  const rawDoc = getPrintBySlug(slug);\n\n  if (!rawDoc) return { notFound: true };\n\n  const print = {\n    title: rawDoc.title || \"Exclusive Print\",\n    price: rawDoc.price || null,\n    excerpt: rawDoc.excerpt || null,\n  };\n\n  try {\n    const source = await serialize(rawDoc.body.raw);\n    return { \n      props: { print, source: JSON.parse(JSON.stringify(source)) }, \n      revalidate: 1800 \n    };\n  } catch (err) {\n    return { notFound: true };\n  }\n};\n\nconst PrintPage: NextPage<{print: any, source: any}> = ({ print, source }) => (\n  <Layout title={print.title}>\n    <main className=\"mx-auto max-w-3xl px-4 py-12 lg:py-20\">\n      <header className=\"mb-10 border-b border-gold/10 pb-10 text-center\">\n        <p className=\"text-xs font-semibold uppercase tracking-widest text-gold/70\">Exclusive Print</p>\n        <h1 className=\"font-serif text-4xl text-cream mt-4\">{print.title}</h1>\n        {print.price && <p className=\"text-lg text-gold mt-2\">{print.price}</p>}\n      </header>\n      <article className=\"prose prose-invert max-w-none\">\n        <MDXRemote {...source} components={mdxComponents} />\n      </article>\n    </main>\n  </Layout>\n);\n\nexport default PrintPage;","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\prints\\index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\privacy.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\resources\\[...slug].tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\resources\\index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\security-policy.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\security.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\shorts\\[slug].tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\shorts\\index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\speaking\\index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\strategy\\[slug].tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\strategy\\index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\subscribe.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":244,"column":28,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[11583,11868],"text":"\n              The Founding Readers Circle is intentionally limited to ensure\n              meaningful engagement and strategic focus. This is more than a\n              newsletterâ€”it&apos;s the beginning of a movement to rebuild the\n              architecture of human purpose.\n            "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[11583,11868],"text":"\n              The Founding Readers Circle is intentionally limited to ensure\n              meaningful engagement and strategic focus. This is more than a\n              newsletterâ€”it&lsquo;s the beginning of a movement to rebuild the\n              architecture of human purpose.\n            "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[11583,11868],"text":"\n              The Founding Readers Circle is intentionally limited to ensure\n              meaningful engagement and strategic focus. This is more than a\n              newsletterâ€”it&#39;s the beginning of a movement to rebuild the\n              architecture of human purpose.\n            "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[11583,11868],"text":"\n              The Founding Readers Circle is intentionally limited to ensure\n              meaningful engagement and strategic focus. This is more than a\n              newsletterâ€”it&rsquo;s the beginning of a movement to rebuild the\n              architecture of human purpose.\n            "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// pages/subscribe.tsx\nimport type { NextPage } from \"next\";\nimport * as React from \"react\";\nimport Head from \"next/head\";\nimport Link from \"next/link\";\n\nimport Layout from \"@/components/Layout\";\nimport NewsletterForm from \"@/components/NewsletterForm\";\n\nconst SubscribePage: NextPage = () => {\n  const pageTitle = \"Join the Founding Readers Circle | Abraham of London\";\n  const pageDescription =\n    \"Early access to The Architecture of Human Purpose Canon for fathers, founders, builders, and institutional architects shaping the future of civilization.\";\n\n  return (\n    <Layout pageTitle={pageTitle}>\n      <Head>\n        <title>{pageTitle}</title>\n        <meta name=\"description\" content={pageDescription} />\n        <meta property=\"og:title\" content={pageTitle} />\n        <meta property=\"og:description\" content={pageDescription} />\n        <meta property=\"og:type\" content=\"website\" />\n        <meta name=\"twitter:card\" content=\"summary_large_image\" />\n        <meta name=\"twitter:title\" content={pageTitle} />\n        <meta name=\"twitter:description\" content={pageDescription} />\n      </Head>\n\n      <main className=\"min-h-screen bg-charcoal text-cream\">\n        <section className=\"mx-auto flex max-w-4xl flex-col gap-10 px-6 py-16 lg:py-24\">\n          {/* Premium Header Section */}\n          <div className=\"space-y-6 border-b border-softGold/20 pb-8 text-center\">\n            <div className=\"inline-flex items-center gap-2 rounded-full border border-softGold/30 bg-softGold/10 px-4 py-2\">\n              <span className=\"text-xs font-semibold uppercase tracking-[0.2em] text-softGold\">\n                The Architecture of Human Purpose Â· Canon\n              </span>\n            </div>\n\n            <h1 className=\"bg-gradient-to-b from-cream to-softGold bg-clip-text font-serif text-4xl font-bold tracking-tight text-transparent sm:text-5xl lg:text-6xl\">\n              Join the Founding Readers Circle\n            </h1>\n\n            <p className=\"mx-auto max-w-2xl text-lg leading-relaxed text-gray-300 sm:text-xl\">\n              For the builders, reformers, and institutional architects ready to\n              shape the conversation around human purpose and civilizational\n              design.\n            </p>\n          </div>\n\n          {/* Two Column Layout */}\n          <div className=\"grid gap-12 lg:grid-cols-2 lg:gap-16\">\n            {/* Left Column: Benefits & Value Proposition */}\n            <div className=\"space-y-8\">\n              {/* Founding Reader Benefits */}\n              <div className=\"rounded-2xl border border-softGold/25 bg-black/40 p-8 backdrop-blur-sm\">\n                <h2 className=\"mb-6 font-serif text-2xl font-bold text-cream\">\n                  Founding Reader Benefits\n                </h2>\n\n                <div className=\"space-y-6\">\n                  <div className=\"flex gap-4\">\n                    <div className=\"mt-1 flex h-6 w-6 flex-shrink-0 items-center justify-center rounded-full bg-softGold/20\">\n                      <span className=\"text-sm text-softGold\">1</span>\n                    </div>\n                    <div>\n                      <h3 className=\"mb-1 font-semibold text-cream\">\n                        Exclusive Early Access\n                      </h3>\n                      <p className=\"text-sm leading-relaxed text-gray-300\">\n                        Receive chapter previews and frameworks months before\n                        public release, with direct author commentary on\n                        implementation.\n                      </p>\n                    </div>\n                  </div>\n\n                  <div className=\"flex gap-4\">\n                    <div className=\"mt-1 flex h-6 w-6 flex-shrink-0 items-center justify-center rounded-full bg-softGold/20\">\n                      <span className=\"text-sm text-softGold\">2</span>\n                    </div>\n                    <div>\n                      <h3 className=\"mb-1 font-semibold text-cream\">\n                        Founder-Only Masterclasses\n                      </h3>\n                      <p className=\"text-sm leading-relaxed text-gray-300\">\n                        Live sessions diving deep into the frameworks, tools,\n                        and implementation strategies for personal and\n                        organizational transformation.\n                      </p>\n                    </div>\n                  </div>\n\n                  <div className=\"flex gap-4\">\n                    <div className=\"mt-1 flex h-6 w-6 flex-shrink-0 items-center justify-center rounded-full bg-softGold/20\">\n                      <span className=\"text-sm text-softGold\">3</span>\n                    </div>\n                    <div>\n                      <h3 className=\"mb-1 font-semibold text-cream\">\n                        Strategic Community Access\n                      </h3>\n                      <p className=\"text-sm leading-relaxed text-gray-300\">\n                        Connect with other builders, reformers, and\n                        institutional architects in private conversations that\n                        shape the future.\n                      </p>\n                    </div>\n                  </div>\n\n                  <div className=\"flex gap-4\">\n                    <div className=\"mt-1 flex h-6 w-6 flex-shrink-0 items-center justify-center rounded-full bg-softGold/20\">\n                      <span className=\"text-sm text-softGold\">4</span>\n                    </div>\n                    <div>\n                      <h3 className=\"mb-1 font-semibold text-cream\">\n                        Permanent Founding Status\n                      </h3>\n                      <p className=\"text-sm leading-relaxed text-gray-300\">\n                        Your name in the official canon registry and lifetime\n                        priority access to all Abraham of London initiatives.\n                      </p>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Urgency Indicator */}\n                <div className=\"mt-8 rounded-lg border border-softGold/20 bg-softGold/10 p-4\">\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"h-3 w-3 flex-shrink-0 animate-pulse rounded-full bg-softGold\" />\n                    <p className=\"text-sm font-semibold text-softGold\">\n                      Limited to first 1,000 members â€¢{\" \"}\n                      {Math.floor(Math.random() * 100) + 750} spots remaining\n                    </p>\n                  </div>\n                </div>\n              </div>\n\n              {/* Testimonial/Endorsement Placeholder */}\n              <div className=\"rounded-2xl border border-gray-600/30 bg-black/30 p-6\">\n                <blockquote className=\"space-y-3\">\n                  <p className=\"text-sm italic leading-relaxed text-gray-300\">\n                    &quot;The frameworks in this canon provide the missing\n                    architecture for understanding why civilizations succeed or\n                    fail. Essential reading for anyone building institutions\n                    meant to last generations.&quot;\n                  </p>\n                  <footer className=\"text-xs text-gray-400\">\n                    â€” Early Reader, Institutional Architect\n                  </footer>\n                </blockquote>\n              </div>\n            </div>\n\n            {/* Right Column: Enrollment Form */}\n            <div className=\"space-y-8\">\n              <div className=\"rounded-2xl border border-softGold/25 bg-black/40 p-8 backdrop-blur-sm\">\n                <div className=\"mb-8 text-center\">\n                  <h2 className=\"mb-3 font-serif text-2xl font-bold text-cream\">\n                    Secure Your Founding Access\n                  </h2>\n                  <p className=\"text-sm leading-relaxed text-gray-300\">\n                    Enter your email to receive immediate access to the Prelude\n                    MiniBook and join the exclusive Founding Readers Circle.\n                  </p>\n                </div>\n\n                {/* Enhanced Form Section */}\n                <div className=\"space-y-6\">\n                  <div className=\"rounded-lg border border-softGold/10 bg-gradient-to-r from-softGold/5 to-transparent p-4\">\n                    <h3 className=\"mb-2 text-sm font-semibold uppercase tracking-wide text-cream\">\n                      What You&apos;ll Receive Immediately:\n                    </h3>\n                    <ul className=\"space-y-1 text-sm text-gray-300\">\n                      <li>â€¢ The Architecture of Human Purpose Prelude (PDF)</li>\n                      <li>â€¢ Founding Reader welcome package</li>\n                      <li>â€¢ Early access to Chapter 1 frameworks</li>\n                      <li>â€¢ Invitation to first masterclass</li>\n                    </ul>\n                  </div>\n\n                  <NewsletterForm\n                    variant=\"premium\"\n                    buttonText=\"Join the Founding Readers Circle â†’\"\n                  />\n\n                  {/* Trust Indicators */}\n                  <div className=\"space-y-3 border-t border-gray-600/30 pt-4 text-center\">\n                    <div className=\"flex items-center justify-center gap-6 text-xs text-gray-400\">\n                      <span>No Spam</span>\n                      <span>â€¢</span>\n                      <span>One-Click Unsubscribe</span>\n                      <span>â€¢</span>\n                      <span>Priority Support</span>\n                    </div>\n                    <p className=\"text-xs text-gray-500\">\n                      By joining, you agree to our{\" \"}\n                      <Link\n                        href=\"/privacy\"\n                        className=\"text-softGold hover:underline\"\n                      >\n                        Privacy Policy\n                      </Link>{\" \"}\n                      and consent to receive strategic updates.\n                    </p>\n                  </div>\n                </div>\n              </div>\n\n              {/* Additional Value Proposition */}\n              <div className=\"rounded-2xl border border-gray-600/30 bg-black/30 p-6\">\n                <h3 className=\"mb-3 text-sm font-semibold uppercase tracking-wide text-cream\">\n                  Why This Matters Now:\n                </h3>\n                <ul className=\"space-y-2 text-sm text-gray-300\">\n                  <li className=\"flex items-start gap-2\">\n                    <span className=\"mt-1 text-softGold\">â€¢</span>\n                    <span>\n                      We&apos;re living through the most significant power\n                      realignment since the Roman Empire.\n                    </span>\n                  </li>\n                  <li className=\"flex items-start gap-2\">\n                    <span className=\"mt-1 text-softGold\">â€¢</span>\n                    <span>\n                      The frameworks for understanding civilization are outdated\n                      and incomplete.\n                    </span>\n                  </li>\n                  <li className=\"flex items-start gap-2\">\n                    <span className=\"mt-1 text-softGold\">â€¢</span>\n                    <span>\n                      Those who master this architecture will shape the next\n                      century.\n                    </span>\n                  </li>\n                </ul>\n              </div>\n            </div>\n          </div>\n\n          {/* Bottom CTA Section */}\n          <div className=\"border-t border-gray-600/30 pt-12 text-center\">\n            <p className=\"mx-auto max-w-2xl text-sm leading-relaxed text-gray-400\">\n              The Founding Readers Circle is intentionally limited to ensure\n              meaningful engagement and strategic focus. This is more than a\n              newsletterâ€”it's the beginning of a movement to rebuild the\n              architecture of human purpose.\n            </p>\n          </div>\n        </section>\n      </main>\n    </Layout>\n  );\n};\n\nexport default SubscribePage;\n","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\terms-of-service.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\terms.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\ventures\\index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\pages\\works-in-progress.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\playwright.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\postcss\\no-slash-opacity.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\proxy.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\scripts\\auto-resolve-conflicts.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\scripts\\build-fallback.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\scripts\\check-conflicts.js","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'eIdx' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":93,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":93,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import fs from \"node:fs\";\nimport path from \"node:path\";\nimport { fileURLToPath } from \"node:url\";\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n\n/** Only scan real source trees (skip build output) */\nconst SOURCE_DIRS = [\n  \"app\",\n  \"components\",\n  \"lib\",\n  \"src\",\n  \"scripts\",\n  \"styles\",\n  \"netlify\",\n  \"patches\",\n  \"types\",\n  \"pages\",\n  \"config\",\n];\nconst IGNORE_DIRS = [\n  \"node_modules\",\n  \".next\",\n  \".netlify\",\n  \".contentlayer\",\n  \".turbo\",\n  \".cache\",\n  \".git\",\n  \"dist\",\n  \"build\",\n  \"public\",\n];\nconst TEXT_EXTS = new Set([\n  \".ts\",\n  \".tsx\",\n  \".js\",\n  \".jsx\",\n  \".mjs\",\n  \".cjs\",\n  \".json\",\n  \".md\",\n  \".mdx\",\n  \".css\",\n  \".scss\",\n  \".sass\",\n  \".yml\",\n  \".yaml\",\n  \".toml\",\n]);\n\n/** Strict Git marker regexes (line must match the actual markers) */\nconst START_RE = /^<{7}(?:[ \\t].*)?$/m; // <<<<<<< HEAD or <<<<<<< branch\nconst MID_RE = /^={7}\\s*$/m; // =======\nconst END_RE = /^>{7}(?:[ \\t].*)?$/m; // >>>>>>> commit/branch\n\nfunction walk(dir) {\n  const out = [];\n  if (!fs.existsSync(dir)) return out;\n  for (const entry of fs.readdirSync(dir, { withFileTypes: true })) {\n    const full = path.join(dir, entry.name);\n    if (IGNORE_DIRS.some((d) => full.includes(path.sep + d + path.sep)))\n      continue;\n    if (entry.isDirectory()) out.push(...walk(full));\n    else out.push(full);\n  }\n  return out;\n}\n\nfunction isTextFile(file) {\n  return TEXT_EXTS.has(path.extname(file).toLowerCase());\n}\n\n/** True conflict iff a file has a proper block: start + mid + end (at least one set) */\nfunction hasRealConflict(text) {\n  // fast check\n  if (!START_RE.test(text)) return false;\n  // verify a block order exists\n  let i = 0;\n  while (i < text.length) {\n    const start = text.slice(i).search(START_RE);\n    if (start === -1) return false;\n    const sIdx = i + start;\n\n    const afterStart = text.slice(sIdx);\n    const midRel = afterStart.search(MID_RE);\n    if (midRel === -1) return false;\n    const mIdx = sIdx + midRel;\n\n    const afterMid = text.slice(mIdx);\n    const endRel = afterMid.search(END_RE);\n    if (endRel === -1) return false;\n    const eIdx = mIdx + endRel;\n\n    // Found one valid block\n    return true;\n  }\n  return false;\n}\n\nfunction collectCandidates() {\n  let files = [];\n  for (const d of SOURCE_DIRS) if (fs.existsSync(d)) files.push(...walk(d));\n  // only text files under 1MB\n  return files.filter((f) => {\n    try {\n      const st = fs.statSync(f);\n      if (!st.isFile() || st.size > 1024 * 1024) return false;\n      return isTextFile(f);\n    } catch {\n      return false;\n    }\n  });\n}\n\nconsole.log(\"ðŸ” Checking for merge conflicts in editable source files...\\n\");\n\nconst conflicted = [];\nfor (const f of collectCandidates()) {\n  try {\n    const txt = fs.readFileSync(f, \"utf8\");\n    if (hasRealConflict(txt)) conflicted.push(f);\n  } catch {\n    /* ignore */\n  }\n}\n\nif (conflicted.length) {\n  console.error(\"âŒ Merge conflict markers found in the following files:\\n\");\n  conflicted.forEach((f) => console.error(\" â€¢ \" + f));\n  console.error(\"\\nðŸš¨ Resolve these before committing or deploying.\\n\");\n  process.exit(1);\n}\n\nconsole.log(\"âœ… No merge conflicts found in your source tree.\");\n","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\scripts\\check-exports.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\scripts\\check-missing-covers.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'COVER_OVERRIDES' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":6,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// scripts/check-missing-covers.ts\r\nimport { buildSearchIndex, type SearchDoc } from \"../lib/searchIndex\";\r\n\r\ntype ContentKey = `${SearchDoc[\"type\"]}:${string}`;\r\n\r\nconst COVER_OVERRIDES: Record<ContentKey, string> = require(\"../pages/content/cover-overrides.json\"); \r\n// or, if you keep it inline, just copy the object here manually for the check.\r\n\r\nfunction hasCover(doc: SearchDoc): boolean {\r\n  const key = `${doc.type}:${doc.slug}` as ContentKey;\r\n  // @ts-ignore â€“ this is just a quick script\r\n  const overrides = (global as any).COVER_OVERRIDES || {};\r\n  if (overrides[key]) return true;\r\n  return !!doc.coverImage;\r\n}\r\n\r\nconst index = buildSearchIndex();\r\n\r\nconst missing = index.filter((doc) => !hasCover(doc));\r\n\r\nconsole.log(\"Docs without cover art:\");\r\nfor (const doc of missing) {\r\n  console.log(\r\n    `- ${doc.type}:${doc.slug}  (title: ${doc.title})  current coverImage: ${doc.coverImage ?? \"none\"}`,\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\scripts\\check-print-slugs.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\scripts\\contentlayer-build.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\scripts\\contentlayer-windows-fix.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\scripts\\debug-build.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\scripts\\fix-canon-files.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\scripts\\fix-content-errors.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\scripts\\fix-print-types.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\scripts\\generate-ultimate-purpose-of-man-pdf.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\scripts\\netlify-build.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\scripts\\prepare-build.js","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'execSync' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":18}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// scripts/prepare-build.js\r\nimport { execSync } from 'child_process';\r\n\r\nconsole.log('ðŸš€ Preparing build environment...');\r\n\r\n// Set environment variables\r\nprocess.env.CI = 'false';\r\nprocess.env.HUSKY = '0';\r\nprocess.env.NEXT_DISABLE_ESLINT = '1';\r\nprocess.env.NEXT_DISABLE_TYPECHECK = '1';\r\n\r\nconsole.log('âœ… Environment variables set');","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\scripts\\prevent-pages-router.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\scripts\\run-migrations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\scripts\\run-validate-downloads.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\scripts\\test-admin.js","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'crypto' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":2,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nconst crypto = require('crypto');\r\n\r\n// Generate test data\r\nfunction generateTestData() {\r\n  const adminKey = process.env.INNER_CIRCLE_ADMIN_KEY || 'test-admin-key';\r\n  const baseUrl = process.env.NEXT_PUBLIC_SITE_URL || 'http://localhost:3000';\r\n  \r\n  console.log('ðŸ”§ Inner Circle Admin Test Script');\r\n  console.log('================================');\r\n  console.log(`Admin Key: ${adminKey.slice(0, 10)}...${adminKey.slice(-10)}`);\r\n  console.log(`Base URL: ${baseUrl}`);\r\n  console.log('');\r\n  \r\n  // Test commands\r\n  console.log('ðŸ“‹ Test Commands:');\r\n  console.log('');\r\n  console.log('1. Export data:');\r\n  console.log(`curl -H \"x-inner-circle-admin-key: ${adminKey}\" ${baseUrl}/api/admin/inner-circle/export`);\r\n  console.log('');\r\n  console.log('2. Test revoke key (replace KEY_HERE):');\r\n  console.log(`curl -X POST -H \"Content-Type: application/json\" -H \"x-inner-circle-admin-key: ${adminKey}\" -d '{\"key\":\"KEY_HERE\"}' ${baseUrl}/api/admin/inner-circle/revoke`);\r\n  console.log('');\r\n  console.log('3. Test cleanup:');\r\n  console.log(`curl -X POST -H \"Content-Type: application/json\" -H \"x-inner-circle-admin-key: ${adminKey}\" ${baseUrl}/api/admin/inner-circle/cleanup`);\r\n  console.log('');\r\n  console.log('4. Test delete member:');\r\n  console.log(`curl -X POST -H \"Content-Type: application/json\" -H \"x-inner-circle-admin-key: ${adminKey}\" -d '{\"email\":\"test@example.com\"}' ${baseUrl}/api/admin/inner-circle/delete-member`);\r\n  console.log('');\r\n  console.log('ðŸŒ Admin UI:');\r\n  console.log(`${baseUrl}/admin/inner-circle`);\r\n}\r\n\r\nif (require.main === module) {\r\n  generateTestData();\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\scripts\\test-content.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\scripts\\validate-gitattributes.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\scripts\\verify-types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\setup.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\setup\\next.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\simple-deploy.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\src\\components\\ArticleHero.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\src\\components\\Callout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\src\\components\\CanonCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\src\\components\\Debug.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\src\\components\\Divider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\src\\components\\Layout\\index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\src\\components\\LuxuryAnimations.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\src\\components\\NewsletterForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\src\\components\\SiteLayout.tsx","messages":[{"ruleId":"@next/next/no-html-link-for-pages","severity":2,"message":"Do not use an `<a>` element to navigate to `/`. Use `<Link />` from `next/link` instead. See: https://nextjs.org/docs/messages/no-html-link-for-pages","line":38,"column":17,"nodeType":"JSXOpeningElement","endLine":38,"endColumn":79},{"ruleId":"@next/next/no-html-link-for-pages","severity":2,"message":"Do not use an `<a>` element to navigate to `/resources/`. Use `<Link />` from `next/link` instead. See: https://nextjs.org/docs/messages/no-html-link-for-pages","line":41,"column":17,"nodeType":"JSXOpeningElement","endLine":44,"endColumn":18},{"ruleId":"@next/next/no-html-link-for-pages","severity":2,"message":"Do not use an `<a>` element to navigate to `/resources/`. Use `<Link />` from `next/link` instead. See: https://nextjs.org/docs/messages/no-html-link-for-pages","line":41,"column":17,"nodeType":"JSXOpeningElement","endLine":44,"endColumn":18},{"ruleId":"@next/next/no-html-link-for-pages","severity":2,"message":"Do not use an `<a>` element to navigate to `/about/`. Use `<Link />` from `next/link` instead. See: https://nextjs.org/docs/messages/no-html-link-for-pages","line":47,"column":17,"nodeType":"JSXOpeningElement","endLine":50,"endColumn":18},{"ruleId":"@next/next/no-html-link-for-pages","severity":2,"message":"Do not use an `<a>` element to navigate to `/about/`. Use `<Link />` from `next/link` instead. See: https://nextjs.org/docs/messages/no-html-link-for-pages","line":47,"column":17,"nodeType":"JSXOpeningElement","endLine":50,"endColumn":18},{"ruleId":"@next/next/no-html-link-for-pages","severity":2,"message":"Do not use an `<a>` element to navigate to `/contact/`. Use `<Link />` from `next/link` instead. See: https://nextjs.org/docs/messages/no-html-link-for-pages","line":53,"column":17,"nodeType":"JSXOpeningElement","endLine":56,"endColumn":18},{"ruleId":"@next/next/no-html-link-for-pages","severity":2,"message":"Do not use an `<a>` element to navigate to `/contact/`. Use `<Link />` from `next/link` instead. See: https://nextjs.org/docs/messages/no-html-link-for-pages","line":53,"column":17,"nodeType":"JSXOpeningElement","endLine":56,"endColumn":18}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React from \"react\";\nimport Head from \"next/head\";\n\ninterface SiteLayoutProps {\n  children: React.ReactNode;\n  title?: string;\n  description?: string;\n  className?: string;\n}\n\nconst SiteLayout: React.FC<SiteLayoutProps> = ({\n  children,\n  title = \"Abraham of London\",\n  description = \"Faith-rooted strategy for fathers, founders, and board-level leaders who refuse to outsource responsibility.\",\n  className = \"\",\n}) => {\n  return (\n    <>\n      <Head>\n        <title>{title}</title>\n        <meta name=\"description\" content={description} />\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n        <link rel=\"icon\" href=\"/favicon.ico\" />\n      </Head>\n\n      <div\n        className={`min-h-screen bg-white dark:bg-gray-900 text-gray-900 dark:text-white ${className}`}\n      >\n        {/* Site header would go here */}\n        <header className=\"border-b border-gray-200 dark:border-gray-700\">\n          <div className=\"max-w-6xl mx-auto px-4 py-4\">\n            <div className=\"flex justify-between items-center\">\n              <div className=\"text-xl font-serif font-semibold text-softGold\">\n                Abraham of London\n              </div>\n              <nav className=\"hidden md:flex space-x-6\">\n                <a href=\"/\" className=\"hover:text-softGold transition-colors\">\n                  Home\n                </a>\n                <a\n                  href=\"/resources\"\n                  className=\"hover:text-softGold transition-colors\"\n                >\n                  Resources\n                </a>\n                <a\n                  href=\"/about\"\n                  className=\"hover:text-softGold transition-colors\"\n                >\n                  About\n                </a>\n                <a\n                  href=\"/contact\"\n                  className=\"hover:text-softGold transition-colors\"\n                >\n                  Contact\n                </a>\n              </nav>\n            </div>\n          </div>\n        </header>\n\n        <main>{children}</main>\n\n        {/* Site footer would go here */}\n        <footer className=\"border-t border-gray-200 dark:border-gray-700 mt-16\">\n          <div className=\"max-w-6xl mx-auto px-4 py-8\">\n            <div className=\"text-center text-gray-600 dark:text-gray-400\">\n              <p>\n                &copy; {new Date().getFullYear()} Abraham of London. All rights\n                reserved.\n              </p>\n              <p className=\"mt-2 text-sm\">\n                Building fathers, founders & faithful leaders.\n              </p>\n            </div>\n          </div>\n        </footer>\n      </div>\n    </>\n  );\n};\n\nexport default SiteLayout;\n","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\src\\components\\SomeOtherComponent.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\src\\components\\mdx-components.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\src\\lib\\server\\downloads-data.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\src\\lib\\server\\events-data.ts","messages":[{"ruleId":"import/no-anonymous-default-export","severity":1,"message":"Assign object to a variable before exporting as module default","line":235,"column":1,"nodeType":"ExportDefaultDeclaration","endLine":241,"endColumn":3}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// lib/server/events-data.ts\nimport fs from \"fs\";\nimport path from \"path\";\nimport matter from \"gray-matter\";\n\n// Server-side guard\nif (typeof window !== \"undefined\") {\n  throw new Error(\"This module is server-only\");\n}\n\nexport interface EventMeta {\n  slug: string;\n  title: string;\n  description?: string;\n  excerpt?: string;\n  date: string;\n  endDate?: string;\n  location?: string;\n  venue?: string;\n  category?: string;\n  tags?: string[];\n  author?: string;\n  featured?: boolean;\n  registrationUrl?: string;\n  content?: string;\n}\n\nconst eventsDir = path.join(process.cwd(), \"content\", \"events\");\nconst exts = [\".mdx\", \".md\"] as const;\n\nfunction resolveEventPath(slug: string): string | null {\n  const real = slug.replace(/\\.mdx?$/i, \"\");\n\n  if (!fs.existsSync(eventsDir)) {\n    console.warn(\"[events-data] Events directory does not exist:\", eventsDir);\n    return null;\n  }\n\n  for (const ext of exts) {\n    const full = path.join(eventsDir, `${real}${ext}`);\n    if (fs.existsSync(full)) return full;\n  }\n  return null;\n}\n\nexport function getEventSlugs(): string[] {\n  if (!fs.existsSync(eventsDir)) {\n    console.warn(\"[events-data] Events directory not found:\", eventsDir);\n    return [];\n  }\n\n  try {\n    return fs\n      .readdirSync(eventsDir)\n      .filter((f) => exts.some((e) => f.toLowerCase().endsWith(e)))\n      .map((f) => f.replace(/\\.mdx?$/i, \"\"));\n  } catch (err) {\n    console.error(\"[events-data] Error reading events directory:\", err);\n    return [];\n  }\n}\n\nexport function getEventBySlug(\n  slug: string,\n  fields: string[] = []\n): EventMeta | null {\n  const real = slug.replace(/\\.mdx?$/i, \"\");\n  const fullPath = resolveEventPath(real);\n\n  if (!fullPath) {\n    console.warn(\"[events-data] Event not found for slug:\", real);\n\n    // Check mock events\n    const knownEvent = mockEvents.find((event) => event.slug === real);\n    if (knownEvent) {\n      if (fields.length > 0) {\n        const filteredEvent: any = {};\n        fields.forEach((field) => {\n          if (field in knownEvent) {\n            filteredEvent[field] = (knownEvent as any)[field];\n          }\n        });\n        return filteredEvent;\n      }\n      return knownEvent;\n    }\n\n    return null;\n  }\n\n  try {\n    const raw = fs.readFileSync(fullPath, \"utf8\");\n    const { data, content } = matter(raw);\n    const fm = data || {};\n\n    const eventData: EventMeta = {\n      slug: real,\n      title: typeof fm.title === \"string\" ? fm.title : \"Untitled Event\",\n      description:\n        typeof fm.description === \"string\" ? fm.description : undefined,\n      excerpt: typeof fm.excerpt === \"string\" ? fm.excerpt : undefined,\n      date: typeof fm.date === \"string\" ? fm.date : new Date().toISOString(),\n      endDate: typeof fm.endDate === \"string\" ? fm.endDate : undefined,\n      location: typeof fm.location === \"string\" ? fm.location : undefined,\n      venue: typeof fm.venue === \"string\" ? fm.venue : undefined,\n      category: typeof fm.category === \"string\" ? fm.category : undefined,\n      tags: Array.isArray(fm.tags) ? fm.tags : undefined,\n      author: typeof fm.author === \"string\" ? fm.author : \"Abraham of London\",\n      featured: typeof fm.featured === \"boolean\" ? fm.featured : false,\n      registrationUrl:\n        typeof fm.registrationUrl === \"string\" ? fm.registrationUrl : undefined,\n      content: content || \"\",\n    };\n\n    if (fields.length > 0) {\n      const filteredEvent: any = {};\n      fields.forEach((field) => {\n        if (field in eventData) {\n          filteredEvent[field] = (eventData as any)[field];\n        }\n      });\n      return filteredEvent;\n    }\n\n    return eventData;\n  } catch (err) {\n    console.error(`[events-data] Error processing event ${slug}:`, err);\n\n    const knownEvent = mockEvents.find((event) => event.slug === real);\n    if (knownEvent) {\n      if (fields.length > 0) {\n        const filteredEvent: any = {};\n        fields.forEach((field) => {\n          if (field in knownEvent) {\n            filteredEvent[field] = (knownEvent as any)[field];\n          }\n        });\n        return filteredEvent;\n      }\n      return knownEvent;\n    }\n\n    return null;\n  }\n}\n\nexport function getAllEvents(fields: string[] = []): EventMeta[] {\n  const slugs = getEventSlugs();\n  const events: EventMeta[] = [];\n\n  for (const slug of slugs) {\n    const event = getEventBySlug(slug, fields);\n    if (event) {\n      events.push(event);\n    }\n  }\n\n  // If no events found in filesystem, use mock events\n  if (events.length === 0) {\n    console.warn(\n      \"[events-data] No events found in filesystem, using mock data\"\n    );\n    return mockEvents.map((event) => {\n      if (fields.length > 0) {\n        const filteredEvent: any = {};\n        fields.forEach((field) => {\n          if (field in event) {\n            filteredEvent[field] = (event as any)[field];\n          }\n        });\n        return filteredEvent as EventMeta;\n      }\n      return event;\n    });\n  }\n\n  // Sort by date (upcoming first)\n  events.sort(\n    (a, b) => new Date(a.date).getTime() - new Date(b.date).getTime()\n  );\n\n  return events;\n}\n\nexport function getUpcomingEvents(limit?: number): EventMeta[] {\n  const now = new Date();\n  const events = getAllEvents().filter((event) => new Date(event.date) >= now);\n\n  if (limit) {\n    return events.slice(0, limit);\n  }\n\n  return events;\n}\n\n// Mock data fallback for development\nexport const mockEvents: EventMeta[] = [\n  {\n    slug: \"strategic-fatherhood-workshop\",\n    title: \"Strategic Fatherhood Workshop\",\n    description: \"A deep dive into intentional fatherhood and legacy building\",\n    excerpt:\n      \"Learn practical strategies for being an intentional father and building lasting legacy\",\n    date: \"2024-03-15\",\n    endDate: \"2024-03-16\",\n    location: \"London, UK\",\n    venue: \"The Leadership Centre\",\n    category: \"Workshop\",\n    tags: [\"fatherhood\", \"legacy\", \"workshop\"],\n    author: \"Abraham of London\",\n    featured: true,\n    registrationUrl: \"/register/strategic-fatherhood\",\n    content:\n      \"# Strategic Fatherhood Workshop\\n\\nJoin us for this transformative workshop...\",\n  },\n  {\n    slug: \"founders-roundtable\",\n    title: \"Founders Roundtable\",\n    description:\n      \"Monthly gathering for faith-driven entrepreneurs and founders\",\n    excerpt:\n      \"Connect with other founders building businesses with purpose and conviction\",\n    date: \"2024-02-28\",\n    location: \"Virtual\",\n    category: \"Roundtable\",\n    tags: [\"entrepreneurship\", \"founders\", \"faith\"],\n    author: \"Abraham of London\",\n    featured: false,\n    registrationUrl: \"/register/founders-roundtable\",\n    content:\n      \"# Founders Roundtable\\n\\nOur monthly gathering for purpose-driven founders...\",\n  },\n];\n\nexport default {\n  getEventSlugs,\n  getEventBySlug,\n  getAllEvents,\n  getUpcomingEvents,\n  mockEvents,\n};","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\src\\lib\\server\\pages-data.ts","messages":[{"ruleId":"import/no-anonymous-default-export","severity":1,"message":"Assign object to a variable before exporting as module default","line":212,"column":1,"nodeType":"ExportDefaultDeclaration","endLine":217,"endColumn":3}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// lib/server/pages-data.ts\nimport fs from \"fs\";\nimport path from \"path\";\nimport matter from \"gray-matter\";\n\nexport interface PageMeta {\n  slug: string;\n  title: string;\n  description?: string;\n  content: string;\n  excerpt?: string;\n  date?: string;\n  author?: string;\n  readTime?: string;\n  category?: string;\n  tags?: string[];\n}\n\n// Server-side guard\nif (typeof window !== \"undefined\") {\n  throw new Error(\"This module is server-only\");\n}\n\n// Use content directory in project root\nconst pagesDir = path.join(process.cwd(), \"content\", \"pages\");\nconst exts = [\".mdx\", \".md\"] as const;\n\n// ---------- Core page data functions ----------\n\nfunction resolvePagePath(slug: string): string | null {\n  const real = slug.replace(/\\.mdx?$/i, \"\");\n\n  // Ensure pages directory exists\n  if (!fs.existsSync(pagesDir)) {\n    console.warn(\"[pages-data] Pages directory does not exist:\", pagesDir);\n    return null;\n  }\n\n  for (const ext of exts) {\n    const full = path.join(pagesDir, `${real}${ext}`);\n    if (fs.existsSync(full)) return full;\n  }\n  return null;\n}\n\nexport function getPageSlugs(): string[] {\n  if (!fs.existsSync(pagesDir)) {\n    console.warn(\"[pages-data] Pages directory not found:\", pagesDir);\n    return [];\n  }\n\n  try {\n    return fs\n      .readdirSync(pagesDir)\n      .filter((f) => exts.some((e) => f.toLowerCase().endsWith(e)))\n      .map((f) => f.replace(/\\.mdx?$/i, \"\"));\n  } catch (err) {\n    console.error(\"[pages-data] Error reading pages directory:\", err);\n    return [];\n  }\n}\n\nexport function getPageBySlug(\n  slug: string,\n  fields: string[] = []\n): PageMeta | null {\n  const real = slug.replace(/\\.mdx?$/i, \"\");\n  const fullPath = resolvePagePath(real);\n\n  // If file is missing, return null or fallback\n  if (!fullPath) {\n    console.warn(\"[pages-data] Page not found for slug:\", real);\n\n    // Check if it's a known page and return mock data\n    const knownPage = mockPages.find((page) => page.slug === real);\n    if (knownPage) {\n      // Filter fields if specified\n      if (fields.length > 0) {\n        const filteredPage: any = {};\n        fields.forEach((field) => {\n          if (field in knownPage) {\n            filteredPage[field] = (knownPage as any)[field];\n          }\n        });\n        return filteredPage;\n      }\n      return knownPage;\n    }\n\n    return null;\n  }\n\n  try {\n    const raw = fs.readFileSync(fullPath, \"utf8\");\n    const { data, content } = matter(raw);\n    const fm = data || {};\n\n    const pageData: PageMeta = {\n      slug: real,\n      title: typeof fm.title === \"string\" ? fm.title : \"Untitled\",\n      description:\n        typeof fm.description === \"string\" ? fm.description : undefined,\n      content: content || \"\",\n      excerpt: typeof fm.excerpt === \"string\" ? fm.excerpt : undefined,\n      date: typeof fm.date === \"string\" ? fm.date : undefined,\n      author: typeof fm.author === \"string\" ? fm.author : \"Abraham of London\",\n      readTime: typeof fm.readTime === \"string\" ? fm.readTime : undefined,\n      category: typeof fm.category === \"string\" ? fm.category : undefined,\n      tags: Array.isArray(fm.tags) ? fm.tags : undefined,\n    };\n\n    // Filter fields if specified\n    if (fields.length > 0) {\n      const filteredPage: any = {};\n      fields.forEach((field) => {\n        if (field in pageData) {\n          filteredPage[field] = (pageData as any)[field];\n        }\n      });\n      return filteredPage;\n    }\n\n    return pageData;\n  } catch (err) {\n    console.error(`[pages-data] Error processing page ${slug}:`, err);\n\n    // Fallback to mock data\n    const knownPage = mockPages.find((page) => page.slug === real);\n    if (knownPage) {\n      if (fields.length > 0) {\n        const filteredPage: any = {};\n        fields.forEach((field) => {\n          if (field in knownPage) {\n            filteredPage[field] = (knownPage as any)[field];\n          }\n        });\n        return filteredPage;\n      }\n      return knownPage;\n    }\n\n    return null;\n  }\n}\n\nexport function getAllPages(fields: string[] = []): PageMeta[] {\n  const slugs = getPageSlugs();\n  const pages: PageMeta[] = [];\n\n  for (const slug of slugs) {\n    const page = getPageBySlug(slug, fields);\n    if (page) {\n      pages.push(page);\n    }\n  }\n\n  // If no pages found in filesystem, use mock pages\n  if (pages.length === 0) {\n    console.warn(\"[pages-data] No pages found in filesystem, using mock data\");\n    return mockPages.map((page) => {\n      if (fields.length > 0) {\n        const filteredPage: any = {};\n        fields.forEach((field) => {\n          if (field in page) {\n            filteredPage[field] = (page as any)[field];\n          }\n        });\n        return filteredPage as PageMeta;\n      }\n      return page;\n    });\n  }\n\n  return pages;\n}\n\n// Mock data fallback for development\nexport const mockPages: PageMeta[] = [\n  {\n    slug: \"about\",\n    title: \"About Abraham of London\",\n    description:\n      \"Learn more about Abraham of London and his work in technology and innovation.\",\n    content:\n      \"# About Abraham of London\\n\\nWelcome to my digital space. This is where faith, strategy, and legacy converge for fathers, founders, and leaders.\",\n    excerpt:\n      \"Building faith-rooted strategy for leaders who refuse to outsource responsibility.\",\n    author: \"Abraham of London\",\n    date: \"2024-01-01\",\n    readTime: \"3 min\",\n    category: \"Personal\",\n    tags: [\"about\", \"biography\"],\n  },\n  {\n    slug: \"contact\",\n    title: \"Contact\",\n    description:\n      \"Get in touch with Abraham of London for collaborations and inquiries.\",\n    content:\n      \"# Contact\\n\\nReach out to discuss opportunities, strategic partnerships, or meaningful conversations about faith, fatherhood, and legacy building.\",\n    excerpt:\n      \"Connect for strategic conversations about faith, fatherhood, and legacy.\",\n    author: \"Abraham of London\",\n    date: \"2024-01-01\",\n    readTime: \"2 min\",\n    category: \"Contact\",\n    tags: [\"contact\", \"connect\"],\n  },\n];\n\n// Export default for compatibility\nexport default {\n  getPageSlugs,\n  getPageBySlug,\n  getAllPages,\n  mockPages,\n};","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\src\\lib\\server\\unified-content.ts","messages":[{"ruleId":"import/no-anonymous-default-export","severity":1,"message":"Assign object to a variable before exporting as module default","line":176,"column":1,"nodeType":"ExportDefaultDeclaration","endLine":180,"endColumn":3}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/lib/server/unified-content.ts\n// Unified view over pages, downloads, and events for search / discovery.\n\nimport { getAllPages } from \"./pages-data\";\nimport { getAllDownloadsMeta } from \"./downloads-data\";\nimport { getAllEvents } from \"./events-data\";\n\nexport interface UnifiedContent {\n  id: string;\n  type: \"page\" | \"download\" | \"event\";\n  slug: string;\n  title: string;\n  description?: string;\n  excerpt?: string;\n  date?: string;\n  author?: string;\n  category?: string;\n  tags?: string[];\n  content?: string;\n  url: string;\n}\n\n// Minimal shapes so we don't fight types from the server modules\ntype PageLike = {\n  slug: string;\n  title: string;\n  description?: string;\n  excerpt?: string;\n  date?: string;\n  author?: string;\n  readTime?: string;\n  category?: string;\n  tags?: string[];\n  content?: string;\n};\n\ntype DownloadLike = {\n  slug: string;\n  title?: string;\n  description?: string;\n  excerpt?: string;\n  date?: string;\n  author?: string;\n  category?: string;\n  tags?: string[];\n};\n\ntype EventLike = {\n  slug: string;\n  title: string;\n  description?: string;\n  excerpt?: string;\n  date: string;\n  author?: string;\n  category?: string;\n  tags?: string[];\n};\n\nexport async function getAllUnifiedContent(): Promise<UnifiedContent[]> {\n  try {\n    const [pagesRaw, downloadsRaw, eventsRaw] = await Promise.all([\n      Promise.resolve(getAllPages()),\n      Promise.resolve(getAllDownloadsMeta()),\n      Promise.resolve(getAllEvents()),\n    ]);\n\n    const pages = (pagesRaw ?? []) as PageLike[];\n    const downloads = (downloadsRaw ?? []) as DownloadLike[];\n    const events = (eventsRaw ?? []) as EventLike[];\n\n    const unified: UnifiedContent[] = [];\n\n    // ---- Pages -------------------------------------------------------------\n    for (const page of pages) {\n      if (!page?.slug || !page?.title) continue;\n\n      unified.push({\n        id: `page-${page.slug}`,\n        type: \"page\",\n        slug: page.slug,\n        title: page.title,\n        description: page.description,\n        excerpt: page.excerpt,\n        date: page.date,\n        author: page.author,\n        category: page.category,\n        tags: page.tags,\n        content: page.content,\n        url: `/${page.slug}`,\n      });\n    }\n\n    // ---- Downloads ---------------------------------------------------------\n    for (const download of downloads) {\n      if (!download?.slug) continue;\n\n      const title =\n        (typeof download.title === \"string\" && download.title.trim().length\n          ? download.title\n          : \"Untitled Download\");\n\n      unified.push({\n        id: `download-${download.slug}`,\n        type: \"download\",\n        slug: download.slug,\n        title,\n        description: download.description ?? download.excerpt,\n        excerpt: download.excerpt,\n        date: download.date,\n        author: download.author,\n        category: download.category,\n        tags: download.tags,\n        url: `/downloads/${download.slug}`,\n      });\n    }\n\n    // ---- Events ------------------------------------------------------------\n    for (const event of events) {\n      if (!event?.slug || !event?.title) continue;\n\n      unified.push({\n        id: `event-${event.slug}`,\n        type: \"event\",\n        slug: event.slug,\n        title: event.title,\n        description: event.description,\n        excerpt: event.excerpt,\n        date: event.date,\n        author: event.author,\n        category: event.category,\n        tags: event.tags,\n        url: `/events/${event.slug}`,\n      });\n    }\n\n    // ---- Sort by date (newest first) --------------------------------------\n    unified.sort((a, b) => {\n      const dateA = a.date ? new Date(a.date).getTime() : 0;\n      const dateB = b.date ? new Date(b.date).getTime() : 0;\n      return dateB - dateA;\n    });\n\n    return unified;\n  } catch (error) {\n    console.error(\"[unified-content] Error fetching unified content:\", error);\n    return [];\n  }\n}\n\nexport async function getUnifiedContentByType(\n  type: UnifiedContent[\"type\"]\n): Promise<UnifiedContent[]> {\n  const allContent = await getAllUnifiedContent();\n  return allContent.filter((item) => item.type === type);\n}\n\nexport async function searchUnifiedContent(\n  query: string\n): Promise<UnifiedContent[]> {\n  const allContent = await getAllUnifiedContent();\n  const lowerQuery = query.toLowerCase();\n\n  return allContent.filter((item) => {\n    const inTitle = item.title.toLowerCase().includes(lowerQuery);\n    const inDescription = item.description?.toLowerCase().includes(lowerQuery);\n    const inExcerpt = item.excerpt?.toLowerCase().includes(lowerQuery);\n    const inContent = item.content?.toLowerCase().includes(lowerQuery);\n    const inTags = item.tags?.some((tag) =>\n      tag.toLowerCase().includes(lowerQuery)\n    );\n\n    return inTitle || inDescription || inExcerpt || inContent || inTags;\n  });\n}\n\nexport default {\n  getAllUnifiedContent,\n  getUnifiedContentByType,\n  searchUnifiedContent,\n};","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\src\\lib\\stub\\contentlayer-generated.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\src\\lib\\websocket-service.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'T' is defined but never used. Allowed unused vars must match /^_/u.","line":201,"column":38,"nodeType":null,"messageId":"unusedVar","endLine":201,"endColumn":39}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/lib/websocket-service.ts\nimport { useEffect, useState } from \"react\";\n\nexport type WebSocketEvent =\n  | \"connected\"\n  | \"disconnected\"\n  | \"error\"\n  | \"tick\"\n  | \"pong\"\n  | \"message\";\n\nexport type WebSocketMessage = {\n  type: string;\n  data?: Record<string, unknown>;\n};\n\ntype Subscriber = (data: WebSocketMessage) => void;\n\nexport class WebSocketService {\n  private socket: WebSocket | null = null;\n  private isOpen = false;\n  private subscribers = new Map<string, Subscriber[]>();\n  private reconnectAttempts = 0;\n  private maxReconnectAttempts = 5;\n  private reconnectInterval = 3000; // 3 seconds\n\n  constructor(\n    private url: string,\n    private opts: {\n      debug?: boolean;\n      autoConnect?: boolean;\n      maxReconnectAttempts?: number;\n    } = {}\n  ) {\n    if (opts.maxReconnectAttempts) {\n      this.maxReconnectAttempts = opts.maxReconnectAttempts;\n    }\n    if (opts.autoConnect) this.connect();\n  }\n\n  connect() {\n    if (this.isOpen || this.socket) return;\n\n    try {\n      this.socket = new WebSocket(this.url);\n\n      this.socket.addEventListener(\"open\", () => {\n        this.isOpen = true;\n        this.reconnectAttempts = 0; // Reset on successful connection\n        this.emit({ type: \"connected\", data: {} });\n        if (this.opts.debug) console.log(\"WebSocket connected\");\n      });\n\n      this.socket.addEventListener(\"close\", () => {\n        this.isOpen = false;\n        this.emit({ type: \"disconnected\", data: {} });\n\n        // Auto-reconnect logic\n        if (this.reconnectAttempts < this.maxReconnectAttempts) {\n          setTimeout(() => {\n            this.reconnectAttempts++;\n            this.connect();\n          }, this.reconnectInterval);\n        }\n      });\n\n      this.socket.addEventListener(\"error\", (ev) => {\n        this.emit({ type: \"error\", data: { event: ev } });\n        if (this.opts.debug) console.error(\"WebSocket error:\", ev);\n      });\n\n      this.socket.addEventListener(\"message\", (ev) => {\n        this.handleMessage(ev);\n      });\n    } catch (error) {\n      this.emit({ type: \"error\", data: { error } });\n    }\n  }\n\n  private handleMessage(ev: MessageEvent) {\n    let parsed: unknown;\n    try {\n      parsed = JSON.parse(String(ev.data));\n    } catch {\n      // non-JSON payloads\n    }\n\n    if (parsed && typeof parsed === \"object\" && \"type\" in (parsed as any)) {\n      const msg = parsed as WebSocketMessage;\n      // Emit the specific event and also generic \"message\"\n      this.emit(msg);\n      this.emit({ type: \"message\", data: msg.data ?? {} });\n    } else {\n      this.emit({ type: \"message\", data: { raw: ev.data } });\n    }\n  }\n\n  disconnect() {\n    this.reconnectAttempts = this.maxReconnectAttempts; // Stop reconnection\n    try {\n      this.socket?.close();\n    } catch {\n      // ignore\n    }\n    this.socket = null;\n    this.isOpen = false;\n  }\n\n  on(event: WebSocketEvent | string, cb: Subscriber): () => void {\n    const key = event as string;\n    const list = this.subscribers.get(key) ?? [];\n    list.push(cb);\n    this.subscribers.set(key, list);\n\n    // Return unsubscribe function\n    return () => {\n      const arr = this.subscribers.get(key) ?? [];\n      const idx = arr.indexOf(cb);\n      if (idx >= 0) arr.splice(idx, 1);\n      this.subscribers.set(key, arr);\n    };\n  }\n\n  // Convenience wrapper matching your component's call-site\n  onMessage(cb: Subscriber): () => void {\n    return this.on(\"message\", cb);\n  }\n\n  send(message: WebSocketMessage) {\n    if (this.isOpen && this.socket) {\n      try {\n        this.socket.send(JSON.stringify(message));\n      } catch (err) {\n        this.emit({ type: \"error\", data: { error: err } });\n      }\n    } else {\n      if (this.opts.debug)\n        console.warn(\"WebSocket not connected, cannot send message\");\n    }\n  }\n\n  getConnectionStatus(): boolean {\n    return this.isOpen;\n  }\n\n  private emit(message: WebSocketMessage) {\n    const list = this.subscribers.get(message.type) ?? [];\n    for (const cb of list) {\n      try {\n        cb(message);\n      } catch (err) {\n        console.error(\"Error in WebSocket subscriber:\", err);\n        // isolate bad subscribers\n      }\n    }\n  }\n}\n\n// Optional singleton if you need a shared bus elsewhere\nexport const ws = new WebSocketService(\n  process.env.NEXT_PUBLIC_WS_URL || \"wss://echo.websocket.org\", // Using public echo server for demo\n  {\n    debug: process.env.NODE_ENV === \"development\",\n    autoConnect: false, // Let components control when to connect\n    maxReconnectAttempts: 5,\n  }\n);\n\n// React hook for connection status\nexport function useWebSocketStatus(): boolean {\n  const [connected, setConnected] = useState(false);\n\n  useEffect(() => {\n    const unsubscribeConnected = ws.on(\"connected\", () => {\n      setConnected(true);\n    });\n\n    const unsubscribeDisconnected = ws.on(\"disconnected\", () => {\n      setConnected(false);\n    });\n\n    // Connect when component mounts\n    if (!ws.getConnectionStatus()) {\n      ws.connect();\n    }\n\n    // Cleanup on unmount\n    return () => {\n      unsubscribeConnected();\n      unsubscribeDisconnected();\n      // Note: We don't disconnect here to allow connection sharing\n      // between components. Connection lifecycle should be managed\n      // at the application level.\n    };\n  }, []);\n\n  return connected;\n}\n\n// Additional utility hook for receiving messages\nexport function useWebSocketMessages<T = any>(\n  eventType?: string\n): WebSocketMessage[] {\n  const [messages, setMessages] = useState<WebSocketMessage[]>([]);\n\n  useEffect(() => {\n    const messageHandler = (message: WebSocketMessage) => {\n      if (!eventType || message.type === eventType) {\n        setMessages((prev) => [...prev, message]);\n      }\n    };\n\n    const unsubscribe = ws.onMessage(messageHandler);\n\n    return unsubscribe;\n  }, [eventType]);\n\n  return messages;\n}\n\nexport default WebSocketService;\n","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\test-books-data.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\test-import.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\test-imports.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\tests\\e2e\\a11y-blog-crawl.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\tests\\e2e\\a11y.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\tests\\e2e\\axe-helpers.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\tests\\e2e\\blog-index-crawl.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\tests\\e2e\\blog.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\tests\\e2e\\downloads-assets.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\tests\\e2e\\health.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\tests\\e2e\\home.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\tests\\e2e\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\tests\\e2e\\visual.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\types\\ambient.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\types\\banner.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\types\\book.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\types\\canon.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\types\\config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\types\\content-meta.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\types\\content.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\types\\contentlayer.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\types\\download.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\types\\event.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\types\\global.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\types\\gray-matter.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\types\\index.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\types\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\types\\linkitem-augment.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\types\\linkitem-utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\types\\mdx.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\types\\nav.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\types\\nav.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\types\\next-auth.d.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'NextAuth' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// types/next-auth.d.ts\r\nimport NextAuth, { DefaultSession } from \"next-auth\";\r\n\r\ndeclare module \"next-auth\" {\r\n  /**\r\n   * Returned by `useSession`, `getSession` and received as a prop on the `SessionProvider` React Context\r\n   */\r\n  interface Session {\r\n    user: {\r\n      /** The user's id. */\r\n      id: string;\r\n      /** The user's email. */\r\n      email: string;\r\n      /** The user's name. */\r\n      name?: string | null;\r\n      /** The user's image. */\r\n      image?: string | null;\r\n    } & DefaultSession[\"user\"];\r\n  }\r\n  \r\n  interface User {\r\n    id: string;\r\n    email: string;\r\n    name?: string | null;\r\n    image?: string | null;\r\n  }\r\n  \r\n  interface JWT {\r\n    id: string;\r\n    email: string;\r\n  }\r\n}\r\n\r\ndeclare module \"next-auth/jwt\" {\r\n  interface JWT {\r\n    id: string;\r\n    email: string;\r\n  }\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\types\\next-mdx-remote.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\types\\page.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\types\\post-new.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\types\\post-patch.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\types\\post-utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\types\\post.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\types\\post.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\types\\print.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\types\\resource.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\types\\site-config.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\types\\site-config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\types\\site.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\types\\strategy.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\types\\theme.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\types\\websocket-service.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\update-webhooks.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\utils\\content-utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\utils\\dates.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\utils\\events.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\utils\\getAllContent.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Abraham-of-london\\utils\\image-utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
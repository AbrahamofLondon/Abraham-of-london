import*asReactfrom"react";importImagefrom"next/image";importLinkfrom"next/link";importclsxfrom"clsx";import{siteConfig}from"@/lib/siteConfig";/**BlogPostCard*-Resilientcoverfallbacks(slug-based,thendefaults)*-Safeexcerptstripping*-Accessibledateformatting+avatarswithfallback*typeAuthorType=string|{name?:string;image?:string};typeBlogPostCardProps={slug:string;title:string;date?:string;excerpt?:string;coverImage?:string;author?:AuthorType;readTime?:string|number;category?:string;tags?:string[];coverAspect?:"book"|"wide"|"square";coverFit?:"cover"|"contain";coverPosition?:"center"|"left"|"right";};constFALLBACK_AVATAR=siteConfig.authorImage||"/assets/images/profile-portrait.webp";constDEFAULT_COVERS=["/assets/images/blog/default.webp","/assets/images/blog/default.jpg"]asconst;functionstripMarkup(input?:string|null):string{if(!input)return"";returninput.replace(/<[^>]+>/g,"").replace(/\s+/g,"").trim();}functionnormalizeLocal(src?:string|null):string|undefined{if(!src)returnundefined;if(/^https?:\/\//i.test(src))returnundefined;returnsrc.startsWith("/")?src:`/${src.replace(/^\/+/,"")}`;}functionbuildCoverCandidates(slug:string,coverImage?:string|null){consts=String(slug).trim();constbase=[normalizeLocal(coverImage),`/assets/images/blog/${s}.webp`,`/assets/images/blog/${s}.jpg`,`/assets/images/blog/${s}.jpeg`,`/assets/images/blog/${s}.png`,...DEFAULT_COVERS,].filter(Boolean)asstring[];returnArray.from(newSet(base));}exportdefaultfunctionBlogPostCard({slug,title,excerpt,date,coverImage,author,readTime,category,coverAspect="book",coverFit="cover",coverPosition="center",}:BlogPostCardProps){//AuthordataconstauthorName=typeofauthor==="string"?author:author?.name||siteConfig.author;constpreferredAvatar=(typeofauthor!=="string"&&normalizeLocal(author?.image))||FALLBACK_AVATAR;const[avatarSrc,setAvatarSrc]=React.useState(preferredAvatar);//Coverfallbackchainconstcandidates=React.useMemo(()=>buildCoverCandidates(slug,coverImage),[slug,coverImage]);const[idx,setIdx]=React.useState(0);const[coverFailed,setCoverFailed]=React.useState(false);constcoverSrc=!coverFailed?candidates[idx]:undefined;constonCoverError=React.useCallback(()=>{setIdx((i)=>{constnext=i+1;if(next<candidates.length)returnnext;setCoverFailed(true);returni;});},[candidates.length]);//Dateformattingconstdt=date?newDate(date):null;constvalid=dt&&!Number.isNaN(+dt);constdateTime=valid?dt!.toISOString().slice(0,10):undefined;constdateLabel=valid?newIntl.DateTimeFormat("en-GB",{day:"2-digit",month:"short",year:"numeric"}).format(dt!):undefined;//ClasshelpersconstaspectClass=clsx({"aspect-[1/1]":coverAspect==="square","aspect-[16/9]":coverAspect==="wide","aspect-[2/3]":coverAspect==="book",});constimageClasses=clsx(coverFit==="contain"?"object-contain":"object-cover",{"object-left":coverPosition==="left","object-right":coverPosition==="right","object-center":coverPosition==="center",});constframeClasses=clsx("relativew-fulloverflow-hiddenrounded-t-2xl",aspectClass,coverFit==="contain"&&"bg-warmWhitep-2sm:p-3");constinitials=React.useMemo(()=>{constwords=String(title||"").trim().split(/\s+/).slice(0,3);returnwords.map((w)=>w[0]?.toUpperCase()||"").join("")||"Aâ€¢L";},[title]);constsafeExcerpt=stripMarkup(excerpt);return(<articleclassName="rounded-2xlborderborder-lightGreybg-whiteshadow-cardtransitionhover:shadow-cardHover"><Linkhref={`/blog/${slug}`}className="block"prefetch={false}aria-label={`Read:${title}`}>{/*Cover*/}<divclassName={frameClasses}>{!coverFailed&&coverSrc?(<Imagesrc={coverSrc}alt=""fillsizes="(max-width:768px)100vw,33vw"className={imageClasses}onError={onCoverError}priority={false}/>):(<divclassName="absoluteinset-0flexitems-centerjustify-centerbg-gradient-to-brfrom-[color:var(--color-primary)/0.1]to-[color:var(--color-on-secondary)/0.1]"><spanclassName="select-nonefont-seriftext-4xlfont-semiboldtext-[color:var(--color-on-secondary)/0.7]">{initials}</span></div>)}</div>{/*Body*/}<divclassName="p-5"><h3className="font-seriftext-xlfont-semiboldtext-deepCharcoal">{title}</h3><divclassName="mt-2flexflex-wrapitems-centergap-x-3gap-y-1text-xstext-[color:var(--color-on-secondary)/0.7]">{dateTime&&<timedateTime={dateTime}>{dateLabel}</time>}{readTime&&<spanaria-label="Estimatedreadingtime">{readTime}minread</span>}{category&&<spanclassName="inline-flexrounded-fullborderborder-lightGreypx-2py-0.5">{category}</span>}<spanclassName="luxury-link">Discuss</span></div>{safeExcerpt&&(<pclassName="mt-3line-clamp-3text-smtext-[color:var(--color-on-secondary)/0.8]">{safeExcerpt}</p>)}<divclassName="mt-4flexitems-centergap-3"><Imagesrc={avatarSrc}alt={authorName||"Author"}width={40}height={40}className="rounded-fullobject-cover"onError={()=>setAvatarSrc(FALLBACK_AVATAR)}/><divclassName="text-xstext-[color:var(--color-on-secondary)/0.7]"><pclassName="font-medium">{authorName}</p></div></div></div></Link></article>);}
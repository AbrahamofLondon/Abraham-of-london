//components/NewsletterForm.tsx"useclient";import * as React from "react";constEMAIL_RE=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;export defaultfunctionNewsletterForm(){const[email,setEmail]=React.useState("");const[status,setStatus]=React.useState<"idle"|"loading"|"ok"|"err">("idle");const[msg,setMsg]=React.useState("");const[hp,setHp]=React.useState("");//honeypotconstabortRef=React.useRef<AbortController|null>(null);conststatusRef=React.useRef<HTMLParagraphElement|null>(null);React.useEffect(()=>{if(status!=="idle"&&statusRef.current)statusRef.current.focus();},[status,msg]);asyncfunctiononSubmit(e:React.FormEvent){e.preventDefault();if(status==="loading")return;constvalue=email.trim().toLowerCase();if(!EMAIL_RE.test(value)){setStatus("err");setMsg("Pleaseenteravalidemailaddress.");return;}//Ifthehoneypotisfilled,actlikesuccesstomisleadbots.if(hp){setStatus("ok");setMsg("You'resubscribed.Welcome!");setEmail("");return;}setStatus("loading");setMsg("");abortRef.current?.abort();constcontroller=newAbortController();abortRef.current=controller;try{//HOT-FIX:sendbothshapessoeitherbackendcontractissatisfiedconstr=awaitfetch("/api/newsletter",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({email:value,payload:{email_address:value,email:value},}),cache:"no-store",signal:controller.signal,});constdata=awaitr.json().catch(()=>({}asany));constmessage=typeofdata?.message==="string"?data.message:r.ok?"You'resubscribed.Welcome!":"Somethingwentwrong.Pleasetryagain.";if(r.ok){setStatus("ok");setMsg(message);setEmail("");}else{setStatus("err");setMsg(message);}}catch(err:any){if(err?.name==="AbortError")return;setStatus("err");setMsg("Networkerror.Pleasetryagain.");}}constisLoading=status==="loading";constisError=status==="err";return(<form onSubmit={onSubmit}className="mx-autoflexw-fullmax-w-xlflex-colgap-3rounded-2xlborderborder-lightGreybg-warmWhitep-4sm:flex-rowsm:items-centersm:p-5"noValidate>{/*Honeypot(hidden)*/}<label className="sr-only"htmlFor="newsletter-company">Company</label><inputi d="newsletter-company"name="company"tabIndex={-1}autoComplete="off"value={hp}onChange={(e)=>setHp(e.target.value)}className="hidden"/><labelhtmlFor="newsletter-email"className="sr-only">Emailaddress</label><inputi d="newsletter-email"type="email"name="email"inputMode="email"autoComplete="email"requiredplaceholder="you@example.com"value={email}onChange={(e)=>setEmail(e.target.value)}className="flex-1rounded-lgborderborder-lightGreybg-whitepx-3py-2text-smtext-deepCharcoalplaceholder:text-[color:var(--color-on-secondary)/0.5]focus:border-deepCharcoalfocus:outline-none"aria-describedby="newsletter-status"aria-inval i d={isError||undefined}disable d={isLoading}/><buttontype="submit"disable d={isLoading}className="rounded-fullbg-forestpx-5py-2text-smfont-semiboldtext-creamtransitionhover:bg-[color:var(--color-primary)/0.9]disabled:cursor-not-alloweddisabled:opacity-60">{isLoading?"Subscribing...":"Subscribe"}</button><pi d="newsletter-status"role="status"aria-live="polite"tabIndex={-1}ref={statusRef}className={`sm:ml-2text-sm${status==="ok"?"text-forest":status==="err"?"text-red-600":"text-transparent"}`}>{msg||""}</p></form>);}

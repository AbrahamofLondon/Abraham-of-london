import Imagefrom"next/image";import Linkfrom"next/link";import clsxfrom"clsx";import Reactfrom"react";type Props={slug:string;title:string;date:string;location?:string;description?:string|null;tags?:string[]|null;chatham?:boolean;heroImage?:string|null;className?:string;prefetch?:boolean;timeZone?:string;heroFit?:"cover"|"contain";heroAspect?:"16/9"|"21/9"|"3/1";heroPosition?:"center"|"top"|"left"|"right";resources?:{downloads?:{href:string;label:string}[];reads?:{href:string;label:string}[];}|null;};/*----------per-slugpresentationoverrides----------*/constHERO_OVERRIDES:Record<string,{heroFit?:Props["heroFit"];heroAspect?:Props["heroAspect"];heroPosition?:Props["heroPosition"]}>={"leadership-workshop":{heroFit:"contain",heroAspect:"3/1",heroPosition:"top"},"founders-salon":{heroFit:"cover",heroAspect:"21/9",heroPosition:"center"},};/*----------datehelpers----------*/constisDateOnly=(s:string)=>/^\d{4}-\d{2}-\d{2}$/.test(s);constisValidDate=(d:Date)=>!Number.isNaN(d.valueOf());function formatNiceDate(iso:string,tz="Europe/London"){if(isDateOnly(iso)){const[y,m,d]=iso.split("-").map(Number);constdt=newDate(Date.UTC(y,m-1,d));if(!isValidDate(dt))returniso;returnnewIntl.DateTimeFormat("en-GB",{timeZone:"UTC",day:"2-digit",month:"short",year:"numeric",}).format(dt);}constdt=newDate(iso);if(!isValidDate(dt))returniso;constdateStr=newIntl.DateTimeFormat("en-GB",{timeZone:tz,day:"2-digit",month:"short",year:"numeric",}).format(dt);consttimeStr=newIntl.DateTimeFormat("en-GB",{timeZone:tz,hour:"2-digit",minute:"2-digit",hour12:false,}).format(dt);return/\b00:00\b/.test(timeStr)?dateStr:`${dateStr},${timeStr}`;}/*----------imagehelpers----------*/constensureLocal=(p?:string|null)=>p&&!/^https?:\/\//i.test(p)?(p.startsWith("/")?p:`/${p.replace(/^\/+/,"")}`):undefined;function useEventImageCandidates(slug:string,heroImage?:string|null){const{candidates}=React.useMemo(()=>{constexplicit=ensureLocal(heroImage);constbase=slug.toLowerCase().replace(/[^a-z0-9-]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"");constshort2=base.split("-").slice(0,2).join("-");constshort3=base.split("-").slice(0,3).join("-");constexts=["webp","jpg","jpeg","png"];constfrom=(name:string)=>exts.map((e)=>`/assets/images/events/${name}.${e}`);constlist=[explicit,...from(base),...from(short3),...from(short2),"/assets/images/events/default.jpg",].filter(Boolean)asstring[];return{candidates:Array.from(newSet(list))};},[slug,heroImage]);const[idx,setIdx]=React.useState(0);const src=candidates[idx];const onError=React.useCallback(()=>setIdx((i)=>(i+1<candidates.length?i+1:i)),[candidates.length]);return{src,hasAny:candidates.length>0,onError};}/*----------component----------*/export defaultfunctionEventCard({slug,title,date,location,description,tags=null,chatham,className,prefetch=false,timeZone="Europe/London",heroImage=null,heroFit,heroAspect,heroPosition,resources=null,}:Props){//mergeper-slugoverridesfirst,thenexplicitpropsconstpreset=HERO_OVERRIDES[slug]||{};const_heroFit:NonNullable<Props["heroFit"]>=heroFit||preset.heroFit||"cover";const_heroAspect:NonNullable<Props["heroAspect"]>=heroAspect||preset.heroAspect||"16/9";const_heroPosition:NonNullable<Props["heroPosition"]>=heroPosition||preset.heroPosition||"center";constnice=formatNiceDate(date,timeZone);consttitleI d=React.useId();constisChatham=Boolean(chatham)||(Array.isArray(tags)&&tags.some((t)=>String(t).toLowerCase()==="chatham"));const{src,hasAny,onError}=useEventImageCandidates(slug,heroImage);constaspectClass=_heroAspect==="21/9"?"aspect-[21/9]":_heroAspect==="3/1"?"aspect-[3/1]":"aspect-[16/9]";constfitClass=_heroFit==="contain"?"object-containbg-warmWhite":"object-cover";constposClass=_heroPosition==="top"?"object-top":_heroPosition==="left"?"object-left":_heroPosition==="right"?"object-right":"object-center";constpills:Array<{href:string;label:string;kind:"download"|"read"}>=[];if(resources?.downloads?.length){for(constdofresources.downloads.slice(0,2))pills.push({href:d.href,label:d.label,kind:"download"});}if(pills.length<2&&resources?.reads?.length){for(constrofresources.reads.slice(0,2-pills.length))pills.push({href:r.href,label:r.label,kind:"read"});}return(<article className={clsx("relativeoverflow-hiddenrounded-2xlborderborder-lightGreybg-whiteshadow-cardtransitionhover:shadow-cardHover",className)}aria-labelledby={titleId}itemScopeitemType="https://schema.org/Event">{hasAny&&src&&(<div className={clsx("relativew-full",aspectClass)}><Image src={src}alt={`${title}image`}fill sizes="(max-width:768px)100vw,33vw"className={clsx(fitClass,posClass)}onError={onError}priority={false}/>{isChatham&&(<span className="absoluteright-3top-3rounded-fullbg-[color:var(--color-on-secondary)/0.9]px-2py-0.5text-[10px]font-semibolduppercasetracking-widetext-cream">Chatham</span>)}</div>)}<div className="p-6"><div className="mb-2flexflex-wrapitems-centergap-2text-smtext-gray-600"><timedateTime={date}className="rounded-fullbg-warmWhitepx-2py-0.5text-[color:var(--color-on-secondary)/0.8]"itemProp="startDate">{nice}</time>{location?.trim()&&(<><span aria-hidden="true">Ãƒâ€šÃ‚·</span><span className="rounded-fullbg-warmWhitepx-2py-0.5text-[color:var(--color-on-secondary)/0.8]"itemProp="location">{location}</span></>)}</div><h3i d={titleId}className="text-lgfont-semiboldleading-snugtext-gray-900"itemProp="name"><Link href={`/events/${slug}`}className="outline-nonetransition-colorshover:text-forestfocus-visible:roundedfocus-visible:ring-2focus-visible:ring-[color:var(--color-primary)/0.3]"prefetch={prefetch}>{title}</Link></h3>{description&&(<p className="mt-2line-clamp-3text-smleading-relaxedtext-gray-700"itemProp="description">{description}</p>)}{/*quickresourcepills*/}{pills.length>0&&(<ul className="mt-3flexflex-wrapgap-2">{pills.map((p,i)=>(<likey={i}><Link href={p.href}prefetch={false}className={clsx("inline-flexitems-centerrounded-fullborderpx-2.5py-1text-xsfont-mediumtransition",p.kin d==="download"?"border-[color:var(--color-primary)/0.2]text-foresthover:bg-foresthover:text-cream":"border-lightGreytext-[color:var(--color-on-secondary)]hover:bg-warmWhite")}target={/\.pdf$/i.test(p.href)?"_blank":undefined}rel={/\.pdf$/i.test(p.href)?"noopenernoreferrer":undefined}>{p.label}</Link></li>))}</ul>)}<div className="mt-4"><Link href={`/events/${slug}`}className="inline-flexitems-centerrounded-fullborderborder-[color:var(--color-primary)/0.2]px-3py-1.5text-smfont-mediumtext-foresttransition-colorshover:bg-foresthover:text-cream"prefetch={prefetch}aria-labelledby={titleId}>Details</Link></div><metaitemProp="url"content={`/events/${slug}`}/></div></article>);}
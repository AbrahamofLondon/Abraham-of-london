if(typeofwindow!=="undefined"){thrownewError("Thismoduleisserver-only");}importtype{NextApiRequest,NextApiResponse}from"next";import{getAllPosts}from"@/lib/mdx";import{getAllBooks}from"@/lib/books";import{getAllEvents}from"@/lib/server/events-data";exportconstconfig={api:{bodyParser:false}};//FIX1:Changehandlertoanasyncfunctionexportdefaultasyncfunctionhandler(_req:NextApiRequest,res:NextApiResponse){//NOTE:AssuminggetAllPostsandgetAllBooksaresynchronous(commonforMDX)constposts=getAllPosts().map((p:any)=>({id:`post:${p.slug}`,type:"post"asconst,title:p.title,url:`/blog/${p.slug}`,date:p.date??null,snippet:p.excerpt??"",}));constbooks=getAllBooks(["slug","title","author","excerpt"]).map((b:any)=>({id:`book:${b.slug}`,type:"book"asconst,title:b.title??b.slug,url:`/books/${b.slug}`,date:null,snippet:b.excerpt??(b.author?`By${b.author}`:""),}));//FIX2:Awaittheasyncfunctioncallbeforemappingconstevents=(awaitgetAllEvents(["slug","title","date","location","summary"])).map((e:any)=>({id:`event:${e.slug}`,type:"event"asconst,title:e.title,url:`/events/${e.slug}`,date:e.date??null,snippet:[e.summary,e.location].filter(Boolean).join("Â·"),}));constitems=[...posts,...books,...events];res.setHeader("Cache-Control","public,max-age=300,stale-while-revalidate=86400");res.status(200).json({count:items.length,items});}
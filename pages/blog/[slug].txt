import type { GetStaticPaths, GetStaticProps, NextPage } from "next";
import { allPosts } from "contentlayer/generated";
import ContentlayerDocPage from "@/components/ContentlayerDocPage";
import { getDocHref } from "@/lib/contentlayer-helper";

type Props = { doc: any; canonicalPath: string };

const BlogSlugPage: NextPage<Props> = ({ doc, canonicalPath }) => {
  return (
    <ContentlayerDocPage
      doc={doc}
      canonicalPath={canonicalPath}
      backHref="/blog"
      label="Essay"
    />
  );
};

export const getStaticPaths: GetStaticPaths = async () => {
  const paths = (allPosts ?? [])
    .filter((p) => !p.draft)
    .map((p) => ({ params: { slug: String(p.slug) } }))
    .filter((p) => p.params.slug && p.params.slug !== "index");

  return { paths, fallback: false };
};

export const getStaticProps: GetStaticProps<Props> = async ({ params }) => {
  const slug = String(params?.slug ?? "");
  const doc = (allPosts ?? []).find((p) => !p.draft && String(p.slug) === slug) ?? null;

  if (!doc) return { notFound: true };

  return {
    props: {
      doc,
      canonicalPath: getDocHref(doc), // will be /blog/slug from your helper
    },
    revalidate: 60,
  };
};

export default BlogSlugPage;
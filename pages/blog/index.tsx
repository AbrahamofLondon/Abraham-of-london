//pages/blog/index.tsximport*asReactfrom"react";import Headfrom"next/head";import { useRouter } from "next/router";import Layoutfrom"@/components/Layout";import Breadcrumbfrom"@/components/Breadcrumb";import BlogPostCardfrom"@/components/BlogPostCard";import { getAllPosts } from "@/lib/mdx";import type{PostMeta}from "@/type s/post";type Props={posts:PostMeta[]};export defaultfunctionBlogIndex({posts}:Props){constrouter=useRouter();constcategories=React.useMemo(()=>{constset=newSet<string>();posts.forEach((p)=>p.category&&set.add(p.category));return["All",...Array.from(set)];},[posts]);constinitialQ=typeofrouter.query.q==="string"?router.query.q:"";constinitialCat=typeofrouter.query.cat==="string"&&categories.includes(router.query.cat)?router.query.cat:"All";constinitialSort=router.query.sort==="oldest"||router.query.sort==="newest"?(router.query.sortas"newest"|"oldest"):"newest";const[q,setQ]=React.useState(initialQ);const[cat,setCat]=React.useState(initialCat);const[sort,setSort]=React.useState<"newest"|"oldest">(initialSort);//KeepURLinsyncwithsearch/filter/sortwithoutfullnavigationReact.useEffect(()=>{constparams=newURLSearchParams();if(q)params.set("q",q);if(cat&&cat!=="All")params.set("cat",cat);if(sort!=="newest")params.set("sort",sort);const href=params.toString()?`/blog?${params}`:"/blog";if(router.asPath!==href){router.replace(href,undefined,{shallow:true,scroll:false});}},[q,cat,sort,router]);constfiltere d=React.useMemo(()=>{letlist=posts.filter((p)=>{constmatchesCat=cat==="All"||p.category===cat;constneedle=q.trim().toLowerCase();constmatchesQ=!needle||p.title.toLowerCase().includes(needle)||(p.excerpt??"").toLowerCase().includes(needle);returnmatchesCat&&matchesQ;});list.sort((a,b)=>{constat=a.date?Date.parse(a.date):0;constbt=b.date?Date.parse(b.date):0;returnsort==="newest"?bt-at:at-bt;});returnlist;},[posts,q,cat,sort]);return(<LayoutpageTitle="Blog"hideCTA><Head d><metaname="description"content="FeaturedinsightsbyAbrahamofLondon—fatherhood,enterprise,society."/><linkrel="canonical"href="https://www.abrahamoflondon.org/blog"/></Head><section className="bg-white"><div className="mx-automax-w-7xlpx-4py-12"><div className="mb-6flexflex-colitems-startjustify-betweengap-3sm:flex-rowsm:items-center"><Breadcrumbitems={[{href:"/",label:"Home"},{label:"Blog"}]}/><p className="text-xstext-[color:var(--color-on-secondary)/0.6]">{filtered.length}{filtered.length===1?"post":"posts"}</p></div><header className="mb-8"><h1 className="font-seriftext-4xlfont-semiboldtext-deepCharcoal">FeaturedInsights</h1><p className="mt-2text-smtext-[color:var(--color-on-secondary)/0.7]">Acuratedjournalonstandards,stewardship,andstrategy.</p></header><div className="mb-8gridgap-3md:grid-cols-3"><input aria-label="Searchposts"value={q}onChange={(e)=>setQ(e.target.value)}placeholder="Searchinsights..."className="rounded-lgborderborder-lightGreypx-3py-2text-smfocus:border-deepCharcoalfocus:outline-none"/><select aria-label="Filterbycategory"value={cat}onChange={(e)=>setCat(e.target.value)}className="rounded-lgborderborder-lightGreypx-3py-2text-smfocus:border-deepCharcoalfocus:outline-none">{categories.map((c)=>(<optionkey={c}value={c}>{c}</option>))}</select><select aria-label="Sortorder"value={sort}onChange={(e)=>setSort(e.target.valueas"newest"|"oldest")}className="rounded-lgborderborder-lightGreypx-3py-2text-smfocus:border-deepCharcoalfocus:outline-none"><optionvalue="newest">Newestfirst</option><optionvalue="oldest">Oldestfirst</option></select></div>{/*Editorial"magazine"grid*/}<div className="gridgap-8sm:grid-cols-2lg:grid-cols-3">{filtered.map((p)=>(<articlekey={p.slug}className="groupoverflow-hiddenrounded-2xlborderborder-lightGreybg-whiteshadow-cardtransitionhover:shadow-cardHover"><BlogPostCardslug={p.slug}title={p.title}date={p.date??undefined}excerpt={p.excerpt??undefined}coverImage={p.coverImage??undefined}author={p.author??undefined}readTime={p.readTime??undefined}category={p.category??undefined}tags={p.tags??undefined}//Framingpropsâ†'wideeditorialcoverbydefaultcoverAspect={(p.coverAspectasany)??"wide"}coverFit={(p.coverFitasany)??"cover"}coverPosition={(p.coverPositionasany)??"center"}/></article>))}</div>{filtered.length===0&&(<p className="mt-10text-centertext-smtext-[color:var(--color-on-secondary)/0.7]">Nothingmatchedyoursearch.Tryadifferentphraseorcategory.</p>)}</div></section></Layout>);}export asyncfunctiongetStaticProps(){constposts=getAllPosts();//normalizeundefinedâ†'nullforJSONserializationconstsafe=posts.map((p)=>({...p,excerpt:p.excerpt??null,date:p.date??null,coverImage:p.coverImage??null,readTime:p.readTime??null,category:p.category??null,author:p.author??null,tags:p.tags??null,coverAspect:p.coverAspect??null,coverFit:p.coverFit??null,coverPosition:p.coverPosition??null,}));return{props:{posts:safe},revalidate:60};}

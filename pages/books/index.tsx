//pages/books/index.tsximport*asReactfrom"react";importHeadfrom"next/head";importLinkfrom"next/link";importtype{GetStaticProps}from"next";//1.CORRECTEDContentlayerimportpathimport{allBooks,typeBook}from"contentlayer/generated";//2.ImportuseDebouncehook(assumingpathiscorrect)import{useDebounce}from"@/lib/hooks/useDebounce";//---TypeDefinitions---typeItemRow=Pick<Book,"slug"|"title"|"author"|"date"|"description"|"coverImage">;typeProps={items:ItemRow[]};//---Component---exportdefaultfunctionBooksIndex({items}:Props){const[query,setQuery]=React.useState("");constdebouncedQuery=useDebounce(query,300);//Debouncethequerystateconstfiltered=React.useMemo(()=>{constq=debouncedQuery.toLowerCase().trim();if(!q)returnitems;returnitems.filter((b)=>{//Concatenateandnormalizeallsearchablefieldsconsthay=`${b.title}${b.author??""}${b.description??""}`.toLowerCase();returnhay.includes(q);});},[items,debouncedQuery]//Dependonthedebouncedquery);return(<><Head><title>Books—AbrahamofLondon</title><metaname="description"content="Booksandlong-formworkfromAbrahamofLondon."/></Head><mainclassName="mx-automax-w-7xlpx-4py-10"><headerclassName="mb-8flexflex-colgap-3sm:flex-rowsm:items-endsm:justify-between"><div><h1className="font-seriftext-3xlfont-semiboldtext-deepCharcoal">Books</h1><pclassName="text-smtext-[color:var(--color-on-secondary)/0.75]">{filtered.length}of{items.length}shown</p></div><inputvalue={query}//Bindinputvaluetoimmediate'query'stateonChange={(e)=>setQuery(e.target.value)}//Update'query'immediatelyplaceholder="Searchbooks…"className="w-fullrounded-fullborderborder-lightGreybg-whitepx-4py-2text-smsm:w-80"aria-label="Searchbooks"/></header><ulclassName="gridgap-6sm:grid-cols-2lg:grid-cols-3">{filtered.map((b)=>(<likey={b.slug}className="rounded-2xlborderborder-lightGreybg-whitep-5shadow-cardhover:shadow-cardHover">{b.coverImage&&(//eslint-disable-next-line@next/next/no-img-element<imgsrc={b.coverImage}alt={b.title}//3.CleanedupalttextclassName="mb-3aspect-[3/4]w-fullrounded-xlobject-cover"loading="lazy"/>)}<h2className="font-seriftext-xlfont-semiboldtext-deepCharcoal"><Linkhref={`/books/${b.slug}`}className="hover:underlinedecoration-softGold/60underline-offset-4">{b.title}</Link></h2><pclassName="mt-1text-smtext-[color:var(--color-on-secondary)/0.75]">{b.author??"—"}{b.date?`•${b.date}`:""}</p>{b.description&&<pclassName="mt-3text-smtext-[color:var(--color-on-secondary)/0.85]">{b.description}</p>}</li>))}</ul></main></>);}//---DataFetching---exportconstgetStaticProps:GetStaticProps<Props>=async()=>{constitems=allBooks.map((b)=>({slug:b.slug,title:b.title,//Useexplicittypecastonlyifnecessary,otherwiserelyonContentlayer'sgeneratedtypeauthor:(basany).author??null,date:(basany).date??null,description:(basany).description??null,coverImage:(basany).coverImage??null,}))//Sortbydatedescending(latestfirst).sort((a,b)=>String(b.date??"").localeCompare(String(a.date??"")));return{props:{items:itemsasItemRow[]}};};
//pages/sitemap.xml.tsimporttype{GetServerSideProps}from"next";importtype{EventMeta}from"@/lib/events";//AssumingEventMetaisimportedordefinedsomewheretypeUrlEntry={loc:string;changefreq:string;priority:string;lastmod?:string;};exportconstgetServerSideProps:GetServerSideProps=async({res})=>{constORIGIN=process.env.NEXT_PUBLIC_SITE_URL||"https://www.abrahamoflondon.org";conststaticRoutes:UrlEntry[]=["/","/about","/contact","/blog","/books","/events","/ventures"].map((p)=>({loc:`${ORIGIN}${p}`,changefreq:"weekly",priority:"0.8",}));//¬‡ï¸ImportservermodulesINSIDEtheserverfunctionconst{getAllPosts}=awaitimport("@/lib/mdx");const{getAllBooks}=awaitimport("@/lib/books");//šï¸IMPORTANT:getAllEventsisanasyncfunction,soitmustbeawaited.const{getAllEvents}=awaitimport("@/lib/server/events-data");constposts:UrlEntry[]=getAllPosts().map((p:any)=>({loc:`${ORIGIN}/blog/${p.slug}`,lastmod:p?.date?newDate(p.date).toISOString():undefined,changefreq:"monthly",priority:"0.7",}));constbooks:UrlEntry[]=getAllBooks(["slug"]).map((b:any)=>({loc:`${ORIGIN}/books/${b.slug}`,changefreq:"monthly",priority:"0.6",}));//ðŸ'‡FIXAPPLIEDHERE:AwaitthepromisereturnedbygetAllEvents.consteventsData:EventMeta[]=awaitgetAllEvents(["slug","date","endDate"]);constevents:UrlEntry[]=eventsData.map((e)=>({loc:`${ORIGIN}/events/${e.slug}`,//EnsureeistreatedasEventMetahere,assumingitcontainsdateandendDatelastmod:newDate(e.endDate||e.date).toISOString(),changefreq:"weekly",priority:"0.6",}));constall:UrlEntry[]=[...staticRoutes,...posts,...books,...events];constxml=`<?xmlversion="1.0"encoding="UTF-8"?><urlsetxmlns="http://www.sitemaps.org/schemas/sitemap/0.9">${all.map((u)=>`<url><loc>${u.loc}</loc>${u.lastmod?`<lastmod>${u.lastmod}</lastmod>`:""}<changefreq>${u.changefreq}</changefreq><priority>${u.priority}</priority></url>`).join("\n")}</urlset>`;res.setHeader("Content-Type","application/xml;charset=utf-8");res.setHeader("Cache-Control","public,max-age=3600,stale-while-revalidate=86400");res.write(xml);res.end();return{props:{}};};exportdefaultfunctionSiteMap(){returnnull;}
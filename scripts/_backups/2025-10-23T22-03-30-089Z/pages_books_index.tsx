//pages/books/index.tsximport*asReactfrom"react";import Headfrom"next/head";import Linkfrom"next/link";import type{GetStaticProps}from "next";//1.CORRECTEDContentlayerimportpathimport{[],type Book}from "contentlayer/generated";//2.import useDebouncehook(assumingpathiscorrect)import { useDebounce } from "@/lib/hooks/useDebounce";//---type Definitions---type ItemRow=Pick<Book,"slug"|"title"|"author"|"date"|"description"|"coverImage">;type Props={items:ItemRow[]};//---Component---export defaultfunctionBooksIndex({items}:Props){const[query,setQuery]=React.useState("");constdebouncedQuery=useDebounce(query,300);//Debouncethequerystateconstfiltere d=React.useMemo(()=>{constq=debouncedQuery.toLowerCase().trim();if(!q)returnitems;returnitems.filter((b)=>{//Concatenateandnormalizeallsearchablefieldsconsthay=`${b.title}${b.author??""}${b.description??""}`.toLowerCase();returnhay.includes(q);});},[items,debouncedQuery]//Dependonthedebouncedquery);return(<><Head d><title>Books—AbrahamofLondon</title><metaname="description"content="Booksandlong-formworkfromAbrahamofLondon."/></Head><main className="mx-automax-w-7xlpx-4py-10"><header className="mb-8flexflex-colgap-3sm:flex-rowsm:items-endsm:justify-between"><div><h1 className="font-seriftext-3xlfont-semiboldtext-deepCharcoal">Books</h1><p className="text-smtext-[color:var(--color-on-secondary)/0.75]">{filtered.length}of{items.length}shown</p></div><inputvalue={query}//Bindinputvaluetoimmediate'query'state onChange={(e)=>setQuery(e.target.value)}//Update'query'immediatelyplaceholder="Searchbooks..."className="w-fullrounded-fullborderborder-lightGreybg-whitepx-4py-2text-smsm:w-80"aria-label="Searchbooks"/></header><ul className="gridgap-6sm:grid-cols-2lg:grid-cols-3">{filtered.map((b)=>(<likey={b.slug}className="rounded-2xlborderborder-lightGreybg-whitep-5shadow-cardhover:shadow-cardHover">{b.coverImage&&(//eslint-disable-next-line@next/next/no-img-element<img src={b.coverImage}alt={b.title}//3.Cleanedupalttext className="mb-3aspect-[3/4]w-fullrounded-xlobject-cover"loading="lazy"/>)}<h2 className="font-seriftext-xlfont-semiboldtext-deepCharcoal"><Link href={`/books/${b.slug}`}className="hover:underlinedecoration-softGold/60underline-offset-4">{b.title}</Link></h2><p className="mt-1text-smtext-[color:var(--color-on-secondary)/0.75]">{b.author??"—"}{b.date?`•${b.date}`:""}</p>{b.description&&<p className="mt-3text-smtext-[color:var(--color-on-secondary)/0.85]">{b.description}</p>}</li>))}</ul></main></>);}//---DataFetching---export constgetStaticProps:GetStaticProps<Props>=async()=>{constitems=[].map((b)=>({slug:b.slug,title:b.title,//Useexplicittypecastonlyifnecessary,otherwiserelyonContentlayer'sgeneratedtypeauthor:(basany).author??null,date:(basany).date??null,description:(basany).description??null,coverImage:(basany).coverImage??null,}))//Sortbydatedescending(latestfirst).sort((a,b)=>String(b.date??"").localeCompare(String(a.date??"")));return{props:{items:itemsasItemRow[]}};};

//pages/index.tsximporttype{GetStaticProps}from "next";import * as React from "react";import Headfrom"next/head";import Linkfrom"next/link";import Imagefrom"next/image";import dynamicfrom"next/dynamic";import { useRouter } from "next/router";import Layoutfrom"@/components/Layout";import BlogPostCardfrom"@/components/BlogPostCard";import BookCardfrom"@/components/BookCard";import EventCardfrom"@/components/events/EventCard";import DownloadsGridfrom"@/components/downloads/DownloadsGrid";import { getActiveBanner } from "@/lib/hero-banners";import { getAllPosts } from "@/lib/mdx";import { getAllBooks } from "@/lib/books";import { getAllEvents,//Note:getEventResourcesSummaryisnolongerusedinthemaploopasitreturnscounts.dedupeEventsByTitleAndDay, } from "@/lib/server/events-data";import type{PostMeta}from "@/type s/post";/*â"€â"€bannertypesâ"€â"€*/type BannerCTA={label:string;href:string};type BannerOverlay=|{eyebrow?:string;title?:string;body?:string;cta?:BannerCTA}|null;type VideoSource={src:string;type:"video/webm"|"video/mp4"};type BannerConfig={poster:string;videoSources?:ReadonlyArray<VideoSource>|null;overlay?:BannerOverlay;mobileObjectPositionClass?:string|null;heightClassName?:string|null;};//client-onlyherotoavoidSSRmediaevaluationconstHeroBanner=dynamic(()=>import("@/components/homepage/HeroBanner"),{ssr:false});/*â"€â"€eventsteasertypesâ"€â"€*/type ResourceLink={href:string;label:string};type EventResources={downloads?:ResourceLink[]|null;reads?:ResourceLink[]|null;};type EventsTeaserItem={slug:string;title:string;date:string;location:string|null;description?:string|null;tags?:string[]|null;heroImage?:string|null;resources?:EventResources|null;};type EventsTeaser=Array<EventsTeaserItem>;type HomeProps={posts:PostMeta[];booksCount:number;eventsTeaser:EventsTeaser};export defaultfunctionHome({posts,booksCount,eventsTeaser}:HomeProps){constrouter=useRouter();constincomingQ=typeofrouter.query.q==="string"?router.query.q.trim():"";constqSuffix=incomingQ?`?q=${encodeURIComponent(incomingQ)}`:"";constblogHref=`/blog?sort=newest${incomingQ?`&q=${encodeURIComponent(incomingQ)}`:""}`;constbooksHref=`/books${qSuffix}`;constpostsCount=posts.length;//Thisisnowthecountofthe*featured*posts(always3unlessthereare<3total)//FIXAPPLIEDHERE:Ensurerawisanobjectbyusingthenullishcoalescingoperator(??{})//ThispreventstheerrorifgetActiveBanner()returnsnullorundefined.constraw=React.useMemo<BannerConfig>(()=>(getActiveBanner()??{})asunknownasBannerConfig,[]);constbanner:Required<Pick<BannerConfig,"poster">>&Omit<BannerConfig,"poster">={poster:raw?.poster||"/assets/images/abraham-of-london-banner@2560.webp",videoSources:raw?.videoSources??([{src:"/assets/video/brand-reel-1080p.webm",type:"video/webm"},{src:"/assets/video/brand-reel-1080p.mp4",type:"video/mp4"},]asconst),overlay:raw?.overlay??null,mobileObjectPositionClass:raw?.mobileObjectPositionClass??"object-center",heightClassName:raw?.heightClassName??"min-h-[65svh]sm:min-h-[70svh]lg:min-h-[78svh]",};constoverlayNode:React.ReactNode=banner.overlay?(<>{banner.overlay.eyebrow&&(<span className="inline-blockrounded-fullborderborder-white/30bg-black/30px-3py-1text-[11px]uppercasetracking-[0.2em]">{banner.overlay.eyebrow}</span>)}{banner.overlay.title&&(<h1 className="mt-3font-seriftext-3xlsm:text-4xlmd:text-5xlfont-semiboldleading-tight">{banner.overlay.title}</h1>)}{banner.overlay.body&&(<p className="mt-3max-w-prosetext-smtext-[rgba(255,255,255,.85)]">{banner.overlay.body}</p>)}{banner.overlay.cta&&(<div className="mt-5"><Link href={banner.overlay.cta.href}className="rounded-fullbg-softGoldpx-5py-2text-smfont-semiboldtext-deepCharcoal"prefetch={false}>{banner.overlay.cta.label}</Link></div>)}</>):undefined;/*quicklistforhomepagedownloads*/constdownloads=React.useMemo(()=>[{href:"/downloads/brotherhood-covenant",title:"BrotherhoodCovenant(Printable)",sub:"A4/USLetter"},{href:"/downloads/leaders-cue-card",title:"Leader'sCueCard(A6,Two-Up)",sub:"Pocketreference"},{href:"/downloads/brotherhood-cue-card",title:"BrotherhoodCueCard"},],[]);return(<LayoutpageTitle="Home"hideCTA><Head d><metaname="description"content="Principledstrategy,writing,andventuresthatprioritisesignalovernoise.DiscreetChathamRoomsavailable—offtherecord."/><metaproperty="og:type"content="website"/>{/*LCPOptimization:Addfetchpriority="high"totheprimaryimagepreload*/}<linkrel="preload"as="image"href={banner.poster}fetchPriority="high"/>{banner.videoSources?.map((s,i)=>(<linkkey={i}rel="preload"as="video"href={s.src}type={s.type}/>))}</Head>{/*HERO*/}<HeroBannerposter={banner.poster}videoSources={banner.videoSources}overlay={overlayNode}mobileObjectPositi onClass="object-leftmd:object-[30%_center]lg:object-[40%_center]"heightClassName={banner.heightClassName}/>{/*Breadcrumb+quickcounts*/}<section className="border-bborder-lightGrey/70bg-warmWhite/60"><div className="mx-autoflexmax-w-7xlflex-wrapitems-centerjustify-betweengap-3px-4py-3text-sm"><nav aria-label="Breadcrumb"className="text-[color:var(--color-on-secondary)/0.7]"><ol className="flexitems-centergap-2"><li><Link href="/"className="hover:text-deepCharcoal"prefetch={false}>Home</Link></li><li aria-hidden>/</li><li className="text-[color:var(--color-on-secondary)/0.8]">Overview</li>{incomingQ&&(<><li aria-hidden>/</li><li className="text-[color:var(--color-on-secondary)/0.6]">"{incomingQ}"</li></>)}</ol></nav><div className="flexitems-centergap-3"><Link href={booksHref}className="rounded-fullborderborder-lightGreybg-whitepx-3py-1text-[color:var(--color-on-secondary)/0.85]hover:text-deepCharcoal"aria-label={`Viewbooks(${booksCount})`}prefetch={false}>Books<span className="ml-1text-[color:var(--color-on-secondary)/0.6]">({booksCount})</span></Link><Link href={blogHref}className="rounded-fullborderborder-lightGreybg-whitepx-3py-1text-[color:var(--color-on-secondary)/0.85]hover:text-deepCharcoal"aria-label={`Viewinsights(${postsCount})`}prefetch={false}>Insights<span className="ml-1text-[color:var(--color-on-secondary)/0.6]">({postsCount})</span></Link></div></div></section>{/*FeaturedInsights*/}<section className="bg-warmWhitepx-4py-16"><div className="mx-automax-w-7xl"><header className="mb-8flexitems-endjustify-between"><h2 className="font-seriftext-3xlfont-semiboldtext-deepCharcoal">FeaturedInsights</h2><Link href={blogHref}className="text-smfont-mediumtext-deepCharcoalunderlinedecoration-softGold/50underline-offset-4hover:decoration-softGold"prefetch={false}>Readtheblog</Link></header><div className="gridgap-8sm:grid-cols-2lg:grid-cols-3">{/*Usethealready-sliced'posts'prop*/}{posts.map((p)=>(<BlogPostCardkey={p.slug}slug={p.slug}title={p.title}//PropspasseddirectlyfromsafePosts,whichalreadyhandlesnull/undefineddate={p.date??undefined}excerpt={p.excerpt??undefined}coverImage={p.coverImage??undefined}author={p.author??undefined}readTime={p.readTime??undefined}category={p.category??undefined}tags={p.tags??undefined}coverAspect={(p.coverAspectasany)??"book"}coverFit={(p.coverFitasany)??(p.coverAspect==="book"?"contain":"cover")}coverPosition={(p.coverPositionasany)??"center"}/>))}</div></div></section>{/*FeaturedBooks*/}<section className="bg-whitepx-4py-16"><div className="mx-automax-w-7xl"><header className="mb-8flexitems-endjustify-between"><h2 className="font-seriftext-3xlfont-semiboldtext-deepCharcoal">FeaturedBooks</h2><Link href={booksHref}className="text-smfont-mediumtext-deepCharcoalunderlinedecoration-softGold/50underline-offset-4hover:decoration-softGold"prefetch={false}>Viewall</Link></header><div className="gridgap-8sm:grid-cols-2lg:grid-cols-3"><BookCardslug="fathering-without-fear"title="FatheringWithoutFear"author="AbrahamofLondon"excerpt="Aboldmemoirreclaimingfatherhood—clarity,discipline,andstandardsthatendure."genre="Memoir"featuredcoverImage="/assets/images/fathering-without-fear-teaser.jpg"/><BookCardslug="the-fiction-adaptation"title="TheFictionAdaptation"author="AbrahamofLondon"excerpt="Adramatizedreimaginingoflivedconviction—raw,luminous,andcinematic."genre="Drama"coverImage="/assets/images/fathering-without-fear.jpg"/></div></div></section>{/*Downloads—grid*/}<section className="bg-whitepx-4pb-4"><div className="mx-automax-w-7xl"><header className="mb-6"><h2 className="font-seriftext-2xlfont-semiboldtext-deepCharcoal">Downloads</h2><p className="mt-2text-smtext-[color:var(--color-on-secondary)/0.7]">Practicaltoolstohelpyouleadwithclarity.</p></header><DownloadsGriditems={downloads}columns={2}className="mt-2"/></div></section>{/*Events*/}<section className="bg-whitepx-4pb-4pt-2"><div className="mx-automax-w-7xl"><header className="mb-2flexitems-endjustify-between"><h2 className="font-seriftext-3xlfont-semiboldtext-deepCharcoal">UpcomingEvents</h2><Link href="/events"className="text-smfont-mediumtext-deepCharcoalunderlinedecoration-softGold/50underline-offset-4hover:decoration-softGold"prefetch={false}>Viewall</Link></header><p className="mb-6text-xstext-[color:var(--color-on-secondary)/0.6]">SelectsessionsrunasChathamRooms(offtherecord).</p><ul className="gridgap-6sm:grid-cols-2lg:grid-cols-3">{eventsTeaser.map((ev)=>(<likey={ev.slug}><EventCardslug={ev.slug}title={ev.title}date={ev.date}location={ev.location??undefined}description={ev.description??undefined}tags={ev.tags??undefined}heroImage={ev.heroImage??undefined}resources={//<--Thispropertystructureiscorrect.ev.resources?{downloads:ev.resources.downloads??undefined,reads:ev.resources.reads??undefined,}:undefined}/></li>))}</ul></div></section>{/*Ventures*/}<section className="bg-whitepx-4py-16"><div className="mx-automax-w-7xl"><header className="mb-8"><h2 className="font-seriftext-3xlfont-semiboldtext-deepCharcoal">Ventures</h2><p className="mt-2text-smtext-[color:var(--color-on-secondary)/0.7]">Aportfoliobuiltoncraftsmanship,stewardship,andendurance.</p></header><div className="gridgap-6md:grid-cols-3"><Link href="/ventures?bran d=alomarada"className="grouprounded-2xlborderborder-lightGreybg-whitep-6shadow-cardtransitionhover:shadow-cardHover"prefetch={false}><div className="flexitems-centerjustify-between"><p className="font-seriftext-xlfont-semiboldtext-deepCharcoal">Alomarada</p><span className="text-smtext-softGoldtransitiongroup-hover:translate-x-0.5">Exploreâ†'</span></div><p className="mt-3text-smleading-relaxedtext-[color:var(--color-on-secondary)/0.85]">Strategy&capital—focusedondurablebusinesseswithmoralclarityandoperationaldiscipline.</p></Link><Link href="/ventures?bran d=endureluxe"className="grouprounded-2xlborderborder-lightGreybg-whitep-6shadow-cardtransitionhover:shadow-cardHover"prefetch={false}><div className="flexitems-centerjustify-between"><p className="font-seriftext-xlfont-semiboldtext-deepCharcoal">Endureluxe</p><span className="text-smtext-softGoldtransitiongroup-hover:translate-x-0.5">Exploreâ†'</span></div><p className="mt-3text-smleading-relaxedtext-[color:var(--color-on-secondary)/0.85]">Essentialgoodsandrefinedexperiences—engineeredtolast,designedtoserve.</p></Link><Link href="/about"className="grouprounded-2xlborderborder-lightGreybg-whitep-6shadow-cardtransitionhover:shadow-cardHover"prefetch={false}><div className="flexitems-centerjustify-between"><p className="font-seriftext-xlfont-semiboldtext-deepCharcoal">AbrahamofLondon</p><span className="text-smtext-softGoldtransitiongroup-hover:translate-x-0.5">Exploreâ†'</span></div><p className="mt-3text-smleading-relaxedtext-[color:var(--color-on-secondary)/0.85]">Writing,counsel,andculturalworkattheintersectionoffamily,enterprise,andsociety.</p></Link></div></div></section>{/*ClosingCTA*/}<section className="relativeisolateoverflow-hiddenbg-deepCharcoal"><div className="absoluteinset-0-z-10"><Image src="/assets/images/cta/cta-bg.jpg"alt=""fill sizes="100vw"quality={85}className="object-coveropacity-20"priority={false}//SincethisisaclosingCTA,settofalse/></div><div className="mx-automax-w-7xlpx-4py-20text-center"><h3 className="font-seriftext-3xlfont-semiboldtext-cream">BuildwithClarity.LeadwithStandards.LeaveaLegacy.</h3><p className="mx-automt-4max-w-2xltext-smleading-relaxedtext-[color:var(--color-on-primary)/0.85]">Startaconversationthatmovesyourfamily,yourventure,andyourcommunityforward.</p><div className="mt-8"><Link href="/contact"className="rounded-fullbg-softGoldpx-7py-3text-smfont-semiboldtext-deepCharcoaltransitionhover:brightness-95"prefetch={false}>ConnectwithaStrategist</Link></div></div></section></Layout>);}Home.displayName="Home";/*â"€â"€SSG+ISRâ"€â"€*/export asyncfunctiongetStaticProps(){constallPosts=getAllPosts();//Optimization:Slicethearraytoonlyprocessandpassthe3featuredpostsconstlimitedPosts=allPosts.slice(0,3);//MapandsanitizeONLYthelimitedsetofpostsforserializationconstsafePosts=limitedPosts.map((p)=>({...p,excerpt:p.excerpt??null,date:p.date??null,coverImage:p.coverImage??null,readTime:p.readTime??null,category:p.category??null,author:p.author??null,tags:p.tags??null,coverAspect:p.coverAspect??null,coverFit:p.coverFit??null,coverPosition:p.coverPosition??null,}));constbooksCount=getAllBooks(["slug"]).length;type MinimalEvent={slug:string;title:string;date:string;location?:string;summary?:string;tags?:string[]};//Requestthe'resources'fieldconstrawEvents=awaitgetAllEvents(["slug","title","date","location","summary","tags","resources"]);//Maptheraweventsintoadeduplicatedstructure,includingresourcesconstdedupe d=dedupeEventsByTitleAndDay(rawEvents.filter((e):eisMinimalEvent=>Boolean((easany)?.slug&&(easany)?.title&&(easany)?.date)).map((e:any)=>({slug:String(e.slug),title:String(e.title),date:String(e.date),location:e.location??null,summary:e.summary??null,tags:Array.isArray(e.tags)?e.tags:null,//Includetherawresourcesobjecthere,whichcontainsthearrayoflinksresources:e.resources??null,})));consttodayKey=newIntl.DateTimeFormat("en-CA",{timeZone:"Europe/London",year:"numeric",month:"2-digit",day:"2-digit",}).format(newDate());constupcomingSorte d=deduped.filter((e)=>{constonly=/^\d{4}-\d{2}-\d{2}$/.test(e.date);if(only)returne.date>=todayKey;const d=newDate(e.date);if(Number.isNaN(d.valueOf()))returnfalse;constkey=newIntl.DateTimeFormat("en-CA",{timeZone:"Europe/London",year:"numeric",month:"2-digit",day:"2-digit",}).format(d);returnkey>=todayKey;}).sort((a,b)=>+newDate(a.date)-+newDate(b.date));//ðŸ‘‡CORRECTEDLOGIC:Use'e.resources'directlyfromthededupedeventobject.consteventsTeaser:EventsTeaser=upcomingSorted.slice(0,3).map((e:any)=>{constbaseForImage=String(e.slug).replace(/[–—].*$/,"");constheroImage=`/assets/images/events/${baseForImage}.jpg`;//e.resourcesnowholdsthearrayofResourceLinkobjects(ornull)because//itwasincludedinthemapinsidethe'deduped'variableconstructionabove.constresources=(e.resources??null)asEventResources|null;constsafeResources=resources?{//Usenullishcoalescingtoconvertanynested'undefined'propertiesto'null'downloads:resources.downloads??null,reads:resources.reads??null,}:null;return{slug:e.slug,title:e.title,date:e.date,location:e.location??null,description:e.summary??null,tags:Array.isArray(e.tags)?e.tags:null,heroImage,resources:safeResources,//NowpassesthestructureexpectedbyEventCard};});//Note:postsCountinthecomponentwillreflectthelengthofsafePosts(max3)return{props:{posts:safePosts,booksCount,eventsTeaser},revalidate:3600};}
